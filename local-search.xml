<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>2022ç¬¬äº”å±Š&quot;å¼ºç½‘&quot;æ‹Ÿæ€</title>
    <link href="/2022/11/07/2022QW%E6%8B%9F%E6%80%81/"/>
    <url>/2022/11/07/2022QW%E6%8B%9F%E6%80%81/</url>
    
    <content type="html"><![CDATA[<blockquote><p>é¢˜ç›®å¤§å¤šæ˜¯è°ƒè¯•+æ±‡ç¼–ï¼Œè€ƒç‚¹æ¶‰åŠollvmã€goã€vehã€callã€vmã€‚</p></blockquote><p>æœ‰ç‚¹<span class="github-emoji"><span>ğŸ˜¡</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f621.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><span class="github-emoji"><span>ğŸ˜¡</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f621.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><span class="github-emoji"><span>ğŸ˜¡</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f621.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>, babyreè¿™é¢˜å…¶å®æ²¡å•¥é€†å‘ä¸Šçš„éš¾åº¦ï¼Œæ— éåœ¨tlsæ³¨å†Œå¡äº†åè°ƒè¯•ï¼Œä¸»è¦æ˜¯é™¤æ³•å¼‚å¸¸è°ƒç”¨vehçš„å¤„ç†å‡½æ•°æ¥ä¿®æ”¹aesçš„sç›’ï¼Œaesçš„ç®—æ³•å®ç°éƒ¨åˆ†æ˜¯4ä¸ªè¿ç»­å­—èŠ‚ä¸ºä¸€è¡Œè€Œä¸æ˜¯ä¸€åˆ—ï¼Œç±»ä¼¼ä¸€ä¸ªè½¬ç½®æ“ä½œã€‚ä¸€æ—¶å…´èµ·æ‰‹æ’¸AESï¼Œè°ƒè¯•è½®ç§˜é’¥æ¥è§£å¯†ï¼Œåº”è¯¥æ˜¯ç¬¬4è§£ã€‚</p><p>ç„¶è€Œï¼Œèµ›åå®¢æœæ‰¾æˆ‘??? è¯´æˆ‘py??? flagæ³„éœ²ï¼Œå½“æ—¶<span class="github-emoji"><span>ğŸ­</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f42d.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><span class="github-emoji"><span>ğŸ­</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f42d.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>å°±æƒŠäº†ï¼Œè¿aeséƒ½æ˜¯ä¸€å­—å­—ç çš„ä½•æ¥pyä¸€è¯´ï¼Œéƒ½æ²¡å’Œåˆ«äººäº¤æµæ€ä¹ˆæ³„éœ²ã€‚äºæ˜¯æ‰¾äº†å®¢æœç»™çš„ç–‘ä¼¼äº¤æˆ‘flagçš„é˜Ÿä¼çš„å¸ˆå‚…è¯¢é—®ï¼Œå¸ˆå‚…ä¹Ÿå¾ˆæ‡µé€¼â€¦ä½†æ˜¯ä»–ç›´æ¥é—®æˆ‘é™„ä»¶æ˜¯ä¸æ˜¯babyre5ï¼Œæˆ‘åˆä¸‹é™„ä»¶ç¡®è®¤ï¼Œç¡®å®æ˜¯ã€‚è€Œä»–ä»¬é‚£è¾¹ä¹Ÿæ˜¯babyre5ï¼Œè€Œåˆ«çš„é˜Ÿåˆ™æ˜¯å…¶ä»–babyrexxï¼Œåˆç€åŠ¨æ€é™„ä»¶æ”¹äº†zipçš„åï¼Œå†…å®¹ä¸€è‡´ã€‚</p><p>â€¦å®¢æœä¹Ÿæ˜¯è€å¿ƒå¬äº†æˆ‘çš„æè¿°ï¼Œå¹¶ç¡®å®å•†è®¨ä¹‹åç»™å‡ºç­”å¤ï¼Œå¯¹äº‹ä¸å¯¹äººï¼Œæ²¡å•¥æ¶æ„ï¼Œ<span class="github-emoji"><span>ğŸ­</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f42d.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><span class="github-emoji"><span>ğŸ­</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f42d.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>çš„å«å£°è¿˜çœŸæ˜¯å¯è€å‘¢~ã€‚åªæ˜¯å¸Œæœ›é˜Ÿå‹çš„åŠªåŠ›ä¸èƒ½å› ä¸ºå‡­ç©ºè€Œæ¥çš„ç¢°æ’è€Œè¢«æ‘§æ¯ï¼Œå¥½ä¸å®¹æ˜“æœ‰èµ·è‰²çš„æˆ˜é˜Ÿå†æ¬¡è¿›å…¥ä½è°·ã€‚</p><blockquote><p><span class="github-emoji"><span>ğŸ˜ƒ</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f603.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><span class="github-emoji"><span>ğŸ˜ƒ</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f603.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><span class="github-emoji"><span>ğŸ˜ƒ</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f603.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> å¦ï¼Œä¸¤ä¸ªæ¯«ä¸ç›¸å¹²çš„zipéƒ½èƒ½ç¢°æ’ï¼Œ<span class="github-emoji"><span>ğŸ­</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f42d.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><span class="github-emoji"><span>ğŸ­</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f42d.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>æˆ‘å‘€ï¼Œå’‹æ²¡ä¸ªå­¦reçš„å°å§å§å¸¦æˆ‘å‘¢~</p></blockquote><h2 id="Crypto">Crypto</h2><h3 id="WeakRandom">WeakRandom</h3><blockquote><p>ä¸€å…ƒéšæœºæ•°ç”Ÿæˆï¼Œè¾“å‡ºçš„éšæœºæ•°ä¼šæ³„éœ²16bitçš„xçš„ä¿¡æ¯ï¼Œå¹¶ä¸”é«˜16bitä¹Ÿä¸xæœ‰å…³ï¼Œå› ä¸ºé™åˆ¶æ—¶é™æ¯”è¾ƒé•¿ï¼Œå€ŸåŠ©é«˜16bitç›´æ¥çˆ†ç ´å³å¯ã€‚</p></blockquote><figure class="highlight python"><table><tbody><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">next</span>(<span class="hljs-params">self</span>):</span><br>    x = <span class="hljs-built_in">int</span>((self.x ** <span class="hljs-number">2</span>) // (<span class="hljs-number">10</span> ** (self.s // <span class="hljs-number">2</span>))) % self.n<br>    self.x = x<br>    high = (<span class="hljs-built_in">int</span>(hashlib.sha256(<span class="hljs-built_in">str</span>(x).encode()).hexdigest(),<span class="hljs-number">16</span>) &gt;&gt; <span class="hljs-number">16</span>) &amp; (<span class="hljs-number">2</span> ** <span class="hljs-number">16</span> - <span class="hljs-number">1</span>)<br>    low = x &amp; (<span class="hljs-number">2</span> ** <span class="hljs-number">16</span> - <span class="hljs-number">1</span>)<br>    result = high &lt;&lt; <span class="hljs-number">16</span> | low<br>    <span class="hljs-keyword">return</span> result<br></code></pre></td></tr></tbody></table></figure><p>å¯è§è¾“å‡ºéšæœºæ•°ä¸­çš„ä½16bitå³xä¸­çš„ä½16bitï¼Œè€Œå…¶é«˜16bitæ˜¯å¯¹xè¿›è¡Œhashç­‰è¿ç®—ï¼Œé‚£ä¹ˆç›´æ¥çˆ†ç ´é«˜16bitï¼ŒåšåŒæ ·çš„hashè¿ç®—å†ä¸éšæœºæ•°ä¸­çš„é«˜16bitè¿›è¡Œæ¯”å¯¹å³å¯æ¢å¤xï¼Œä¹‹åå°±å¯ä»¥æ­£å¸¸é¢„æµ‹ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> time <span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> sha256<br><span class="hljs-keyword">from</span> mycrypto.retool <span class="hljs-keyword">import</span> pfw<br>guess=<span class="hljs-number">0</span><br>myx=<span class="hljs-number">0</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getx</span>(<span class="hljs-params">xx:<span class="hljs-built_in">int</span></span>):</span><br>    <span class="hljs-keyword">global</span> guess,myx<br>    low=xx&amp;<span class="hljs-number">0xffff</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0xffff</span>):<br>        tt=i&lt;&lt;<span class="hljs-number">16</span>|low<br>        ans=(<span class="hljs-built_in">int</span>(hashlib.sha256(<span class="hljs-built_in">str</span>(tt).encode()).hexdigest(), <span class="hljs-number">16</span>) &gt;&gt; <span class="hljs-number">16</span>) &amp; (<span class="hljs-number">2</span> ** <span class="hljs-number">16</span> - <span class="hljs-number">1</span>)<br>        <span class="hljs-keyword">if</span> ans==xx&gt;&gt;<span class="hljs-number">16</span>:<br>            guess=<span class="hljs-number">1</span><br>            myx=tt<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">'get get x'</span>)<br>            <span class="hljs-keyword">return</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_num</span>():</span><br>    <span class="hljs-keyword">global</span> myx<br>    x = <span class="hljs-built_in">int</span>((myx ** <span class="hljs-number">2</span>) // (<span class="hljs-number">10</span> ** <span class="hljs-number">2</span>)) % <span class="hljs-number">10000000000</span><br>    myx = x<br>    high = (<span class="hljs-built_in">int</span>(sha256(<span class="hljs-built_in">str</span>(myx).encode()).hexdigest(), <span class="hljs-number">16</span>) &gt;&gt; <span class="hljs-number">16</span>) &amp; (<span class="hljs-number">2</span> ** <span class="hljs-number">16</span> - <span class="hljs-number">1</span>)<br>    low = x &amp; (<span class="hljs-number">2</span> ** <span class="hljs-number">16</span> - <span class="hljs-number">1</span>)<br>    result = high &lt;&lt; <span class="hljs-number">16</span> | low<br>    <span class="hljs-keyword">return</span> result<br><br>r=remote(<span class="hljs-string">'172.51.60.200'</span>,<span class="hljs-number">9998</span>)<br>p=r.recvline().strip()<br>p=p.split(<span class="hljs-string">b' == '</span>)<br>m=p[<span class="hljs-number">0</span>][<span class="hljs-number">12</span>:-<span class="hljs-number">1</span>].decode()<br>t=p[<span class="hljs-number">1</span>].decode()<br>ans=pfw(m,<span class="hljs-number">4</span>,t).encode()<br>r.recvuntil(<span class="hljs-string">b'Give me XXXX:'</span>)<br>r.sendline(ans)<br>r.recvuntil(<span class="hljs-string">b'predict game!'</span>)<br>cnt=<span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>):<br>    r.recvuntil(<span class="hljs-string">b'Please your guess :'</span>)<br>    <span class="hljs-keyword">if</span> guess==<span class="hljs-number">0</span>:<br>        r.sendline(<span class="hljs-string">b'0'</span>)<br>    <span class="hljs-keyword">else</span>:<br>        r.sendline(<span class="hljs-built_in">str</span>(get_num()).encode())<br>    p=r.recvline().strip()<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">b'Success!'</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> p:<br>        num=<span class="hljs-built_in">int</span>(p.split(<span class="hljs-string">b'is '</span>)[-<span class="hljs-number">1</span>])<br>        <span class="hljs-keyword">if</span> guess==<span class="hljs-number">0</span>:<br>            getx(num)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">'=.='</span>)<br>    <span class="hljs-keyword">else</span>:<br>        cnt+=<span class="hljs-number">1</span><br>        <span class="hljs-built_in">print</span>(cnt)<br>r.interactive()<br>r.close()<br><span class="hljs-comment"># é™åˆ¶çš„æ—¶é—´å¤ªé•¿äº†ï¼Œç›´æ¥çˆ†ç ´2å­—èŠ‚å³å¯æ¢å¤çŠ¶æ€</span><br></code></pre></td></tr></tbody></table></figure><h2 id="Misc">Misc</h2><h3 id="babymisc">babymisc</h3><blockquote><p>ç»å…¸äºŒåˆ†ï¼Œé“¶è¡Œå¡å¯†6ä½æ•°ï¼Œåœ¨lostå‰èƒ½çŒœ13/14æ¬¡ä¹Ÿå°±2^13å†…çš„æ•°æ®å¯ä»¥æ‰¾ï¼Œç›´æ¥è½¬ä¸ºæ¦‚ç‡é—®é¢˜ï¼Œå¤šæ¬¡äº¤äº’é™å®šåœ¨å°èŒƒå›´å†…äºŒåˆ†å³å¯ã€‚</p></blockquote><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>e=<span class="hljs-number">0</span><br><br><span class="hljs-keyword">while</span> e==<span class="hljs-number">0</span>:<br>  <span class="hljs-built_in">min</span> = <span class="hljs-number">480000</span><br>  num = <span class="hljs-number">0</span><br>  <span class="hljs-built_in">max</span> = <span class="hljs-built_in">min</span>+<span class="hljs-number">2</span>**<span class="hljs-number">12</span><br>  r = remote(<span class="hljs-string">'172.51.60.153'</span>, <span class="hljs-number">9999</span>)<br>  r.recvuntil(<span class="hljs-string">b'&gt;'</span>)<br>  r.sendline(<span class="hljs-string">b'Y'</span>)<br>  <span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>    r.recvuntil(<span class="hljs-string">b'Please enter a number:'</span>)<br>    r.sendline(<span class="hljs-built_in">str</span>(num).encode())<br>    p=r.recvline().strip()<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">b'low'</span> <span class="hljs-keyword">in</span> p:<br>        <span class="hljs-built_in">min</span>=num<br>        num=(<span class="hljs-built_in">max</span>+num)//<span class="hljs-number">2</span><br>        <span class="hljs-built_in">print</span>(p)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">"min:%d max:%d num:%d"</span>%(<span class="hljs-built_in">min</span>,<span class="hljs-built_in">max</span>,num))<br><br>    <span class="hljs-keyword">elif</span> <span class="hljs-string">b'up'</span> <span class="hljs-keyword">in</span> p:<br>        <span class="hljs-built_in">print</span>(p)<br>        <span class="hljs-built_in">max</span>=num<br>        num=(<span class="hljs-built_in">min</span>+num)//<span class="hljs-number">2</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">"min:%d max:%d num:%d"</span>%(<span class="hljs-built_in">min</span>, <span class="hljs-built_in">max</span>, num))<br>    <span class="hljs-keyword">else</span> :<br>        <span class="hljs-built_in">print</span>(p)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">b'You lost'</span> <span class="hljs-keyword">in</span> p:<br>            r.close()<br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(r.recvline())<br>            <span class="hljs-built_in">print</span>(r.recvline())<br>            <span class="hljs-built_in">print</span>(r.recvline())<br>            e=<span class="hljs-number">1</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">'********************************************************'</span>)<br>            <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">if</span> e==<span class="hljs-number">1</span>:<br>        r.interactive()<br>        <span class="hljs-keyword">break</span><br><br><span class="hljs-string">"""</span><br><span class="hljs-string">b'Bingo'</span><br><span class="hljs-string">b'Time use:1.13second\n'</span><br><span class="hljs-string">b"To thank you, I'll give you the flag\n"</span><br><span class="hljs-string">b'flag{NTbkIYgC4ZxeAZJohoeP0Xi2ubrgQUKH}\n'</span><br><span class="hljs-string">"""</span><br></code></pre></td></tr></tbody></table></figure><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221106175215920.png" alt="image-20221106175215920"></p><h2 id="Re">Re</h2><h3 id="comeongo">comeongo</h3><blockquote><p>goè¯­è¨€é€†å‘ï¼Œå°†usernameå’Œpasswdåˆ‡ç‰‡ç»„åˆè¿›è¡ŒåŠ å¯†ï¼Œåœ¨mian_check1ã€main_check2ä¸­è¿›è¡Œcheckï¼Œè®¾è®¡åŠ å¯†base58ã€base64ã€ç§»ä½å’Œæ–¹ç¨‹ç»„ã€‚</p></blockquote><p>è¦æ±‚è¾“å…¥çš„usernameå’Œpasswdå‡ä¸º16å­—èŠ‚ï¼Œmain_check1æ˜¯æ­£å¸¸çš„base58åŠ å¯†</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221106162733131.png" alt="image-20221106162733131"></p><p>cyberchefè§£å‡ºGoM0bi13G3tItEzFï¼Œé€šè¿‡åˆ‡ç‰‡çš„é€»è¾‘å¾—çŸ¥è¯¥éƒ¨åˆ†ä¸ºusernameå’Œpasswdçš„å‰8ä¸ªå­—èŠ‚ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221106163659228.png" alt="image-20221106163659228"></p><p>maincheck2å°†usernameå’Œpasswdçš„å8ä¸ªå­—èŠ‚å†åˆ†æˆ4å­—èŠ‚ä¸€ç»„ï¼Œæ¯æ¬¡åŠ å¯†ä¸€ç»„(4å­—èŠ‚nameã€4å­—èŠ‚passwd)ï¼Œç¬¬ä¸€æ®µæœ€åä¼šæœ‰base64åŠ å¯†ï¼Œå¯¹X051YmNmRnE=è§£å¯†åå¾—_NubcfFqï¼Œåœ¨base64å‰è¿˜æœ‰ä¸€éƒ¨åˆ†ç§»ä½åŠ å¯†ã€‚æµ‹è¯•è¾“å…¥ä¸º<code>bxs</code>æ—¶ä¼šè¾“å‡º<code>nlg</code>æ»¡è¶³12ç§»ä½ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">k=<span class="hljs-string">b'nlg'</span><br>s=<span class="hljs-string">b'bxs'</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):<br>    <span class="hljs-keyword">if</span> s[i]&gt;<span class="hljs-number">96</span> <span class="hljs-keyword">and</span> s[i]&lt;<span class="hljs-number">123</span>:<br>        <span class="hljs-keyword">if</span> s[i]-<span class="hljs-number">97</span>+<span class="hljs-number">12</span>&lt;<span class="hljs-number">26</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(((s[i]-<span class="hljs-number">97</span>+<span class="hljs-number">12</span>)%<span class="hljs-number">26</span>)+<span class="hljs-number">97</span>),end=<span class="hljs-string">''</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(((s[i] - <span class="hljs-number">97</span> -<span class="hljs-number">12</span> +<span class="hljs-number">26</span>) % <span class="hljs-number">26</span>) + <span class="hljs-number">97</span>),end=<span class="hljs-string">''</span>)<br><span class="hljs-built_in">print</span>()<br></code></pre></td></tr></tbody></table></figure><p>æ‰€ä»¥å¯¹<code>_NubcfFq</code>è¿›è¡Œç§»ä½è§£å¯†å¾—åˆ°<code>_BinorRe</code>ï¼Œä¹‹åä½¿ç”¨<code>main_encryptBytes</code>å‡½æ•°åŠ å¯†æœ€åä¸€ç»„ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221106165122015.png" alt="image-20221106165122015"></p><p>æŠŠä¸¤éƒ¨åˆ†çš„å€¼é€å­—èŠ‚ç›¸åŠ èµ·æ¥ï¼Œå¹¶ä¸”ä¼šæŠŠå¯†ç é‚£éƒ¨åˆ†çš„å‰ä¸¤ä¸ªå­—èŠ‚æ”¹ä¸ºvGï¼Œè¿™æ ·èƒ½ä¿è¯å‰ä¸¤ä¸ªå­—èŠ‚æ˜¯å¯ä»¥ç¡®å®šçš„ã€‚ä¹‹ååœ¨main_runtime_otherä¸­ä¼šé™åˆ¶åä¸¤ä¸ªå­—èŠ‚çš„å·®å€¼åˆ†åˆ«ä¸º0x3få’Œ0x1fï¼Œè§£æ–¹ç¨‹å³å¯æ¢å¤ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221106165831028.png" alt="image-20221106165831028"></p><blockquote><p>goçš„åç¼–è¯‘è¿™å—è¿˜æ˜¯æœ‰æ‰€æ¬ ç¼ºï¼Œå…³é”®æ˜¯ç´§è·Ÿè¾“å…¥çš„å˜åŒ–æ¥æ±‚è§£ã€‚</p></blockquote><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> md5<br>n=<span class="hljs-string">'GoM0bi13ABabef12'</span><br>s=<span class="hljs-string">'G3tItEzF_bxs2345'</span><br><br>k=<span class="hljs-string">b'nlg'</span><br>s=<span class="hljs-string">b'bxs'</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):<br>    <span class="hljs-keyword">if</span> s[i]&gt;<span class="hljs-number">96</span> <span class="hljs-keyword">and</span> s[i]&lt;<span class="hljs-number">123</span>:<br>        <span class="hljs-keyword">if</span> s[i]-<span class="hljs-number">97</span>+<span class="hljs-number">12</span>&lt;<span class="hljs-number">26</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(((s[i]-<span class="hljs-number">97</span>+<span class="hljs-number">12</span>)%<span class="hljs-number">26</span>)+<span class="hljs-number">97</span>),end=<span class="hljs-string">''</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(((s[i] - <span class="hljs-number">97</span> -<span class="hljs-number">12</span> +<span class="hljs-number">26</span>) % <span class="hljs-number">26</span>) + <span class="hljs-number">97</span>),end=<span class="hljs-string">''</span>)<br><span class="hljs-built_in">print</span>()<br>s=<span class="hljs-string">b'ubcf'</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(s)):<br>    <span class="hljs-keyword">if</span> s[i]&gt;<span class="hljs-number">96</span> <span class="hljs-keyword">and</span> s[i]&lt;<span class="hljs-number">123</span>:<br>        <span class="hljs-keyword">if</span> s[i]-<span class="hljs-number">97</span>&gt;=<span class="hljs-number">12</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(((s[i]-<span class="hljs-number">97</span>-<span class="hljs-number">12</span>)%<span class="hljs-number">26</span>)+<span class="hljs-number">97</span>),end=<span class="hljs-string">''</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(((s[i] - <span class="hljs-number">97</span> +<span class="hljs-number">12</span> +<span class="hljs-number">26</span>) % <span class="hljs-number">26</span>) + <span class="hljs-number">97</span>),end=<span class="hljs-string">''</span>)<br><span class="hljs-built_in">print</span>()<br>C=<span class="hljs-string">'_NubcfFq'</span><br><span class="hljs-comment"># _BinorRe</span><br><br>n=<span class="hljs-string">'GoM0bi13_BingGo@'</span><br>s=<span class="hljs-string">'G3tItEzForRevG0!'</span><br><br>a=<span class="hljs-string">b'gG@!'</span><br>b=<span class="hljs-string">b'vG_@'</span><br>cc=[<span class="hljs-number">0xDD</span>, <span class="hljs-number">0x8F</span>, <span class="hljs-number">0xA1</span>, <span class="hljs-number">0x64</span>]<br><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>((<span class="hljs-number">0xa1</span>+<span class="hljs-number">0x3f</span>-<span class="hljs-number">2</span>)//<span class="hljs-number">2</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>((<span class="hljs-number">0xa1</span>+<span class="hljs-number">0x3f</span>-<span class="hljs-number">2</span>)//<span class="hljs-number">2</span>-<span class="hljs-number">0x3f</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>((<span class="hljs-number">0x64</span>+<span class="hljs-number">0x1f</span>-<span class="hljs-number">3</span>)//<span class="hljs-number">2</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>((<span class="hljs-number">0x64</span>+<span class="hljs-number">0x1f</span>-<span class="hljs-number">3</span>)//<span class="hljs-number">2</span> - <span class="hljs-number">0x1f</span>))<br>n=<span class="hljs-string">'GoM0bi13_BingGo@'</span><br>s=<span class="hljs-string">'G3tItEzForRevG0!'</span><br><span class="hljs-built_in">print</span>(md5((<span class="hljs-string">'flag{'</span>+n+s+<span class="hljs-string">'}'</span>).encode()).hexdigest())<br></code></pre></td></tr></tbody></table></figure><h3 id="mcmc">mcmc</h3><blockquote><p>ä¸»è¦æ˜¯æ§åˆ¶æµå¹³å¦åŒ–å’Œè™šå‡æ§åˆ¶æµæ··æ·†ï¼Œç”¨D810æ’ä»¶å¯ä»¥è¿˜åŸå¤§éƒ¨åˆ†é€»è¾‘ï¼Œå¹¶ä¸”éƒ¨åˆ†åŠ å¯†çš„åŸºæœ¬å—éƒ½æ¯”è¾ƒå¤§ä¸”æ˜æ˜¾ï¼Œç›´æ¥çœ‹æ±‡ç¼–è¿˜åŸé€»è¾‘å³å¯ã€‚</p></blockquote><p>åŠ å¯†çš„ä¸»è¦é€»è¾‘å¦‚ä¸‹</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221105212557046.png" alt="image-20221105212557046"></p><p>è¾“å…¥32å­—èŠ‚ï¼Œå¼‚æˆ–äº†éƒ¨åˆ†ï¼Œå¹¶æ¯æ¬¡4ä¸ªdwordç±»å‹è¿›è¡Œçº¿æ€§è¿ç®—ï¼Œsub_405480å‡½æ•°åæ··æ·†ä¸æ˜¯å¤ªå¥½ï¼Œä½†æ˜¯å…¶åŠ å¯†çš„åŸºæœ¬å—å¾ˆå¤§ï¼Œç›´æ¥è°ƒè¯•è·Ÿæ±‡ç¼–å³å¯è¿˜åŸé€»è¾‘ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221105212933137.png" alt="image-20221105212933137"></p><p>è¿˜åŸçš„åŠ å¯†ç®—æ³•å¦‚ä¸‹,å¯¹4å—è¿›è¡Œçº¿æ€§è¿ç®—ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">encry</span>(<span class="hljs-params">s:<span class="hljs-built_in">list</span></span>):</span><br>    c=[<span class="hljs-number">0</span>]*<span class="hljs-number">4</span>                                <br>    c[<span class="hljs-number">0</span>]=<span class="hljs-number">2</span>*s[<span class="hljs-number">0</span>]+s[<span class="hljs-number">1</span>]-s[<span class="hljs-number">2</span>]+s[<span class="hljs-number">3</span>]<br>    c[<span class="hljs-number">1</span>]=s[<span class="hljs-number">0</span>]+s[<span class="hljs-number">1</span>]+s[<span class="hljs-number">2</span>]-s[<span class="hljs-number">3</span>]<br>    c[<span class="hljs-number">2</span>]=s[<span class="hljs-number">0</span>]-s[<span class="hljs-number">1</span>]+s[<span class="hljs-number">2</span>]-s[<span class="hljs-number">3</span>]<br>    c[<span class="hljs-number">3</span>]=s[<span class="hljs-number">0</span>]+<span class="hljs-number">2</span>*s[<span class="hljs-number">1</span>]-s[<span class="hljs-number">2</span>]+<span class="hljs-number">2</span>*s[<span class="hljs-number">3</span>]<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>        c[i]&amp;=<span class="hljs-number">0xffffffff</span><br>    <span class="hljs-keyword">return</span> c<br></code></pre></td></tr></tbody></table></figure><p>ä¹‹åçš„ sub_4011A0å‡½æ•°æ˜¯salsa20åŠ å¯†çš„ç§˜é’¥åˆå§‹åŒ–ï¼Œæ ¹æ®findcryptè¯†åˆ«å‡ºçš„<code>expand 32-byte k</code>å¯åˆ¤æ–­ï¼Œè€Œç§˜é’¥å’Œéšæœºæ•°éƒ½æ˜¯åœ¨<code>init_array</code>ç³»åˆ—å‡½æ•°ä¸­è·å–çš„ï¼Œå› ä½salsa20ä¸ºæµå¯†ç ï¼Œæ‰€ä»¥ä¸»è¦å®šä½åˆ°åŠ å¯†çš„å¼‚æˆ–ï¼Œåœ¨sub_401820å‡½æ•°ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221105213538149.png" alt="image-20221105213538149"></p><p>v7ä»…ä¸æµç§˜é’¥ç›¸å…³ï¼Œä¹‹åæ ¹æ®içš„å¥‡å¶æƒ…å†µç”Ÿæˆä¸åŒçš„v4ï¼Œä¹‹åæ˜¯å°†æ˜æ–‡ä¸v4+v7è¿›è¡Œå¼‚æˆ–ï¼Œv7å¯ä»¥é€šè¿‡è°ƒè¯•è·å–ï¼Œæ¯”å¯¹çš„å¯†æ–‡å¯ä»¥æŸ¥çœ‹<code>.data</code>æ®µçš„æ•°æ®ï¼Œå‘ç°æœ‰32å­—èŠ‚çš„æ•°ç»„ï¼Œå¹¶ä¸”å¯¹å…¶äº¤å‰å¼•ç”¨å‡ºç°åœ¨äº†ä¸sæ¯”å¯¹çš„ä»£ç é™„è¿‘ï¼Œå¹¶ä¸”åœ¨salsa20åŠ å¯†ä¹‹åå¯†æ–‡sæ²¡æœ‰å†å˜åŒ–ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221105214203909.png" alt="image-20221105214203909"></p><p>è§£å¯†è„šæœ¬å’Œæµ‹è¯•æ•°æ®å¦‚ä¸‹</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">def <span class="hljs-title">encry</span><span class="hljs-params">(s:<span class="hljs-built_in">list</span>)</span>:</span><br><span class="hljs-function">    c</span>=[<span class="hljs-number">0</span>]*<span class="hljs-number">4</span>                                 #ç¡¬çœ‹æ±‡ç¼–<br>    c[<span class="hljs-number">0</span>]=<span class="hljs-number">2</span>*s[<span class="hljs-number">0</span>]+s[<span class="hljs-number">1</span>]-s[<span class="hljs-number">2</span>]+s[<span class="hljs-number">3</span>]<br>    c[<span class="hljs-number">1</span>]=s[<span class="hljs-number">0</span>]+s[<span class="hljs-number">1</span>]+s[<span class="hljs-number">2</span>]-s[<span class="hljs-number">3</span>]<br>    c[<span class="hljs-number">2</span>]=s[<span class="hljs-number">0</span>]-s[<span class="hljs-number">1</span>]+s[<span class="hljs-number">2</span>]-s[<span class="hljs-number">3</span>]<br>    c[<span class="hljs-number">3</span>]=s[<span class="hljs-number">0</span>]+<span class="hljs-number">2</span>*s[<span class="hljs-number">1</span>]-s[<span class="hljs-number">2</span>]+<span class="hljs-number">2</span>*s[<span class="hljs-number">3</span>]<br>    <span class="hljs-keyword">for</span> i in range(<span class="hljs-number">4</span>):<br>        c[i]&amp;=<span class="hljs-number">0xffffffff</span><br>    <span class="hljs-keyword">return</span> c<br><br>cc=encry([<span class="hljs-number">0x61616161</span>,<span class="hljs-number">0x3A616161</span>,<span class="hljs-number">0x61616161</span>,<span class="hljs-number">0x3B616161</span>])<br><br><span class="hljs-meta">#aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</span><br>t1=[<span class="hljs-number">0x23</span>, <span class="hljs-number">0x24</span>, <span class="hljs-number">0x24</span>, <span class="hljs-number">0xC9</span>, <span class="hljs-number">0xC2</span>, <span class="hljs-number">0xC2</span>, <span class="hljs-number">0xC2</span>, <span class="hljs-number">0xA5</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x5B</span>, <span class="hljs-number">0x84</span>, <span class="hljs-number">0x85</span>, <span class="hljs-number">0x85</span>, <span class="hljs-number">0xCF</span>, <span class="hljs-number">0x23</span>, <span class="hljs-number">0x24</span>, <span class="hljs-number">0x24</span>, <span class="hljs-number">0xD7</span>, <span class="hljs-number">0xC2</span>, <span class="hljs-number">0xC2</span>, <span class="hljs-number">0xC2</span>, <span class="hljs-number">0xC1</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x4D</span>, <span class="hljs-number">0x84</span>, <span class="hljs-number">0x85</span>, <span class="hljs-number">0x85</span>, <span class="hljs-number">0xEB</span>]<br>c1=[<span class="hljs-number">0xD4</span>, <span class="hljs-number">0xCB</span>, <span class="hljs-number">0xB1</span>, <span class="hljs-number">0xE7</span>, <span class="hljs-number">0x73</span>, <span class="hljs-number">0xEE</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0x93</span>, <span class="hljs-number">0xA0</span>, <span class="hljs-number">0x7B</span>, <span class="hljs-number">0x3D</span>, <span class="hljs-number">0x1F</span>, <span class="hljs-number">0x04</span>, <span class="hljs-number">0x96</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0xDE</span>, <span class="hljs-number">0xCC</span>, <span class="hljs-number">0x1B</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x68</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0x51</span>, <span class="hljs-number">0x3D</span>, <span class="hljs-number">0xE8</span>, <span class="hljs-number">0x0C</span>, <span class="hljs-number">0xFC</span>, <span class="hljs-number">0xEF</span>, <span class="hljs-number">0x7A</span>, <span class="hljs-number">0x9D</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0x97</span>, <span class="hljs-number">0x59</span>]<br><br>kstr=[ t1[i]^c1[i] <span class="hljs-keyword">for</span> i in range(<span class="hljs-number">32</span>)]<br><span class="hljs-keyword">for</span> i in range(<span class="hljs-number">32</span>):<br>    <span class="hljs-keyword">if</span> i&amp;<span class="hljs-number">1</span>:<br>        kstr[i]-=c1[(i<span class="hljs-number">-1</span>+<span class="hljs-number">32</span>)%<span class="hljs-number">32</span>]<br>    <span class="hljs-keyword">else</span>:<br>        kstr[i]-=t1[(i+<span class="hljs-number">1</span>)%<span class="hljs-number">32</span>]<br>kstr=[(i+<span class="hljs-number">256</span>)%<span class="hljs-number">256</span> <span class="hljs-keyword">for</span> i in kstr]<br><br><span class="hljs-meta">#bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb</span><br>t2=[<span class="hljs-number">0x26</span>, <span class="hljs-number">0x27</span>, <span class="hljs-number">0x27</span>, <span class="hljs-number">0xCA</span>, <span class="hljs-number">0xC4</span>, <span class="hljs-number">0xC4</span>, <span class="hljs-number">0xC4</span>, <span class="hljs-number">0xA9</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x5D</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0x89</span>, <span class="hljs-number">0x89</span>, <span class="hljs-number">0xCF</span>, <span class="hljs-number">0x26</span>, <span class="hljs-number">0x27</span>, <span class="hljs-number">0x27</span>, <span class="hljs-number">0xD4</span>, <span class="hljs-number">0xC4</span>, <span class="hljs-number">0xC4</span>, <span class="hljs-number">0xC4</span>, <span class="hljs-number">0xC5</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0x89</span>, <span class="hljs-number">0x89</span>, <span class="hljs-number">0xE3</span>]<br>c2=[<span class="hljs-number">0xDC</span>, <span class="hljs-number">0xD0</span>, <span class="hljs-number">0xB1</span>, <span class="hljs-number">0xE4</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0xF4</span>, <span class="hljs-number">0x72</span>, <span class="hljs-number">0x91</span>, <span class="hljs-number">0xA0</span>, <span class="hljs-number">0x7B</span>, <span class="hljs-number">0x3F</span>, <span class="hljs-number">0x1B</span>, <span class="hljs-number">0x0C</span>, <span class="hljs-number">0x92</span>, <span class="hljs-number">0x0F</span>, <span class="hljs-number">0xD2</span>, <span class="hljs-number">0xD4</span>, <span class="hljs-number">0x60</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0x4D</span>, <span class="hljs-number">0x5F</span>, <span class="hljs-number">0xC7</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0x0C</span>, <span class="hljs-number">0xFC</span>, <span class="hljs-number">0xF5</span>, <span class="hljs-number">0x6E</span>, <span class="hljs-number">0x95</span>, <span class="hljs-number">0x8C</span>, <span class="hljs-number">0x83</span>, <span class="hljs-number">0x7D</span>]<br>kstr1=[ t2[i]^c2[i] <span class="hljs-keyword">for</span> i in range(<span class="hljs-number">32</span>)]<br><span class="hljs-keyword">for</span> i in range(<span class="hljs-number">32</span>):<br>    <span class="hljs-keyword">if</span> i&amp;<span class="hljs-number">1</span>:<br>        kstr1[i]-=c2[(i<span class="hljs-number">-1</span>+<span class="hljs-number">32</span>)%<span class="hljs-number">32</span>]<br>    <span class="hljs-keyword">else</span>:<br>        kstr1[i]-=t2[(i+<span class="hljs-number">1</span>)%<span class="hljs-number">32</span>]<br>kstr1=[(i+<span class="hljs-number">256</span>)%<span class="hljs-number">256</span> <span class="hljs-keyword">for</span> i in kstr1]<br><br>assert kstr==kstr1<br>v7=kstr1<br><br>def hexdump(s:<span class="hljs-built_in">list</span>):<br>    <span class="hljs-keyword">for</span> i in s:<br>        print(hex(i)[<span class="hljs-number">2</span>:].zfill(<span class="hljs-number">2</span>),end=<span class="hljs-string">' '</span>)<br>    print()<br>enc=[<span class="hljs-number">0x06</span>, <span class="hljs-number">0x08</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x04</span>, <span class="hljs-number">0x60</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0x08</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0x4A</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0x32</span>, <span class="hljs-number">0x58</span>, <span class="hljs-number">0xEE</span>, <span class="hljs-number">0x97</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x84</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0xF2</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0x6B</span>, <span class="hljs-number">0xE8</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x24</span>, <span class="hljs-number">0x99</span>, <span class="hljs-number">0xF6</span>, <span class="hljs-number">0xE3</span>, <span class="hljs-number">0x21</span>, <span class="hljs-number">0x51</span>, <span class="hljs-number">0xC2</span>, <span class="hljs-number">0x5D</span>, <span class="hljs-number">0xBF</span>, <span class="hljs-number">0x32</span>]<br><br>c=[]<br>from z3 <span class="hljs-keyword">import</span> *<br>a2=[BitVec(<span class="hljs-string">'a2%d'</span>%i,<span class="hljs-number">8</span>) <span class="hljs-keyword">for</span> i in range(<span class="hljs-number">32</span>)]<br>sol=Solver()<br><span class="hljs-keyword">for</span> i in range(<span class="hljs-number">32</span>):<br>    <span class="hljs-keyword">if</span> i&amp;<span class="hljs-number">1</span>:<br>        v4=c[i<span class="hljs-number">-1</span>]<br>    <span class="hljs-keyword">else</span>:<br>        v4=a2[i+<span class="hljs-number">1</span>]<br>    c.append((a2[i]^(v4+v7[i]))&amp;<span class="hljs-number">0xff</span>)<br>    sol.append(c[i]==enc[i])<br>print(sol.check())<br>m=sol.model()<br>encry_c=[m[a2[i]].as_long() <span class="hljs-keyword">for</span> i in range(<span class="hljs-number">32</span>)]<br>print(encry_c)<br>hexdump(encry_c)<br><span class="hljs-meta"># assert encry_c==t2</span><br><br>print(<span class="hljs-string">'sol salsal20 success!'</span>)<br>tc=[]<br><span class="hljs-keyword">for</span> i in range(<span class="hljs-number">0</span>,<span class="hljs-number">32</span>,<span class="hljs-number">4</span>):<br>    tmp=<span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> j in range(<span class="hljs-number">4</span>):<br>        tmp|=(encry_c[i+j]&lt;&lt;(<span class="hljs-number">8</span>*j))<br>    tc.append(tmp)<br><br>from claripy <span class="hljs-keyword">import</span> *<br>fm=[BVS(<span class="hljs-string">'fm%d'</span>%i,<span class="hljs-number">32</span>) <span class="hljs-keyword">for</span> i in range(<span class="hljs-number">4</span>)]<br>sol0=Solver()<br>fc1=encry(fm)<br><span class="hljs-keyword">for</span> i in range(<span class="hljs-number">4</span>):<br>    sol0.add(fc1[i]==tc[i+<span class="hljs-number">4</span>])  #åˆ†ä¸¤ç»„è§£å³å¯<br>print(sol0.check_satisfiability())<br><span class="hljs-keyword">for</span> i in range(<span class="hljs-number">4</span>):<br>    print(<span class="hljs-keyword">int</span>.to_bytes(sol0.eval(fm[i],<span class="hljs-number">4</span>)[<span class="hljs-number">0</span>],<span class="hljs-number">4</span>,<span class="hljs-string">'little'</span>).decode(),end=<span class="hljs-string">'')</span><br><span class="hljs-string">print()</span><br><span class="hljs-string">#3ummer170ver_C0Gingcn0t(T0p0hhh2</span><br><span class="hljs-string"># m0=sol0.model()</span><br><span class="hljs-string"># print(int.to_bytes(m0[fm[0]].as_long(),4,'</span>little<span class="hljs-number">'</span>))<br>s=<span class="hljs-built_in">list</span>(b<span class="hljs-number">'3u</span>mmer170ver_C0Gingcn0t(T0p0hhh2<span class="hljs-number">'</span>)<br>s[<span class="hljs-number">7</span>] ^= <span class="hljs-number">0x44</span><br>s[<span class="hljs-number">15</span>] ^= <span class="hljs-number">0x23</span><br>s[<span class="hljs-number">23</span>] ^= <span class="hljs-number">0x5B</span><br>s[<span class="hljs-number">31</span>] ^= <span class="hljs-number">0x5A</span><br>print(bytes(s))<br></code></pre></td></tr></tbody></table></figure><h3 id="windows-call">windows_call</h3><blockquote><p>é¢˜ç›®éšè—äº†å¤§éƒ¨åˆ†çš„windowså‡½æ•°ï¼Œå¹¶ä¸”æ•°æ®é€šè¿‡åç§»æ¥å¯»å€ï¼Œç»“åˆè°ƒè¯•å’Œç®—æ³•ç‰¹å¾è¿˜åŸç¨‹åºé€»è¾‘ã€‚</p></blockquote><p>é¦–å…ˆæ˜¯checkè¾“å…¥æ ¼å¼ä¸ºflag{}ï¼Œå¹¶ä¸”é™åˆ¶å†…å®¹é•¿åº¦ä¸º40å­—èŠ‚çš„16è¿›åˆ¶æ•°æ®ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221106170559796.png" alt="image-20221106170559796"></p><p>æœŸé—´ä¼šå°†è¾“å…¥å†…å®¹å°å†™è½¬å¤§å†™ï¼Œå¹¶ä¿å­˜è½¬åŒ–å‰åçš„å­—ç¬¦ã€‚è°ƒè¯•ä¸­å¯çŸ¥<code>c</code>å‡½æ•°ä¸­åŒ…å«<code>md5</code>çš„æ¨¡æ•°ï¼Œæ•…è¯¥éƒ¨åˆ†çº¿å¯¹è½¬æ¢å‰å’Œè½¬æ¢åçš„è¾“å…¥è¿›è¡Œmd5æ ¡æ£€ï¼Œè¦æ±‚ç›¸åŒå³è¾“å…¥çš„å†…å®¹ä¸ºå¤§å†™ï¼Œä¹‹åä¼šå°†è¾“å…¥2ä¸ªä¸€ç»„è½¬ä¸ºå­—èŠ‚æ•°æ®ï¼Œå­˜åœ¨0x400åç§»å¤„ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221106170752644.png" alt="image-20221106170752644"></p><p>è½¬æ¢åçš„è¾“å…¥20å­—èŠ‚ï¼Œå–å‡ºå‰4ä¸ªå­—èŠ‚ï¼Œåˆ†ä¸º2ä¸ªwordæ•°æ®xå’Œyæ¥ç”Ÿæˆåç»­åŠ å¯†æ‰€ä½¿ç”¨çš„keyå’Œivã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221106171110451.png" alt="image-20221106171110451"></p><p>å› ä¸ºåœ¨å¯†æ–‡çš„æ¯”å¯¹å¤„æœ‰å¯¹xå’Œyå€¼çš„çº¦æŸï¼Œå¯ä»¥é€šè¿‡è¯¥çº¦æŸçˆ†ç ´xå’Œyå…±4ä¸ªå­—èŠ‚ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221106171207819.png" alt="image-20221106171207819"></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_key</span>(<span class="hljs-params">x,y</span>):</span><br>    c=x^y<br>    d=c&amp;<span class="hljs-number">0xff</span><br>    h=c&gt;&gt;<span class="hljs-number">8</span><br>    <span class="hljs-built_in">sum</span>=<span class="hljs-number">0</span><br>    out=[]<br>    out0=[]<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">16</span>):<br>        out.append((h+i)^(d+i))<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">16</span>):<br>        out0.append(out[i]^((i-<span class="hljs-number">64</span>+<span class="hljs-number">0x100</span>)%<span class="hljs-number">0x100</span>))<br>        <span class="hljs-built_in">sum</span>+=out0[i]<br>    <span class="hljs-comment">#print(hex(sum))</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">sum</span>,out0,out<br><br>get_key(<span class="hljs-number">0x2301</span>,<span class="hljs-number">0xbc4a</span>)<br><br><span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0xff</span>):<br>    v7=x&lt;&lt;<span class="hljs-number">8</span> | <span class="hljs-number">0xa0</span><br>    <span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0xffff</span>):<br>        <span class="hljs-keyword">if</span> (v7-y)&amp;<span class="hljs-number">0xffff</span>==<span class="hljs-number">0x2B8</span> <span class="hljs-keyword">and</span> (v7+<span class="hljs-number">0x3500</span>)&amp;<span class="hljs-number">0xffff</span> &lt;=<span class="hljs-number">0x800</span> <span class="hljs-keyword">and</span> (y+<span class="hljs-number">0x3800</span>)&amp;<span class="hljs-number">0xffff</span>&lt;=<span class="hljs-number">0x800</span>:<br>            <span class="hljs-keyword">if</span> get_key(v7,y)[<span class="hljs-number">0</span>]==<span class="hljs-number">0x8A8</span>:<br><br>                <span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(v7),<span class="hljs-built_in">hex</span>(y))<br><span class="hljs-comment">#0xcca0 0xc9e8</span><br><span class="hljs-comment">#0xcea0 0xcbe8</span><br><span class="hljs-comment">#æ»¡è¶³æ¡ä»¶çš„ä¸º x=0xcca0 y=0xc9e8ï¼Œæ•…å‰8ä¸ªå­—ç¬¦ä¸ºE8C9A0CC</span><br></code></pre></td></tr></tbody></table></figure><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221106171506809.png" alt="image-20221106171506809"></p><p>é¦–å…ˆç»è¿‡ç§˜é’¥æ‰©å±•ï¼Œ0x80(128),ä¹‹åä¼ å…¥keyå’Œivåˆ°sub_402613è¿›è¡ŒåŠ å¯†ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221106171621293.png" alt="image-20221106171621293"></p><p>å¯è§å…ˆå¼‚æˆ–ivï¼Œå†ECBå³å…¸å‹çš„CBCæ¨¡å¼ã€‚åœ¨å°è¯•ä½¿ç”¨fingeræ¢å¤ç¬¦å·æ—¶ï¼Œå…¶è¯†åˆ«å‡ºäº†<code>Camellia</code>ç®—æ³•è®©äººè¯¯è§£ï¼Œè§‚å¯Ÿåç»­ç®—æ³•å’Œç‰¹å¾å¹¶æ²¡æœ‰æ‰¾åˆ°å…¶ç‰¹å¾è¿ç®—ï¼Œ=.=è¢«å‘äº†å¥½ä¹…ï¼Œä»¥ä¸ºæ˜¯é­”æ”¹ã€‚ä¹‹ååœ¨è°ƒè¯•ç§˜é’¥æ‰©å±•(sub_40234A)è¯¦ç»†æ­¥éª¤æ—¶å‘ç°äº†AESçš„ç‰¹å¾Sboxï¼Œåœ¨v4çš„280åç§»å¤„ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221106172014100.png" alt="image-20221106172014100"></p><p>ä½¿ç”¨AESè§£å¯†å¯†æ–‡ï¼ŒcheckæˆåŠŸã€‚å¹²æ‰°fingerçš„è¯†åˆ«æŠ€æœ¯æ¯”è¾ƒå¸…ï¼Œæ€ä¼¤åŠ›è›®å¤§çš„ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_key</span>(<span class="hljs-params">x,y</span>):</span><br>    c=x^y<br>    d=c&amp;<span class="hljs-number">0xff</span><br>    h=c&gt;&gt;<span class="hljs-number">8</span><br>    <span class="hljs-built_in">sum</span>=<span class="hljs-number">0</span><br>    out=[]<br>    out0=[]<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">16</span>):<br>        out.append((h+i)^(d+i))<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">16</span>):<br>        out0.append(out[i]^((i-<span class="hljs-number">64</span>+<span class="hljs-number">0x100</span>)%<span class="hljs-number">0x100</span>))<br>        <span class="hljs-built_in">sum</span>+=out0[i]<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">sum</span>,out0,out<br><br><br><span class="hljs-comment"># for x in range(0xff):</span><br><span class="hljs-comment">#     v7=x&lt;&lt;8 | 0xa0</span><br><span class="hljs-comment">#     for y in range(0xffff):</span><br><span class="hljs-comment">#         if (v7-y)&amp;0xffff==0x2B8 and (v7+0x3500)&amp;0xffff &lt;=0x800 and (y+0x3800)&amp;0xffff&lt;=0x800:</span><br><span class="hljs-comment">#             if get_key(v7,y)[0]==0x8A8:</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#                 print(hex(v7),hex(y))</span><br><span class="hljs-comment">#0xcca0 0xc9e8</span><br><span class="hljs-comment">#0xcea0 0xcbe8</span><br><span class="hljs-comment">#å‰8ä¸ªå­—èŠ‚æ­£ç¡®åå³å¯è°ƒè¯•æå–ivå’Œk</span><br>k=[<span class="hljs-number">0x8D</span>, <span class="hljs-number">0x8E</span>, <span class="hljs-number">0x8F</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0x81</span>, <span class="hljs-number">0x82</span>, <span class="hljs-number">0x83</span>, <span class="hljs-number">0x84</span>, <span class="hljs-number">0x95</span>, <span class="hljs-number">0x96</span>, <span class="hljs-number">0x97</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0x89</span>, <span class="hljs-number">0x8A</span>, <span class="hljs-number">0x8B</span>, <span class="hljs-number">0x8C</span>]<br>iv=[<span class="hljs-number">0x4D</span>, <span class="hljs-number">0x4F</span>, <span class="hljs-number">0x4D</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0x47</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0x5D</span>, <span class="hljs-number">0x5F</span>, <span class="hljs-number">0x5D</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0x47</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0x43</span>]<br><span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(iv)==<span class="hljs-built_in">len</span>(k)<br><br>enc=[<span class="hljs-number">0xF3A03784</span>, <span class="hljs-number">0xFC3436EC</span>,<span class="hljs-number">0x6F38A294</span>,<span class="hljs-number">0x7C7E343F</span>]<br>mc=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> enc:<br>    mc.append(<span class="hljs-built_in">int</span>.to_bytes(i,<span class="hljs-number">4</span>,<span class="hljs-string">'little'</span>))<br><br>s=<span class="hljs-string">'flag{E8C9A0CC8437A0F3EC3634FC94A2386F3F347E7C}'</span><br><br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br>aes=AES.new(<span class="hljs-built_in">bytes</span>(k),AES.MODE_CBC,<span class="hljs-built_in">bytes</span>(iv))<br><span class="hljs-built_in">print</span>(aes.decrypt(<span class="hljs-string">b''</span>.join(mc)).<span class="hljs-built_in">hex</span>().upper())<br>flag=<span class="hljs-string">'flag{E8C9A0CC8B9854CDD0AC321B790FC74EFA520FBC}'</span><br></code></pre></td></tr></tbody></table></figure><h3 id="babyre">babyre</h3><blockquote><p>tlsä¸­è§¦å‘å¼‚,å€ŸåŠ©vehä¿®æ”¹AESçš„sboxï¼Œç¨‹åºå­˜åœ¨åè°ƒè¯•ä¸è¿‡ä¸å½±å“æ­£å¸¸æ‰§è¡Œï¼ŒæŠŠä¿®æ”¹åçš„sboxåœ¨åŠ å¯†å‰patchèƒ½è¾¾åˆ°åŒä¸€ä¸ªæ•ˆæœã€‚</p></blockquote><p>tlså›è°ƒå‡½æ•°ï¼Œå®Œæˆæ³¨å†Œveh-&gt;åè°ƒè¯•-&gt;è§¦å‘/0å¼‚å¸¸-&gt;ä¿®æ”¹sboxã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221106173214891.png" alt="image-20221106173214891"></p><p>ä¿®æ”¹sboxçš„æ“ä½œä¸ç¨‹åºè¾“å…¥è·åè°ƒè¯•æ­¥éª¤æ— å…³ï¼Œç›´æ¥åœ¨handleå‡½æ•°ä¸‹æ–­ç‚¹ï¼Œæ”¹è·³è½¬ç»•è¿‡åè°ƒè¯•è®©ç¨‹åºè§¦å‘å¼‚å¸¸æ–­ä¸‹å³å¯get sboxã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221106173709006.png" alt="image-20221106173709006"></p><p>è¿è¡Œæ—¶é€šè¿‡idapythonè¿›è¡Œpatchå³å¯æ¨¡æ‹Ÿè§¦å‘å¼‚å¸¸çš„æƒ…å†µã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> idautils<br>sbox=[<span class="hljs-number">0x00000077</span>, <span class="hljs-number">0x00000068</span>, <span class="hljs-number">0x00000063</span>, <span class="hljs-number">0x0000006F</span>, <span class="hljs-number">0x000000E6</span>, <span class="hljs-number">0x0000007F</span>, <span class="hljs-number">0x0000007B</span>, <span class="hljs-number">0x000000D1</span>, ...]<br><br>adr=<span class="hljs-number">0xCD4000</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>    patch_dword(adr+<span class="hljs-number">4</span>*i,sbox[i])<br><span class="hljs-built_in">print</span>(<span class="hljs-string">'ok'</span>)<br></code></pre></td></tr></tbody></table></figure><p>å› ä¸ºç§˜é’¥æ‰©å±•ä¸­å‡ºç°äº†å¯†æ–‡çš„è¸ªè¿¹ï¼Œä½†æ˜¯åˆå§‹çš„keyæ˜¯å†™æ­»åœ¨ç§˜é’¥ä¸­çš„ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥è°ƒè¯•è·å–è½®ç§˜é’¥ä»¥é¿å…å‡ºé”™ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221106174010265.png" alt="image-20221106174010265"></p><p>å¹¶ä¸”åˆ†æˆä¸¤ç»„è¿›è¡ŒåŠ å¯†ï¼Œå‰ä¸€ç»„çš„å¯†æ–‡ä¼šç”¨äºç¬¬äºŒç»„çš„åˆå§‹åŒ–ã€‚</p><p>å¯¹äºAESçš„åŠ å¯†éƒ¨åˆ†å°±æœ‰ä¸€ç‚¹é˜´é—´äº†ï¼Œç»“æ„å¾ˆç»å…¸ä½†æ˜¯å…¶åœ¨çŸ©é˜µçš„æ’å¸ƒä¸Šä¸ä»¥å¾€ä¸åŒï¼Œè¯¥ç¨‹åºä¸­ä¸ºè¿ç»­4ä¸ªå­—èŠ‚ä¸ºä¸€è¡Œè€Œå¹¶éä¸€åˆ—ï¼Œå¹¶ä¸”è½®ç§˜é’¥å¼‚æˆ–æ—¶çš„ä¸‹æ ‡ç´¢å¼•ä¹Ÿè¿›è¡Œäº†å˜åŠ¨ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221106174111858.png" alt="image-20221106174111858"></p><p>å¤§éƒ¨åˆ†è„šæœ¬éƒ½ç”¨åˆ—æ¥å†™çš„ï¼Œæ‰‹ä¸Šæ²¡æœ‰å¥½ç”¨çš„æ¿å­æ¥æ”¹ï¼Œç›´æ¥ç°åœºæ‰‹æ’¸AESï¼Œé¡ºä¾¿å¤ä¹ å¯†ç å­¦; ), è·Ÿä¸€è½®ä¸è°ƒè¯•åŠ å¯†ç›¸åŒå³å¯get flag(ç´¯å•Šã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">hexdump</span>(<span class="hljs-params">s</span>):</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(s)):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(s[i])[<span class="hljs-number">2</span>:].zfill(<span class="hljs-number">2</span>),end=<span class="hljs-string">' '</span>)<br>    <span class="hljs-built_in">print</span>()<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_invs</span>(<span class="hljs-params">sb:<span class="hljs-built_in">list</span></span>):</span><br>    out=[<span class="hljs-number">0</span>]*<span class="hljs-number">256</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>        out[sb[i]]=i<br>    <span class="hljs-keyword">return</span> out<br>sbox=[<span class="hljs-number">0x00000077</span>, <span class="hljs-number">0x00000068</span>, <span class="hljs-number">0x00000063</span>, <span class="hljs-number">0x0000006F</span>, <span class="hljs-number">0x000000E6</span>, <span class="hljs-number">0x0000007F</span>, <span class="hljs-number">0x0000007B</span>, <span class="hljs-number">0x000000D1</span>, <span class="hljs-number">0x00000024</span>, <span class="hljs-number">0x00000015</span>, <span class="hljs-number">0x00000073</span>, <span class="hljs-number">0x0000003F</span>, <span class="hljs-number">0x000000EA</span>, <span class="hljs-number">0x000000C3</span>, <span class="hljs-number">0x000000BF</span>, <span class="hljs-number">0x00000062</span>, <span class="hljs-number">0x000000DE</span>, <span class="hljs-number">0x00000096</span>, <span class="hljs-number">0x000000DD</span>, <span class="hljs-number">0x00000069</span>, <span class="hljs-number">0x000000EE</span>, <span class="hljs-number">0x0000004D</span>, <span class="hljs-number">0x00000053</span>, <span class="hljs-number">0x000000E4</span>, <span class="hljs-number">0x000000B9</span>, <span class="hljs-number">0x000000C0</span>, <span class="hljs-number">0x000000B6</span>, <span class="hljs-number">0x000000BB</span>, <span class="hljs-number">0x00000088</span>, <span class="hljs-number">0x000000B0</span>, <span class="hljs-number">0x00000066</span>, <span class="hljs-number">0x000000D4</span>, <span class="hljs-number">0x000000A3</span>, <span class="hljs-number">0x000000E9</span>, <span class="hljs-number">0x00000087</span>, <span class="hljs-number">0x00000032</span>, <span class="hljs-number">0x00000022</span>, <span class="hljs-number">0x0000002B</span>, <span class="hljs-number">0x000000E3</span>, <span class="hljs-number">0x000000D8</span>, <span class="hljs-number">0x00000020</span>, <span class="hljs-number">0x000000B1</span>, <span class="hljs-number">0x000000F1</span>, <span class="hljs-number">0x000000E5</span>, <span class="hljs-number">0x00000065</span>, <span class="hljs-number">0x000000CC</span>, <span class="hljs-number">0x00000025</span>, <span class="hljs-number">0x00000001</span>, <span class="hljs-number">0x00000010</span>, <span class="hljs-number">0x000000D3</span>, <span class="hljs-number">0x00000037</span>, <span class="hljs-number">0x000000D7</span>, <span class="hljs-number">0x0000000C</span>, <span class="hljs-number">0x00000082</span>, <span class="hljs-number">0x00000011</span>, <span class="hljs-number">0x0000008E</span>, <span class="hljs-number">0x00000013</span>, <span class="hljs-number">0x00000006</span>, <span class="hljs-number">0x00000094</span>, <span class="hljs-number">0x000000F6</span>, <span class="hljs-number">0x000000FF</span>, <span class="hljs-number">0x00000033</span>, <span class="hljs-number">0x000000A6</span>, <span class="hljs-number">0x00000061</span>, <span class="hljs-number">0x0000001D</span>, <span class="hljs-number">0x00000097</span>, <span class="hljs-number">0x00000038</span>, <span class="hljs-number">0x0000000E</span>, <span class="hljs-number">0x0000000F</span>, <span class="hljs-number">0x0000007A</span>, <span class="hljs-number">0x0000004E</span>, <span class="hljs-number">0x000000B4</span>, <span class="hljs-number">0x00000046</span>, <span class="hljs-number">0x0000002F</span>, <span class="hljs-number">0x000000C2</span>, <span class="hljs-number">0x000000A7</span>, <span class="hljs-number">0x0000003D</span>, <span class="hljs-number">0x000000F7</span>, <span class="hljs-number">0x0000003B</span>, <span class="hljs-number">0x00000090</span>, <span class="hljs-number">0x00000047</span>, <span class="hljs-number">0x000000C5</span>, <span class="hljs-number">0x00000014</span>, <span class="hljs-number">0x000000F9</span>, <span class="hljs-number">0x00000034</span>, <span class="hljs-number">0x000000E8</span>, <span class="hljs-number">0x000000A5</span>, <span class="hljs-number">0x0000004F</span>, <span class="hljs-number">0x0000007E</span>, <span class="hljs-number">0x000000DF</span>, <span class="hljs-number">0x000000AA</span>, <span class="hljs-number">0x0000002D</span>, <span class="hljs-number">0x0000005E</span>, <span class="hljs-number">0x00000058</span>, <span class="hljs-number">0x0000004C</span>, <span class="hljs-number">0x000000DB</span>, <span class="hljs-number">0x000000C4</span>, <span class="hljs-number">0x000000FB</span>, <span class="hljs-number">0x000000BE</span>, <span class="hljs-number">0x000000EF</span>, <span class="hljs-number">0x00000057</span>, <span class="hljs-number">0x00000059</span>, <span class="hljs-number">0x00000027</span>, <span class="hljs-number">0x00000091</span>, <span class="hljs-number">0x00000051</span>, <span class="hljs-number">0x000000ED</span>, <span class="hljs-number">0x00000016</span>, <span class="hljs-number">0x0000006B</span>, <span class="hljs-number">0x00000044</span>, <span class="hljs-number">0x00000028</span>, <span class="hljs-number">0x0000008B</span>, <span class="hljs-number">0x000000BC</span>, <span class="hljs-number">0x00000045</span>, <span class="hljs-number">0x000000B7</span>, <span class="hljs-number">0x00000054</span>, <span class="hljs-number">0x0000009B</span>, <span class="hljs-number">0x00000086</span>, <span class="hljs-number">0x00000089</span>, <span class="hljs-number">0x0000002C</span>, <span class="hljs-number">0x000000E1</span>, <span class="hljs-number">0x000000A8</span>, <span class="hljs-number">0x000000A2</span>, <span class="hljs-number">0x000000CE</span>, <span class="hljs-number">0x00000035</span>, <span class="hljs-number">0x00000004</span>, <span class="hljs-number">0x000000EB</span>, <span class="hljs-number">0x000000E7</span>, <span class="hljs-number">0x000000C6</span>, <span class="hljs-number">0x000000D9</span>, <span class="hljs-number">0x00000018</span>, <span class="hljs-number">0x00000007</span>, <span class="hljs-number">0x000000F8</span>, <span class="hljs-number">0x0000004B</span>, <span class="hljs-number">0x00000083</span>, <span class="hljs-number">0x00000050</span>, <span class="hljs-number">0x00000003</span>, <span class="hljs-number">0x000000D0</span>, <span class="hljs-number">0x000000B3</span>, <span class="hljs-number">0x0000006A</span>, <span class="hljs-number">0x00000029</span>, <span class="hljs-number">0x00000070</span>, <span class="hljs-number">0x00000049</span>, <span class="hljs-number">0x0000000D</span>, <span class="hljs-number">0x00000067</span>, <span class="hljs-number">0x00000074</span>, <span class="hljs-number">0x00000095</span>, <span class="hljs-number">0x0000005B</span>, <span class="hljs-number">0x000000C8</span>, <span class="hljs-number">0x00000036</span>, <span class="hljs-number">0x0000003E</span>, <span class="hljs-number">0x00000084</span>, <span class="hljs-number">0x0000009C</span>, <span class="hljs-number">0x00000052</span>, <span class="hljs-number">0x000000FA</span>, <span class="hljs-number">0x000000AC</span>, <span class="hljs-number">0x00000000</span>, <span class="hljs-number">0x000000CA</span>, <span class="hljs-number">0x0000004A</span>, <span class="hljs-number">0x0000001F</span>, <span class="hljs-number">0x000000CF</span>, <span class="hljs-number">0x000000F4</span>, <span class="hljs-number">0x00000026</span>, <span class="hljs-number">0x0000002E</span>, <span class="hljs-number">0x0000001E</span>, <span class="hljs-number">0x0000005D</span>, <span class="hljs-number">0x00000012</span>, <span class="hljs-number">0x00000030</span>, <span class="hljs-number">0x00000048</span>, <span class="hljs-number">0x000000D6</span>, <span class="hljs-number">0x000000C7</span>, <span class="hljs-number">0x000000B8</span>, <span class="hljs-number">0x00000076</span>, <span class="hljs-number">0x00000085</span>, <span class="hljs-number">0x00000081</span>, <span class="hljs-number">0x000000F0</span>, <span class="hljs-number">0x0000006D</span>, <span class="hljs-number">0x000000F3</span>, <span class="hljs-number">0x000000DC</span>, <span class="hljs-number">0x00000023</span>, <span class="hljs-number">0x00000079</span>, <span class="hljs-number">0x00000099</span>, <span class="hljs-number">0x000000C1</span>, <span class="hljs-number">0x0000005A</span>, <span class="hljs-number">0x000000BD</span>, <span class="hljs-number">0x00000078</span>, <span class="hljs-number">0x00000042</span>, <span class="hljs-number">0x000000E0</span>, <span class="hljs-number">0x000000FE</span>, <span class="hljs-number">0x00000071</span>, <span class="hljs-number">0x0000006E</span>, <span class="hljs-number">0x000000BA</span>, <span class="hljs-number">0x0000001C</span>, <span class="hljs-number">0x000000AE</span>, <span class="hljs-number">0x0000006C</span>, <span class="hljs-number">0x00000031</span>, <span class="hljs-number">0x0000003A</span>, <span class="hljs-number">0x00000008</span>, <span class="hljs-number">0x000000B2</span>, <span class="hljs-number">0x000000A0</span>, <span class="hljs-number">0x000000D2</span>, <span class="hljs-number">0x000000FC</span>, <span class="hljs-number">0x000000C9</span>, <span class="hljs-number">0x00000060</span>, <span class="hljs-number">0x0000000B</span>, <span class="hljs-number">0x0000005F</span>, <span class="hljs-number">0x000000A9</span>, <span class="hljs-number">0x0000009F</span>, <span class="hljs-number">0x0000009E</span>, <span class="hljs-number">0x00000064</span>, <span class="hljs-number">0x0000002A</span>, <span class="hljs-number">0x000000A1</span>, <span class="hljs-number">0x00000072</span>, <span class="hljs-number">0x0000005C</span>, <span class="hljs-number">0x00000017</span>, <span class="hljs-number">0x000000E2</span>, <span class="hljs-number">0x0000001A</span>, <span class="hljs-number">0x00000075</span>, <span class="hljs-number">0x00000021</span>, <span class="hljs-number">0x00000043</span>, <span class="hljs-number">0x000000AD</span>, <span class="hljs-number">0x00000092</span>, <span class="hljs-number">0x000000D5</span>, <span class="hljs-number">0x00000009</span>, <span class="hljs-number">0x0000008A</span>, <span class="hljs-number">0x000000F5</span>, <span class="hljs-number">0x000000EC</span>, <span class="hljs-number">0x0000008C</span>, <span class="hljs-number">0x00000005</span>, <span class="hljs-number">0x0000007D</span>, <span class="hljs-number">0x000000CD</span>, <span class="hljs-number">0x0000009A</span>, <span class="hljs-number">0x00000080</span>, <span class="hljs-number">0x0000008F</span>, <span class="hljs-number">0x0000000A</span>, <span class="hljs-number">0x00000093</span>, <span class="hljs-number">0x000000FD</span>, <span class="hljs-number">0x000000DA</span>, <span class="hljs-number">0x00000041</span>, <span class="hljs-number">0x0000003C</span>, <span class="hljs-number">0x000000CB</span>, <span class="hljs-number">0x00000098</span>, <span class="hljs-number">0x000000B5</span>, <span class="hljs-number">0x0000009D</span>, <span class="hljs-number">0x00000019</span>, <span class="hljs-number">0x000000AB</span>, <span class="hljs-number">0x000000F2</span>, <span class="hljs-number">0x00000056</span>, <span class="hljs-number">0x0000007C</span>, <span class="hljs-number">0x00000055</span>, <span class="hljs-number">0x0000008D</span>, <span class="hljs-number">0x00000039</span>, <span class="hljs-number">0x0000001B</span>, <span class="hljs-number">0x000000A4</span>, <span class="hljs-number">0x00000040</span>, <span class="hljs-number">0x000000AF</span>, <span class="hljs-number">0x00000002</span>]<br>invsbox = get_invs(sbox)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">round_key</span>(<span class="hljs-params">m:<span class="hljs-built_in">list</span>,rk:<span class="hljs-built_in">list</span></span>):</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>            m[<span class="hljs-number">4</span> * i + j] ^= rk[(<span class="hljs-number">3</span> - i) + <span class="hljs-number">4</span> * j]<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">inv_sub</span>(<span class="hljs-params">m:<span class="hljs-built_in">list</span></span>):</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(m)):<br>        m[i]=invsbox[m[i]]<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">byte_sub</span>(<span class="hljs-params">m:<span class="hljs-built_in">list</span></span>):</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(m)):<br>        m[i]=sbox[m[i]]<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">shift_row</span>(<span class="hljs-params">s:<span class="hljs-built_in">list</span></span>):</span><br>    out=s[:<span class="hljs-number">4</span>]<br>    out.extend(s[<span class="hljs-number">5</span>:<span class="hljs-number">8</span>])<br>    out.append(s[<span class="hljs-number">4</span>])<br>    out.extend(s[<span class="hljs-number">10</span>:<span class="hljs-number">12</span>])<br>    out.extend(s[<span class="hljs-number">8</span>:<span class="hljs-number">10</span>])<br>    out.append(s[<span class="hljs-number">15</span>])<br>    out.extend(s[<span class="hljs-number">12</span>:<span class="hljs-number">15</span>])<br>    <span class="hljs-keyword">return</span> out<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">inv_shift_row</span>(<span class="hljs-params">s:<span class="hljs-built_in">list</span></span>):</span><br>    out=s[:<span class="hljs-number">4</span>]<br>    out.append(s[<span class="hljs-number">7</span>])<br>    out.extend(s[<span class="hljs-number">4</span>:<span class="hljs-number">7</span>])<br>    out.extend(s[<span class="hljs-number">10</span>:<span class="hljs-number">12</span>])<br>    out.extend(s[<span class="hljs-number">8</span>:<span class="hljs-number">10</span>])<br>    out.extend(s[<span class="hljs-number">13</span>:<span class="hljs-number">16</span>])<br>    out.append(s[<span class="hljs-number">12</span>])<br>    <span class="hljs-keyword">return</span> out<br><br><br>xtime = <span class="hljs-keyword">lambda</span> a: (((a &lt;&lt; <span class="hljs-number">1</span>) ^ <span class="hljs-number">0x1B</span>) &amp; <span class="hljs-number">0xFF</span>) <span class="hljs-keyword">if</span> (a &amp; <span class="hljs-number">0x80</span>) <span class="hljs-keyword">else</span> (a &lt;&lt; <span class="hljs-number">1</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">mix_single_column</span>(<span class="hljs-params">a</span>):</span><br>    t = a[<span class="hljs-number">0</span>] ^ a[<span class="hljs-number">1</span>] ^ a[<span class="hljs-number">2</span>] ^ a[<span class="hljs-number">3</span>]<br>    u = a[<span class="hljs-number">0</span>]<br>    a[<span class="hljs-number">0</span>] ^= t ^ xtime(a[<span class="hljs-number">0</span>] ^ a[<span class="hljs-number">1</span>])<br>    a[<span class="hljs-number">1</span>] ^= t ^ xtime(a[<span class="hljs-number">1</span>] ^ a[<span class="hljs-number">2</span>])<br>    a[<span class="hljs-number">2</span>] ^= t ^ xtime(a[<span class="hljs-number">2</span>] ^ a[<span class="hljs-number">3</span>])<br>    a[<span class="hljs-number">3</span>] ^= t ^ xtime(a[<span class="hljs-number">3</span>] ^ u)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">mix_column</span>(<span class="hljs-params">c:<span class="hljs-built_in">list</span></span>):</span><br>    a = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>        tmp = []<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>            tmp.append(c[<span class="hljs-number">4</span> * j + i])<br>        a.append(tmp)<br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>        mix_single_column(a[i])<br>    cc = [<span class="hljs-number">0</span>] * <span class="hljs-number">16</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>            cc[<span class="hljs-number">4</span> * j + i] = a[i][j]<br>    <span class="hljs-keyword">return</span> cc<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">GFMul</span>(<span class="hljs-params">a:<span class="hljs-built_in">int</span>,b:<span class="hljs-built_in">int</span></span>):</span><br>    sig=<span class="hljs-number">0</span><br>    ans=<span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> a:<br>        <span class="hljs-keyword">if</span>(a&amp;<span class="hljs-number">1</span>): ans^=b<br>        a&gt;&gt;=<span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span> a:<br>            sig=(b&gt;&gt;<span class="hljs-number">7</span>)&amp;<span class="hljs-number">1</span><br>            b=(b&lt;&lt;<span class="hljs-number">1</span>)&amp;<span class="hljs-number">0xff</span><br>            <span class="hljs-keyword">if</span>(sig) :b^=<span class="hljs-number">0x1b</span><br>    <span class="hljs-keyword">return</span> ans<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">inv_mix_col</span>(<span class="hljs-params">c:<span class="hljs-built_in">list</span></span>):</span><br>    tmp=[]<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>            tmp.append(c[<span class="hljs-number">4</span>*j+i])<br>    m=[<span class="hljs-number">0</span>]*<span class="hljs-number">16</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">16</span>,<span class="hljs-number">4</span>):<br>        m[i] = GFMul(<span class="hljs-number">0xe</span>, tmp[i]) ^ GFMul(<span class="hljs-number">0xb</span>, tmp[i + <span class="hljs-number">1</span>]) ^ GFMul(<span class="hljs-number">0xd</span>, tmp[i + <span class="hljs-number">2</span>]) ^ GFMul(<span class="hljs-number">0x9</span>, tmp[i + <span class="hljs-number">3</span>]);<br>        m[i + <span class="hljs-number">1</span>] = GFMul(<span class="hljs-number">0x9</span>, tmp[i]) ^ GFMul(<span class="hljs-number">0xe</span>, tmp[i + <span class="hljs-number">1</span>]) ^ GFMul(<span class="hljs-number">0xb</span>, tmp[i + <span class="hljs-number">2</span>]) ^ GFMul(<span class="hljs-number">0xd</span>, tmp[i + <span class="hljs-number">3</span>]);<br>        m[i + <span class="hljs-number">2</span>] = GFMul(<span class="hljs-number">0xd</span>, tmp[i]) ^ GFMul(<span class="hljs-number">0x9</span>, tmp[i + <span class="hljs-number">1</span>]) ^ GFMul(<span class="hljs-number">0xe</span>, tmp[i + <span class="hljs-number">2</span>]) ^ GFMul(<span class="hljs-number">0xb</span>, tmp[i + <span class="hljs-number">3</span>]);<br>        m[i + <span class="hljs-number">3</span>] = GFMul(<span class="hljs-number">0xb</span>, tmp[i]) ^ GFMul(<span class="hljs-number">0xd</span>, tmp[i + <span class="hljs-number">1</span>]) ^ GFMul(<span class="hljs-number">0x9</span>, tmp[i + <span class="hljs-number">2</span>]) ^ GFMul(<span class="hljs-number">0xe</span>, tmp[i + <span class="hljs-number">3</span>]);<br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>            tmp[<span class="hljs-number">4</span>*i+j]=m[i+<span class="hljs-number">4</span>*j]<br>    <span class="hljs-keyword">return</span> tmp<br><br><br><span class="hljs-comment"># kk=[0x0C, 0x38, 0x93, 0x17, 0x54, 0xF7, 0xA7, 0x11, 0x20, 0xC8, 0x89, 0xF7, 0x25, 0xFA, 0x1A, 0xD4]</span><br><span class="hljs-comment"># m=[0x61]*16</span><br><span class="hljs-comment"># c=[0x00000076, 0x00000070, 0x00000096, 0x000000B5, 0x000000F2, 0x000000C6, 0x000000E8, 0x0000007B, 0x00000059, 0x00000096, 0x000000A9, 0x0000009B, 0x0000006D, 0x00000035, 0x00000041, 0x00000044]</span><br><span class="hljs-comment"># round_key(m,kk)</span><br><span class="hljs-comment"># hexdump(m)</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># print('--- byte_sub ---')</span><br><span class="hljs-comment"># c=m</span><br><span class="hljs-comment"># byte_sub(c)</span><br><span class="hljs-comment"># hexdump(c)</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># x=[0x0000007F, 0x0000003C, 0x00000005, 0x00000022, 0x0000003E, 0x0000007C, 0x00000002, 0x000000F4, 0x0000001C, 0x000000A6, 0x0000009D, 0x000000F9, 0x00000019, 0x00000004, 0x00000076, 0x00000060]</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># print('--- shift_row ---')</span><br><span class="hljs-comment"># c=shift_row(c)</span><br><span class="hljs-comment"># hexdump(c)</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># print('--- mix_column ---')</span><br><span class="hljs-comment"># cc=mix_column(c)</span><br><span class="hljs-comment"># print(cc)</span><br><span class="hljs-comment"># hexdump(cc)</span><br><span class="hljs-comment"># inv_mix_col(cc)</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># rkk=[0x44, 0x07, 0xBE, 0xB4, 0x10, 0xF0, 0x19, 0xA5, 0x30, 0x38, 0x90, 0x52, 0x15, 0xC2, 0x8A, 0x86]</span><br><span class="hljs-comment"># print('--- round_key ---')</span><br><span class="hljs-comment"># round_key(cc,rkk)</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># ee=[0x000000CB, 0x00000099, 0x00000057, 0x000000A4, 0x00000080, 0x00000065, 0x00000092, 0x0000007E, 0x0000001B, 0x00000056, 0x000000A5, 0x0000003B, 0x0000005D, 0x00000014, 0x00000046, 0x00000075]</span><br><span class="hljs-comment"># hexdump(cc)</span><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">encry</span>(<span class="hljs-params">t:<span class="hljs-built_in">list</span>,exkey:<span class="hljs-built_in">list</span></span>):</span><br>    m=t[:]<br>    round_key(m,exkey[:<span class="hljs-number">16</span>])<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">10</span>):<br>        byte_sub(m)<br>        m=shift_row(m)<br>        m=mix_column(m)<br>        round_key(m,exkey[<span class="hljs-number">16</span>*i:<span class="hljs-number">16</span>*i+<span class="hljs-number">16</span>])<br>    byte_sub(m)<br>    m=shift_row(m)<br>    round_key(m,exkey[<span class="hljs-number">160</span>:<span class="hljs-number">176</span>])<br>    <span class="hljs-keyword">return</span> m[:]<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decry</span>(<span class="hljs-params">t:<span class="hljs-built_in">list</span>,exkey:<span class="hljs-built_in">list</span></span>):</span><br>    c=t[:]<br>    round_key(c,exkey[<span class="hljs-number">160</span>:<span class="hljs-number">176</span>])<br>    c=inv_shift_row(c)<br>    inv_sub(c)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">9</span>,<span class="hljs-number">0</span>,-<span class="hljs-number">1</span>):<br>        round_key(c, exkey[<span class="hljs-number">16</span> * i:<span class="hljs-number">16</span> * i + <span class="hljs-number">16</span>])<br>        c=inv_mix_col(c)<br>        c=inv_shift_row(c)<br>        inv_sub(c)<br>    round_key(c,exkey[:<span class="hljs-number">16</span>])<br>    hexdump(c)<br>    <span class="hljs-keyword">return</span> c<br><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">'--- encry ---'</span>)<br>rk=[<span class="hljs-number">0x0C</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0x93</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0x54</span>, <span class="hljs-number">0xF7</span>, <span class="hljs-number">0xA7</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0xC8</span>, <span class="hljs-number">0x89</span>, <span class="hljs-number">0xF7</span>, <span class="hljs-number">0x25</span>, <span class="hljs-number">0xFA</span>, <span class="hljs-number">0x1A</span>, <span class="hljs-number">0xD4</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0x07</span>, <span class="hljs-number">0xBE</span>, <span class="hljs-number">0xB4</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0xF0</span>, <span class="hljs-number">0x19</span>, <span class="hljs-number">0xA5</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0x90</span>, <span class="hljs-number">0x52</span>, <span class="hljs-number">0x15</span>, <span class="hljs-number">0xC2</span>, <span class="hljs-number">0x8A</span>, <span class="hljs-number">0x86</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x5E</span>, <span class="hljs-number">0x9B</span>, <span class="hljs-number">0xC8</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0xAE</span>, <span class="hljs-number">0x82</span>, <span class="hljs-number">0x6D</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x96</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0x3F</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x54</span>, <span class="hljs-number">0x98</span>, <span class="hljs-number">0xB9</span>, <span class="hljs-number">0x56</span>, <span class="hljs-number">0xC8</span>, <span class="hljs-number">0xBB</span>, <span class="hljs-number">0x8A</span>, <span class="hljs-number">0x46</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0xE7</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0xF0</span>, <span class="hljs-number">0x2B</span>, <span class="hljs-number">0xD8</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0xA4</span>, <span class="hljs-number">0xB3</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0xB9</span>, <span class="hljs-number">0x25</span>, <span class="hljs-number">0xF2</span>, <span class="hljs-number">0xEF</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0xCB</span>, <span class="hljs-number">0x08</span>, <span class="hljs-number">0x99</span>, <span class="hljs-number">0xB3</span>, <span class="hljs-number">0xE0</span>, <span class="hljs-number">0xD0</span>, <span class="hljs-number">0xCA</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0xB1</span>, <span class="hljs-number">0x71</span>, <span class="hljs-number">0x51</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0x8E</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0xC9</span>, <span class="hljs-number">0x1A</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0xA1</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0xCA</span>, <span class="hljs-number">0xDD</span>, <span class="hljs-number">0xB6</span>, <span class="hljs-number">0x7A</span>, <span class="hljs-number">0x7B</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x90</span>, <span class="hljs-number">0x4C</span>, <span class="hljs-number">0xE8</span>, <span class="hljs-number">0xDE</span>, <span class="hljs-number">0x82</span>, <span class="hljs-number">0x85</span>, <span class="hljs-number">0xF2</span>, <span class="hljs-number">0xC9</span>, <span class="hljs-number">0x23</span>, <span class="hljs-number">0xAC</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0x14</span>, <span class="hljs-number">0x95</span>, <span class="hljs-number">0xD6</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0x4A</span>, <span class="hljs-number">0x6A</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0x5E</span>, <span class="hljs-number">0x94</span>, <span class="hljs-number">0xE8</span>, <span class="hljs-number">0xE3</span>, <span class="hljs-number">0xAC</span>, <span class="hljs-number">0x5D</span>, <span class="hljs-number">0xCB</span>, <span class="hljs-number">0x4F</span>, <span class="hljs-number">0x94</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0x5E</span>, <span class="hljs-number">0x99</span>, <span class="hljs-number">0xD7</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0x51</span>, <span class="hljs-number">0x3E</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0xD0</span>, <span class="hljs-number">0xB9</span>, <span class="hljs-number">0xDD</span>, <span class="hljs-number">0x9C</span>, <span class="hljs-number">0x8D</span>, <span class="hljs-number">0x72</span>, <span class="hljs-number">0x92</span>, <span class="hljs-number">0x08</span>, <span class="hljs-number">0xC4</span>, <span class="hljs-number">0x2C</span>, <span class="hljs-number">0x0B</span>, <span class="hljs-number">0xDF</span>, <span class="hljs-number">0xDA</span>, <span class="hljs-number">0x4D</span>, <span class="hljs-number">0x4F</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x0A</span>, <span class="hljs-number">0xF4</span>, <span class="hljs-number">0x92</span>, <span class="hljs-number">0x9C</span>, <span class="hljs-number">0x87</span>, <span class="hljs-number">0x86</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x94</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0xAA</span>, <span class="hljs-number">0x0B</span>, <span class="hljs-number">0x4B</span>, <span class="hljs-number">0x69</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0xE3</span>, <span class="hljs-number">0x1D</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0xA3</span>, <span class="hljs-number">0x71</span>, <span class="hljs-number">0x81</span>, <span class="hljs-number">0xE4</span>, <span class="hljs-number">0x25</span>, <span class="hljs-number">0x71</span>, <span class="hljs-number">0x15</span>, <span class="hljs-number">0xA7</span>, <span class="hljs-number">0x8F</span>, <span class="hljs-number">0x7A</span>, <span class="hljs-number">0x5E</span>]<br>rdk=[<span class="hljs-number">0x0C</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0x93</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0x54</span>, <span class="hljs-number">0xF7</span>, <span class="hljs-number">0xA7</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0xC8</span>, <span class="hljs-number">0x89</span>, <span class="hljs-number">0xF7</span>, <span class="hljs-number">0x25</span>, <span class="hljs-number">0xFA</span>, <span class="hljs-number">0x1A</span>, <span class="hljs-number">0xD4</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x13</span>, <span class="hljs-number">0xAA</span>, <span class="hljs-number">0xA0</span>, <span class="hljs-number">0x04</span>, <span class="hljs-number">0xE4</span>, <span class="hljs-number">0x0D</span>, <span class="hljs-number">0xB1</span>, <span class="hljs-number">0x24</span>, <span class="hljs-number">0x2C</span>, <span class="hljs-number">0x84</span>, <span class="hljs-number">0x46</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0xD6</span>, <span class="hljs-number">0x9E</span>, <span class="hljs-number">0x92</span>, <span class="hljs-number">0x0B</span>, <span class="hljs-number">0x7B</span>, <span class="hljs-number">0x48</span>, <span class="hljs-number">0xBD</span>, <span class="hljs-number">0x0F</span>, <span class="hljs-number">0x9F</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0x0C</span>, <span class="hljs-number">0x2B</span>, <span class="hljs-number">0xB3</span>, <span class="hljs-number">0xC1</span>, <span class="hljs-number">0x4A</span>, <span class="hljs-number">0x2A</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x5F</span>, <span class="hljs-number">0xD8</span>, <span class="hljs-number">0x7E</span>, <span class="hljs-number">0x8A</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0x71</span>, <span class="hljs-number">0x15</span>, <span class="hljs-number">0x54</span>, <span class="hljs-number">0x6E</span>, <span class="hljs-number">0x5A</span>, <span class="hljs-number">0xA6</span>, <span class="hljs-number">0x95</span>, <span class="hljs-number">0x24</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0xC3</span>, <span class="hljs-number">0xCA</span>, <span class="hljs-number">0xFC</span>, <span class="hljs-number">0xDA</span>, <span class="hljs-number">0xCF</span>, <span class="hljs-number">0x2B</span>, <span class="hljs-number">0x0A</span>, <span class="hljs-number">0xAB</span>, <span class="hljs-number">0xDA</span>, <span class="hljs-number">0x7F</span>, <span class="hljs-number">0x64</span>, <span class="hljs-number">0xF1</span>, <span class="hljs-number">0x7C</span>, <span class="hljs-number">0xEA</span>, <span class="hljs-number">0x40</span>, <span class="hljs-number">0x81</span>, <span class="hljs-number">0xBF</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0xBC</span>, <span class="hljs-number">0xAB</span>, <span class="hljs-number">0xD7</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0xB9</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x0D</span>, <span class="hljs-number">0x48</span>, <span class="hljs-number">0xDD</span>, <span class="hljs-number">0xF1</span>, <span class="hljs-number">0x71</span>, <span class="hljs-number">0xA2</span>, <span class="hljs-number">0x9D</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0xCE</span>, <span class="hljs-number">0x82</span>, <span class="hljs-number">0x21</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x92</span>, <span class="hljs-number">0xA8</span>, <span class="hljs-number">0x9E</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x9F</span>, <span class="hljs-number">0xE0</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0xB3</span>, <span class="hljs-number">0xEE</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0xDE</span>, <span class="hljs-number">0xC3</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0xC0</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0x40</span>, <span class="hljs-number">0xA8</span>, <span class="hljs-number">0x0B</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0xEB</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0xB1</span>, <span class="hljs-number">0xD9</span>, <span class="hljs-number">0xA9</span>, <span class="hljs-number">0xED</span>, <span class="hljs-number">0x72</span>, <span class="hljs-number">0xF9</span>, <span class="hljs-number">0x69</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0x9D</span>, <span class="hljs-number">0xFC</span>, <span class="hljs-number">0x86</span>, <span class="hljs-number">0x1D</span>, <span class="hljs-number">0x9F</span>, <span class="hljs-number">0xCB</span>, <span class="hljs-number">0x6D</span>, <span class="hljs-number">0x2E</span>, <span class="hljs-number">0x2E</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0xC4</span>, <span class="hljs-number">0xC3</span>, <span class="hljs-number">0x5C</span>, <span class="hljs-number">0xEB</span>, <span class="hljs-number">0xAD</span>, <span class="hljs-number">0xD1</span>, <span class="hljs-number">0xB7</span>, <span class="hljs-number">0xA2</span>, <span class="hljs-number">0x7B</span>, <span class="hljs-number">0x87</span>, <span class="hljs-number">0x28</span>, <span class="hljs-number">0x69</span>, <span class="hljs-number">0x16</span>, <span class="hljs-number">0xA9</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x7B</span>, <span class="hljs-number">0xD2</span>, <span class="hljs-number">0x6A</span>, <span class="hljs-number">0x5A</span>, <span class="hljs-number">0x90</span>, <span class="hljs-number">0x7F</span>, <span class="hljs-number">0xBB</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0x08</span>, <span class="hljs-number">0x0F</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0x19</span>, <span class="hljs-number">0xDE</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0x1A</span>, <span class="hljs-number">0xCB</span>, <span class="hljs-number">0xB4</span>, <span class="hljs-number">0x3D</span>, <span class="hljs-number">0x8A</span>, <span class="hljs-number">0xB4</span>, <span class="hljs-number">0x0F</span>]<br>enc=[<span class="hljs-number">0x0000004E</span>, <span class="hljs-number">0x00000054</span>, <span class="hljs-number">0x000000D6</span>, <span class="hljs-number">0x00000026</span>, <span class="hljs-number">0x000000C7</span>, <span class="hljs-number">0x00000097</span>, <span class="hljs-number">0x00000097</span>, <span class="hljs-number">0x0000008B</span>, <span class="hljs-number">0x00000006</span>, <span class="hljs-number">0x000000E5</span>, <span class="hljs-number">0x00000009</span>, <span class="hljs-number">0x0000009E</span>, <span class="hljs-number">0x000000BE</span>, <span class="hljs-number">0x00000057</span>, <span class="hljs-number">0x00000008</span>, <span class="hljs-number">0x0000004E</span>, <span class="hljs-number">0x00000028</span>, <span class="hljs-number">0x0000002A</span>, <span class="hljs-number">0x0000008A</span>, <span class="hljs-number">0x0000007F</span>, <span class="hljs-number">0x00000088</span>, <span class="hljs-number">0x000000C9</span>, <span class="hljs-number">0x000000F7</span>, <span class="hljs-number">0x000000EB</span>, <span class="hljs-number">0x000000E2</span>, <span class="hljs-number">0x000000BA</span>, <span class="hljs-number">0x000000F4</span>, <span class="hljs-number">0x0000005E</span>, <span class="hljs-number">0x000000E1</span>, <span class="hljs-number">0x00000040</span>, <span class="hljs-number">0x000000C0</span>, <span class="hljs-number">0x0000005A</span>]<br>rdk2=[<span class="hljs-number">0x2A</span>, <span class="hljs-number">0xEE</span>, <span class="hljs-number">0xC7</span>, <span class="hljs-number">0x59</span>, <span class="hljs-number">0xDF</span>, <span class="hljs-number">0x60</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0xD6</span>, <span class="hljs-number">0xBE</span>, <span class="hljs-number">0xC1</span>, <span class="hljs-number">0x6C</span>, <span class="hljs-number">0xF1</span>, <span class="hljs-number">0x6B</span>, <span class="hljs-number">0xF2</span>, <span class="hljs-number">0x4D</span>, <span class="hljs-number">0x6A</span>, <span class="hljs-number">0x3C</span>, <span class="hljs-number">0x85</span>, <span class="hljs-number">0x5A</span>, <span class="hljs-number">0xAF</span>, <span class="hljs-number">0xE3</span>, <span class="hljs-number">0xE5</span>, <span class="hljs-number">0x6A</span>, <span class="hljs-number">0x79</span>, <span class="hljs-number">0x5D</span>, <span class="hljs-number">0x24</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0xD6</span>, <span class="hljs-number">0x4B</span>, <span class="hljs-number">0xE2</span>, <span class="hljs-number">0xB0</span>, <span class="hljs-number">0x94</span>, <span class="hljs-number">0xB8</span>, <span class="hljs-number">0x0A</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0x71</span>, <span class="hljs-number">0xD2</span>, <span class="hljs-number">0x73</span>, <span class="hljs-number">0x0E</span>, <span class="hljs-number">0x55</span>, <span class="hljs-number">0xD4</span>, <span class="hljs-number">0xFB</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0x83</span>, <span class="hljs-number">0x9F</span>, <span class="hljs-number">0x19</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0x87</span>, <span class="hljs-number">0x40</span>, <span class="hljs-number">0xC1</span>, <span class="hljs-number">0x23</span>, <span class="hljs-number">0xF6</span>, <span class="hljs-number">0x92</span>, <span class="hljs-number">0xB2</span>, <span class="hljs-number">0x2D</span>, <span class="hljs-number">0xA3</span>, <span class="hljs-number">0x46</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0x15</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0xD9</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0xCA</span>, <span class="hljs-number">0xE3</span>, <span class="hljs-number">0xE8</span>, <span class="hljs-number">0x14</span>, <span class="hljs-number">0x3C</span>, <span class="hljs-number">0x71</span>, <span class="hljs-number">0x5A</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0x9F</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0x13</span>, <span class="hljs-number">0x2C</span>, <span class="hljs-number">0xBF</span>, <span class="hljs-number">0xEE</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0xAF</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0xC4</span>, <span class="hljs-number">0x2D</span>, <span class="hljs-number">0x93</span>, <span class="hljs-number">0x8E</span>, <span class="hljs-number">0x9E</span>, <span class="hljs-number">0x14</span>, <span class="hljs-number">0x0C</span>, <span class="hljs-number">0xB9</span>, <span class="hljs-number">0x8D</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0xB3</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0xCE</span>, <span class="hljs-number">0xA6</span>, <span class="hljs-number">0xBC</span>, <span class="hljs-number">0x86</span>, <span class="hljs-number">0xAB</span>, <span class="hljs-number">0x8B</span>, <span class="hljs-number">0x2F</span>, <span class="hljs-number">0x08</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x9F</span>, <span class="hljs-number">0x23</span>, <span class="hljs-number">0xB1</span>, <span class="hljs-number">0xB8</span>, <span class="hljs-number">0xA7</span>, <span class="hljs-number">0x90</span>, <span class="hljs-number">0xE6</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0x8A</span>, <span class="hljs-number">0xF4</span>, <span class="hljs-number">0xF2</span>, <span class="hljs-number">0x71</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0xDB</span>, <span class="hljs-number">0xFA</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0x9E</span>, <span class="hljs-number">0xF8</span>, <span class="hljs-number">0x4B</span>, <span class="hljs-number">0xFC</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0x68</span>, <span class="hljs-number">0xAD</span>, <span class="hljs-number">0x8A</span>, <span class="hljs-number">0xE0</span>, <span class="hljs-number">0xF2</span>, <span class="hljs-number">0xA3</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0xE1</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0x59</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0x7F</span>, <span class="hljs-number">0xD1</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0xC8</span>, <span class="hljs-number">0x46</span>, <span class="hljs-number">0xB9</span>, <span class="hljs-number">0xBF</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0xD8</span>, <span class="hljs-number">0xBC</span>, <span class="hljs-number">0xE1</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0x95</span>, <span class="hljs-number">0xB8</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0x46</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0xAA</span>, <span class="hljs-number">0x8B</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0xFD</span>, <span class="hljs-number">0x15</span>, <span class="hljs-number">0xC9</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0xCB</span>, <span class="hljs-number">0xA1</span>, <span class="hljs-number">0x0C</span>, <span class="hljs-number">0x28</span>, <span class="hljs-number">0x5E</span>, <span class="hljs-number">0x19</span>, <span class="hljs-number">0x4F</span>, <span class="hljs-number">0x6E</span>, <span class="hljs-number">0x1A</span>, <span class="hljs-number">0xB3</span>, <span class="hljs-number">0xC4</span>, <span class="hljs-number">0x6E</span>, <span class="hljs-number">0xE7</span>, <span class="hljs-number">0xA6</span>, <span class="hljs-number">0x0D</span>]<br>p1=enc[:<span class="hljs-number">16</span>]<br>p2=enc[<span class="hljs-number">16</span>:]<br>m1=decry(p1,rdk)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">bytes</span>(m1))<br>s=<span class="hljs-string">'jRphhACRh8TquLAKaaaaaaaaaaaaaaaa'</span><br>m2=decry(p2,rdk2)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">bytes</span>(m2))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">'flag{jRphhACRh8TquLAKHJuppYiK0gaC4MME}'</span>)<br></code></pre></td></tr></tbody></table></figure>]]></content>
    
    
    <categories>
      
      <category>CTF-WP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>RE</tag>
      
      <tag>Wp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022-10æœˆDASCTF X GFCTF</title>
    <link href="/2022/10/26/2022-10%E6%9C%88DASCTF%20X%20GFCTF/"/>
    <url>/2022/10/26/2022-10%E6%9C%88DASCTF%20X%20GFCTF/</url>
    
    <content type="html"><![CDATA[<h1>2022-10æœˆDASCTF X GFCTF</h1><blockquote><p>è€ƒç‚¹: å­—èŠ‚ç ã€ollvmæ··æ·†ã€duilibç¨‹åºé€†å‘ã€sysé©±åŠ¨ã€å¼‚å¸¸å¤„ç†</p></blockquote><p>ç®—æ³•æµ“åº¦ä¸æ˜¯å¾ˆé«˜ï¼ŒğŸ¹ğŸ¹æ¯”è¾ƒå–œæ¬¢ï¼Œbabysysä¸ªäººæ„Ÿè§‰é¢˜ç›®ä¸é”™ï¼Œæœ¬æ–‡ä¹Ÿä¸»è¦ä»‹ç»äº†è¯¥é¢˜çš„åšé¢˜æ€è·¯ã€‚</p><h3 id="PYCODE">PYCODE</h3><p>version3.9ï¼Œdisæ‹¿å­—èŠ‚ç ï¼Œç›´æ¥ç¿»è¯‘å³å¯ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></div></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br>cc=<span class="hljs-string">'8b2e4e858126bc8478d6a6a485215f03'</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">extract_number</span>(<span class="hljs-params">x</span>):</span><br>    x = x ^ (x &gt;&gt; <span class="hljs-number">11</span>)<br>    x=x&amp;<span class="hljs-number">0xffffffff</span><br>    x = x ^ ((x &lt;&lt; <span class="hljs-number">7</span>) &amp; <span class="hljs-number">2022072721</span>)<br>    x = x &amp; <span class="hljs-number">0xffffffff</span><br>    x = x ^ ((x &lt;&lt; <span class="hljs-number">15</span>) &amp; <span class="hljs-number">2323163360</span>)<br>    x = x &amp; <span class="hljs-number">0xffffffff</span><br>    x = x ^ (x &gt;&gt; <span class="hljs-number">18</span>)<br>    x = x &amp; <span class="hljs-number">0xffffffff</span><br>    <span class="hljs-keyword">return</span> x<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">transform</span>(<span class="hljs-params">m</span>):</span><br>    new_message = <span class="hljs-string">''</span><br>    l = <span class="hljs-built_in">len</span>(m)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(l//<span class="hljs-number">4</span>):<br>        enc = m[<span class="hljs-number">4</span> * i:<span class="hljs-number">4</span> * i + <span class="hljs-number">4</span>]<br>        enc = bytes_to_long(enc)<br>        enc = extract_number(enc)<br>        new_message += long_to_bytes(enc, <span class="hljs-number">4</span>)<br>    <span class="hljs-keyword">return</span>  new_message<br>cc=<span class="hljs-built_in">bytes</span>.fromhex(cc)<br>c=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(cc)//<span class="hljs-number">4</span>):<br>    c.append(bytes_to_long(cc[<span class="hljs-number">4</span>*i:<span class="hljs-number">4</span>*i+<span class="hljs-number">4</span>]))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">re</span>(<span class="hljs-params">x</span>):</span><br>    x=x^(x&gt;&gt;<span class="hljs-number">18</span>)<br>    t=(x^((x&lt;&lt;<span class="hljs-number">15</span>)&amp;<span class="hljs-number">2323163360</span>))&amp;<span class="hljs-number">0xffffffff</span><br>    x=x^((t&lt;&lt;<span class="hljs-number">15</span>)&amp;<span class="hljs-number">2323163360</span>)<br>    x = x &amp; <span class="hljs-number">0xffffffff</span><br>    t1=(x ^ ((x &lt;&lt; <span class="hljs-number">7</span>) &amp; <span class="hljs-number">2022072721</span>))&amp;<span class="hljs-number">0xffffffff</span> <span class="hljs-comment">#14</span><br>    t2=(x ^ ((t1 &lt;&lt; <span class="hljs-number">7</span>) &amp; <span class="hljs-number">2022072721</span>))&amp;<span class="hljs-number">0xffffffff</span><span class="hljs-comment">#21</span><br>    t3=(x ^ ((t2 &lt;&lt; <span class="hljs-number">7</span>) &amp; <span class="hljs-number">2022072721</span>))&amp;<span class="hljs-number">0xffffffff</span> <span class="hljs-comment">#28</span><br>    x=x ^ ((t3 &lt;&lt; <span class="hljs-number">7</span>) &amp; <span class="hljs-number">2022072721</span>)<br>    x = x &amp; <span class="hljs-number">0xffffffff</span><br>    t = x ^ (x &gt;&gt; <span class="hljs-number">11</span>) <span class="hljs-comment">#22</span><br>    x=x ^ (t &gt;&gt; <span class="hljs-number">11</span>)<br>    <span class="hljs-keyword">return</span> x<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(c)):<br>    <span class="hljs-built_in">print</span>(long_to_bytes(re(c[i])).<span class="hljs-built_in">hex</span>(),end=<span class="hljs-string">''</span>)<br><span class="hljs-comment">#DASCTF{89196e63ab5556e7389d2bb44f8e6e06}</span><br></code></pre></td></tr></tbody></table></figure><h3 id="è´ªç©CTF">è´ªç©CTF</h3><p>ä¸»è¦é€»è¾‘åœ¨<code>sub_7FF6A72619C0</code>,TLSå‡½æ•°åˆåè°ƒè¯•ï¼Œnopæ‰å³å¯ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®æ¡ä»¶æ–­ç‚¹ä¾¿äºè°ƒè¯•ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221023180526090.png" alt="image-20221023180526090"></p><p>å¯¹è´¦å·åŠ å¯†å•çº¯å¼‚æˆ–æœ€åä¸€ä½ï¼Œå¯¹å¯†ç åŠ å¯†åˆ™æ˜¯AESï¼Œé¦–å…ˆä¼šåŠ¨æ€æ¢å¤sboxã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221023180723914.png" alt="image-20221023180723914"></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python">s=[ <span class="hljs-number">0x04</span>, <span class="hljs-number">0x1F</span>, <span class="hljs-number">0x1F</span>, <span class="hljs-number">0x1E</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0x4B</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x16</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0x55</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0x73</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">15</span>):<br>    s[i]^=s[<span class="hljs-number">15</span>]<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">bytes</span>(s))<br>k=<span class="hljs-built_in">bytes</span>(s)<br><span class="hljs-comment">#wllm08067sec&amp;das</span><br><span class="hljs-keyword">from</span> Crypto.Cipher.AES <span class="hljs-keyword">import</span> *<br>aes=new(k,MODE_ECB)<br>c=<span class="hljs-built_in">bytes</span>([<span class="hljs-number">0x3C</span>, <span class="hljs-number">0x97</span>, <span class="hljs-number">0x72</span>, <span class="hljs-number">0x96</span>, <span class="hljs-number">0x5A</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x9C</span>, <span class="hljs-number">0x97</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x4D</span>, <span class="hljs-number">0x90</span>, <span class="hljs-number">0x84</span>, <span class="hljs-number">0xE8</span>, <span class="hljs-number">0x5F</span>, <span class="hljs-number">0x56</span>])<br><span class="hljs-built_in">print</span>(aes.decrypt(c))<br><span class="hljs-comment">#DASCTF{wllm08067sec&amp;dase4deb7a6510a10f7}</span><br></code></pre></td></tr></tbody></table></figure><h3 id="cutere">cutere</h3><p>é€šè¿‡ä¸€åœºå¤„ç†ä¿®æ”¹äº†rc4çš„ç§˜é’¥å’Œbase64è¡¨ï¼ŒåŠ å¯†ä¸»ä½“éƒ¨åˆ†é‡‡ç”¨ollvmæ··æ·†è¿‡äº†ï¼Œä¸è¿‡åŠ å¯†é€»è¾‘æ²¡å˜ï¼Œè°ƒè¯•å‡ºå…³é”®å€¼ç›´æ¥è§£å¯†å³å¯ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221023181006551.png" alt="image-20221023181006551"></p><p>ç›´æ¥cyberchefä¸€æŠŠæ¢­</p><p>rc4</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221023181117914.png" alt="image-20221023181117914"></p><p>æ¢è¡¨base64</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221023181223173.png" alt="image-20221023181223173"></p><p>æœ€åäº¤æ›¿æ‹¼æ¥å³å¯</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(<span class="hljs-string">'a'</span>*<span class="hljs-number">32</span>)<br>rc4=<span class="hljs-string">'szv~'</span><br>buf0=<span class="hljs-string">'DST{Wo7Xj5Ad8Nx8'</span><br>buf1=<span class="hljs-string">'ACFg0Gw1Jo5Ix9C}'</span><br>nbase=<span class="hljs-string">'ghijklmnopqrstuvwxyz0123456789+/ABCDEFGHIJKLMNOPQRSTUVWXYZabcdef'</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(buf1)):<br>    <span class="hljs-built_in">print</span>(buf0[i]+buf1[i],end=<span class="hljs-string">''</span>)<br></code></pre></td></tr></tbody></table></figure><h2 id="babysys">babysys</h2><blockquote><p>æ— åŒå‡»è°ƒè¯•ç»éªŒï¼Œåªèƒ½ç¡¬åŠ¨æ€åˆ†æã€‚æœ¬é¢˜å†…æ ¸æˆåˆ†ä¸å¤šï¼Œä¸»è¦æ˜¯å¼‚å¸¸å¤„ç†ï¼Œæ„Ÿè°¢Retardçˆ·çš„ç‚¹æ’­ï¼ŒğŸ¹ğŸ¹æˆ‘å•Š~ ï¼Œæ‰ç†æ¸…ç¨‹åºé€»è¾‘ã€‚</p></blockquote><h3 id="å¼‚å¸¸è¡¥å……">å¼‚å¸¸è¡¥å……</h3><blockquote><p>å…³äºx64SEHç›¸å…³è¡¥å……ï¼Œä¿®å¤æ§åˆ¶æµçš„ç›¸å…³ç»“æ„ä½“</p></blockquote><h4 id="å¼‚å¸¸æ³¨å†Œ">å¼‚å¸¸æ³¨å†Œ</h4><p>æ¯ä¸ªéå¶å‡½æ•°åªè¦å¯¹åº”ä¸€ä¸ª<code>RUNTIME_FUNCTION</code>ç»“æ„ä½“ï¼Œå¦‚æœå¶å‡½æ•°ä½¿ç”¨äº†SEHï¼Œä¹Ÿä¼šæœ‰å¯¹åº”çš„ç»“æ„ä½“ã€‚</p><blockquote><p>ä¸è°ƒç”¨å‡½æ•°ã€åˆæ²¡æœ‰ä¿®æ”¹æ ˆæŒ‡é’ˆï¼Œä¹Ÿæ²¡æœ‰ä½¿ç”¨ SEH çš„å‡½æ•°å°±å«åšâ€œå¶å‡½æ•°â€ï¼Œæ ‘çš„å¶å­èŠ‚ç‚¹ã€‚</p></blockquote><p>x64 windowsä¸­å¼‚å¸¸æ³¨å†Œä¿¡æ¯å‘ç”Ÿäº†å·¨å¤§çš„æ”¹å˜ï¼Œå¼‚å¸¸æ³¨å†Œä¿¡æ¯åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ç”Ÿæˆï¼Œé“¾æ¥æ—¶å†™å…¥ PE+ å¤´ä¸­çš„ <code>ExceptionDirectory</code> ï¼Œå…¶ä¸­å‡ ä¹åŒ…å«æ‰€æœ‰å‡½æ•°çš„æ ˆæ“ä½œã€å¼‚å¸¸å¤„ç†ç­‰ä¿¡æ¯ã€‚</p><p>ç¨‹åºå‡ºç°å¼‚å¸¸-&gt;æŸ¥æ‰¾å‡½æ•°çš„<code>runtime_function</code>ç»“æ„ä½“-&gt;æ‰¾åˆ°<code>unwind_info</code>,åˆ¤æ–­flagsï¼Œå¦‚æœæ²¡æœ‰å¼‚å¸¸å¤„ç†ç¨‹åºï¼Œé‚£ä¹ˆæ ¹æ®å¼‚å¸¸çš„ä½ç½®å‚ç…§<code>unwind_code</code>è¿›è¡Œå›æ»šï¼Œè¿”å›åˆ°ä¸Šå±‚å‡½æ•°ï¼Œç»§ç»­æŸ¥<code>runtime_function</code>ç»“æ„ä½“ï¼ŒæŸ¥çœ‹æœ‰æ— å¤„ç†å‡½æ•°ï¼Œå¦‚æœæœ‰åˆ™è¿›è¡Œå¼‚å¸¸å¤„ç†ï¼Œå¦‚æœæ— åˆ™ç»§ç»­å›æ»šé‡å¤æŸ¥<code>runtime_function</code>ã€‚</p><blockquote><p>è‡³äºfindallyå—çš„æ‰§è¡Œï¼Œæ»¡è¶³å…¨å±€å±•å¼€ï¼Œä¼šå…ˆæ‰¾ä¸€ä¸ªå¼‚å¸¸è¿‡æ»¤ç¨‹åºæ‰§è¡Œï¼Œå¦‚æœè¿”å›1</p></blockquote><p><code>ExceptionDir</code></p><p>å…¶ä¸­åŒ…å«å¤šæ¡å­—æ®µ<code>RUNTIME_FUNCTION</code>,ä¸€å…±12å­—èŠ‚ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">IMAGE_RUNTIME_FUNCTION_ENTRY</span> {</span><br>  DWORD BeginAddress;<span class="hljs-comment">//å‡½æ•°é¦–åœ°å€</span><br>  DWORD EndAddress;<span class="hljs-comment">//å‡½æ•°ç»“æŸåœ°å€</span><br>  <span class="hljs-class"><span class="hljs-keyword">union</span> {</span><span class="hljs-comment">//å‡½æ•°unwindç›¸å…³ä¿¡æ¯</span><br>    DWORD UnwindInfoAddress;<br>    DWORD UnwindData;<br>  } DUMMYUNIONNAME;<br>} RUNTIME_FUNCTION, *PRUNTIME_FUNCTION, _IMAGE_RUNTIME_FUNCTION_ENTRY, *_PIMAGE_RUNTIME_FUNCTION_ENTRY;<br></code></pre></td></tr></tbody></table></figure><p>unwindç»“æ„ä½“è®°å½•æœ‰å…³å¼‚å¸¸å¤„ç†å’Œå‡½æ•°æ“ä½œçš„ä¿¡æ¯ï¼Œç”¨äºå›æ»šã€‚</p><blockquote><p>æ˜“å¤±å¯„å­˜å™¨rcxã€rdxã€r8ã€r9ã€r10ã€r11</p></blockquote><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">UNWIND_INFO_HDR</span></span><br><span class="hljs-class">{</span><br>  <span class="hljs-keyword">char</span> Ver3_Flags;<span class="hljs-comment">//ä½3ä½æ˜¯version é«˜5ä½æ˜¯flags</span><br>  <span class="hljs-keyword">char</span> PrologSize;<span class="hljs-comment">//å‡½æ•°å¤´å¤§å°ï¼Œå‡½æ•°å¤´ä¸€èˆ¬æ˜¯å¯¹æ ˆè¿›è¡Œå¯†é›†æ“ä½œçš„ä¸€éƒ¨åˆ†</span><br>  <span class="hljs-keyword">char</span> CntUnwindCodes;<span class="hljs-comment">//UWIND_CODEçš„æ•°é‡</span><br>  <span class="hljs-keyword">char</span> FrReg_FrRegOff;<span class="hljs-comment">// FrRegç”¨ä½œfpçš„å¯„å­˜å™¨ç¼–å·  fpä¸­å­˜æ”¾ rsp+16*FrRegOff</span><br>};<br><span class="hljs-comment">/*flagså€¼ - å…³é”®</span><br><span class="hljs-comment">UNW_FLAG_NHANDLER 0x0 ä¸å¯¹å¼‚å¸¸è¿›è¡Œå¤„ç†</span><br><span class="hljs-comment">UNW_FLAG_EHANDLER 0x01 ä½¿ç”¨Exceptå‡½æ•°è¿›è¡Œå¤„ç†ã€‚</span><br><span class="hljs-comment">UNW_FLAG_UHANDLER 0x02 ä½¿ç”¨finallyå‡½æ•°å¤„ç†ã€‚</span><br><span class="hljs-comment">UNW_FLAG_CHAININFO 0x04 ä½¿ç”¨è°ƒç”¨é“¾ï¼ŒæŸäº›å‡½æ•°è¢«å…¶ä»–å‡½æ•°è°ƒç”¨ï¼Œåœ¨å¼‚å¸¸ä¼šæ»šæ—¶ä¹Ÿéœ€è¦åšè°ƒç”¨ä»–å‡½æ•°çš„å›æ»šå·¥ä½œï¼Œå¯ä»¥ç›´æ¥ç”¨å…¶ä¸Šå±‚å‡½æ•°çš„runtime_funcå³å¯ã€‚</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></tbody></table></figure><p>å½“unwind_infoâ€”ä¸­çš„flagå­—æ®µä¸ºåä¸‰ç§æƒ…å†µæ—¶ï¼Œåç»­ä¸å®šé•¿æ•°ç»„<code>unwind_code</code>çš„ç»“æ„å¦‚ä¸‹ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221024202124917.png" alt="image-20221024202124917"></p><p>UWIND_CODEç”¨äºè®°å½•å‡½æ•°å¤´ä¸­æœ‰å…³éæ˜“å¤±æ€§å¯„å­˜å™¨å’ŒRSPçš„æ“ä½œã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">UNWIND_CODE</span></span><br><span class="hljs-class">{</span><br>  <span class="hljs-keyword">char</span> PrologOff;     <span class="hljs-comment">// æ‰§è¡Œæ­¤æ“ä½œçš„æŒ‡ä»¤æœ«å°¾çš„åç§»é‡</span><br>  <span class="hljs-keyword">char</span> OpCode_OpInfo;<br>  <span class="hljs-comment">//Unwind operation code  low  4bit</span><br>  <span class="hljs-comment">//Operation info   high 4bit</span><br>};<br></code></pre></td></tr></tbody></table></figure><p><code>PrologOff</code>è·ç¦»å¤´éƒ¨åç§»çš„åç§»é‡ï¼Œä¾‹å¦‚å€¼ä¸ºxï¼Œé‚£ä¹ˆåœ¨mainå‡½æ•°xå­—èŠ‚ä¹‹å¤–å‘ç”Ÿå¼‚å¸¸ï¼Œåˆ™éœ€è¦æ­¤æ¬¡å›æ»šï¼Œå¦åˆ™ä¸è¿›è¡Œå›æ»šï¼Œ<code>info</code>åˆ™æ˜¯æ ¹æ®opçš„ç±»å‹æ‰€éœ€çš„ç›¸å…³å‚æ•°ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221024185740395.png" alt="image-20221024185740395"></p><p>ä¾‹å¦‚<code>47a0</code>å‡½æ•°çš„ä¸€æ¡<code>unwind_code</code>å¦‚ä¸‹ï¼Œç¬¬ä¸€ä¸ªå€¼æ˜¯4ï¼Œç»“åˆå‡½æ•°å¤„çš„æ±‡ç¼–ä¸º<code>sub rsp,0x38</code>è¡¨ç¤ºçš„è¯¥4å­—èŠ‚çš„æ ˆæ“ä½œï¼Œè€Œ0x62ï¼Œä½4ä½ä¸º2å³<code>UWOP_ALLOC_SMALL</code>,å¯¹äº<code>info</code>çš„å€¼ä¸º6ï¼ŒæŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221024190207532.png" alt="image-20221024190207532"></p><p>åœ¨æ ˆä¸Šå¼€è¾Ÿäº†ä¸€ä¸ª8*<code>info</code>+8å¤§å°çš„ç©ºé—´ï¼Œå³6*8+8 = 0x38, ä¹Ÿå°±è¯¥æ¡<code>unwind_code</code>è®°å½•ç€è¯¥å‡½æ•°å‰4å­—èŠ‚åšçš„æ“ä½œåœ¨æ ˆä¸Šå¼€è¾Ÿäº†0x38çš„ç©ºé—´ï¼Œå¦‚æœåœ¨ä¹‹åå‡ºç°å¼‚å¸¸ï¼Œåˆ™å›æ»šæ—¶åˆ™éœ€è¦è¿›è¡Œç›¸åº”çš„æ ˆå¤„ç†ã€‚</p><blockquote><p>unwind_codeçš„å¤„ç†é¡ºåºå’Œå‡½æ•°ä¸­å¯¹æ ˆæ“ä½œçš„æŒ‡ä»¤ç›¸åã€‚</p></blockquote><p>å¯¹äºflagsä¸º1æˆ–2æ—¶ï¼Œå³å‡½æ•°å­˜åœ¨å¼‚å¸¸å¤„ç†/ç»ˆæ­¢å¤„ç†çš„ç¨‹åºã€‚</p><p><code>unwind_info </code>ä¸­ä¼šå¡å…¥<code>__C_specific_handler</code>å‡½æ•°ï¼Œä»–æ ¹æ®<code>SCOPE_TABLE</code>è¿›è¡Œå¼‚å¸¸å¤„ç†æˆ–ç»ˆæ­¢å¤„ç†ï¼Œè¯¥å‡½æ•°åè·Ÿ<code>SCOPE_TABLE</code>çš„æ•°é‡ï¼Œä¹‹åä¾¿æ˜¯ï¼Œç›¸å…³çš„scopeç»“æ„ä½“æ•°ç»„ã€‚</p><p><code>C_SCOPE_TABLE</code>ç»“æ„ä½“è®°å½•äº†å¼‚å¸¸å¤„ç†çš„ç»“æ„,å¤§å°16å­—èŠ‚ï¼Œ4ä¸ª<code>RVA</code>ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">C_SCOPE_TABLE</span></span><br><span class="hljs-class">{</span><br>  <span class="hljs-keyword">void</span> *__ptr32 Begin;     <span class="hljs-comment">//tryå—å¼€å§‹çš„é¦–åœ°å€</span><br>  <span class="hljs-keyword">void</span> *__ptr32 End;   <span class="hljs-comment">// tryå—ç»“æŸçš„åœ°å€</span><br>  <span class="hljs-keyword">void</span> *__ptr32 Handler;<br>  <span class="hljs-keyword">void</span> *__ptr32 Target;<br>};<br><span class="hljs-comment">/*å¯¹äºhandlerå’Œtarget</span><br><span class="hljs-comment">å¦‚æœUNWIND_INFO_HDRä¸­Flagsä¸ºUNW_FLAG_EHANDLER(1),åˆ™ä»¥æ­¤ä¸ºfilterç¨‹åºå’Œexceptç¨‹åºã€‚</span><br><span class="hljs-comment">å¦‚æœFlagsä¸ºUNW_FLAG_UHANDLER(2),åˆ™ä¸ºfinallyç¨‹åºå’Œ0ã€‚</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></tbody></table></figure><p>ç»¼ä¸Šï¼Œ<code>RUNTIME_FUNCTION</code>æœ€åä¼šæŒ‡å‘ä¸€ç³»åˆ—çš„<code>unwind_code</code>ç”¨äºå›æ»šã€‚</p><p>ç»“æ„ä½“æ±‡æ€»</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">RUNTIME_FUNCTION</span> {</span><br>        ULONG BeginAddress;<br>        ULONG EndAddress;<br>        ULONG UnwindData;<br>    } RUNTIME_FUNCTION, *PRUNTIME_FUNCTION;<br><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">enum</span> _<span class="hljs-title">UNWIND_OP_CODES</span> {</span><br>        UWOP_PUSH_NONVOL = <span class="hljs-number">0</span>,<br>        UWOP_ALLOC_LARGE,       <span class="hljs-comment">// 1</span><br>        UWOP_ALLOC_SMALL,       <span class="hljs-comment">// 2</span><br>        UWOP_SET_FPREG,         <span class="hljs-comment">// 3</span><br>        UWOP_SAVE_NONVOL,       <span class="hljs-comment">// 4</span><br>        UWOP_SAVE_NONVOL_FAR,   <span class="hljs-comment">// 5</span><br>        UWOP_SPARE_CODE1,       <span class="hljs-comment">// 6</span><br>        UWOP_SPARE_CODE2,       <span class="hljs-comment">// 7</span><br>        UWOP_SAVE_XMM128,       <span class="hljs-comment">// 8</span><br>        UWOP_SAVE_XMM128_FAR,   <span class="hljs-comment">// 9</span><br>        UWOP_PUSH_MACHFRAME     <span class="hljs-comment">// 10</span><br>    } UNWIND_OP_CODES, *PUNWIND_OP_CODES;<br><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">union</span> _<span class="hljs-title">UNWIND_CODE</span> {</span><br>        <span class="hljs-class"><span class="hljs-keyword">struct</span> {</span><br>            UCHAR CodeOffset;<br>            UCHAR UnwindOp : <span class="hljs-number">4</span>;<br>            UCHAR OpInfo : <span class="hljs-number">4</span>;<br>        };<br>    <br>        USHORT FrameOffset;<br>    } UNWIND_CODE, *PUNWIND_CODE;<br>    <br>    <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> UNW_FLAG_NHANDLER 0x0   <span class="hljs-comment">//no </span></span><br>    <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> UNW_FLAG_EHANDLER 0x1<span class="hljs-comment">//exception</span></span><br>    <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> UNW_FLAG_UHANDLER 0x2<span class="hljs-comment">//unwind(finally)</span></span><br>    <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> UNW_FLAG_CHAININFO 0x4  <span class="hljs-comment">//chain</span></span><br><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">UNWIND_INFO</span> {</span><br>        UCHAR Version : <span class="hljs-number">3</span>;     <span class="hljs-comment">//å‰éƒ¨åˆ†ä¸€å…±4å­—èŠ‚ï¼ŒIDAä¸­å®šä¹‰ä¸ºUNWIND_INFO_HDR</span><br>        UCHAR Flags : <span class="hljs-number">5</span>;   <br>        UCHAR SizeOfProlog;    <span class="hljs-comment">//å‡½æ•°å¤´éƒ¨å¤§å°</span><br>        UCHAR CountOfCodes;    <span class="hljs-comment">//ä¸å®šé•¿ç»“æ„ä½“å¤§å°ï¼Œä¸è¿‡æ›´å‡†ç¡®åº”è¯¥æ˜¯åŒ…å«çš„dwæ•°æ®çš„ä¸ªæ•°  </span><br>        UCHAR FrameRegister : <span class="hljs-number">4</span>;<br>        UCHAR FrameOffset : <span class="hljs-number">4</span>;<br>        UNWIND_CODE UnwindCode[<span class="hljs-number">1</span>]; <span class="hljs-comment">//ä¸å®šé•¿æ•°ç»„</span><br>    <br>    <span class="hljs-comment">//</span><br>    <span class="hljs-comment">// The unwind codes are followed by an optional DWORD aligned field that</span><br>    <span class="hljs-comment">// contains the exception handler address or a function table entry if</span><br>    <span class="hljs-comment">// chained unwind information is specified. If an exception handler address</span><br>    <span class="hljs-comment">// is specified, then it is followed by the language specified exception</span><br>    <span class="hljs-comment">// handler data.</span><br>    <span class="hljs-comment">//</span><br>    <span class="hljs-comment">//  union {</span><br>    <span class="hljs-comment">//      struct {</span><br>    <span class="hljs-comment">//          ULONG ExceptionHandler;</span><br>    <span class="hljs-comment">//          ULONG ExceptionData[];</span><br>    <span class="hljs-comment">//      };</span><br>    <span class="hljs-comment">//</span><br>    <span class="hljs-comment">//      RUNTIME_FUNCTION FunctionEntry;</span><br>    <span class="hljs-comment">//  };</span><br>    <span class="hljs-comment">//</span><br>    <br>    } UNWIND_INFO, *PUNWIND_INFO;<br><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">SCOPE_TABLE</span> {</span><br>        ULONG Count;<br>        <span class="hljs-class"><span class="hljs-keyword">struct</span></span><br><span class="hljs-class">        {</span><br>            ULONG BeginAddress;<br>            ULONG EndAddress;<br>            ULONG HandlerAddress;<br>            ULONG JumpTarget;<br>        } ScopeRecord[<span class="hljs-number">1</span>];<br>    } SCOPE_TABLE, *PSCOPE_TABLE;<br></code></pre></td></tr></tbody></table></figure><p>è¯¦è§å®˜æ–¹: <a href="https://learn.microsoft.com/en-us/cpp/build/exception-handling-x64?view=msvc-170">https://learn.microsoft.com/en-us/cpp/build/exception-handling-x64?view=msvc-170</a></p><h4 id="å¼‚å¸¸ä¿¡æ¯">å¼‚å¸¸ä¿¡æ¯</h4><p><code>__finally</code>ä»£ç å—ä¸ºç»ˆæ­¢ç¨‹åºï¼Œ<code>__except(filter())</code>ä¸ºå¼‚å¸¸å¤„ç†ç¨‹åº,<code>filter</code>ä¸ºå¼‚å¸¸è¿‡æ»¤ç¨‹åºï¼Œè¿”å›å€¼æœ‰ä¸‰ç§æƒ…å†µã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c">EXCEPTION_CONTINUE_EXECUTION(<span class="hljs-number">-1</span>)  <span class="hljs-comment">//åœ¨å‘ç”Ÿå¼‚å¸¸çš„åœ°æ–¹ç»§ç»­æ‰§è¡Œ</span><br>EXCEPTION_EXECUTE_HANDLER(<span class="hljs-number">1</span>)    <span class="hljs-comment">//æ‰§è¡Œå¼‚å¸¸å¤„ç†ç¨‹åº</span><br>EXCEPTION_CONTINUE_SEARCH(<span class="hljs-number">0</span>)    <span class="hljs-comment">//ç»§ç»­å‘ä¸Šå¯»æ‰¾å¼‚å¸¸è¿‡æ»¤ç¨‹åºï¼Œç›´åˆ°èƒ½å¤„ç†    </span><br></code></pre></td></tr></tbody></table></figure><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221024221213623.png" alt="image-20221024221213623"></p><blockquote><p>ç³Š~</p></blockquote><p>å¼‚å¸¸å¤„ç†ä¸­ä¸å¼‚å¸¸ä¿¡æ¯ç›¸å…³ç»“æ„ä½“ï¼Œå¯ç”±GetExceptionInformationå‡½æ•°è·å–ï¼Œè¿”å›<code>EXCEPTION_POINTERS</code>ç±»å‹çš„æŒ‡é’ˆã€‚</p><p><code>EXCEPTION_POINTERS</code></p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">EXCEPTION_POINTERS</span> {</span><br>  PEXCEPTION_RECORD ExceptionRecord; <span class="hljs-comment">//ä¸CPUæ— å…³çš„ä¿¡æ¯</span><br>  PCONTEXT          ContextRecord; <span class="hljs-comment">//CPUç›¸å…³çš„å¼‚å¸¸ä¿¡æ¯ï¼Œå¯„å­˜å™¨ç­‰ã€‚</span><br>} EXCEPTION_POINTERS, *PEXCEPTION_POINTERS;<br></code></pre></td></tr></tbody></table></figure><p><code>PEXCEPTION_RECORD</code></p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">EXCEPTION_RECORD</span> {</span><br>  DWORD                    ExceptionCode;<br>  DWORD                    ExceptionFlags;<br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">EXCEPTION_RECORD</span> *<span class="hljs-title">ExceptionRecord</span>;</span><br>  PVOID                    ExceptionAddress;<br>  DWORD                    NumberParameters;<br>  ULONG_PTR                ExceptionInformation[EXCEPTION_MAXIMUM_PARAMETERS];<br>} EXCEPTION_RECORD;<br></code></pre></td></tr></tbody></table></figure><h3 id="é¢˜è§£">é¢˜è§£</h3><p>ç”¨æˆ·ç¨‹åºè®¿é—®é©±åŠ¨ï¼Œé€šè¿‡<code>CreateFile</code>è®¿é—®è®¾å¤‡ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221024222100867.png" alt="image-20221024222100867"></p><p>åŒæ—¶ä½¿ç”¨<code>DeviceIoControl</code>å‡½æ•°å‘é©±åŠ¨å‘é€ä¿¡æ¯ï¼Œæ§åˆ¶è®¾å¤‡æ‰§è¡Œç›¸å…³æ“ä½œï¼Œæ“ä½œæ§åˆ¶ä»£ç ä¸º0x222000ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">BOOL <span class="hljs-title">DeviceIoControl</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">  (HANDLE) hDevice,                 <span class="hljs-comment">// handle to device</span></span></span><br><span class="hljs-params"><span class="hljs-function">  <span class="hljs-literal">NULL</span>,                             <span class="hljs-comment">// lpInBuffer</span></span></span><br><span class="hljs-params"><span class="hljs-function">  <span class="hljs-number">0</span>,                                <span class="hljs-comment">// nInBufferSize</span></span></span><br><span class="hljs-params"><span class="hljs-function">  (LPVOID) lpOutBuffer,             <span class="hljs-comment">// output buffer</span></span></span><br><span class="hljs-params"><span class="hljs-function">  (DWORD) nOutBufferSize,           <span class="hljs-comment">// size of output buffer</span></span></span><br><span class="hljs-params"><span class="hljs-function">  (LPDWORD) lpBytesReturned,        <span class="hljs-comment">// number of bytes returned</span></span></span><br><span class="hljs-params"><span class="hljs-function">  (LPOVERLAPPED) lpOverlapped       <span class="hljs-comment">// OVERLAPPED structure</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>;<br></code></pre></td></tr></tbody></table></figure><p>é©±åŠ¨ç¨‹åºé€šè¿‡<code>IoCreateDevice</code>åˆ›å»ºè®¾å¤‡åç§°ï¼Œå¹¶ä½¿ç”¨<code>IoCreateSymbolicLink</code>åˆ›å»ºç¬¦å·é“¾æ¥ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221024222622619.png" alt="image-20221024222622619"></p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">DRIVER_OBJECT</span> {</span><br>  CSHORT             Type;<br>  CSHORT             Size;<br>  PDEVICE_OBJECT     DeviceObject;<br>  ULONG              Flags;<br>  PVOID              DriverStart;<br>  ULONG              DriverSize;<br>  PVOID              DriverSection;<br>  PDRIVER_EXTENSION  DriverExtension;<br>  UNICODE_STRING     DriverName;<br>  PUNICODE_STRING    HardwareDatabase;<br>  PFAST_IO_DISPATCH  FastIoDispatch;<br>  PDRIVER_INITIALIZE DriverInit;<br>  PDRIVER_STARTIO    DriverStartIo;<br>  PDRIVER_UNLOAD     DriverUnload;<br>  PDRIVER_DISPATCH   MajorFunction[IRP_MJ_MAXIMUM_FUNCTION + <span class="hljs-number">1</span>];<br>} DRIVER_OBJECT, *PDRIVER_OBJECT;<br></code></pre></td></tr></tbody></table></figure><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221023233226231.png" alt="image-20221023233226231"></p><p>å¹¶ä¸”é©±åŠ¨ç¨‹åºæ³¨å†Œäº†ä¸€ä¸ª<code>DriverObject-&gt;MajorFunction[14]</code>çš„å‡½æ•°ï¼Œ0xeå¯¹åº”ç€<code>IRP_MJ_DEVICE_CONTROL</code>,å³åº”ç”¨ç¨‹åºè°ƒç”¨<code> DeviceIoControl</code>ï¼Œä¼šæŒ‡å‘æ³¨å†Œçš„<code>sub_14000175C</code>å‡½æ•°ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221024230024387.png" alt="image-20221024230024387"></p><p>è¯¥å‡½æ•°ä¼šåŒ¹é…æ“ä½œæ§åˆ¶ç ï¼Œå¹¶ä¸”è·å–åº”ç”¨ç¨‹åºä¼ å…¥çš„è¾“å…¥è®¡ç®—å…¶é•¿åº¦ï¼Œå¹¶ä½¿ç”¨<code>sub_1400018d8</code>å‡½æ•°è¿›è¡Œå¤„ç†ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221024230632623.png" alt="image-20221024230632623"></p><p>åç»­å‡½æ•°å¤šä½¿ç”¨å¼‚æˆ–æ¥åšSMCï¼Œå¹¶ä¸”åœ¨è°ƒç”¨åæ¢å¤ã€‚</p><p><code>get_func_len</code>å‡½æ•°æ˜¯é€šè¿‡è®¿é—®<code>runtime_function</code>ç»“æ„ä½“è·å–å‡½æ•°å¼€å§‹å’Œç»“æŸä½ç½®åšå·®è·å–ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221024231130224.png" alt="image-20221024231130224"></p><p>å¦‚æœå¯¹PEæ–‡ä»¶ç†Ÿæ‚‰çš„è¯ï¼Œ<code>0x3c</code>æ˜¯doså¤´æœ€åå››å­—èŠ‚ï¼ŒæŒ‡å‘NTå¤´ï¼Œè€Œ0xA0åˆ™å¯¹åº”<code>ExceptionDir</code>çš„é¦–åœ°å€ï¼Œç›¸å…³ç»“æ„ä½“ä¸Šæ–‡å·²ç»™å‡ºã€‚</p><p>ä½¿ç”¨ipyè§£å¯†ä»£ç ï¼Œä½†æ˜¯å‘ç°åæ–‡å¹¶æ²¡æœ‰ç›´æ¥è°ƒç”¨ï¼Œè€Œæ˜¯åœ¨è°ƒç”¨<code>hook_2_func_encrypt</code>åå°±å°†è§£å¯†åçš„ä»£ç è¿˜åŸäº†ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> idautils<br>adr=<span class="hljs-number">0x140001288</span><br>end=<span class="hljs-number">0x1400014C1</span><br>size=end-adr<br>code=<span class="hljs-built_in">bytearray</span>(get_bytes(adr,size))<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(code)):<br>    code[i]^=<span class="hljs-number">0xab</span><br>    patch_byte(adr+i,code[i])<br><span class="hljs-built_in">print</span>(<span class="hljs-string">'win'</span>)<br></code></pre></td></tr></tbody></table></figure><p>æŸ¥çœ‹<code>hook_2_func_encrypt</code>åœ°å€çš„å‡½æ•°ï¼Œå…¶é€šè¿‡è§¦å‘int3å¼‚å¸¸æ¥æ‰§è¡Œå¼‚å¸¸è¿‡æ»¤ç¨‹åºï¼Œè¿™æ ·ä¾¿èƒ½è°ƒç”¨åˆšåˆšè§£å¯†çš„<code> sub_140001288</code>å‡½æ•°ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221024231929089.png" alt="image-20221024231929089"></p><p><code>sub_140001288</code></p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221024232450647.png" alt="image-20221024232450647"></p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221025083058978.png" alt="image-20221025083058978"></p><p>é€šè¿‡v3(cnt)ä»0å¼€å§‹è®¡æ•°ï¼Œå¹¶æ¯”å¯¹v3çš„å€¼å®Œæˆä¸åŒæ“ä½œã€‚å¦‚æœv3çš„å€¼å°äº7ï¼Œåˆ™æ‰§è¡Œå¦å¤–ä¸¤ç»„æ“ä½œã€‚å¹¶ä¸”åœ¨æœ€åé€šè¿‡<code>EXCEPTION_POINTERS</code>è·å–å¼‚å¸¸ipï¼Œå¦‚æœå¼‚å¸¸å¤„æŒ‡ä»¤ä¸º0xccå¹¶ä¸”v3ä¸ç­‰äº1å°±å°†ipåŠ 1åè¿”å›ï¼Œè¿”å›å€¼ä¸º-1å³ç»§ç»­åœ¨å¼‚å¸¸å¤„æ‰§è¡Œã€‚</p><p>å¦‚æœv3ä¸º1æˆ–3æ—¶ï¼Œä¼šå…ˆå¯¹è¾“å…¥è¿›è¡Œ+içš„å¤„ç†ï¼Œä¹‹åè°ƒç”¨<code>sub_140001AB4</code>å‡½æ•°ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221025085825841.png" alt="image-20221025085825841"></p><p><code>sub_140001AB4</code>å‡½æ•°åŠ å¯†é€»è¾‘å¦‚ä¸‹</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221025090206334.png" alt="image-20221025090206334"></p><p>é€šè¿‡è®¡ç®—ä¸¤ä¸ªå›ºå®šå‡½æ•°çš„md5ç›¸å¼‚æˆ–ï¼Œå°†å¾—åˆ°çš„32ä¸ªå­—ç¬¦åˆ†ä¸º16ä¸ªå­—èŠ‚ä¸€ç»„ï¼Œç¬¬ä¸€ç»„ç”¨åšteaåŠ å¯†ï¼Œç¬¬äºŒç»„ç”¨ä½œteaè§£å¯†ï¼Œç±»ä¼¼3DESå¤„ç†ã€‚</p><p>å½“v3ç­‰äº2/4æ—¶ï¼Œä¼šé¦–å…ˆè°ƒç”¨<code> sub_140001C60</code>,å¹¶ä¸”å¼‚æˆ–0x10ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221025090522937.png" alt="image-20221025090522937"></p><p>ä¸€å…±æœ‰6ä¸ªint3ï¼Œå¹¶ä¸”ç¬¬ä¸€æ¬¡ä¸æ”¹ipæ•…cntä¸€å…±åŠ äº†7æ¬¡ï¼Œç¬¬7æ¬¡è¿›å…¥ifå—å¤„ç†ã€‚</p><p>é¦–å…ˆä¼šè°ƒç”¨<code>sub_140001868</code>å‡½æ•°ï¼Œä¿®æ”¹è§¦å‘å¼‚å¸¸å‡½æ•°çš„<code>runtime_function</code>ç»“æ„ä½“ï¼Œä¿®æ”¹å…¶å¼‚å¸¸å¤„ç†ç¨‹åºä¸º<code>0x140001009</code>å¤„çš„<code>func_encrypt</code>å‡½æ•°ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221025094325672.png" alt="image-20221025094325672"></p><p>ä¹‹åä¼šå°†<code>sub_1400014C4</code>å‡½æ•°å¼‚æˆ–0x66ï¼Œå¹¶ä¸”è¿”å›-1ï¼Œä¸‹æ¬¡è§¦å‘å¼‚å¸¸å¯¹åº”çš„cntä¸º8åˆ™è¿”å›1ï¼Œé‚£ä¹ˆå¼‚å¸¸ç”±exceptå—çš„å¼‚å¸¸å¤„ç†ç¨‹åºè¿›è¡Œå¤„ç†ï¼Œå³è°ƒç”¨åˆšåˆšä¿®æ”¹çš„<code>0x140001009 </code>åœ°å€å¤„çš„å‡½æ•°ã€‚</p><blockquote><p>å¯¹<code>sub_1400014C4</code>å‡½æ•°è¿˜ä¼šå¼‚æˆ–0xccï¼Œè°ƒç”¨ç»“æŸåä¼šå¼‚æˆ–0xaaï¼Œå› ä¸º0x66^0xcc == 0xaa,è¿™é‡Œå¥—äº†ä¸€å±‚ã€‚</p></blockquote><p>å‡½æ•°çš„smcä¸åœ¨èµ˜è¿°ï¼Œå¤„ç†æµç¨‹ä¸ºå°†å¯†æ–‡å†å¼‚æˆ–0x99å¹¶ä½¿ç”¨<code>sub_140001C60</code>è¿›è¡ŒteaåŠ å¯†ï¼Œç»“æœä¸v11æ¯”å¯¹ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221026172745157.png" alt="image-20221026172745157"></p><p><code>sub_140001c60</code>å‡½æ•°</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> __fastcall <span class="hljs-title">sub_140001C60</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> *a1)</span></span><br><span class="hljs-function"></span>{<br>  __int64 v2; <span class="hljs-comment">// r10</span><br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> v0; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-keyword">int</span> sum; <span class="hljs-comment">// r11d</span><br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> v1; <span class="hljs-comment">// r9d</span><br>  __int64 round; <span class="hljs-comment">// rbx</span><br><br>  v2 = <span class="hljs-number">5</span>i64;<br>  <span class="hljs-keyword">do</span><br>  {<br>    v0 = *a1;<br>    sum = <span class="hljs-number">0</span>;<br>    v1 = a1[<span class="hljs-number">1</span>];<br>    round = <span class="hljs-number">32</span>i64;<br>    <span class="hljs-keyword">do</span><br>    {<br>      sum -= <span class="hljs-number">0x61C88647</span>;<br>      v0 += (<span class="hljs-number">16</span> * v1 + <span class="hljs-number">17</span>) ^ ((v1 &gt;&gt; <span class="hljs-number">5</span>) + <span class="hljs-number">34</span>) ^ (sum + v1);<br>      v1 += (<span class="hljs-number">16</span> * v0 + <span class="hljs-number">51</span>) ^ ((v0 &gt;&gt; <span class="hljs-number">5</span>) + <span class="hljs-number">68</span>) ^ (sum + v0);<br>      --round;<br>    }<br>    <span class="hljs-keyword">while</span> ( round );<br>    *a1 = v0;<br>    a1[<span class="hljs-number">1</span>] = v1;<br>    a1 += <span class="hljs-number">2</span>;<br>    --v2;<br>  }<br>  <span class="hljs-keyword">while</span> ( v2 );<br>}<br></code></pre></td></tr></tbody></table></figure><p>æ•´ä½“åŠ å¯†æµç¨‹ç®€åŒ–åå¦‚ä¸‹</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//å¾ªç¯ä¸¤è½®</span><br>ms[i]+=i<br>sub_140001AB4(v2); <span class="hljs-comment">//ä¸¤ä¸ªtea åŠ å¯† è§£å¯†</span><br>sub_140001C60(v2); <span class="hljs-comment">//tea</span><br>ms[i]^=<span class="hljs-number">0x10</span><br>    <br><span class="hljs-comment">//sub_140001638å¼‚å¸¸å¤„ç†å‡½æ•°</span><br>ms[i]^=<span class="hljs-number">0x99</span><br>sub_140001C60(v2) <span class="hljs-comment">//tea</span><br></code></pre></td></tr></tbody></table></figure><p>ç®—æ³•æ— é­”æ”¹ï¼Œåªè¦å–åˆ°keyå€¼å³å¯ï¼Œè§£å¯†è„šæœ¬å¦‚ä¸‹ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ut32 unsigned int</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> delta 0x9e3779b9</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> __fastcall <span class="hljs-title">sub_140001C60</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>* a1)</span></span><br><span class="hljs-function"></span>{<br>__int64 v2; <span class="hljs-comment">// r10</span><br><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> v0; <span class="hljs-comment">// r8d</span><br><span class="hljs-keyword">int</span> sum; <span class="hljs-comment">// r11d</span><br><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> v1; <span class="hljs-comment">// r9d</span><br>__int64 round; <span class="hljs-comment">// rbx</span><br><br>v2 = <span class="hljs-number">1</span>i64;<br><span class="hljs-keyword">do</span><br>{<br>v0 = *a1;<br>sum = <span class="hljs-number">0</span>;<br>v1 = a1[<span class="hljs-number">1</span>];<br>round = <span class="hljs-number">32</span>i64;<br><span class="hljs-keyword">do</span><br>{<br>sum -= <span class="hljs-number">0x61C88647</span>;<br>v0 += (<span class="hljs-number">16</span> * v1 + <span class="hljs-number">17</span>) ^ ((v1 &gt;&gt; <span class="hljs-number">5</span>) + <span class="hljs-number">34</span>) ^ (sum + v1);<br>v1 += (<span class="hljs-number">16</span> * v0 + <span class="hljs-number">51</span>) ^ ((v0 &gt;&gt; <span class="hljs-number">5</span>) + <span class="hljs-number">68</span>) ^ (sum + v0);<br>--round;<br>}     <span class="hljs-keyword">while</span> (round);<br>*a1 = v0;<br>a1[<span class="hljs-number">1</span>] = v1;<br>a1 += <span class="hljs-number">2</span>;<br>--v2;<br>}   <span class="hljs-keyword">while</span> (v2);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">"sum: %08x\n"</span>, sum);<br>}<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Tea_Encrypt</span><span class="hljs-params">(ut32* src, ut32* k)</span> </span>{<br>ut32 sum = <span class="hljs-number">0</span>;<br>ut32 v0 = src[<span class="hljs-number">0</span>];<br>ut32 v1 = src[<span class="hljs-number">1</span>];<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">0x20</span>; i++) {<br>sum += delta;<br>v0 += ((v1 &lt;&lt; <span class="hljs-number">4</span>) + k[<span class="hljs-number">0</span>]) ^ (v1 + sum) ^ ((v1 &gt;&gt; <span class="hljs-number">5</span>) + k[<span class="hljs-number">1</span>]);<br>v1 += ((v0 &lt;&lt; <span class="hljs-number">4</span>) + k[<span class="hljs-number">2</span>]) ^ (v0 + sum) ^ ((v0 &gt;&gt; <span class="hljs-number">5</span>) + k[<span class="hljs-number">3</span>]);<br>}<br>src[<span class="hljs-number">0</span>] = v0;<br>src[<span class="hljs-number">1</span>] = v1;<br>}<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Tea_Decrypt</span><span class="hljs-params">(ut32* enc, ut32* k)</span> </span>{<br><span class="hljs-keyword">int</span> sum = delta * <span class="hljs-number">0x20</span>;<br>ut32 v0 = enc[<span class="hljs-number">0</span>];<br>ut32 v1 = enc[<span class="hljs-number">1</span>];<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">0x20</span>; i++) {<br>v1 -= ((v0 &lt;&lt; <span class="hljs-number">4</span>) + k[<span class="hljs-number">2</span>]) ^ (v0 + sum) ^ ((v0 &gt;&gt; <span class="hljs-number">5</span>) + k[<span class="hljs-number">3</span>]);<br>v0 -= ((v1 &lt;&lt; <span class="hljs-number">4</span>) + k[<span class="hljs-number">0</span>]) ^ (v1 + sum) ^ ((v1 &gt;&gt; <span class="hljs-number">5</span>) + k[<span class="hljs-number">1</span>]);<br>sum -= delta;<br>}<br>enc[<span class="hljs-number">0</span>] = v0;<br>enc[<span class="hljs-number">1</span>] = v1;<br>}<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">output</span><span class="hljs-params">(ut32* m, ut32 n)</span> </span>{<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++)<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">"0x%08x "</span>, m[i]);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">"\n"</span>);<br>}<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{<br>ut32 m[<span class="hljs-number">10</span>] = { <span class="hljs-number">0xbb929b51</span>,<span class="hljs-number">0x25fed57f</span>,<span class="hljs-number">0x988aa03d</span>,<span class="hljs-number">0xbdc35d79</span>,<span class="hljs-number">0xe60aca2f</span>,<span class="hljs-number">0xf2755515</span>,<span class="hljs-number">0x67aa0fc2</span>,<span class="hljs-number">0xeb1992a8</span>,<span class="hljs-number">0x62759e50</span>,<span class="hljs-number">0x461e460c</span> };<br>ut32 k1[<span class="hljs-number">4</span>] = { <span class="hljs-number">0x656565e</span>,<span class="hljs-number">0x57575207</span>,<span class="hljs-number">0x5201040a</span>,<span class="hljs-number">0xf045605</span> };<br><br>ut32 k2[<span class="hljs-number">4</span>] = { <span class="hljs-number">0x7595701</span>,<span class="hljs-number">0x5601560c</span>,<span class="hljs-number">0x5651565a</span>,<span class="hljs-number">0x5525056</span> };<br><br>ut32 k[<span class="hljs-number">4</span>] = { <span class="hljs-number">17</span>,<span class="hljs-number">34</span>,<span class="hljs-number">51</span>,<span class="hljs-number">68</span> };<br><br><span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">10</span>;i+=<span class="hljs-number">2</span>)<br>Tea_Decrypt(m+i, k);<br><br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {<br>m[i] ^= <span class="hljs-number">0x99999999</span>;<br>}<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">2</span>; j++) {<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++)<br>m[i] ^= <span class="hljs-number">0x10101010</span>;<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i += <span class="hljs-number">2</span>) {<br>Tea_Decrypt(m + i, k);<br>Tea_Encrypt(m + i, k2);<br>Tea_Decrypt(m + i, k1);<br>}<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">40</span>; i++) {<br>*((<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>*)m + i) -= i;<br>}<br>}<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">40</span>; i++) {<br><span class="hljs-built_in">putchar</span>(*((<span class="hljs-keyword">char</span>*)m + i));<br>}<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}<br></code></pre></td></tr></tbody></table></figure><h3 id="å‚è€ƒ">å‚è€ƒ</h3><p><a href="https://bbs.pediy.com/thread-190668.htm">(å‘é‡åŒ–å¼‚111å¸¸å¤„ç†)VEH hook</a></p><p><a href="http://yimitumi.com/2020/05/13/VEH-Hook/">åŸºäºå¼‚å¸¸å¤„ç†çš„Hookå‡½æ•°(VEH Hook)</a></p><p><a href="https://voidsec.com/windows-drivers-reverse-engineering-methodology/#windows-driver-101">Windows é©±åŠ¨ç¨‹åºé€†å‘å·¥ç¨‹æ–¹æ³•</a></p><p><a href="https://www.pediy.com/kssd/pediy12/142371.htm">SEHåˆ†æç¬”è®°ï¼ˆX64ç¯‡)</a></p>]]></content>
    
    
    <categories>
      
      <category>CTF-WP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>RE</tag>
      
      <tag>Wp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022ASISCTF</title>
    <link href="/2022/10/17/2022ASISCTF/"/>
    <url>/2022/10/17/2022ASISCTF/</url>
    
    <content type="html"><![CDATA[<h1>2022ASISCTF</h1><blockquote><p>é—²æ¥å‚é’“ç¢§æºªä¸Šï¼Œè®°å¤±è¸ªäººå£å›å½’ï¼Œå†ä¸æ›´å°±è£å‡å¹´æ›´åšä¸»å’¯x)ï¼Œè¢«å­¦å¼Ÿä»¬ğŸ´æƒ¨ï¼Œå…¶å®æœ‰äººå·å·å»å¥‡å®‰ä¿¡æ°é’±ï¼Œæˆ‘ä¸è¯´æ˜¯è°.-.<a href="https://forum.butian.net/people/8376/community">Lu1u</a>ï¼Œä½†æ˜¯é¢‘ç‡ç¡®å®æ˜¯ä½äº†ä¸å°‘ã€‚äº¦å¦‚å­¦å¼Ÿæ‰€è¨€: å‰å®³çš„ä¸æ˜¯æˆ‘ï¼Œæ˜¯18å²~</p></blockquote><p>Get Tips: blackboxã€unicornã€hookã€angrã€‚</p><h2 id="figole">figole</h2><p>Androidé¢˜ï¼Œjavaå±‚é€†å‘ï¼Œé€šè¿‡æ··æ·†éšè—æ§åˆ¶æµã€‚</p><p><code>timesnewroman.ttf</code>æ˜¯ä¸ª<code>SQLite</code>æ•°æ®åº“ï¼Œç¨‹åºé€šè¿‡l1å’Œl2æ–¹æ³•ä»ä¸­æå–å‡ºæ•°æ®moveToPositionæ–¹æ³•ç”¨äºé€‰ç€å“ªä¸€è¡Œã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221016210943577.png" alt="image-20221016210943577"></p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221016210842327.png" alt="image-20221016210842327"></p><p>å…³é”®åŠ å¯†ä¸ºshctfdexä¸‹çš„echå‡½æ•°ï¼Œä¸ºcbcæ¨¡å¼çš„aesï¼Œkeyå’Œivé€šè¿‡getkeyè·å–ï¼Œå°†ä¸€ä¸ªæ‹¼æ¥çš„å­—ç¬¦å–å¥‡/å¶ä¸‹æ ‡åˆ†æˆä¸¤ç»„ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221016211410711.png" alt="image-20221016211410711"></p><blockquote><p>å…¥å£å¤„æ˜¯ DActivityï¼Œå¯¹ä»æ•°æ®åº“æ‹¿åˆ°çš„ç¬¬äºŒæ®µæ•°æ®è§£å¯†ä¹‹åè¿˜è¦ç»è¿‡<code>cdec</code>è§£å¯†ï¼ŒAndroidğŸ‘´ç›´æ¥hookæ‹¿æ•°æ®å³å¯ã€‚</p></blockquote><figure class="highlight python"><table><tbody><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><pre><code class="hljs python">s1=<span class="hljs-string">'XPNXVO]PJYSJXTNYVM]PJ^RMX\OZVO\W'</span><br>t=<span class="hljs-string">''</span><br>kk=<span class="hljs-string">b'key'</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>):<br>   t+=<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(s1[i])^kk[i%<span class="hljs-number">3</span>])<br><span class="hljs-built_in">print</span>(t)<br>s=<span class="hljs-built_in">bytes</span>.fromhex(t).decode()+<span class="hljs-string">'8i7a4t6155263210'</span><br>k=<span class="hljs-string">''</span><br>iv=<span class="hljs-string">''</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(s)):<br>    <span class="hljs-keyword">if</span> i%<span class="hljs-number">2</span>==<span class="hljs-number">0</span>:<br>        k+=s[i]<br>    <span class="hljs-keyword">else</span>:<br>        iv+=s[i]<br><span class="hljs-built_in">print</span>(k,iv)<br><span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> b64decode<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br>c=<span class="hljs-string">'7mePfqpM6Wd1El2sj4dlUboU6PieF7La8IJ1e76cfp4='</span><br>c=b64decode(c)<br>aes=AES.new(k.encode(),AES.MODE_CBC,iv.encode()[:<span class="hljs-number">16</span>])<br><span class="hljs-built_in">print</span>(aes.decrypt(c))<br></code></pre></td></tr></tbody></table></figure><h2 id="traditional">traditional</h2><p>rusté€†å‘ï¼Œç¬¦å·å¥åœ¨ã€‚åˆ›å»ºflag.txtè°ƒè¯•å³å¯ï¼Œå¾—åˆ°ç¨‹åºæµç¨‹ä¸ºbase64åŠ å¯†ã€å¤æ‚çš„ç§»ä½è¿ç®—ã€base64è§£å¯†ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221016212336795.png" alt="image-20221016212336795"></p><p>ç»å…¸ç§»ä½è¿ç®—ï¼Œè·‘å‡ºç½®æ¢è¡¨å³å¯ï¼Œå› ä¸ºæ˜¯åœ¨base64è¡¨ä¹‹ååšçš„å˜æ¢ï¼Œå­—æ¯è¡¨å°±64ä¸ª,patchç¨‹åºè·å–å³å¯ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> string<br><span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> *<br>s1=<span class="hljs-string">'This is the flag: '</span><br>s2=<span class="hljs-string">'This is the flag: MDEyMzQ1Njc4OWFiY2RlZjAxMjM0NTY3ODlhYmNkZWYw'</span><br>s3=<span class="hljs-string">'This is the flag: MDEyMzQ1Njc4OWFiY2RlZjAxMjM0NTY3ODlhYmNkZWYw Just decode it :P'</span><br><span class="hljs-comment">#å€’å™å¤„ç†</span><br>s4=<span class="hljs-string">'P: ti edoced tsuJ wYWZkNmYhlDO3YTN0MjMxAjZlR2YiFWO4cjN1QzMyEDM :galf eht si sihT'</span><br><span class="hljs-comment">#ç±»ä¼¼æ¢è¡¨å¤„ç†,ç›´æ¥é€šè¿‡patch base64è¡¨ è·‘å‡ºå˜æ¢åçš„è¡¨è§„åˆ™</span><br><span class="hljs-string">"""</span><br><span class="hljs-string">' ' -&gt; '/'</span><br><span class="hljs-string">':' -&gt; '+'</span><br><span class="hljs-string">"""</span><br>s=<span class="hljs-string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'</span><br>ntb=<span class="hljs-string">'OPQRSTUVWXYZABCDEFGHIJKLMNtuvwxyzabcdefghijklmnopqrs5678901234+/'</span><br><br>f=<span class="hljs-built_in">open</span>(<span class="hljs-string">r'flag.enc'</span>,<span class="hljs-string">'rb'</span>)<br>enc=f.read()<br>f.close()<br>enc=b64encode(enc).decode()<br>m1=<span class="hljs-string">''</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(enc)):<br>    m1+=s[ntb.index(enc[i])]<br>m1=m1[::-<span class="hljs-number">1</span>]<br><span class="hljs-built_in">print</span>(m1)<br><span class="hljs-built_in">print</span>(b64decode(<span class="hljs-string">'QVNJU3tzSU1wTDNfYlU3X20xeDNkX1IzdkVyNWVfN0FzSyF9'</span>))<br></code></pre></td></tr></tbody></table></figure><h2 id="hannibal">hannibal</h2><blockquote><p>åšé¢˜æ—¶æœ‰ç‚¹çŠ¯è¿·ç³Šäº†ï¼Œé€»è¾‘å¾ˆç®€å•ï¼Œéå¾—æƒ³ç€çˆ†ç ´æ—¶é—´æˆ³â€¦ å¯¼è‡´å¿½ç•¥äº†åŸè·Ÿè¿™ä¸€ç‚¹</p></blockquote><p>é¦–å…ˆå°†è¾“å…¥è½¬ä¸ºäºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå­—èŠ‚è½¬ä¸º7bitï¼Œæ•…é•¿åº¦p=7+(n-1)*8ï¼Œä¹‹ååˆé€šè¿‡éšæœºæ•°æ‰¾åˆ°ä»¥pä¸ºæ¨¡æ•°çš„ä¸€ä¸ªåŸè·Ÿï¼Œä¾æ¬¡æ¥éå†å…¶ç®€åŒ–å‰©ä½™ç³»ï¼Œç”¨äºç”Ÿæˆæ··æ·†è¡¨ã€‚</p><blockquote><p>è¿™æ ·ä¼šä¸¢æ‰ä¸€ä½ï¼Œå› ä¸ºç®€åŒ–å‰©ä½™ä¸­ä¸å­˜åœ¨0ï¼Œç¬¬ä¸€ä¸ªå› ä¸ºæ˜¯åœ¨asciiè¡¨çš„èŒƒå›´å†…ï¼Œæ‰€ä»¥æ’å®šä¸º0ã€‚</p></blockquote><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> libnum <span class="hljs-keyword">import</span>  s2b<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_all_randk</span>(<span class="hljs-params">p</span>):</span><br>    tb=<span class="hljs-built_in">set</span>()<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>,p-<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">if</span> (p-<span class="hljs-number">1</span>)%i==<span class="hljs-number">0</span>:<br>            tb.add(i)<br>    tb=<span class="hljs-built_in">list</span>(tb)<br>    kk=[]<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>,p-<span class="hljs-number">2</span>):<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">pow</span>(i,p-<span class="hljs-number">1</span>,p)==<span class="hljs-number">1</span>:<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">all</span>([<span class="hljs-built_in">pow</span>(i,j,p)!=<span class="hljs-number">1</span> <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> tb]):<br>                    kk.append(i)<br>    <span class="hljs-keyword">return</span> kk<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_arr</span>(<span class="hljs-params">x,p</span>):</span><br>    ans=[<span class="hljs-number">1</span>]<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(p-<span class="hljs-number">1</span>):<br>        ans.append((ans[i]*x)%p)<br>    <span class="hljs-keyword">assert</span> ans[-<span class="hljs-number">1</span>]==<span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> ans[:-<span class="hljs-number">1</span>]<br><br>f=<span class="hljs-built_in">open</span>(<span class="hljs-string">r'flag.enc'</span>,<span class="hljs-string">'rb'</span>)<br>buf=f.read()<br>f.close()<br>enc_len=<span class="hljs-number">0x276</span><br>p=<span class="hljs-number">0x277</span><br>n=(p-<span class="hljs-number">7</span>)/<span class="hljs-number">8</span><br><span class="hljs-built_in">print</span>(n)<br>kk=get_all_randk(p)<br>mm=s2b(buf)[<span class="hljs-number">1</span>:-<span class="hljs-number">1</span>]<br><br><span class="hljs-keyword">for</span> index <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(kk)):<br>    res=[<span class="hljs-string">'#'</span>]*p<br>    sh_tb=get_arr(kk[index],p)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(sh_tb)):<br>        res[sh_tb[i]]=mm[i]<br>    ans0=<span class="hljs-string">'00'</span>+<span class="hljs-string">''</span>.join(res[<span class="hljs-number">1</span>:])<br>    ans1=<span class="hljs-string">'01'</span>+<span class="hljs-string">''</span>.join(res[<span class="hljs-number">1</span>:])<br>    ans0=(long_to_bytes(<span class="hljs-built_in">int</span>(ans0,<span class="hljs-number">2</span>)))<br>    ans1=(long_to_bytes(<span class="hljs-built_in">int</span>(ans1,<span class="hljs-number">2</span>)))<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">b'ASIS'</span> <span class="hljs-keyword">in</span> ans0 : <span class="hljs-built_in">print</span>(ans0) ;<span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-string">b'ASIS'</span> <span class="hljs-keyword">in</span> ans1 : <span class="hljs-built_in">print</span>(ans1) ;<span class="hljs-keyword">break</span><br>    <span class="hljs-comment">#print('res: ' +ans)</span><br><span class="hljs-comment">#ASIS{Bi7_fL!p__Fl0P__w1Th_5ImPl3_pOW!!}</span><br></code></pre></td></tr></tbody></table></figure><p>èµ›æ—¶æ€è·¯ patchç¨‹åºçˆ†ç ´ï¼Œå°†éšæœºåºåˆ—å†™å…¥åˆ°æ–‡ä»¶å†è¯»å–ï¼Œå¥ˆä½•ç´¢å¼•å·²ç»å¤§äºäº†å•ä¸ªå­—èŠ‚ï¼Œä¸å¤±ä¸ºä¸€ç§çˆ†ç ´æ€è·¯ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221016205324002.png" alt=""></p><h2 id="vivbit">vivbit</h2><blockquote><p>aarch64æ¶æ„ï¼Œhannibalå‡çº§ç‰ˆï¼Œå˜æ¢æ›´åŠ å¤æ‚ï¼Œå•çº¯è°ƒè¯•çœ‹å°±ä¸åˆé€‚äº†ï¼Œä¸è¿‡åŠ å¯†çš„æ ¸å¿ƒä»æ˜¯bitä½çš„æ··æ·†ï¼Œå„ä¸ªå­—ç¬¦é—´å¹¶æ— å…³ç³»ï¼Œå¯ä»¥è€ƒè™‘çˆ†ç ´/æµ‹è¯•ï¼Œæµ‹è¯•æ¯ä¸ªå­—èŠ‚å½±å“çš„bitä½ã€‚</p><p>RetardğŸ‘´æ–¹æ³•å¤ªå¸…äº†ï¼Œqemuæ¨¡æ‹Ÿæ‰§è¡Œï¼Œæ¯”è¾ƒå¯†æ–‡å’Œæµ‹è¯•flagå­—ç¬¦å½±å“çš„bitä½ï¼Œå¦‚æœç›¸åŒåˆ™å½“å‰ä½ç½®æ˜¯æ­£ç¡®çš„flagå­—ç¬¦ï¼Œé€ä¸ªå­—èŠ‚è¿›è¡Œçˆ†ç ´ï¼Œè¿›è€Œgetflagã€‚x) æŠ„ä½œä¸š</p></blockquote><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20221016214440859.png" alt="image-20221016214440859"></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> string<br><span class="hljs-keyword">from</span> libnum <span class="hljs-keyword">import</span> s2b<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">enc</span>(<span class="hljs-params">flag, size=<span class="hljs-number">0</span></span>):</span><br>    <span class="hljs-keyword">if</span> size:<br>        flag = flag.ljust(size, <span class="hljs-string">b'*'</span>)<br>    <span class="hljs-built_in">open</span>(<span class="hljs-string">'./flag.txt'</span>, <span class="hljs-string">'wb'</span>).write(flag)<br>    os.system(<span class="hljs-string">'qemu-aarch64 vivbit_orig'</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'./flag.enc'</span>, <span class="hljs-string">'rb'</span>).read()<br><br>test_size = <span class="hljs-number">64</span>                                       <span class="hljs-comment">#éœ€è¦ä¸º4çš„å€æ•°è¿›è¡Œæµ‹è¯•</span><br>flag_enc = <span class="hljs-built_in">open</span>(<span class="hljs-string">'./chall_flag.enc'</span>, <span class="hljs-string">'rb'</span>).read()<br>verify_bins = s2b(flag_enc)                          <span class="hljs-comment">#è½¬æˆäºŒè¿›åˆ¶ä¸²</span><br>flag = <span class="hljs-string">''</span><br><span class="hljs-keyword">while</span> <span class="hljs-built_in">len</span>(flag) &lt; <span class="hljs-number">64</span>:<br>    cached = <span class="hljs-built_in">dict</span>()<br>    diff = <span class="hljs-built_in">set</span>()<br>    a = s2b(enc((flag+<span class="hljs-string">'L'</span>).encode(), test_size))     <span class="hljs-comment">#ç”Ÿæˆä¸€ä¸ªæ¨¡æ¿ç”¨äºæ‰¾å‡ºä¿®æ”¹å½“å‰ä½ç½®å­—èŠ‚å½±å“å¯†æ–‡ä¸­çš„bitä½</span><br>    <span class="hljs-keyword">for</span> ch <span class="hljs-keyword">in</span> string.printable:<br>        b = s2b(enc((flag+ch).encode(), test_size))  <span class="hljs-comment">#çˆ†ç ´å½“å‰ä¸åŒçš„ä½ï¼Œç”Ÿæˆä¸€ä¸ªå­—å…¸</span><br>        cached[ch] = b<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(a)):<br>            <span class="hljs-keyword">if</span> a[i] != b[i]:<br>                diff.add(i)                          <span class="hljs-comment">#å°†å½“å‰å­—ç¬¦å¯èƒ½å½±å“çš„æ‰€æœ‰ä½ç½®éƒ½è®°å½•åˆ°diff</span><br>    diff = <span class="hljs-built_in">list</span>(diff)<br>    <span class="hljs-built_in">print</span>(diff)<br><br>    maybe = []<br>    <span class="hljs-keyword">for</span> ch <span class="hljs-keyword">in</span> string.printable:<br>        tmp = cached[ch]<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">all</span>([tmp[i] == verify_bins[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> diff]):  <span class="hljs-comment">#å½±å“çš„bitä½ä¸å¯†æ–‡ä¸­çš„ç›¸åŒåˆ™ä¸ºæ­£ç¡®å­—ç¬¦</span><br>            maybe.append(ch)<br>    <span class="hljs-built_in">print</span>(maybe)<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(maybe) == <span class="hljs-number">1</span>:<br>        flag += maybe[<span class="hljs-number">0</span>]<br>    <span class="hljs-keyword">else</span>:<br>        flag += <span class="hljs-string">'?'</span>                                   <br>    <span class="hljs-built_in">print</span>(flag)<br><br></code></pre></td></tr></tbody></table></figure>]]></content>
    
    
    <categories>
      
      <category>CTF-WP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>RE</tag>
      
      <tag>Wp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>DAS_5æœˆ_å‡ºé¢˜äººæŒ‘æˆ˜èµ›</title>
    <link href="/2022/05/28/2022DAS5%E6%9C%88/"/>
    <url>/2022/05/28/2022DAS5%E6%9C%88/</url>
    
    <content type="html"><![CDATA[<h1>DAS 5æœˆ</h1><blockquote><p>éš”å¤©å°±è¦è€ƒè¯•ï¼Œå•çº¯æ‘¸äº†æ‘¸ï¼Œçœ‹èƒ½å¦æ‘¸åˆ°å·¥ä½œé‡å°‘çš„ï¼Œäºæ˜¯é€‰æ‹©äº†luajitï¼Œç½‘ä¸Šçš„æ–¹æ³•å‡ ä¹å°è¯•äº†ä¸€éä¹Ÿæ²¡æœ‰è§£å†³æ–¹æ¡ˆï¼Œç‰ˆæœ¬ä¿¡æ¯æ²¡æœ‰ï¼Œluajitè‡ªå¸¦çš„åæ±‡ç¼–å°è¯•æ— æœï¼Œä½“éªŒæå·®ã€‚</p></blockquote><h2 id="wer">wer</h2><h3 id="æ±‚è§£">æ±‚è§£</h3><blockquote><p>bcfè™šå‡æ§åˆ¶æµï¼ŒçœŸæ­£çš„é€»è¾‘ä¸åœ¨mainï¼Œè€Œæ˜¯åœ¨æŸä¸ªå‡½æ•°å†…å¯¹è¾“å…¥è¿›è¡Œäº†è½¬å­˜ï¼Œä¹‹ååˆè¿›è¡Œäº†ç›¸å…³å¤„ç†ã€‚</p></blockquote><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220527091239631.png" alt="image-20220527091239631"></p><p>ç›´æ¥å®šä½åˆ°è¾“å…¥éƒ¨åˆ†ï¼Œè¦æ±‚è¾“å…¥ä¸º38ä½å¹¶ä¸”å°†è¾“å…¥å­˜å…¥ä¸¤ä¸ªxmmwordä¸‹ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220527091852751.png" alt="image-20220527091852751"></p><p>è·Ÿè¿›<code>sub_1400DB50</code>,a2ä¸­å­˜æ”¾çš„æˆ‘ä»¬çš„è¾“å…¥ï¼Œå¯è§å¯¹è¾“å…¥è¿›è¡Œäº†è½¬ç§»ï¼Œä¹‹åå¯¹<code>xmmword_140035C20</code>äº¤å‰å¼•ç”¨ï¼Œå®šä½åˆ°ä¸€ä¸ªæ–°çš„å¤„ç†å‡½æ•°ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220527092129863.png" alt="image-20220527092129863"></p><p>checké€»è¾‘ä¸º input[i]^v3[i]==102 ,å¾ªç¯32æ¬¡å¦‚æœæˆåŠŸå°±è¾“å‡ºcorrectã€‚</p><p><code>exp</code></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><pre><code class="hljs python">enc=[<span class="hljs-number">0x05</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0x55</span>, <span class="hljs-number">0x05</span>, <span class="hljs-number">0x04</span>, <span class="hljs-number">0x07</span>, <span class="hljs-number">0x5E</span>, <span class="hljs-number">0x54</span>, <span class="hljs-number">0x05</span>, <span class="hljs-number">0x07</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0x5F</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0x05</span>, <span class="hljs-number">0x55</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x54</span>, <span class="hljs-number">0x55</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0x05</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x52</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x51</span>, <span class="hljs-number">0x53</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(enc)):<br>    enc[i]^=<span class="hljs-number">102</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">b'flag{'</span>+<span class="hljs-built_in">bytes</span>(enc)+<span class="hljs-string">b'}'</span>)<br><span class="hljs-comment">#flag{ce3cba82ca6de596565c3f231ecd4675}</span><br></code></pre></td></tr></tbody></table></figure><blockquote><p>ä¸‹æ¬¡æ—¶é—´ç´§è¿˜æ˜¯è€è€å®å®æ‘¸windowsäº†ï¼Œä¸æ‘¸ä¸ç†Ÿæ‚‰çš„é¢†åŸŸã€‚ğŸ˜­ğŸ˜­ğŸ˜­</p></blockquote><h3 id="æº¯æº">æº¯æº</h3><p>æŸ¥é˜…<a href="https://docs.microsoft.com/en-us/windows/win32/wer/windows-error-reporting">Windows é”™è¯¯æŠ¥å‘Š - Win32 åº”ç”¨|å¾®è½¯æ–‡æ¡£ (microsoft.com)</a>å®˜æ–¹æ–‡æ¡£ï¼Œäº†è§£WERå’ŒARR(ç¨‹åºæ¢å¤å’Œé‡å¯)çš„ç›¸å…³çŸ¥è¯†ã€‚</p><blockquote><p>é”™è¯¯æŠ¥å‘ŠåŠŸèƒ½ä½¿ç”¨æˆ·èƒ½å¤Ÿé€šçŸ¥å¾®è½¯æœ‰å…³åº”ç”¨ç¨‹åºæ•…éšœã€å†…æ ¸æ•…éšœã€æ— ååº”çš„åº”ç”¨ç¨‹åºå’Œå…¶ä»–åº”ç”¨ç¨‹åºçš„å…·ä½“é—®é¢˜ã€‚å¹¶ä¸”å¯ä»¥ä½¿ç”¨åº”ç”¨ç¨‹åºæ¢å¤å’Œé‡å¯(ARR)ï¼Œä»¥ç¡®ä¿å®¢æˆ·åœ¨å…¶åº”ç”¨ç¨‹åºå´©æºƒæ—¶ä¸ä¼šä¸¢å¤±æ•°æ®ï¼Œå¹¶å…è®¸ç”¨æˆ·å¿«é€Ÿè¿”å›åˆ°ä»–ä»¬çš„ä»»åŠ¡ã€‚</p></blockquote><p>å¯¹getflagçš„ä¸»è¦å‡½æ•°è¿›è¡Œäº¤å‰å¼•ç”¨ï¼Œè§‚å¯Ÿå‡½æ•°è°ƒç”¨çš„å…³ç³»ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220527124229347.png" alt="image-20220527124229347"></p><p><strong>é¦–å…ˆatexitæ³¨å†Œäº†ç»ˆæ­¢å‡½æ•°ï¼Œå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹æ³¨å†Œç»ˆæ­¢å‡½æ•°ï¼Œå¹¶ä¸”ä»–åœ¨ç¨‹åºç»“æŸæ—¶è°ƒç”¨ã€‚</strong></p><p>å¹¶ä¸”æ³¨å†Œæ˜¯åœ¨mainå‡½æ•°è¿è¡Œå‰å®Œæˆçš„ã€‚</p><blockquote><p>inittermå‡½æ•°è´Ÿè´£éå†å‡½æ•°æŒ‡é’ˆè¡¨å¹¶åˆå§‹åŒ–å®ƒä»¬çš„å†…éƒ¨æ–¹æ³•ã€‚</p></blockquote><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220527125654996.png" alt="image-20220527125654996"></p><blockquote><p>è¿™ä¸ªç‰¹æ€§ä¸ºå…¶èƒ½éšè—æ§åˆ¶æµï¼Œå·å¤©æ¢æ—¥ï¼Œå›¾ç©·è€ŒåŒ•ä¸è§æä¾›äº†æ”¯æ’‘ã€‚</p></blockquote><p>å…¶æ¬¡æ˜¯æ³¨å†Œäº†<strong>æ¢å¤å›è°ƒå‡½æ•°</strong></p><p>å¦‚æœåº”ç”¨ç¨‹åºé‡åˆ°æœªå¤„ç†çš„å¼‚å¸¸æˆ–å˜å¾—æ— å“åº”ï¼ŒWindows é”™è¯¯æŠ¥å‘Š ï¼ˆWERï¼‰ å°†è°ƒç”¨æŒ‡å®šçš„æ¢å¤å›è°ƒã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">HRESULT <span class="hljs-title">RegisterApplicationRecoveryCallback</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">  [in]           APPLICATION_RECOVERY_CALLBACK pRecoveyCallback, <span class="hljs-comment">//æ¢å¤å‡½æ•°æŒ‡é’ˆ</span></span></span><br><span class="hljs-params"><span class="hljs-function">  [in, optional] PVOID                         pvParameter,      <span class="hljs-comment">//ä¼ é€’å˜é‡çš„æŒ‡é’ˆï¼Œå¯ä¸ºç©º</span></span></span><br><span class="hljs-params"><span class="hljs-function">  [in]           DWORD                         dwPingInterval,   <span class="hljs-comment">//æ¢å¤ ping é—´éš”ï¼Œä»¥æ¯«ç§’ä¸ºå•ä½ï¼Œå¿…é¡»è¦åœ¨è¿™ä¸ªé—´éš”å†…è°ƒç”¨ApplicationRecoveryInProgresså‡½æ•°æ¥è¯´æ˜æ­£åœ¨ä¸»åŠ¨æ¢å¤ï¼Œå¦åˆ™ä¼šè¢«werç»ˆæ­¢ã€‚</span></span></span><br><span class="hljs-params"><span class="hljs-function">  [in]           DWORD                         dwFlags           <span class="hljs-comment">//ç›®å‰æ— æ„ä¹‰</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>;<br><br>ApplicationRecoveryInProgress(&amp;pbCancelled);<span class="hljs-comment">// æŒ‡ç¤ºè°ƒç”¨åº”ç”¨ç¨‹åºæ­£åœ¨ç»§ç»­æ¢å¤æ•°æ®ã€‚</span><br><br><span class="hljs-function">HRESULT <span class="hljs-title">ApplicationRecoveryInProgress</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">  [out] PBOOL pbCancelled    <span class="hljs-comment">//ç”¨æˆ·æ˜¯å¦å–æ¶ˆæ¢å¤ï¼Œç”±werè®¾ç½® ;å–æ¶ˆæ¢å¤/æ¢å¤å®Œæˆæ—¶ pbCancelledä¸º1</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">ApplicationRecoveryFinished</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">  [in] BOOL bSuccess          <span class="hljs-comment">//æ¢å¤æˆåŠŸè¾“å…¥ä¸º1 ä¸æˆåŠŸä¸º0</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>;<br><br></code></pre></td></tr></tbody></table></figure><p><code>æ³¨å†Œå‡½æ•°</code></p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> __fastcall <span class="hljs-title">sub_14000F4A0</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>{<br>  HWND ForegroundWindow; <span class="hljs-comment">// rax</span><br><br>  ForegroundWindow = GetForegroundWindow();     <span class="hljs-comment">//æ£€ç´¢å‰å°çª—å£çš„å¥æŸ„ï¼ˆç”¨æˆ·å½“å‰æ­£åœ¨ä½¿ç”¨çš„çª—å£ï¼‰</span><br>  WerReportHang(ForegroundWindow, <span class="hljs-number">0</span>i64);        <span class="hljs-comment">// werå‡½æ•°ï¼Œåœ¨æŒ‡å®šçš„çª—å£ä¸Šå¯åŠ¨â€œæ— å“åº”â€æŠ¥å‘Šã€‚</span><br>  sub_14000F490(); <span class="hljs-comment">//æ²¡æœ‰æ‰§è¡Œåˆ° è¿›ç¨‹å°±ç»“æŸäº†</span><br>}<br><br>.text:<span class="hljs-number">000000014000F</span>490 sub_14000F490   proc near               ; CODE XREF: sub_14000F4A0+<span class="hljs-number">19</span>â†“j<br>.text:<span class="hljs-number">000000014000F</span>490                                         ; DATA XREF: .pdata:<span class="hljs-number">0000000140036894</span>â†“o<br>.text:<span class="hljs-number">000000014000F</span>490 ; __unwind { <span class="hljs-comment">// sub_140010E50</span><br>.text:<span class="hljs-number">000000014000F</span>490                 <span class="hljs-keyword">xor</span>     ecx, ecx<br>.text:<span class="hljs-number">000000014000F</span>492                 mov     eax, <span class="hljs-number">61</span>h ; <span class="hljs-string">'a'</span><br>.text:<span class="hljs-number">000000014000F</span>497                 mov     [rcx], ax    <span class="hljs-comment">//å†…å­˜åœ°å€0æ˜¯æœªåˆ†é…çš„åŒºåŸŸ ä¼šå¼•å‘å†…å­˜è®¿é—®å¼‚å¸¸</span><br>.text:<span class="hljs-number">000000014000F</span>49A                 retn<br>.text:<span class="hljs-number">000000014000F</span>49A ; } <span class="hljs-comment">// starts at 14000F490</span><br>.text:<span class="hljs-number">000000014000F</span>49A sub_14000F490   endp<br><br></code></pre></td></tr></tbody></table></figure><blockquote><p>å› ä¸ºWindowsä¼šè‡ªåŠ¨æŠ¥å‘Šæœªå¤„ç†çš„å¼‚å¸¸ï¼Œåº”ç”¨ç¨‹åºä¸åº”è¯¥å¤„ç†è‡´å‘½çš„å¼‚å¸¸ã€‚</p><p>å¦‚æœå‡ºç°æ•…éšœæˆ–ä¸å“åº”çš„è¿›ç¨‹æ˜¯äº¤äº’å¼çš„ï¼ŒWERä¼šæ˜¾ç¤ºä¸€ä¸ªç”¨æˆ·ç•Œé¢ï¼Œå‘ŠçŸ¥ç”¨æˆ·è¿™ä¸ªé—®é¢˜ã€‚</p><p>å¦‚æœåœ¨ç”¨æˆ·è¯•å›¾ä¸åº”ç”¨ç¨‹åºè¿›è¡Œäº¤äº’æ—¶ï¼Œåº”ç”¨ç¨‹åºåœ¨äº”ç§’é’Ÿå†…ä¸å“åº”Windowsæ¶ˆæ¯ï¼Œåˆ™è¢«è®¤ä¸ºæ˜¯æ— å“åº”çš„ã€‚</p></blockquote><p>å› ä¸ºæˆ‘ä»¬<code>WerReportHang</code>å¯åŠ¨äº†"æ— å“åº”"æŠ¥å‘Šï¼ŒWERä¼šæœ‰ç¨‹åºæœªå“åº”çš„å¼‚å¸¸ï¼Œåœ¨å¼‚å¸¸é€€å‡ºä¹‹å‰ï¼Œè°ƒç”¨æ¢å¤å›è°ƒã€‚</p><ol><li>ä½¿ç”¨æ¢å¤å›è°ƒå°è¯•åœ¨åº”ç”¨ç¨‹åºç»ˆæ­¢ä¹‹å‰ä¿å­˜æ•°æ®å’ŒçŠ¶æ€ä¿¡æ¯ã€‚ ç„¶åï¼Œå¯ä»¥åœ¨é‡å¯åº”ç”¨ç¨‹åºæ—¶ä½¿ç”¨ä¿å­˜çš„æ•°æ®å’ŒçŠ¶æ€ä¿¡æ¯ã€‚</li><li>æ— å“åº”æŠ¥å‘Šå®Œæˆåï¼Œå®ƒå°†ç»ˆæ­¢åˆ›å»ºçª—å£çš„è¿›ç¨‹ã€‚è¿™ä¹Ÿæ˜¯è°ƒè¯•åˆ°è¿™ä¸€æ­¥ä¼šæŒ‚æ‰çš„åŸå› ã€‚</li></ol><p>æ•´ä½“æµç¨‹:  æ³¨å†Œç»ˆæ­¢å‡½æ•°/æ¢å¤å‡½æ•°  -&gt; main(è™šå‡æ§åˆ¶æµç»“æŸ) -&gt; ç»ˆæ­¢å‡½æ•° -&gt; å½“å‰çª—å£å¯åŠ¨"æ— å“åº”"æŠ¥å‘Š -&gt; è§¦å‘å¼‚å¸¸ -&gt; æ¢å¤å‡½æ•°ã€‚</p><h2 id="CEF">CEF</h2><h3 id="æ±‚è§£-2">æ±‚è§£</h3><blockquote><p>ç¨‹åºçš„ä¾èµ–æœ‰ç‚¹å¤šï¼Œå½“æ—¶å­˜ä¸‹æ–‡ä»¶å°±æ²¡ç»†çœ‹ï¼Œåæ¥çœ‹ç¾¤#REtardå¸ˆå‚…å‘äº†ä¸€å¼ å›¾ï¼Œçœ‹ç€æœ‰ç‚¹ç†Ÿæ‚‰çš„sm4ï¼Œç»ˆäºè¿˜æ˜¯å¯¹ä»–ä¸‹æ‰‹äº†ã€‚</p></blockquote><p>è¿è¡Œç¨‹åºï¼Œä¼šæœ‰ä¸€æ®µæŠ¥é”™ï¼Œä¸è¿‡å¯ä»¥æ ¹æ®è¿™ä¸ªæ˜æ–‡ä¿¡æ¯è¿›è¡Œæœç´¢ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220527201157512.png" alt="image-20220527201157512"></p><p>æŸ¥çœ‹stringsçª—å£ï¼Œäº¤å‰å¼•ç”¨<code>please input your flag</code>å¾—åˆ°çš„ä»£ç é€»è¾‘échecké€»è¾‘ï¼Œåº”è¯¥æ˜¯åœ¨æ³¨å†Œçª—å£ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220527201315343.png" alt="image-20220527201315343"></p><p>å¯ä»¥åœ¨æ•°æ®æ®µå¯¹å…¶ä»–å¯ç–‘çš„æ•°æ®è¿›è¡Œäº¤å‰å¼•ç”¨ï¼Œå°¤å…¶æ˜¯é•¿åº¦ä¸º32ä½çš„(ç»å…¸flag len)ï¼Œæˆ–è€…æ˜¯åŠ å¯†é€»è¾‘ä¸­éœ€è¦ç”¨çš„æ•°æ®è¡¨ã€‚</p><p>å¯ä»¥é€šè¿‡äº¤å‰å¼•ç”¨å®šä½åˆ°<code>sub_44F360</code>å‡½æ•°ï¼Œå…¶ä¸­ä¸€äº›æ˜¾ç¤ºæ˜æ–‡æœ‰å¼‚æˆ–è§£å¯†å¾—åˆ°ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220527202145352.png" alt="image-20220527202145352"></p><p>è§£å¯†å¯å¾—document.write(â€˜%câ€™); å¹¶ä¸”ä¹‹åå…¶ä»–å­—ç¬¦å¯å¾—alert(â€˜Correctâ€™)ã€‚</p><blockquote><p>ğŸ˜€ğŸ˜€ğŸ˜€ï¼Œé€šè¿‡è§£å¯†å‡ºçš„ä¸€äº›æ˜æ–‡å­—ç¬¦å’ŒåŠ å¯†é€»è¾‘èµ°å‘ç¡®å®šè¯¥å¤„æ˜¯å…³é”®checkç‚¹ã€‚</p></blockquote><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220527202548836.png" alt="image-20220527202548836"></p><p>è¿™æ­¥é€»è¾‘æ²¡æœ‰æ¶‰åŠè¾“å…¥ï¼Œå¦‚æœæœ‰äº†è§£è¿‡<a href="https://github.com/smallboyZ/Reverse_Crypto/blob/main/SM4/sm4.c">SM4 - mygithub</a>åŠ å¯†çš„è¯ï¼Œå¯ä»¥çœ‹å‡ºä»–å¤§è‡´ä¸ºç§˜é’¥æ‰©å±•çš„è¿‡ç¨‹ï¼Œç”±TKç”ŸæˆCK(è½®ç§˜é’¥)ï¼Œä¸è¿‡è¿›è¡Œäº†ç®€åŒ–æ²¡æœ‰sboxçš„æ›¿æ¢è¿‡ç¨‹ã€‚</p><blockquote><p>å¹¶ä¸”å‡ºé¢˜äººå¯¹ç»†èŠ‚å¤„ç†æ¯”è¾ƒå¥½ï¼Œå¯¹ç©ºé—´è¿›è¡Œäº†ä¼˜åŒ–ï¼Œé€šè¿‡æ¨¡è¿ç®—æ¥ä½¿è½®ç§˜é’¥çš„ç”Ÿæˆæ›´èŠ‚çœç©ºé—´ã€‚</p></blockquote><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sm4_exkey</span><span class="hljs-params">(<span class="hljs-keyword">uint32_t</span>*mkey)</span> </span>{<br>    <span class="hljs-keyword">int</span> i;<br><br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++) { <span class="hljs-comment">//åˆå§‹ç§˜é’¥å¼‚æˆ–FK</span><br>        mkey[i] ^= FK[i];<br>    }<br><br>    rK = (<span class="hljs-keyword">uint32_t</span>*)(mkey + <span class="hljs-number">4</span>);<br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++) {<br>        <span class="hljs-keyword">uint32_t</span> tmp = mkey[i + <span class="hljs-number">1</span>] ^ mkey[i + <span class="hljs-number">2</span>] ^ mkey[i + <span class="hljs-number">3</span>] ^ CK[i];<br>        sbox_replace(&amp;tmp);      <br>        rK[i]=mkey[i]^L2(tmp);<br>    } <br>}<br></code></pre></td></tr></tbody></table></figure><p>pythonæ¨¡æ‹Ÿå®ç°å¦‚ä¸‹</p><blockquote><p>å‘½åå¯èƒ½æœ‰äº›å·®å¼‚ï¼Œä¸»è¦æ˜¯åŠ å¯†æµç¨‹ã€‚</p></blockquote><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rol</span>(<span class="hljs-params">n,x</span>):</span><br>    <span class="hljs-keyword">return</span> (n&lt;&lt;x | n&gt;&gt;(<span class="hljs-number">32</span>-x))&amp;<span class="hljs-number">0xffffffff</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">ror</span>(<span class="hljs-params">n,x</span>):</span><br>    <span class="hljs-keyword">return</span> (n&gt;&gt;x | n&lt;&lt;(<span class="hljs-number">32</span>-x))&amp;<span class="hljs-number">0xffffffff</span><br><br><br>x=[<span class="hljs-number">0xA3B1BAC6</span>, <span class="hljs-number">0x56AA3350</span>, <span class="hljs-number">0x677D9197</span>, <span class="hljs-number">0xB27022DC</span>]<br>s=[<span class="hljs-number">0x12345678</span>, <span class="hljs-number">0x90ABCDEF</span>, <span class="hljs-number">0xFEDCBA09</span>, <span class="hljs-number">0x87654321</span>]<br>block=[x[i]^s[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>)]<br><br>tb=[<span class="hljs-number">0x00070E15</span>, <span class="hljs-number">0x1C232A31</span>, <span class="hljs-number">0x383F464D</span>, <span class="hljs-number">0x545B6269</span>, <span class="hljs-number">0x70777E85</span>, <span class="hljs-number">0x8C939AA1</span>, <span class="hljs-number">0xA8AFB6BD</span>, <span class="hljs-number">0xC4CBD2D9</span>, <span class="hljs-number">0xE0E7EEF5</span>, <span class="hljs-number">0xFC030A11</span>, <span class="hljs-number">0x181F262D</span>, <span class="hljs-number">0x343B4249</span>, <span class="hljs-number">0x50575E65</span>, <span class="hljs-number">0x6C737A81</span>, <span class="hljs-number">0x888F969D</span>, <span class="hljs-number">0xA4ABB2B9</span>, <span class="hljs-number">0xC0C7CED5</span>, <span class="hljs-number">0xDCE3EAF1</span>, <span class="hljs-number">0xF8FF060D</span>, <span class="hljs-number">0x141B2229</span>, <span class="hljs-number">0x30373E45</span>, <span class="hljs-number">0x4C535A61</span>, <span class="hljs-number">0x686F767D</span>, <span class="hljs-number">0x848B9299</span>, <span class="hljs-number">0xA0A7AEB5</span>, <span class="hljs-number">0xBCC3CAD1</span>, <span class="hljs-number">0xD8DFE6ED</span>, <span class="hljs-number">0xF4FB0209</span>, <span class="hljs-number">0x10171E25</span>, <span class="hljs-number">0x2C333A41</span>, <span class="hljs-number">0x484F565D</span>, <span class="hljs-number">0x646B7279</span>] <span class="hljs-comment">#å…¶å®è¿™æ˜¯SM4æ ‡å‡†çš„CK</span><br><br>ck=[]<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>):<br>    v11=tb[i]^block[(i+<span class="hljs-number">1</span>)%<span class="hljs-number">4</span>]^block[(i+<span class="hljs-number">2</span>)%<span class="hljs-number">4</span>]^block[(i+<span class="hljs-number">3</span>)%<span class="hljs-number">4</span>]<br>    t=v11^ror(v11,<span class="hljs-number">9</span>)^rol(v11,<span class="hljs-number">13</span>)<br>    block[i%<span class="hljs-number">4</span>]=block[i%<span class="hljs-number">4</span>]^t<br>    ck.append(block[i%<span class="hljs-number">4</span>])<br></code></pre></td></tr></tbody></table></figure><p>ä¹‹åå¯ä»¥è§‚å¯Ÿåˆ°è°ƒç”¨äº†CK_table,å¹¶ä¸”å°†è¾“å…¥4ä¸ªä¸€ç»„è½¬ä¸ºDWORDç±»å‹ï¼Œä¹‹åè°ƒç”¨<code>sub_4520E0</code>è¿›è¡ŒåŠ å¯†ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220527204027178.png" alt="image-20220527204027178"></p><p><code>sub_4520E0</code>å‡½æ•°åŠ å¯†ä¸»ä½“å¦‚ä¸‹</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220527204401527.png" alt="image-20220527204401527"></p><p>è¿‡ç¨‹ä¸ç§˜é’¥æ‰©å±•ç±»ä¼¼ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">mstr=[<span class="hljs-number">0</span>]*<span class="hljs-number">32</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>):<br>    v3=ck[i]^mstr[(i+<span class="hljs-number">1</span>)%<span class="hljs-number">4</span>]^mstr[(i+<span class="hljs-number">2</span>)%<span class="hljs-number">4</span>]^mstr[(i+<span class="hljs-number">3</span>)%<span class="hljs-number">4</span>]<br>    t=v3^rol(v3,<span class="hljs-number">2</span>)^ror(v3,<span class="hljs-number">8</span>)^rol(v3,<span class="hljs-number">10</span>)^ror(v3,<span class="hljs-number">14</span>)<br>    mstr[i%<span class="hljs-number">4</span>]=mstr[i%<span class="hljs-number">4</span>]^t<br></code></pre></td></tr></tbody></table></figure><p>ä¹‹åå†èµ‹å€¼æ—¶ï¼ŒBlock[0-3] åˆ†åˆ«å¯¹åº” v42ã€v41ã€v40ã€v39ï¼Œä¹‹åå­˜åˆ°CK[5]å¼€å§‹çš„åœ°å€ï¼Œæ‰€ä»¥åœ¨äºŒè½®è§£å¯†æ—¶ckçš„4ä¸ªæ•°æ®è¢«æ›¿æ¢ã€‚</p><p>ç»¼ä¸Šï¼Œè§£å¯†æµç¨‹å¦‚ä¸‹ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rol</span>(<span class="hljs-params">n,x</span>):</span><br>    <span class="hljs-keyword">return</span> (n&lt;&lt;x | n&gt;&gt;(<span class="hljs-number">32</span>-x))&amp;<span class="hljs-number">0xffffffff</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">ror</span>(<span class="hljs-params">n,x</span>):</span><br>    <span class="hljs-keyword">return</span> (n&gt;&gt;x | n&lt;&lt;(<span class="hljs-number">32</span>-x))&amp;<span class="hljs-number">0xffffffff</span><br><br><br>x=[<span class="hljs-number">0xA3B1BAC6</span>, <span class="hljs-number">0x56AA3350</span>, <span class="hljs-number">0x677D9197</span>, <span class="hljs-number">0xB27022DC</span>]<br>s=[<span class="hljs-number">0x12345678</span>, <span class="hljs-number">0x90ABCDEF</span>, <span class="hljs-number">0xFEDCBA09</span>, <span class="hljs-number">0x87654321</span>]<br>block=[x[i]^s[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>)]<br><br>tb=[<span class="hljs-number">0x00070E15</span>, <span class="hljs-number">0x1C232A31</span>, <span class="hljs-number">0x383F464D</span>, <span class="hljs-number">0x545B6269</span>, <span class="hljs-number">0x70777E85</span>, <span class="hljs-number">0x8C939AA1</span>, <span class="hljs-number">0xA8AFB6BD</span>, <span class="hljs-number">0xC4CBD2D9</span>, <span class="hljs-number">0xE0E7EEF5</span>, <span class="hljs-number">0xFC030A11</span>, <span class="hljs-number">0x181F262D</span>, <span class="hljs-number">0x343B4249</span>, <span class="hljs-number">0x50575E65</span>, <span class="hljs-number">0x6C737A81</span>, <span class="hljs-number">0x888F969D</span>, <span class="hljs-number">0xA4ABB2B9</span>, <span class="hljs-number">0xC0C7CED5</span>, <span class="hljs-number">0xDCE3EAF1</span>, <span class="hljs-number">0xF8FF060D</span>, <span class="hljs-number">0x141B2229</span>, <span class="hljs-number">0x30373E45</span>, <span class="hljs-number">0x4C535A61</span>, <span class="hljs-number">0x686F767D</span>, <span class="hljs-number">0x848B9299</span>, <span class="hljs-number">0xA0A7AEB5</span>, <span class="hljs-number">0xBCC3CAD1</span>, <span class="hljs-number">0xD8DFE6ED</span>, <span class="hljs-number">0xF4FB0209</span>, <span class="hljs-number">0x10171E25</span>, <span class="hljs-number">0x2C333A41</span>, <span class="hljs-number">0x484F565D</span>, <span class="hljs-number">0x646B7279</span>]<br><br>ck=[]<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>):<br>    v11=tb[i]^block[(i+<span class="hljs-number">1</span>)%<span class="hljs-number">4</span>]^block[(i+<span class="hljs-number">2</span>)%<span class="hljs-number">4</span>]^block[(i+<span class="hljs-number">3</span>)%<span class="hljs-number">4</span>]<br>    t=v11^ror(v11,<span class="hljs-number">9</span>)^rol(v11,<span class="hljs-number">13</span>)<br>    block[i%<span class="hljs-number">4</span>]=block[i%<span class="hljs-number">4</span>]^t<br>    ck.append(block[i%<span class="hljs-number">4</span>])<br><br><span class="hljs-string">""" encry</span><br><span class="hljs-string">mstr=[0]*32</span><br><span class="hljs-string">for i in range(32):</span><br><span class="hljs-string">    v3=ck[i]^mstr[(i+1)%4]^mstr[(i+2)%4]^mstr[(i+3)%4]</span><br><span class="hljs-string">    t=v3^rol(v3,2)^ror(v3,8)^rol(v3,10)^ror(v3,14)</span><br><span class="hljs-string">    mstr[i%4]=mstr[i%4]^t</span><br><span class="hljs-string">"""</span><br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decry</span>(<span class="hljs-params">enc</span>):</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">31</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>):<br>        v3 = ck[i] ^ enc[(i + <span class="hljs-number">1</span>) % <span class="hljs-number">4</span>] ^ enc[(i + <span class="hljs-number">2</span>) % <span class="hljs-number">4</span>] ^ enc[(i + <span class="hljs-number">3</span>) % <span class="hljs-number">4</span>]<br>        t = v3 ^ rol(v3, <span class="hljs-number">2</span>) ^ ror(v3, <span class="hljs-number">8</span>) ^ rol(v3, <span class="hljs-number">10</span>) ^ ror(v3, <span class="hljs-number">14</span>)<br>        enc[i % <span class="hljs-number">4</span>] = enc[i % <span class="hljs-number">4</span>] ^ t<br><br><br>enc=[<span class="hljs-number">0xC0CB547D</span>, <span class="hljs-number">0xD7F5DB74</span>, <span class="hljs-number">0x1B92D96F</span>, <span class="hljs-number">0x204628EB</span>, <span class="hljs-number">0x60D3D5E5</span>, <span class="hljs-number">0x2F366D80</span>, <span class="hljs-number">0x612F63B0</span>, <span class="hljs-number">0x30A90F20</span>]<br>c1=enc[:<span class="hljs-number">4</span>][::-<span class="hljs-number">1</span>]<br>decry(c1)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">int</span>.to_bytes(c1[i], <span class="hljs-number">4</span>, <span class="hljs-string">'little'</span>).decode(),end=<span class="hljs-string">''</span>)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>    ck[<span class="hljs-number">5</span>+i]=enc[i]<br><br>c2=enc[<span class="hljs-number">4</span>:][::-<span class="hljs-number">1</span>]<br>decry(c2)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">int</span>.to_bytes(c2[i], <span class="hljs-number">4</span>, <span class="hljs-string">'little'</span>).decode(),end=<span class="hljs-string">''</span>)<br><span class="hljs-comment">#flag{3b2365b04700b5eac3a5fd0ba21b687f}</span><br></code></pre></td></tr></tbody></table></figure><p>æ˜¾ç¤ºçš„æ— æ³•æ‰“å¼€urlï¼Œå®é™…è¾“å…¥è§£å¯†çš„å­—ç¬¦å´æœ‰å›æ˜¾ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220527210629834.png" alt="image-20220527210629834"></p><h3 id="æº¯æº-2">æº¯æº</h3><blockquote><p><code>CEF</code>æ˜¯<code>Chromium Embedded Framework</code>çš„ç¼©å†™ï¼Œå³â€œChromiumåµŒå…¥å¼æ¡†æ¶â€ï¼Œé‡‡ç”¨c++ç¼–å†™ï¼Œåœ°ä½ç±»ä¼¼äºElectronï¼Œæ˜¯webå¼€å‘åº”ç”¨ç¨‹åºçš„é‡è¦æ¡†æ¶ã€‚</p></blockquote><p>ç›®å½•ç‰¹å¾</p><figure class="highlight tex"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs tex">cef.pak<br>cef<span class="hljs-built_in">_</span>100<span class="hljs-built_in">_</span>percent.pak<br>cef<span class="hljs-built_in">_</span>200<span class="hljs-built_in">_</span>percent.pak<br>libcef.dll<br></code></pre></td></tr></tbody></table></figure><p>cefä½¿ç”¨å¤šè¿›ç¨‹ï¼Œä¸»è¿›ç¨‹ä¸º"æµè§ˆå™¨è¿›ç¨‹"ï¼Œå¹¶ä¸”ä»–å®ç°çš„åŠŸèƒ½å°±æ˜¯å°†Chromium çš„æµè§ˆå™¨åµŒå…¥åˆ°åº”ç”¨ç¨‹åºä¸­ã€‚</p><p>cefåº”ç”¨ç¨‹åºdemoé»˜è®¤åŠ è½½<code>google.com</code>,å½“ç„¶è¿™ä¸ªurlå¯ä»¥åˆ‡æ¢ä¸ºæœ¬åœ°æ–‡ä»¶ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// åŠ è½½æœ¬åœ°æ–‡ä»¶â€œc:\example\example.htmlâ€ </span><br>... <br><span class="hljs-keyword">if</span> (url.empty()) <br>  url = <span class="hljs-string">"file://c:/example/example.html"</span>; <br>â€¦<br></code></pre></td></tr></tbody></table></figure><blockquote><p>æœ¬é¢˜urlè®¾ç½®çš„please input your flag å½“ç„¶æ˜¯é”™è¯¯çš„æ— æ³•åŠ è½½é¡µé¢ã€‚</p></blockquote><p>å…¥å£ç‚¹å‡½æ•°</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;windows.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"include/cef_command_line.h"</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"include/cef_sandbox_win.h"</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"tests/cefsimple/simple_app.h"</span></span><br><br><span class="hljs-comment">// When generating projects with CMake the CEF_USE_SANDBOX value will be defined</span><br><span class="hljs-comment">// automatically if using the required compiler version. Pass -DUSE_SANDBOX=OFF</span><br><span class="hljs-comment">// to the CMake command-line to disable use of the sandbox.</span><br><span class="hljs-comment">// Uncomment this line to manually enable sandbox support.</span><br><span class="hljs-comment">// #define CEF_USE_SANDBOX 1</span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> defined(CEF_USE_SANDBOX)</span><br><span class="hljs-comment">// The cef_sandbox.lib static library may not link successfully with all VS</span><br><span class="hljs-comment">// versions.</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> comment(lib, <span class="hljs-meta-string">"cef_sandbox.lib"</span>)</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br><br><span class="hljs-comment">// Entry point function for all processes.</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> APIENTRY <span class="hljs-title">wWinMain</span><span class="hljs-params">(HINSTANCE hInstance,</span></span><br><span class="hljs-params"><span class="hljs-function">                      HINSTANCE hPrevInstance,</span></span><br><span class="hljs-params"><span class="hljs-function">                      LPTSTR lpCmdLine,</span></span><br><span class="hljs-params"><span class="hljs-function">                      <span class="hljs-keyword">int</span> nCmdShow)</span> </span>{<br>  UNREFERENCED_PARAMETER(hPrevInstance);<br>  UNREFERENCED_PARAMETER(lpCmdLine);<br><br>  <span class="hljs-comment">// Enable High-DPI support on Windows 7 or newer.</span><br>  CefEnableHighDPISupport();<br><br>  <span class="hljs-keyword">void</span>* sandbox_info = <span class="hljs-literal">nullptr</span>;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> defined(CEF_USE_SANDBOX)</span><br>  <span class="hljs-comment">// Manage the life span of the sandbox information object. This is necessary</span><br>  <span class="hljs-comment">// for sandbox support on Windows. See cef_sandbox_win.h for complete details.</span><br>  CefScopedSandboxInfo scoped_sandbox;<br>  sandbox_info = scoped_sandbox.sandbox_info();<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br><br>  <span class="hljs-comment">// Provide CEF with command-line arguments.</span><br>  <span class="hljs-function">CefMainArgs <span class="hljs-title">main_args</span><span class="hljs-params">(hInstance)</span></span>;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> CEFåº”ç”¨ç¨‹åºæœ‰å¤šä¸ªå­è¿›ç¨‹ï¼ˆæ¸²æŸ“ã€GPUç­‰ï¼‰ï¼Œå…±äº«åŒä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ã€‚è¿™ä¸ªå‡½æ•°æ£€æŸ¥å‘½ä»¤è¡Œï¼Œå¦‚æœè¿™æ˜¯ä¸ª ä¸€ä¸ªå­è¿›ç¨‹ï¼Œåˆ™æ‰§è¡Œé€‚å½“çš„é€»è¾‘ã€‚</span><br><span class="hljs-comment">*/</span><br>  <span class="hljs-keyword">int</span> exit_code = CefExecuteProcess(main_args, <span class="hljs-literal">nullptr</span>, sandbox_info);<br>  <span class="hljs-keyword">if</span> (exit_code &gt;= <span class="hljs-number">0</span>) {<br>    <span class="hljs-comment">// The sub-process has completed so return here.</span><br>    <span class="hljs-keyword">return</span> exit_code;<br>  }<br><br>  <span class="hljs-comment">// Parse command-line arguments for use in this method.</span><br>  CefRefPtr&lt;CefCommandLine&gt; command_line = CefCommandLine::CreateCommandLine();<br>  command_line-&gt;InitFromString(::GetCommandLineW());<br><br>  <span class="hljs-comment">// Specify CEF global settings here.</span><br>  CefSettings settings;<br><br>  <span class="hljs-keyword">if</span> (command_line-&gt;HasSwitch(<span class="hljs-string">"enable-chrome-runtime"</span>)) {<br>    <span class="hljs-comment">// Enable experimental Chrome runtime. See issue #2969 for details.</span><br>    settings.chrome_runtime = <span class="hljs-literal">true</span>;<br>  }<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> !defined(CEF_USE_SANDBOX)</span><br>  settings.no_sandbox = <span class="hljs-literal">true</span>;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br><br>  <span class="hljs-comment">// SimpleApp implements application-level callbacks for the browser process.</span><br>  <span class="hljs-comment">/*</span><br><span class="hljs-comment">  å®ƒå°†åœ¨CEFåˆå§‹åŒ–åçš„OnContextInitialized()ä¸­åˆ›å»ºç¬¬ä¸€ä¸ªæµè§ˆå™¨å®ä¾‹ã€‚</span><br><span class="hljs-comment">  */</span><br>  <span class="hljs-function">CefRefPtr&lt;SimpleApp&gt; <span class="hljs-title">app</span><span class="hljs-params">(<span class="hljs-keyword">new</span> SimpleApp)</span></span>;<br><br>  <span class="hljs-comment">// åˆå§‹åŒ–CEF</span><br>  CefInitialize(main_args, settings, app.get(), sandbox_info);<br><br>  <span class="hljs-comment">// Run the CEF message loop. This will block until CefQuitMessageLoop() is</span><br>  <span class="hljs-comment">// called.</span><br>  CefRunMessageLoop();<br><br>  <span class="hljs-comment">// Shut down CEF.</span><br>  CefShutdown();<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}<br></code></pre></td></tr></tbody></table></figure><p>è‡³äºä¸€äº›å›è°ƒå‡½æ•°å’Œæ›´è¯¦ç»†çš„å®ä¾‹å¯ä»¥ç»“åˆ<a href="https://bitbucket.org/chromiumembedded/cef/wiki/Tutorial.md">CEF-WIKI</a>æä¾›çš„demoæºç è¿›è¡Œè°ƒè¯•å’Œå­¦ä¹ ã€‚</p><blockquote><p>å¤§è‡´äº†è§£æµç¨‹ï¼Œè¿™ä¸ªæ¡†æ¶è¿˜æ˜¯æ¯”è¾ƒæœ‰è¶£çš„ï¼Œä¹‹åå¯ä»¥æ·±å…¥å­¦ä¹ ä¸€ä¸‹:)ã€‚</p></blockquote><h4 id="å°æ’æ›²">å°æ’æ›²</h4><p>å¯¹è§£å¯†å‡ºçš„js apiæ˜¯å¦æ„Ÿåˆ°å¼‚æˆ–ï¼Œæœç´¢CEFé€›çœ‹é›ªæ—¶æ‰åˆ°äº†å‡ºé¢˜äººçš„èº«å½±ã€‚</p><blockquote><p>ä¸è¿‡æœ¬é¢˜æ¥è¯´æ˜¯cefç›´æ¥è°ƒç”¨jsçš„ï¼Œå¹¶éé‡‡ç”¨çš„ä»¥ä¸‹æŠ€æœ¯æ‰‹æ®µã€‚</p></blockquote><p><a href="https://bbs.pediy.com/thread-268570.htm">å°†jsä»£ç æ³¨å…¥åˆ°ç¬¬ä¸‰æ–¹CEFåº”ç”¨ç¨‹åºçš„ä¸€ç‚¹æµ…è§-ç¼–ç¨‹æŠ€æœ¯-çœ‹é›ªè®ºå›-å®‰å…¨ç¤¾åŒº|å®‰å…¨æ‹›è˜|bbs.pediy.com</a></p><p>è¯¥æ–‡ä½œè€…æŠ“ä½CEFç¨‹åºåˆ›å»ºæµè§ˆå™¨çš„ç‰¹ç‚¹ï¼Œè¯•å›¾æ‰¾åˆ°ç”Ÿæˆçš„æµè§ˆå™¨å¯¹è±¡ï¼Œä»¥æ­¤æ¥ä»»æ„æ‰§è¡Œjsä»£ç ã€‚</p><blockquote><p>cef çš„æ ¸å¿ƒå…¨éƒ¨åœ¨libcef.dllé‡Œï¼Œæ‰€ä»¥ä»å…¶ä¸­åˆ›å»ºæµè§ˆå™¨çš„APIå…¥æ‰‹ï¼Œä¸ºäº†æ‹¿åˆ°åˆ›å»ºå‡ºçš„æµè§ˆå™¨å¯¹è±¡ã€‚</p></blockquote><p><strong>å°è¯•</strong></p><p>æ‰¾åˆ°åˆ›å»ºæµè§ˆå™¨çš„APIï¼Œè¿›è¡Œhookæ‹¿åˆ°æµè§ˆå™¨å¯¹è±¡ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">cef_browser_host_create_browser</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">cef_window_info_t</span>* windowInfo,</span></span><br><span class="hljs-params"><span class="hljs-function">    struct <span class="hljs-keyword">_cef_client_t</span>* client,</span></span><br><span class="hljs-params"><span class="hljs-function">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">cef_string_t</span>* url,</span></span><br><span class="hljs-params"><span class="hljs-function">    struct <span class="hljs-keyword">_cef_browser_settings_t</span>* settings,</span></span><br><span class="hljs-params"><span class="hljs-function">    struct <span class="hljs-keyword">_cef_request_context_t</span>* request_context)</span></span>;<br></code></pre></td></tr></tbody></table></figure><p>è€Œè¿™ä¸ªå‡½æ•°æ˜¯å¼‚æ­¥,æ‰€ä»¥<code>cef_browser_t*</code>å­˜åœ¨äºåˆ›å»ºæˆåŠŸçš„å›è°ƒä¸­ï¼Œä½œè€…ä¹‹ååˆé€šè¿‡<code>_cef_client_t* client</code>å‚æ•°å…¥æ‰‹å»hookå›è°ƒï¼Œä½†æœ€ç»ˆä»¥å¤±è´¥å‘Šç»ˆã€‚</p><p>åŒæ­¥å’Œå¼‚æ­¥å¤ä¹ <a href="https://www.cnblogs.com/IT-CPC/p/10898871.html">åŒæ­¥(Synchronous)å’Œå¼‚æ­¥(Asynchronous) - myCpC - åšå®¢å›­ (cnblogs.com)</a></p><p><strong>æŸ³æš—èŠ±æ˜</strong></p><p>å¸ˆå‚…åˆé€šè¿‡è§‚å¯Ÿlibcefçš„å…¶ä»–APIï¼Œæ‰¾åˆ°äº†çªç ´å£ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">///</span><br><span class="hljs-comment">// Returns the current (top) context object in the V8 context stack.</span><br><span class="hljs-comment">///</span><br><span class="hljs-function">CEF_EXPORT <span class="hljs-keyword">cef_v8context_t</span>* <span class="hljs-title">cef_v8context_get_current_context</span><span class="hljs-params">()</span></span>; <span class="hljs-comment">//è¿”å›V8å¼•æ“çš„ä¸Šä¸‹æ–‡</span><br></code></pre></td></tr></tbody></table></figure><p>ä»‹äºV8jsä¸browseræ˜¯ç»‘å®šçš„ï¼Œæ‰€ä»¥å€ŸåŠ©v8jså¼•æ“çš„ä¸Šä¸‹æ–‡æ¥æ‹¿åˆ°browserå¯¹è±¡ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">cef_browser_t</span>* browser = <span class="hljs-literal">NULL</span>;<br><span class="hljs-function"><span class="hljs-keyword">cef_v8context_t</span>* <span class="hljs-title">my_cef_v8context_get_current_context</span><span class="hljs-params">()</span> </span>{<br>    <span class="hljs-keyword">cef_v8context_t</span>* js_context = ori_cef_v8context_get_current_context(); <span class="hljs-comment">//è·å–V8jså¼•æ“ä¸Šä¸‹æ–‡</span><br>    Print(<span class="hljs-string">"my_cef_v8context_get_current_context js_context: %X!!\n"</span>, js_context);<br>    browser = js_context-&gt;get_browser(js_context); <span class="hljs-comment">//å¾—åˆ°æµè§ˆå™¨å¯¹è±¡!!!</span><br>    <span class="hljs-comment">//Print("[!!!] browser = %X\n", browser);</span><br>    <span class="hljs-keyword">_cef_frame_t</span>* frame = browser-&gt;get_main_frame(browser);<br>    <span class="hljs-comment">//Print("[!!!] frame = %X\n", frame);</span><br>    CefString script = payload;<br>    CefString url = xorstr(<span class="hljs-string">"app/wd"</span>).crypt_get();<br>    frame-&gt;execute_java_script(frame, script.GetStruct(), url.GetStruct(), <span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">return</span> js_context;<br>}<br><span class="hljs-comment">// write by renbohan  https://bbs.pediy.com/thread-268570.htm</span><br></code></pre></td></tr></tbody></table></figure><p>è‡³æ­¤ç›®çš„å·²ç»è¾¾æˆï¼Œå³æˆ‘ä»¬æˆåŠŸæ‹¿åˆ°äº†cefåˆ›å»ºå‡ºçš„æµè§ˆå™¨å¯¹è±¡ã€‚æ‰€è°“è¿‡æ²³æ‹†æ¡¥ï¼Œæ‹¿åˆ°è¯¥å¯¹è±¡åå°±å¯ä»¥éå¸¸æ–¹ä¾¿çš„æ‰§è¡Œjsä»£ç ï¼Œä»è€Œcefçš„æ‰“å·¥ç”Ÿæ¶¯ç»“æŸï¼Œjsæ‰æ˜¯checkä»£ç çš„ä¸»åœºã€‚</p><h2 id="LuaJit">LuaJit</h2><blockquote><p>å“¦ï¼Œå¤šä¹ˆç—›çš„é¢†æ‚Ÿ~ğŸ˜±ğŸ˜±ğŸ˜±</p></blockquote><p>æ‹¿åˆ°æ–‡ä»¶åå¯ä»¥é€šè¿‡010æ‰“å¼€ï¼Œå‘ç°æ˜¯éPEæ–‡ä»¶æ ¼å¼ï¼Œæ ¹æ®æ–‡ä»¶å¤´<code>1B 4C 4A 02</code>æœç´¢å¾—çŸ¥ä¸ºluajitç¼–è¯‘çš„æ–‡ä»¶ã€‚</p><p>LuaJIT ä½¿ç”¨äº†ä¸€ç§å…¨æ–°çš„æ–¹å¼æ¥ç¼–è¯‘å’Œæ‰§è¡Œ Lua è„šæœ¬ã€‚ç»è¿‡å¤„ç†åçš„ LuaJIT ç¨‹åºï¼Œå­—èŠ‚ç çš„ç¼–ç å®ç°æ›´åŠ ç®€å•ï¼Œæ‰§è¡Œæ•ˆç‡ç›¸æ¯” Lua å’Œ Luac æ›´åŠ é«˜æ•ˆã€‚</p><blockquote><p>ç›´æ¥ç™¾åº¦luajité€†å‘ï¼Œä¹‹å‰æ²¡æ¥è§¦è¿‡æ­¤ç±»é€†å‘ï¼Œæ ¼å±€å°äº†ğŸ™ƒã€‚æœ‰å¹¸ä¹‹å‰åœ¨<a href="https://blog.shi1011.cn/rev/android/1216">ğŸŸå“¥ - Mas0n</a>åšå®¢ä¸Šçœ‹åˆ°è¿‡å‡ ç§luaçš„ä¿æŠ¤æ–¹å¼å’Œè§£å†³æ–¹æ¡ˆã€‚</p></blockquote><p>å¯ä»¥é€šè¿‡éè™«å¤§ç‰›çš„<a href="https://www.anquanke.com/post/id/90241#h3-11">Luaç¨‹åºé€†å‘ä¹‹Luajitå­—èŠ‚ç ä¸åæ±‡ç¼–</a>äº†è§£luajitçš„opcodeç»“æ„å’Œæ–‡ä»¶æ ¼å¼ï¼Œå¹¶ä¸”æä¾›äº†010çš„<code>luajit.bt</code>çš„æ¨¡æ¿ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220528115928721.png" alt="image-20220528115928721"></p><p>å¹¶ä¸”ä¹Ÿç›´æ¥è¿›è¡Œäº†åæ±‡ç¼–ï¼Œå½“ç„¶é˜…è¯»luajitåæ±‡ç¼–ä¹‹åçš„å­—èŠ‚ç ä¹Ÿæ˜¯ä¸€ç§æŠ˜ç£¨ï¼Œäºæ˜¯åœ¨<code>gayhub</code>ä¸Šå››å¤„æœå¯»åç¼–è¯‘çš„è½®å­ï¼Œä¸è¿‡ç»“æœéƒ½ä¸å°½äººæ„ã€‚</p><blockquote><p>æ€»ç»“: å‰è¾ˆä»¬çš„å·¥å…·å¤§å¤šä¸€è„‰ç›¸æ‰¿ï¼Œæ ¹æ®ç‰ˆæœ¬æ›´æ–°æ·»åŠ æ–°çš„opcodeï¼›åŒæ—¶åªèƒ½åç¼–è¯‘luajitç¼–è¯‘å‡º32ä½çš„æ–‡ä»¶ï¼Œå¯¹64ä½ä¸é€‚ç”¨ã€‚</p><p>è€Œä¸”æœ¬é¢˜æ²¡æœ‰ç»™å‡ºluajitçš„å…·ä½“ç‰ˆæœ¬ï¼Œæƒ³é‡‡ç”¨luajitåŸç”Ÿçš„åæ±‡ç¼–å·¥å…·è¿›è¡Œåæ±‡ç¼–éƒ½è¦è‡ªè¡Œæ‘¸ç´¢ç‰ˆæœ¬,ä¸»æµåº”è¯¥åœ¨2.1æˆ–2.0ğŸ˜­ã€‚</p></blockquote><p>LJDæœ€è¿‘çš„ä¸€ä¸ªé¡¹ç›®**<a href="https://github.com/Dr-MTN/luajit-decompiler">luajit-decompiler</a>**ï¼ŒçŸ¥é“é¢˜ç›®å¯¹åº”ç‰ˆæœ¬æ‰å¯çŸ¥æ˜¯å¦éœ€è¦æ”¹opcodeï¼Œæˆ–è€…æ˜¯å·¥å…·çš„æœ‰å…³æŠ¥é”™ä¿¡æ¯ã€‚</p><p>åˆåœ¨å¾çˆ±ä¸Šçœ‹åˆ°ä¸€ç¯‡åšå®¢<a href="https://www.52pojie.cn/thread-1378796-1-1.html"><strong>luajitåç¼–è¯‘ã€è§£å¯†</strong></a>,å…¶ä¸­æåˆ°äº†å¦ä¸€ç§å·¥å…·**<a href="https://github.com/bobsayshilol/luajit-decomp"> luajit-decomp</a>**,æ­¤å·¥å…·ä½¿ç”¨èµ·æ¥åªéœ€ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„luajitå¹¶ç¼–è¯‘ï¼Œæ‹¿åˆ°å…¶ä¸­çš„<code>luajit.exe</code>ã€<code>lua51.dll</code>ã€<code>jitæ–‡ä»¶å¤¹</code>æ”¾åˆ°decompæ–‡ä»¶å¤¹ä¸‹ï¼Œè¿è¡Œjitdecompå³å¯ã€‚</p><ol><li><code>luajit-decomp\data\luajit</code>ä¸‹å­˜æ”¾å¾…åç¼–è¯‘çš„jitæ–‡ä»¶ã€‚</li><li>è¿è¡Œjitdecompï¼Œç»“æœä¼šåœ¨<code>luajit-decomp\data\out</code>è·¯å¾„ä¸‹ã€‚</li></ol><p>è™½ç„¶èƒ½å¯¹32/64ä½ç¼–è¯‘æ–‡ä»¶æˆåŠŸè¿›è¡Œåç¼–è¯‘ï¼Œä¸è¿‡åç¼–è¯‘åçš„ä»£ç ä¹Ÿæ¯”è¾ƒéš¾è¯»ï¼Œç›¸æ¯”è¯»å­—èŠ‚ç å¹¶æ²¡æœ‰å‡å°‘å¤ªå¤šå·¥ä½œé‡ï¼Œä¸è¿‡ä¹Ÿä¸å¤±ä¸ºä¸€ç§ä¸é”™æ–¹æ³•ã€‚</p><blockquote><p>åæ¥å’Œç¾¤å‹è®¨è®ºï¼Œ#REtardå¸ˆå‚…è¯´ç‰ˆæœ¬ä¸ºLuaJIT-2.1.0-beta3ï¼Œå¹¶ä¸”t0hkaå¸ˆå‚…archæ‹‰çš„æœ€æ–°çš„åŒ…ï¼Œç”¨å…¶è‡ªå¸¦çš„luajit -bl å³å®Œæˆäº†åæ±‡ç¼–ã€‚</p></blockquote><p>å»å®˜ç½‘ä¸‹è½½2.1.0-beta3çš„æºç ï¼Œä½¿ç”¨VSå·¥å…·åŒ…ä¸­çš„å‘½ä»¤è¡Œç¼–è¯‘å·¥å…·<code>vcvars64.bat</code>æ¥å®Œæˆç¼–è¯‘ï¼Œåœ¨Luajitæ ¹ç›®å½•ä¸‹æ‰“å¼€cmdè¾“å…¥<code>vcvars64.bat</code></p><p>æ–‡ä»¶è·¯å¾„ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-string">"F:\visual studio2019\VC\Auxiliary\Build\vcvars64.bat"</span><br></code></pre></td></tr></tbody></table></figure><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220528200018823.png" alt="image-20220528200018823"></p><blockquote><p>åœ¨MSVC 32ä½ç¼–è¯‘ç¯å¢ƒä¸‹  msvcbuild.bat  ç¼–è¯‘32ä½</p><p>msvcbuild.bat gc64ç¼–è¯‘64ä½ï¼Œç¼–è¯‘64ä½åé¢ä¸€å®šè¦è·Ÿgc64, å³ä¾¿æ˜¯å¼€å¯çš„x64çš„ç¼–è¯‘å‘½ä»¤è¡Œã€‚</p></blockquote><p>ä¹‹åæˆåŠŸç¼–è¯‘å‡º<code>luajit.exe</code> å’Œ <code>lua51.dll</code>è¿™ä¸¤ä¸ªç¨‹åºï¼Œè¿™ä¹Ÿæ˜¯luajit-decompå·¥å…·å®ç°åç¼–è¯‘çš„æ”¯æ’‘ã€‚</p><p>åŒç›®å½•ä¸‹ç”¨è¿‡luajit.exe -bl task.jit å¯ä»¥æ˜¾ç¤ºåç¼–è¯‘åçš„å­—èŠ‚ç ã€‚</p><blockquote><p>ç»å…¸luajit.exe -h ç½—åˆ—æŒ‡ä»¤èœå•</p></blockquote><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220528201038811.png" alt="image-20220528201038811"></p><p>åç¼–è¯‘ä¸å¾—å°±æ’¸å­—èŠ‚ç ï¼Œä¸è¿‡å®˜ç½‘ç»™å‡ºçš„ä¸»è¦æ˜¯2.0ç‰ˆæœ¬çš„bytecode ï¼Œ è¯¦ç»†å¯è§<code>src/lj_bc.h</code> ã€‚</p><p>å¯ä»¥è‡ªå·±å†™ä¸€äº›luaä»£ç ï¼Œä¹‹åluajit -b test.lua xxx è¿›è¡Œç¼–è¯‘ä¹‹åæŸ¥çœ‹å­—èŠ‚ç å¯¹ç…§ã€‚</p><blockquote><p>æˆ–è€…ç”¨luajit-decompåç¼–è¯‘ä¸€ä¸‹ï¼Œå¯è¯»æ€§æ˜¯æœ‰ç‚¹å·®çš„ã€‚å…ˆæš‚æ—¶å‘Šä¸€æ®µè½ï¼Œä¹‹åå¡«å‘å§ï¼Œå³ä½¿æˆ‘çš„çŸ¥è¯†æ˜Ÿçƒå·²ç»è¢«æŒ–çš„å‘å‘æ´¼æ´¼å’¯!</p></blockquote><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220528213003579.png" alt="image-20220528213003579"></p><p>ç›¸å…³è¿æ¥:</p><p>LuaJitå®˜ç½‘ : <a href="http://luajit.org/">http://luajit.org/</a>  ä¸€äº›å‚è€ƒæ–‡æ¡£å’Œç¼–è¯‘æ–¹æ³•</p><p><a href="http://wiki.luajit.org/Bytecode-2.0">LuaJIT 2.0 Bytecode Instructions</a></p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>çŸ¥è¯†é¢å’Œå¹¿åº¦è¿˜æ˜¯å·®äº†äº¿ç‚¹ï¼Œä¹‹å‰å¤ªå¤šé¢˜ç›®éƒ½åªæ˜¯å±€é™åœ¨è§£å¯†è¡¨é¢ï¼Œæ²¡å»æº¯æºã€‚åŒæ—¶å•çº¯è§£å¯†çš„è¯æ€è·¯è¦æ‰“å¼€ï¼Œèƒ½åœ¨æœ€çŸ­æ—¶é—´å†…å®šä½å…³é”®å¤„ç†å‡½æ•°çš„èƒ½åŠ›ååˆ†é‡è¦ï¼ŒåŒæ—¶èµ›åçš„å¤ç°å’Œæ·±å…¥å­¦ä¹ é¢˜ç›®æ¶‰åŠçš„è€ƒç‚¹ä¹Ÿæ˜¯å¿…ä¸å¯å°‘çš„éƒ¨åˆ†ã€‚ğŸ˜ƒğŸ˜ƒğŸ˜ƒ</p>]]></content>
    
    
    <categories>
      
      <category>CTF-WP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WER</tag>
      
      <tag>CEF</tag>
      
      <tag>LuaJIT</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ¨¡æ‹Ÿæ ˆå¸§ä¿®å¤</title>
    <link href="/2022/04/20/NaCl-%E7%A8%8B%E5%BA%8F%E4%BF%AE%E5%A4%8D/"/>
    <url>/2022/04/20/NaCl-%E7%A8%8B%E5%BA%8F%E4%BF%AE%E5%A4%8D/</url>
    
    <content type="html"><![CDATA[<h1>æ¨¡æ‹Ÿæ ˆå¸§ä¿®å¤</h1><blockquote><p>å¡«å‘ï¼Œæ¨¡æ‹Ÿå †æ ˆçš„å¤åŸã€‚</p></blockquote><h3 id="æœ‰å…³æ ˆå¸§æ±‡ç¼–å¤ä¹ ">æœ‰å…³æ ˆå¸§æ±‡ç¼–å¤ä¹ </h3><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><pre><code class="hljs assembly">endbr64<br>;ç”¨äºæ ‡è®°ç¨‹åºä¸­é—´æ¥è°ƒç”¨å’Œè·³è½¬çš„æœ‰æ•ˆè·³è½¬ç›®æ ‡åœ°å€ End Branch 64 bit<br>;é—´æ¥è·³è½¬çš„æ¥åº”æŒ‡ä»¤,å…¶å®Intelä¸ºäº†é˜²æ­¢æ§åˆ¶æµè¢«åŠ«æŒ,æ­£å¸¸è·³è½¬çš„ç¬¬ä¸€æ¡æŒ‡ä»¤,å¦‚æœä¸æ˜¯,é‚£ä¹ˆCPUä¼šæŠ¥é”™,å¼•å‘#cpå¼‚å¸¸,é”™è¯¯è·³è½¬ã€‚<br>;ç›´æ¥è°ƒç”¨ call + åç§»  <br>;é—´æ¥è°ƒç”¨ call + ç»å¯¹åœ°å€ å¾€å¾€ä¼šå°†ç»“æœä¿å­˜åœ¨æŸå¯„å­˜å™¨ä¸­  <br>push xxx<br>;å¯è§£æä¸º sub esp,4 mov dword ptr ss:[esp],xxx<br>;æˆ–æ˜¯    lea esp,dword ptr ss:[esp-4] å† mov  <br>pop xxx ;ä¸pushç±»ä¼¼<br></code></pre></td></tr></tbody></table></figure><blockquote><p>pushå’Œpopå¯ç”±movå’Œsubç­‰ä¸¤æ­¥æ“ä½œç»„æˆï¼Œæ‰€ä»¥å¼€è¾Ÿå †æ ˆæ—¶ä¸€èˆ¬æ˜¯sub espï¼Œxxx ä¹‹åé€šè¿‡movæ¥ä½¿ç”¨æ ˆç©ºé—´ï¼Œè€Œä¸æ˜¯pushã€‚è¿™æ ·èƒ½æé«˜æŒ‡ä»¤çš„æ‰§è¡Œæ•ˆç‡ã€‚</p></blockquote><p>å¸¸è§æ ˆå¸§çš„æ¨¡æ¿,ä»¥ä¸€ä¸ªdebugç‰ˆæœ¬çš„åŠ æ³•ä¸ºä¾‹ã€‚</p><blockquote><p>ç»ƒä¹ çš„è¯æœ€å¥½è‡ªå·±è·Ÿä¸€ä¸ªå‡½æ•°ç”¨excelç”»ä¸€ä¸‹å †æ ˆå›¾ã€‚</p></blockquote><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs assembly">push 2 //å‚æ•°å…¥æ ˆ<br>push 3<br><br>call func<br><br>//å‡½æ•°å†…å®¹<br>push ebp<br>mov ebp,esp<br>sub esp,40h //å¼€è¾Ÿæ ˆç©ºé—´<br><br>push ebx  //ä¿å­˜ç°åœº<br>push esi<br>push edi<br><br>lea edi,dword ptr ss:[esp-40] //å¼€è¾Ÿç©ºé—´ å¡«å……0xcc(int 3) é˜²æ­¢æº¢å‡º<br>mov ecx,0x10<br>mov eax,0xcccccccc<br>rep stos dword ptr ss:[edi]<br><br>mov eax,dword ptr ss:[ebp+8] //è°ƒç”¨å‚æ•°å®ŒæˆåŠ æ³•<br>add eax,dword ptr ss:[ebp+0ch]<br><br>pop edi //æ¢å¤ç°åœº<br>pop esi<br>pop ebx<br><br>mov esp,ebp <br>pop ebp<br>ret<br><br>add esp,8 //å¤–å¹³è¡¡å †æ ˆ<br></code></pre></td></tr></tbody></table></figure><p>å…¶å®æ ˆå¸§æœ¬èº«æœ‰ç³»ç»Ÿé»˜è®¤çš„espå’Œebpæ¥ç»´æŠ¤ï¼Œå¦‚æœæˆ‘ä»¬å°†å…¶æ¢ç”¨å…¶ä»–çš„å¯„å­˜å™¨ï¼Œåœ¨å†…å­˜çš„åŸºç¡€ä¸Šæ¨¡æ‹Ÿå †æ ˆï¼Œé‚£ä¹ˆIDAåç¼–è¯‘çš„æ•ˆæœä¼šå¤§æ‰“æŠ˜æ‰£ï¼Œä»è€Œèµ·åˆ°ä¿æŠ¤ä½œç”¨ï¼ŒNaClä¸€é¢˜å°±æ˜¯è¿ç”¨äº†è¯¥ç±»æŠ€æœ¯ã€‚</p><h3 id="ä¾‹é¢˜">ä¾‹é¢˜</h3><blockquote><p>äº‹å…ˆå¯ä»¥ç”¨Luminaå’ŒFingeræ¢å¤ä¸€ä¸‹åº“å‡½æ•°ç¬¦å·ï¼Œå‡å°‘ä¸å¿…è¦çš„è°ƒè¯•æ“ä½œã€‚</p></blockquote><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs assembly">;test_input: 012345abcdefghijklmnopqrstuvwxyz<br>.text:00000000080017B9 call    read<br>.text:00000000080017BE lea     rax, [rbp-30h]<br>.text:00000000080017C2 mov     rdi, rax ;è¾“å…¥çš„32å­—ç¬¦<br>.text:00000000080017C5 call    sub_8080900;ä¸»è¦çš„checkå‡½æ•°<br></code></pre></td></tr></tbody></table></figure><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220420232345847.png" alt="image-20220420232345847"></p><p>è·³è¿‡æ¥<code>endbr64</code>æ£€æµ‹æ˜¯å¦åŠ«æŒï¼Œä¸åŸæœ¬å‡½æ•°å¼€å¤´çš„<code>push ebp</code> å’Œ <code>sub esp,xxx</code>å¤§ä¸ç›¸åŒï¼Œè¿™é‡Œæ˜¯å¯¹r15è¿›è¡Œæ“ä½œï¼Œä¸ºäº†æ–¹ä¾¿è§‚å¯Ÿå³ä¸Šå¼€äº†ä¸€ä¸ªå­çª—å£ä¸“ç”¨æ¥è·Ÿè¸ªR15ã€‚</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs assembly">SFI:0000000008080904 sub     r15d, 28h ; '(' ;å¼€è¾Ÿæ ˆç©ºé—´<br>SFI:0000000008080908 lea     r15, [r13+r15+0] ;r13å€¼ä¸º0<br>SFI:000000000808090D mov     [r15], rdi  ;æ ˆé¡¶å­˜å…¥è¾“å…¥åœ°å€<br>SFI:0000000008080910 mov     dword ptr [r15+24h], 0 ;ç¬¬äºŒä¸ªä½ç½®0<br>SFI:0000000008080918 mov     dword ptr [r15+24h], 0<br>SFI:0000000008080920 jmp     loc_8080A40 ;è·³è½¬<br></code></pre></td></tr></tbody></table></figure><p>ä¹‹ååˆå‘ç°ç±»ä¼¼ç»“æ„</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs assembly">SFI:0000000008080940 loc_8080940:                            ; CODE XREF: sub_8080900+145â†“j<br>SFI:0000000008080940 mov     eax, [r15+24h]<br>SFI:0000000008080944 shl     eax, 3     <br>SFI:0000000008080947 movsxd  rdx, eax<br>SFI:000000000808094A mov     rax, [r15] ;å–è¾“å…¥<br>SFI:000000000808094D add     rax, rdx<br>SFI:0000000008080950 mov     [r15+18h], rax ;å­˜åˆ°æ­¤å¤„<br>SFI:0000000008080954 mov     rax, [r15+18h]<br>SFI:0000000008080958 mov     rdi, rax       ;æ”¾å…¥rdi<br>SFI:000000000808095B nop     dword ptr [rax+rax+00h] ;nop<br>SFI:0000000008080960 lea     r15, [r15-8] ;æ ˆé¡¶ä¸Šç§»<br>SFI:0000000008080964 lea     r12, loc_8080980 <br>SFI:000000000808096B mov     [r15], r12 ;å°†ä¸‹ä¸€ä¸ªæ‰§è¡Œçš„æŒ‡ä»¤å…¥æ ˆ<br>SFI:000000000808096E jmp     loc_8080720 ;è·³è½¬åˆ°è¯¥å¤„æ‰§è¡Œ<br>SFI:000000000808096E ; -------------------------------------------------<br>SFI:0000000008080973 align 20h<br>SFI:0000000008080980<br>SFI:0000000008080980 loc_8080980:                            ; DATA XREF: sub_8080900+64â†‘o<br>SFI:0000000008080980 mov     [r15+10h], rax <br></code></pre></td></tr></tbody></table></figure><p>è¯¥å¤„çš„äº®ç‚¹åœ¨äºä½¿ç”¨r15æ¨¡æ‹Ÿäº†ä¸€ä¸ªcall loc_8080720çš„æ“ä½œï¼Œcallä¹‹åæ‰§è¡Œ8080980å¤„ä»£ç ï¼Œä¸­é—´æ•°æ®ä¸ºåƒåœ¾æŒ‡ä»¤ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220420234051834.png" alt="image-20220420234051834"></p><p>è§‚å¯Ÿå³ä¾§çª—å£å³ä¸ºè°ƒç”¨å‡½æ•°æ—¶å…¥æ ˆçš„<code>retadr</code>å’Œ<code>ebp</code>ï¼Œå¹¶ä¸”å¯¹äºå‡½æ•°è°ƒç”¨çš„ä»£ç å—ç”¨åˆ°äº†endbr64æ¥æ ‡è¯†ï¼Œä¹‹ååˆ™æ˜¯å¼€è¾Ÿæ–°çš„æ ˆå¸§ã€‚</p><blockquote><p>ç¨‹åºæ˜¯64ä½çš„ï¼Œæ‰€ä»¥rbpå’Œè¿”å›åœ°å€ä»¥åŠå¯¹æ ˆçš„æ“ä½œéƒ½æ˜¯ä»¥8å­—èŠ‚ä¸ºå•ä½ã€‚å…¶å®è¿™ä¸ªrbxçš„å†…å®¹ä¹Ÿä¸æ˜¯æ ˆåº•ï¼Œåº”è¯¥æ˜¯ä¿æŒç»“æ„ã€‚</p></blockquote><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220420235428879.png" alt="image-20220420235428879"></p><p>é€»è¾‘æ®µä¸­ä¹Ÿæ’å…¥äº†ä¸€äº›åƒåœ¾æ•°æ®ã€‚</p><p>å‡½æ•°è°ƒç”¨çš„ç»“æ„å·²ç»çŸ¥æ™“ï¼Œæ¥ä¸‹æ¥çœ‹ä»–è°ƒç”¨å®Œæ˜¯å¦‚ä½•æ¢å¤å †æ ˆçš„ã€‚</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs assembly">SFI:00000000080802E0 lea     r15, [r15+8] ;pop<br>SFI:00000000080802E4 mov     edi, [r15-8] ;è¿”å›åœ°å€æ”¾å…¥EDI<br>SFI:00000000080802E8 and     edi, 0FFFFFFE0h<br>SFI:00000000080802EB lea     rdi, [r13+rdi+0]<br>SFI:00000000080802F0 jmp     rdi ;è·³å›<br>SFI:00000000080802F0 ; END OF FUNCTION CHUNK FOR sub_8080900<br></code></pre></td></tr></tbody></table></figure><p>æ‰€ä»¥æ•´ä½“å †æ ˆç”±r15æ¥ç»´æŠ¤ï¼Œå¹¶ä¸”æ¨¡æ‹Ÿäº†callå’Œretï¼ŒåŒæ—¶é€»è¾‘æ®µä¸­è¿˜æœ‰åƒåœ¾æŒ‡ä»¤ã€‚</p><blockquote><p>æˆ‘ä»¬é¢„æœŸæ˜¯æ¢å¤å †æ ˆç”±espå’Œebpæ¥æ§åˆ¶ï¼Œæ¢å¤callå’Œretå‡½æ•°å¹¶ä¸”å»æ‰é€»è¾‘æ®µä¸­çš„åƒåœ¾æŒ‡ä»¤ï¼Œè¿™é¡¹å·¥ä½œå°†é€šè¿‡ä½¿ç”¨ipyæ¥è§£å†³ã€‚</p></blockquote><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python">GetDisasm(adr) <span class="hljs-comment">#å¾—åˆ°adråœ°å€çš„ä¸€æ¡æ±‡ç¼–ä»£ç </span><br><br>GetMnem(adr) <span class="hljs-comment">#å¾—åˆ°adråœ°å€çš„æ“ä½œç </span><br><br>next_head(adr) <span class="hljs-comment">#å–ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€</span><br><br>GetOpnd(adrï¼Œlong n) <span class="hljs-comment">#è·å–æ“ä½œæ•° ç¬¬ä¸€ä¸ªæ“ä½œæ•° næ˜¯0 ç¬¬äºŒä¸ªnæ˜¯1 ... </span><br><br>get_bytes(adr,end-adr) <span class="hljs-comment">#è·å–ä¸€ç‰‡ç©ºé—´çš„å­—èŠ‚</span><br>tmp=get_bytes(adr,end-adr)<br>tmp=tmp.replace(<span class="hljs-string">b'\x74\x03\x75\x01\xE8'</span>,<span class="hljs-string">b'\x90'</span>*<span class="hljs-number">5</span>) <span class="hljs-comment">#æ‰¹é‡patch</span><br><br></code></pre></td></tr></tbody></table></figure><blockquote><p>æœ¬æ¥æ˜¯è¦è¿™æŠŠr15ä¿®æˆrspçš„ï¼Œä½†æ˜¯æœºå™¨æŒ‡ä»¤çš„é•¿åº¦ä¸ä¸€è‡´ï¼Œæ”¹åŠ¨çš„è¯ä¼šæ¯”è¾ƒå¤§ï¼Œä¸ªäººçœ‹åˆ°äº†PZå¸ˆå‚…çš„åˆ†äº«ï¼Œåªéœ€è¦æŠŠæ§åˆ¶æµçš„callå’Œretä¿®çš„æ¸…æ¥šä¸€äº›å°±èƒ½ç”Ÿæˆå¯è¯»çš„åç¼–è¯‘ä»£ç äº†ã€‚</p></blockquote><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs assembly">;ret å¤„çš„ç¡¬ç¼–ç  å…¶ä¸­å¤¹æ‚ç€åƒåœ¾æ•°æ®<br>SFI:000000000807FF5A 66 0F 1F 44 00+                nop     word ptr [rax+rax+00h]<br>SFI:000000000807FF5A 00<br>SFI:000000000807FF60 4D 8D 7F 08                    lea     r15, [r15+8]<br>SFI:000000000807FF64 41 8B 7F F8                    mov     edi, [r15-8]<br>SFI:000000000807FF68 83 E7 E0                       and     edi, 0FFFFFFE0h<br>SFI:000000000807FF6B 49 8D 7C 3D 00                 lea     rdi, [r13+rdi+0]<br>SFI:000000000807FF70 FF E7                          jmp     rdi<br>ret=[0x41, 0x8B, 0x7F, 0xF8, 0x83, 0xE7, 0xE0, 0x49, 0x8D, 0x7C, 0x3D, 0x00, 0xFF, 0xE7]<br><br>;callå¤„ ç”±äºè¿”å›åœ°å€å¤„ä¸ä¸€è‡´æ‰€ä»¥æ“ä½œèµ·æ¥æ¯”<br>SFI:0000000008080A60 4D 8D 7F F8                    lea     r15, [r15-8]<br>SFI:0000000008080A64 4C 8D 25 15 00+                lea     r12, sub_8080A80<br>SFI:0000000008080A64 00 00<br>SFI:0000000008080A6B 4D 89 27                       mov     [r15], r12<br>SFI:0000000008080A6E E9 AD F4 FF FF                 jmp     loc_807FF20<br><br>;æ“ä½œåçš„align 20hå¤¹æ‚ç€åƒåœ¾æ•°æ®<br></code></pre></td></tr></tbody></table></figure><p>æ ¹æ®ä¸Šè¿°ç¡¬ç¼–ç çš„æ ¼å¼ç»™å‡º<code>Patch</code>è„šæœ¬,æ„Ÿè°¢På¸ˆå‚…çš„æ€è·¯åˆ†äº«ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs python">beg=<span class="hljs-number">0x807FEC0</span> <span class="hljs-comment">#çœŸä¸ªSFIæ®µ</span><br>end=<span class="hljs-number">0x8080ad2</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">'Patch Beg'</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">Patch</span>(<span class="hljs-params">l,r</span>):</span><br>    <span class="hljs-keyword">while</span> l&lt;r:<br>        PatchByte(l,<span class="hljs-number">0x90</span>)<br>        l+=<span class="hljs-number">1</span><br><br>adr_ins=[<span class="hljs-number">0</span>]*<span class="hljs-number">5</span><br>call_mod = [<span class="hljs-string">"lea"</span>, <span class="hljs-string">"lea"</span>, <span class="hljs-string">"mov"</span>, <span class="hljs-string">"jmp"</span>]<br>ret_mod = [<span class="hljs-string">"lea"</span>, <span class="hljs-string">"mov"</span>, <span class="hljs-string">"and"</span>, <span class="hljs-string">"lea"</span>, <span class="hljs-string">"jmp"</span>]<br>adr=beg<br><span class="hljs-keyword">while</span> adr&lt;end:<br>    adr_ins[<span class="hljs-number">0</span>]=adr<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">5</span>):  <span class="hljs-comment">#å–4ä¸ªæŒ‡ä»¤åˆ¤æ–­æ˜¯å¦æ˜¯call_mod</span><br>        adr_ins[i]=next_head(adr_ins[i-<span class="hljs-number">1</span>])<br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>        <span class="hljs-keyword">if</span> GetMnem(adr_ins[i])!=call_mod[i]:<br>            <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">else</span>:<br>        Patch(adr_ins[<span class="hljs-number">0</span>],adr_ins[<span class="hljs-number">3</span>])<br>        PatchByte(adr_ins[<span class="hljs-number">3</span>],<span class="hljs-number">0xe8</span>)<br>        l=next_head(adr_ins[<span class="hljs-number">3</span>]) <span class="hljs-comment">#Patch align</span><br>        r=next_head(l)<br>        Patch(l,r)<br>        adr=r<br>        <span class="hljs-keyword">continue</span><br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):  <span class="hljs-comment">#å–5ä¸ªæŒ‡ä»¤åˆ¤æ–­æ˜¯å¦æ˜¯ret_mod</span><br>        <span class="hljs-keyword">if</span> GetMnem(adr_ins[i]) != ret_mod[i]:<br>            <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">else</span>:<br>        Patch(adr_ins[<span class="hljs-number">0</span>],adr_ins[<span class="hljs-number">4</span>])<br>        PatchWord(adr_ins[<span class="hljs-number">4</span>],<span class="hljs-number">0x90</span>)<br>        PatchWord(adr_ins[<span class="hljs-number">4</span>]+<span class="hljs-number">1</span>,<span class="hljs-number">0xc3</span>)<br>        l=next_head(adr_ins[<span class="hljs-number">4</span>]) <span class="hljs-comment">#Patch align</span><br>        r=next_head(l)<br>        Patch(l,r)<br>        adr=r<br>        <span class="hljs-keyword">continue</span><br><br>    adr=next_head(adr)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">'Patch End'</span>)<br><br><span class="hljs-string">""" å»ä¸€äº›åƒåœ¾æ•°æ®çš„è¯</span><br><span class="hljs-string">tmp=get_bytes(beg,end-beg)</span><br><span class="hljs-string">junk1=[0x66, 0x66, 0x2E, 0x0F, 0x1F, 0x84, 0x00, 0x00, 0x00, 0x00, 0x00, 0x66, 0x66, 0x2E, 0x0F, 0x1F, 0x84, 0x00, 0x00, 0x00, 0x00, 0x00, 0x66, 0x0F, 0x1F, 0x84, 0x00, 0x00, 0x00, 0x00, 0x00]</span><br><span class="hljs-string">new_code=tmp.replace(bytes(junk1),b'\x90'*len(junk1))</span><br><span class="hljs-string"></span><br><span class="hljs-string">for i in range(len(new_code)):</span><br><span class="hljs-string">    if tmp[i]!=new_code[i]:</span><br><span class="hljs-string">        PatchByte(beg+i,new_code[i])</span><br><span class="hljs-string">"""</span><br></code></pre></td></tr></tbody></table></figure><p>è¿è¡Œåï¼Œå°†Patchåº”ç”¨åˆ°ä¸€ä¸ªé™„ä»¶ä¸Šï¼ŒIDAé‡æ–°è¿›è¡Œè§£æï¼Œåç¼–è¯‘åç»“åˆè°ƒè¯•ä¿¡æ¯æ¢å¤ç»“æ„ä½“ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220421182303300.png" alt="image-20220421182303300"></p><p>å¯¹æ¯”ä¸Šä¸€ç¯‡æ–‡ç« è°ƒè¯•æ±‡ç¼–å¾—åˆ°çš„åŠ å¯†,ç»“æ„åŸºæœ¬ä¸€è‡´ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">encode</span>(<span class="hljs-params">a,b</span>):</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">44</span>):<br>        a,b=(rol(a,<span class="hljs-number">1</span>)&amp;rol(a,<span class="hljs-number">8</span>))^rol(a,<span class="hljs-number">2</span>)^b^tb[i],a<br>        <span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(a), <span class="hljs-built_in">hex</span>(b))<br>    a,b=b,a<br>    <span class="hljs-keyword">return</span> a,b<br></code></pre></td></tr></tbody></table></figure><blockquote><p>æ¥å–æ¯èŒ¶å§ğŸµğŸµğŸµ</p></blockquote><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c"> *(v3 - <span class="hljs-number">0x24</span>) = round;  <span class="hljs-comment">//8</span><br> *(v3 - <span class="hljs-number">0x30</span>) = enc;    <span class="hljs-comment">//0 </span><br> *(v3 - <span class="hljs-number">0x18</span>) = &amp;unk_80AFB40; <span class="hljs-comment">//0x18</span><br> *(v3 - <span class="hljs-number">8</span>) = *(v2 + *(v3 - <span class="hljs-number">0x30</span>));<span class="hljs-comment">//0x28</span><br> *(v3 - <span class="hljs-number">0xC</span>) = *(v2 + *(v3 - <span class="hljs-number">0x30</span>) + <span class="hljs-number">4</span>);<span class="hljs-comment">//0x24</span><br> *(v3 - <span class="hljs-number">0x10</span>) = <span class="hljs-number">0</span>;<span class="hljs-comment">//0x20</span><br> *(v3 - <span class="hljs-number">0x1C</span>) = <span class="hljs-number">0x10325476</span>;<span class="hljs-comment">//0x14</span><br><span class="hljs-comment">//å¦‚ä½•è®¡ç®—åç§» å…¶å®-0x30 æŒ‡å‘çš„æ˜¯ä¸Šä¸€ä¸ªç»“æ„ä½“æ•°æ® å¹¶ä¸”ç»“æ„ä½“å¤§å°ä¸º0x30ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡ -0x24 = -0x30 +8 æ¥è®¡ç®—åç§»</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">en_st</span>{</span><br>_QWORD Enc;<br>_QWORD Round;<br>_QWORD Delta;<br>_DWORD* Xkey;<br>_DWORD Sum;<br>_DWORD V1;<br>_DWORD V0;<br>_DWORD I;<br>}<br></code></pre></td></tr></tbody></table></figure><p>ä¿®å¤ç»“æ„ä½“åå‡½æ•°å¦‚ä¸‹ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220421193241470.png" alt="image-20220421193241470"></p><p>è§£å¯†å°±ä¸åœ¨èµ˜è¿°äº†ï¼Œåœ¨ä¸Šç¯‡æ–‡ç« ä¸­æœ‰å†™ã€‚</p><blockquote><p>ç”±äºæœ¬é¢˜çš„é€»è¾‘ä»£ç å—è¾ƒå°‘ï¼Œå¹¶ä¸”TeaåŠ å¯†çš„æ±‡ç¼–æ¯”è¾ƒæœ‰ç‰¹ç‚¹ï¼Œæ‰€ä»¥é€šè¿‡è°ƒè¯•è¯»æ±‡ç¼–çš„æ‰‹æ®µä¹Ÿèƒ½å¿«é€Ÿè§£é¢˜ï¼Œä½†ä¸€æ—¦ä»£ç é‡å¤§èµ·æ¥å°±Gäº†ã€‚</p></blockquote><h3 id="End">End</h3><p>å…¶å®ä¸Šè¿°æ“ä½œå¹¶æ²¡ç”¨å®Œå…¨è§£å†³æ ˆæŒ‡é’ˆæ¢å¯„å­˜å™¨çš„é—®é¢˜ï¼Œæˆ‘ä»¬åªæ˜¯å‡­å€Ÿå¯¹callå’Œretçš„ä¿®å¤ä½¿ç¨‹åºæ§åˆ¶é€»è¾‘æ¢å¤ï¼Œè¾¾åˆ°åç¼–è¯‘çš„æ•ˆæœã€‚è¿™æ ·åšçš„ç¼ºç‚¹æ˜¯æˆ‘ä»¬ä¸å¾—ä¸æŠŠ r15æ¨¡æ‹Ÿçš„æ ˆç©ºé—´å½“æˆç»“æ„ä½“æ¥å¤„ç†ï¼Œå…¶å®ä¿®å¤èµ·æ¥ä¹Ÿæ˜¯æœ‰ä¸€å®šéš¾åº¦çš„ï¼Œå¦‚æœå‡½æ•°è°ƒç”¨æ¯”è¾ƒæ·±ï¼Œé‚£ä¹ˆè¿˜æ˜¯æ²¡èƒ½ç®€åŒ–åˆ†æã€‚</p><blockquote><p>å½»åº•ä¿®å¤æ˜¯æŠŠr15æ¢æˆrspï¼Œä¸è¿‡é€šè¿‡IDApythonçš„è¯æ„Ÿè§‰ä¼šæ¯”è¾ƒç¹ï¼Œä½¿ç”¨r15å’Œrspçš„æŒ‡ä»¤é•¿åº¦å¯èƒ½ä¼šå·®1,æ”¹åŠ¨é‡ä¼šæ¯”è¾ƒå¤§ï¼Œç›®å‰çš„å°è¯•ä»¥å¤±è´¥å‘Šç»ˆã€‚ğŸ˜­ğŸ˜­ğŸ˜­</p></blockquote><p><a href="https://www.csdn.net/tags/NtTagg1sMzkyODctYmxvZwO0O0OO0O0O.html">Intel-x64æ±‡ç¼–æŒ‡ä»¤æœºå™¨ç å¯¹åº”åˆ—è¡¨</a> â€“ æ›´å…·ä½“çš„ç¡¬ç¼–ç å¯ä»¥é€šè¿‡åœ¨x64dbgæˆ–ODä¸­å†™æ±‡ç¼–æ¥è§‚å¯Ÿã€‚</p>]]></content>
    
    
    <categories>
      
      <category>RE</category>
      
    </categories>
    
    
    <tags>
      
      <tag>RE</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>StarCTF-2022-someRE</title>
    <link href="/2022/04/19/StarCTF-2022/"/>
    <url>/2022/04/19/StarCTF-2022/</url>
    
    <content type="html"><![CDATA[<h1>*CTF-2022</h1><blockquote><p>é¢˜ç›®æœ¬èº«é€»è¾‘ä¸éš¾ï¼Œä¸»è¦åå‘äºåŸºç¡€èƒ½åŠ›çš„è€ƒå¯Ÿï¼Œæ—¶é—´åœ¨çœ‹æ±‡ç¼–å’Œè°ƒè¯•çš„è¿‡ç¨‹ä¸­æ…¢æ…¢æºœèµ°ã€‚è¿˜æœ‰å°±æ˜¯æ·¦REæ—¶ä¸è¦ä¸­é€”å»ç©å„¿åˆ«çš„æ–¹å‘ï¼ŒåšæŒæ‰æ˜¯èƒœåˆ©ï¼Œä¸€éè°ƒè¯•ä¸è¡Œé‚£å°±æ¥Néï¼Œå½“ç„¶åˆç†çš„æœç´¢å’Œå·¥å…·çš„ä½¿ç”¨å¾€å¾€ä¼šåŠ é€Ÿåˆ†æã€‚ğŸ¤”ğŸ¤”ğŸ¤”</p></blockquote><h2 id="Simple-File-System">Simple File System</h2><p>tipï¼š<code>debug</code></p><blockquote><p>ç­¾åˆ°é¢˜ï¼Œè™½ç„¶åå­—å¬èµ·æ¥æœ‰ç‚¹å“äººã€‚</p></blockquote><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220419173726329.png" alt="image-20220419173726329"></p><p>ç”Ÿæˆæ–‡ä»¶è¿›è¡Œçš„æ“ä½œã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><pre><code class="hljs c">I implemented a very simple file system <span class="hljs-keyword">and</span> buried my flag in it.<br><br>The image file are initiated as follows: <br>./simplefs image.flag <span class="hljs-number">500</span><br> simplefs&gt; format<br> simplefs&gt; mount<br> simplefs&gt; plantflag<br> simplefs&gt; <span class="hljs-built_in">exit</span><br>And you cold run <span class="hljs-string">"help"</span> to explore other commands.<br></code></pre></td></tr></tbody></table></figure><p>ä¸»è¦å…³æ³¨<code>plantflag</code>æ“ä½œï¼Œåªæœ‰å½“<code>sub_1E16("flag", v17, 1)</code>æ‰ä¼šå†™å…¥åŠ å¯†åçš„flagï¼Œå…¶ä½™éƒ½æ˜¯å†™å…¥éšæœºæ•°ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220419174534722.png" alt="image-20220419174534722"></p><p>è¯»å†™éƒ½ä»¥4kä¸ºå•ä½ï¼Œå¹¶ä¸”å†™å…¥çš„æ•°æ®é•¿åº¦ä¸º0x20ï¼Œv4æ˜¯ä»ç¬¬ä¸€ä¸ªæ•°æ®å—ä¸­å–å‡ºçš„4Byteæ•°æ®<code>0xDEEDBEEF</code>,ä¹‹åå°†å¤„ç†åçš„flagå†™å…¥æ–‡ä»¶ã€‚</p><blockquote><p>å¯ä»¥é€šè¿‡è°ƒè¯•æ¨¡æ‹Ÿç”Ÿæˆæ–‡ä»¶çš„è¿‡ç¨‹æ‹¿åˆ°v4ï¼Œå®šä½flagå†™çš„ä½ç½®ã€‚é€šè¿‡010è§‚å¯Ÿ<code>image.flag</code>æ–‡ä»¶ï¼Œ4kä¸€å—ï¼Œæ¯å—å¼€å¤´å¤„ä¾¿æ˜¯å†™å…¥çš„0x20Byteæ•°æ®ï¼Œç›´æ¥éå†æ‰€æœ‰è§£æ ¹æ®flagçš„æ ¼å¼åˆ¤æ–­å³å¯ã€‚</p></blockquote><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python">f=<span class="hljs-built_in">open</span>(<span class="hljs-string">r'G:\game\X-CTF\RE\æ–‡ä»¶ç³»ç»Ÿ\image.flag'</span>,<span class="hljs-string">'rb'</span>).read()<br>s=[]<br>tao=[<span class="hljs-number">0</span>]*<span class="hljs-number">32</span><br>c=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(f),<span class="hljs-number">32</span>):<br>    t=<span class="hljs-built_in">list</span>(f[i:i+<span class="hljs-number">32</span>])<br>    <span class="hljs-keyword">if</span> t!=tao:<br>        c.append(t)<br><br><br>k=[<span class="hljs-number">0xEF</span>,<span class="hljs-number">0xBE</span>,<span class="hljs-number">0xED</span>,<span class="hljs-number">0xDE</span>]<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">ror</span>(<span class="hljs-params">n,m</span>):</span><br>    <span class="hljs-keyword">return</span> ((n&gt;&gt;m) | (n&lt;&lt;(<span class="hljs-number">8</span>-m)))&amp;<span class="hljs-number">0xff</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rol</span>(<span class="hljs-params">n,m</span>):</span><br>    <span class="hljs-keyword">return</span> (((n&lt;&lt;m)&amp;<span class="hljs-number">0xff</span>) | ((n&gt;&gt;(<span class="hljs-number">8</span>-m))&amp;<span class="hljs-number">0xff</span>))<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dcd</span>(<span class="hljs-params">s</span>):</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(s)):<br>        s[i] = rol(s[i],<span class="hljs-number">5</span>)<br>        s[i] ^= k[<span class="hljs-number">3</span>]<br>        s[i] = rol(s[i], <span class="hljs-number">4</span>)<br>        s[i] ^= k[<span class="hljs-number">2</span>]<br>        s[i] = rol(s[i], <span class="hljs-number">3</span>)<br>        s[i] ^= k[<span class="hljs-number">1</span>]<br>        s[i] = rol(s[i], <span class="hljs-number">2</span>)<br>        s[i] ^= k[<span class="hljs-number">0</span>]<br>        s[i] = rol(s[i],<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">try</span>:<br>        m=<span class="hljs-built_in">bytes</span>(s).decode()<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">'*CTF'</span> <span class="hljs-keyword">in</span> m <span class="hljs-keyword">or</span> <span class="hljs-string">'*ctf'</span> <span class="hljs-keyword">in</span> m:<br>            <span class="hljs-built_in">print</span>(m)<br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">pass</span><br><br><span class="hljs-keyword">for</span> tb <span class="hljs-keyword">in</span> c:<br>    dcd(tb)<br><span class="hljs-comment">#*CTF{Gwed9VQpM4Lanf0kEj1oFJR6}</span><br></code></pre></td></tr></tbody></table></figure><blockquote><p>è§£å¯†æ—¶å¼‚æˆ–çš„çš„keyå†™æˆäº†ED EDï¼Œæ²¡æœ‰ç›´æ¥é™æ€å¹²æ‰ï¼Œä¹‹åç»“åˆè°ƒè¯•å‘ç°æŠ„é”™äº†keyã€‚</p></blockquote><h2 id="NaCl">NaCl</h2><p>tipï¼š<code>Feistel/Xtea</code></p><blockquote><p>r15æ¨¡æ‹Ÿespï¼Œè‡ªå·±ç»´æŠ¤çš„å †æ ˆï¼Œæ‰€ä»¥IDAåç¼–è¯‘çš„ä»£ç å°±æ¯”è¾ƒä¹±ï¼Œä¸è¿‡åŠ å¯†çš„é€»è¾‘å—ä¸æ˜¯å¾ˆå¤šï¼Œè°ƒè¯•åŠ è¯»æ±‡ç¼–å³å¯ã€‚=.= ç¡¬é€†</p><p>å¤§ğŸ”¥å‡ºé¢˜æ—¶é—´å·®ä¸å¤šï¼Œå·®ä¸€ç‚¹ç‚¹å°±æ‘¸åˆ°è¡€äº†ğŸ˜­ğŸ˜­ğŸ˜­ã€‚</p></blockquote><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220419171001916.png" alt="image-20220419171001916"></p><p>Xteaçš„deltaå’Œè½®æ•°è¢«é­”æ”¹äº†æ¯”è¾ƒå‘ï¼Œå¹¶ä¸”åœ¨ä¹‹å‰è¿˜è¿›è¡Œäº†<code>Feistel </code>ç»“æ„çš„åŠ å¯†ã€‚é¦–å…ˆç§˜é’¥æ‰©å±•ï¼Œå¾—åˆ°é•¿ä¸º44çš„intæ•°ç»„ï¼Œä¸è¿‡ç§˜é’¥æ˜¯å›ºå®šçš„å¯ä»¥ç›´æ¥dumpç”Ÿæˆçš„æ‰©å±•ç§˜é’¥ã€‚</p><blockquote><p>è´´ä¸€ä¸‹å½“æ—¶è·Ÿè¸ªæ—¶è®°å½•çš„æ•°æ®å¤„ç†ä¿¡æ¯ã€‚</p></blockquote><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rol</span>(<span class="hljs-params">n,m</span>):</span><br>    <span class="hljs-keyword">return</span> ((n&lt;&lt;m)&amp;<span class="hljs-number">0xffffffff</span>)|((n&gt;&gt;(<span class="hljs-number">32</span>-m))&amp;<span class="hljs-number">0xffffffff</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">ror</span>(<span class="hljs-params">n,m</span>):</span><br>    <span class="hljs-keyword">return</span> ((n&gt;&gt;m)&amp;<span class="hljs-number">0xffffffff</span>)|((n&lt;&lt;(<span class="hljs-number">32</span>-m))&amp;<span class="hljs-number">0xffffffff</span>)<br>s=<span class="hljs-number">0x8090a0b</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(ror(s,<span class="hljs-number">3</span>)))<br>s=ror(s,<span class="hljs-number">3</span>)<br><br>x=<span class="hljs-number">0x098BADCFF</span>^<span class="hljs-number">0x4050607</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(x))<br><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(x^s))<br><br>b=<span class="hljs-number">0x10203</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(x^s^b))<br><br>c=ror(<span class="hljs-number">0x8090a0b</span>,<span class="hljs-number">4</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(c))<br><br>d=<span class="hljs-number">0xfdbff9ba</span>^<span class="hljs-number">0xb08090a0</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(d))<br><br>e=<span class="hljs-number">0x10203</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(ror(e,<span class="hljs-number">1</span>)))<br><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(<span class="hljs-number">0x4d3f691a</span>^<span class="hljs-number">0x80008101</span>))<br><span class="hljs-comment"># 0x00000000080AFB70 : 0xcd3fe81b</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">'---------------------------'</span>)<br><br>a=<span class="hljs-number">0x67452301EFCDAB89</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(a&gt;&gt;<span class="hljs-number">1</span>))<br><span class="hljs-comment"># ä¸€å…±æ˜¯0x2c ä»4ä¸ªæ‰©å±•åˆ°äº†44ä¸ªæœ‰ç‚¹ç±»ä¼¼</span><br>tb=[<span class="hljs-number">0x04050607</span>, <span class="hljs-number">0x00010203</span>, <span class="hljs-number">0x0C0D0E0F</span>, <span class="hljs-number">0x08090A0B</span>, <span class="hljs-number">0xCD3FE81B</span>, <span class="hljs-number">0xD7C45477</span>, <span class="hljs-number">0x9F3E9236</span>, <span class="hljs-number">0x0107F187</span>, <span class="hljs-number">0xF993CB81</span>, <span class="hljs-number">0xBF74166C</span>, <span class="hljs-number">0xDA198427</span>, <span class="hljs-number">0x1A05ABFF</span>, <span class="hljs-number">0x9307E5E4</span>, <span class="hljs-number">0xCB8B0E45</span>, <span class="hljs-number">0x306DF7F5</span>, <span class="hljs-number">0xAD300197</span>, <span class="hljs-number">0xAA86B056</span>, <span class="hljs-number">0x449263BA</span>, <span class="hljs-number">0x3FA4401B</span>, <span class="hljs-number">0x1E41F917</span>, <span class="hljs-number">0xC6CB1E7D</span>, <span class="hljs-number">0x18EB0D7A</span>, <span class="hljs-number">0xD4EC4800</span>, <span class="hljs-number">0xB486F92B</span>, <span class="hljs-number">0x8737F9F3</span>, <span class="hljs-number">0x765E3D25</span>, <span class="hljs-number">0xDB3D3537</span>, <span class="hljs-number">0xEE44552B</span>, <span class="hljs-number">0x11D0C94C</span>, <span class="hljs-number">0x9B605BCB</span>, <span class="hljs-number">0x903B98B3</span>, <span class="hljs-number">0x24C2EEA3</span>, <span class="hljs-number">0x896E10A2</span>, <span class="hljs-number">0x2247F0C0</span>, <span class="hljs-number">0xB84E5CAA</span>, <span class="hljs-number">0x8D2C04F0</span>, <span class="hljs-number">0x3BC7842C</span>, <span class="hljs-number">0x1A50D606</span>, <span class="hljs-number">0x49A1917C</span>, <span class="hljs-number">0x7E1CB50C</span>, <span class="hljs-number">0xFC27B826</span>, <span class="hljs-number">0x5FDDDFBC</span>, <span class="hljs-number">0xDE0FC404</span>,<span class="hljs-number">0x0B2B30907</span>]<br><span class="hljs-built_in">print</span>(<span class="hljs-string">'---------------------------'</span>)<br>a=<span class="hljs-number">0x61616161</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(rol(a,<span class="hljs-number">1</span>)))<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(rol(a,<span class="hljs-number">8</span>)))<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(<span class="hljs-number">0xc2c2c2c2</span>&amp;<span class="hljs-number">0x61616161</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(rol(a,<span class="hljs-number">2</span>)))<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(<span class="hljs-number">0x40404040</span>^<span class="hljs-number">0x85858585</span>))<br>b=<span class="hljs-number">0x62626262</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(<span class="hljs-number">0xc5c5c5c5</span>^b))<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(<span class="hljs-number">0xa7a7a7a7</span>^tb[<span class="hljs-number">0</span>]))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">'---------------------------'</span>)<br>a=<span class="hljs-number">0x61616161</span><br>b=<span class="hljs-number">0x62626262</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">44</span>):<br>    a,b=(rol(a,<span class="hljs-number">1</span>)&amp;rol(a,<span class="hljs-number">8</span>))^rol(a,<span class="hljs-number">2</span>)^b^tb[i],a<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(a),<span class="hljs-built_in">hex</span>(b))<br>a,b=b,a<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(a),<span class="hljs-built_in">hex</span>(b))<br><span class="hljs-comment">#0x668a1861 0xacbe01cb</span><br><span class="hljs-comment">#ä¹‹åè·ŸXTea</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">'---------------------------'</span>)<br>c=[<span class="hljs-number">0x0F35310C</span>, <span class="hljs-number">0xD2CFADF5</span>]<br><span class="hljs-comment">#0xacbe01cb 0x668a1861 Xteaç»“æœæ­£ç¡®</span><br></code></pre></td></tr></tbody></table></figure><p><code>exp</code></p><p>é­”æ”¹Xtea</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ut32 unsigned int</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> delta 0x10325476</span><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">XTea_Decrypt</span><span class="hljs-params">(ut32* enc, ut32* k,ut32 r)</span> </span>{<br>ut32 sum = delta * r;<br>ut32 v0 = enc[<span class="hljs-number">0</span>];<br>ut32 v1 = enc[<span class="hljs-number">1</span>];<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; r; i++) {<br>v1 -= (((v0 &lt;&lt; <span class="hljs-number">4</span>) ^ (v0 &gt;&gt; <span class="hljs-number">5</span>)) + v0) ^ (sum + k[(sum &gt;&gt; <span class="hljs-number">11</span>) &amp; <span class="hljs-number">3</span>]);<br>sum -= delta;<br>v0 -= (((v1 &lt;&lt; <span class="hljs-number">4</span>) ^ (v1 &gt;&gt; <span class="hljs-number">5</span>)) + v1) ^ (sum + k[sum &amp; <span class="hljs-number">3</span>]);<br>}<br>enc[<span class="hljs-number">0</span>] = v0;<br>enc[<span class="hljs-number">1</span>] = v1;<br>}<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{<br>ut32 m[<span class="hljs-number">8</span>] = { <span class="hljs-number">0xFDF5C266</span>, <span class="hljs-number">0x7A328286</span>, <span class="hljs-number">0xCE944004</span>, <span class="hljs-number">0x5DE08ADC</span>, <span class="hljs-number">0xA6E4BD0A</span>, <span class="hljs-number">0x16CAADDC</span>, <span class="hljs-number">0x13CD6F0C</span>, <span class="hljs-number">0x1A75D936</span> };<br>ut32 k[<span class="hljs-number">4</span>] = { <span class="hljs-number">0x03020100</span>, <span class="hljs-number">0x07060504</span>, <span class="hljs-number">0x0B0A0908</span>, <span class="hljs-number">0x0F0E0D0C</span> };<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; i += <span class="hljs-number">2</span>) {<br>XTea_Decrypt(m + i, k,<span class="hljs-number">2</span>&lt;&lt;(i/<span class="hljs-number">2</span>)); <span class="hljs-comment">//å¤šè°ƒè¯•å‡ éçœ‹è½®æ•°æ˜¯å¦‚ä½•ç”Ÿæˆçš„</span><br>}<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; i++) {<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">"0x%x ,"</span>, m[i]);<br>}<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}<br></code></pre></td></tr></tbody></table></figure><p><code>RE-Feistel</code></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python">tb=[<span class="hljs-number">0x04050607</span>, <span class="hljs-number">0x00010203</span>, <span class="hljs-number">0x0C0D0E0F</span>, <span class="hljs-number">0x08090A0B</span>, <span class="hljs-number">0xCD3FE81B</span>, <span class="hljs-number">0xD7C45477</span>, <span class="hljs-number">0x9F3E9236</span>, <span class="hljs-number">0x0107F187</span>, <span class="hljs-number">0xF993CB81</span>, <span class="hljs-number">0xBF74166C</span>, <span class="hljs-number">0xDA198427</span>, <span class="hljs-number">0x1A05ABFF</span>, <span class="hljs-number">0x9307E5E4</span>, <span class="hljs-number">0xCB8B0E45</span>, <span class="hljs-number">0x306DF7F5</span>, <span class="hljs-number">0xAD300197</span>, <span class="hljs-number">0xAA86B056</span>, <span class="hljs-number">0x449263BA</span>, <span class="hljs-number">0x3FA4401B</span>, <span class="hljs-number">0x1E41F917</span>, <span class="hljs-number">0xC6CB1E7D</span>, <span class="hljs-number">0x18EB0D7A</span>, <span class="hljs-number">0xD4EC4800</span>, <span class="hljs-number">0xB486F92B</span>, <span class="hljs-number">0x8737F9F3</span>, <span class="hljs-number">0x765E3D25</span>, <span class="hljs-number">0xDB3D3537</span>, <span class="hljs-number">0xEE44552B</span>, <span class="hljs-number">0x11D0C94C</span>, <span class="hljs-number">0x9B605BCB</span>, <span class="hljs-number">0x903B98B3</span>, <span class="hljs-number">0x24C2EEA3</span>, <span class="hljs-number">0x896E10A2</span>, <span class="hljs-number">0x2247F0C0</span>, <span class="hljs-number">0xB84E5CAA</span>, <span class="hljs-number">0x8D2C04F0</span>, <span class="hljs-number">0x3BC7842C</span>, <span class="hljs-number">0x1A50D606</span>, <span class="hljs-number">0x49A1917C</span>, <span class="hljs-number">0x7E1CB50C</span>, <span class="hljs-number">0xFC27B826</span>, <span class="hljs-number">0x5FDDDFBC</span>, <span class="hljs-number">0xDE0FC404</span>,<span class="hljs-number">0x0B2B30907</span>]<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rol</span>(<span class="hljs-params">n,m</span>):</span><br>    <span class="hljs-keyword">return</span> ((n&lt;&lt;m)&amp;<span class="hljs-number">0xffffffff</span>)|((n&gt;&gt;(<span class="hljs-number">32</span>-m))&amp;<span class="hljs-number">0xffffffff</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">ror</span>(<span class="hljs-params">n,m</span>):</span><br>    <span class="hljs-keyword">return</span> ((n&gt;&gt;m)&amp;<span class="hljs-number">0xffffffff</span>)|((n&lt;&lt;(<span class="hljs-number">32</span>-m))&amp;<span class="hljs-number">0xffffffff</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">encode</span>(<span class="hljs-params">a,b</span>):</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">44</span>):<br>        a,b=(rol(a,<span class="hljs-number">1</span>)&amp;rol(a,<span class="hljs-number">8</span>))^rol(a,<span class="hljs-number">2</span>)^b^tb[i],a<br>        <span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(a), <span class="hljs-built_in">hex</span>(b))<br>    a,b=b,a<br>    <span class="hljs-keyword">return</span> a,b<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decode</span>(<span class="hljs-params">a,b</span>):</span><br>    a,b=b,a<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">43</span>,-<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>):<br>        a,b=b,a^(rol(b,<span class="hljs-number">1</span>)&amp;rol(b,<span class="hljs-number">8</span>))^rol(b,<span class="hljs-number">2</span>)^tb[i]<br>    <span class="hljs-keyword">return</span> a,b<br><br>c=[<span class="hljs-number">0xe71f5179</span> ,<span class="hljs-number">0xb55f9204</span> ,<span class="hljs-number">0x722d4a3a</span> ,<span class="hljs-number">0x238e8b65</span> ,<span class="hljs-number">0x4385e0f2</span> ,<span class="hljs-number">0x6703757a</span> ,<span class="hljs-number">0xaabe9be3</span> ,<span class="hljs-number">0x4de4253b</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(c),<span class="hljs-number">2</span>):<br>    a=c[i]<br>    b=c[i+<span class="hljs-number">1</span>]<br>    a,b=decode(a,b)<br>    <span class="hljs-built_in">print</span>((<span class="hljs-built_in">int</span>.to_bytes(a,<span class="hljs-number">4</span>,<span class="hljs-string">'big'</span>)+<span class="hljs-built_in">int</span>.to_bytes(b,<span class="hljs-number">4</span>,<span class="hljs-string">'big'</span>)).decode(),end=<span class="hljs-string">''</span>)<br><br><span class="hljs-comment">#*CTF{mM7pJIobsCTQPO6R0g-L8kFExhYuivBN}</span><br></code></pre></td></tr></tbody></table></figure><blockquote><p>å‡ºé¢˜äºº: å¾ˆæŠ±æ­‰æ‰€æœ‰ç©å®¶é€šè¿‡å¯¹åŸå§‹æ±‡ç¼–ä»£ç çš„åŠ¨æ€è°ƒè¯•å’Œé™æ€åˆ†æè§£å†³äº†è¿™ä¸ªæŒ‘æˆ˜ã€‚å› ä¸ºæˆ‘çš„éšè—é€»è¾‘ä»£ç å¾ˆçŸ­ã€‚å¤ªç³Ÿäº†ã€‚</p></blockquote><p>é¢„æœŸ: é¦–å…ˆï¼Œè½¬å‚¨æ®µSFIå’ŒSFI_dataã€‚ç„¶åï¼Œæ‚¨é€šè¿‡è„šæœ¬ä»£ç ä¿®æ”¹äºŒè¿›åˆ¶æ–‡ä»¶ã€‚æ‚¨éœ€è¦æ¢å¤å †æ ˆã€å¯„å­˜å™¨å’ŒæŒ‡ä»¤è°ƒç”¨ã€ret ç­‰ã€‚</p><blockquote><p>è¿™ï¼Œç¡®å®è‡ªåŠ¨åŒ–é€†å‘å·¥å…·å’Œipythonçš„è¿ç”¨è¿˜ä¸åˆ°ä½ï¼Œæš‚æ—¶ä¸ä¼šå†™ã€‚ğŸ˜”ğŸ˜”ğŸ˜”</p></blockquote><h2 id="jump">jump</h2><p>tipï¼š<code>setjmp/longjmp</code></p><h3 id="ç¡¬é€†">ç¡¬é€†</h3><blockquote><p>é€†å‡ºæµç¨‹çš„æ—¶å€™æœ‰ç‚¹æ™šäº†ï¼Œæ²¡çœ‹æ‡‚é€»è¾‘ï¼Œè‚ä¸åŠ¨äº†ã€‚ã€‚ã€‚</p></blockquote><p>æ— ç¬¦å·ï¼Œæ§åˆ¶æµä¸æ¸…æ™°ï¼Œé€»è¾‘æ¯”è¾ƒä¹±çš„ï¼Œçœ‹ä¸€ä¸‹æ•°æ®æ®µçš„ä¿¡æ¯å‡†å¤‡åŠ¨è°ƒã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220418163622494.png" alt="image-20220418163622494"></p><p>å¯†æ–‡æ˜¯34ä½ï¼Œå¹¶ä¸”ç¬¬ä¸€ä¸ªå‡½æ•°å°±æ˜¯è¾“å…¥ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">input=<span class="hljs-string">"01234567abcdefghijklmnopqrstuvwxyz"</span> <span class="hljs-comment">//æµ‹è¯•è¾“å…¥çš„é•¿åº¦æœ‰é—®é¢˜ ç»“åˆä¸‹æ–‡åˆ†æåº”ä¸º32ä½</span><br></code></pre></td></tr></tbody></table></figure><p>ä¹‹åè¿›å…¥è¿›å…¥<code>sub_46a4c0</code>å‡½æ•°ï¼Œa1æ˜æ˜¾æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œå¯ä»¥é€šè¿‡è°ƒè¯•ä¿¡æ¯å®šä¹‰ä¸€ä¸‹ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220418164403230.png" alt="image-20220418164403230"></p><blockquote><p>åŸæœ¬çŒœæµ‹ä¸ºè™šæ‹Ÿæœº,ä½†åæ¥å‘ç°è¿™æ˜¯ä¿å­˜ä¸Šä¸‹æ–‡çš„æ“ä½œï¼Œç»“åˆè°ƒè¯•ä¿¡æ¯å®šä¹‰ç»“æ„ä½“å­˜æ”¾æ•°æ®ï¼Œè‹¥äº†è§£<code>setjmp/longjmp</code>ç›´æ¥æ”¹å‚æ•°ä¸ºjmpbufç»“æ„ä½“å³å¯ã€‚</p></blockquote><p>ç›´æ¥æŒ‰ç…§setjmpå‡½æ•°çš„å‚æ•°è¿›è¡Œä¿®å¤ï¼Œå¤§è‡´å¦‚ä¸‹ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220418172303587.png" alt="image-20220418172303587"></p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//env ç»“æ„ä½“æ˜¯å…¨å±€å˜é‡</span><br><span class="hljs-function">Int <span class="hljs-title">setjmp</span><span class="hljs-params">(jmp_buf  env)</span></span>;<br>       <span class="hljs-comment">//è¿”å›å€¼ï¼šè‹¥ç›´æ¥è°ƒç”¨åˆ™è¿”å›0ï¼Œè‹¥ä»longjmpè°ƒç”¨è¿”å›åˆ™è¿”å›longjmpä¸­çš„valå€¼</span><br><span class="hljs-function">Void <span class="hljs-title">longjmp</span><span class="hljs-params">(jmp_buf env,<span class="hljs-keyword">int</span> val)</span></span>;<br>       <span class="hljs-comment">//è°ƒç”¨æ­¤å‡½æ•°åˆ™è¿”å›åˆ°è¯­å¥setjmpæ‰€åœ¨çš„åœ°æ–¹ï¼Œå…¶ä¸­env å°±æ˜¯setjmpä¸­çš„ envï¼Œè€Œval åˆ™æ˜¯ä½¿setjmpçš„è¿”å›å€¼å˜ä¸ºvalã€‚</span><br>   <span class="hljs-comment">//è·³åˆ°call setjmpä¹‹åçš„æ±‡ç¼–è¯­å¥ï¼Œå¤„ç†eaxä¸­çš„è¿”å›å€¼ä¹‹å‰ã€‚</span><br><span class="hljs-comment">//å¯ç”¨æ­¤æ¥å®ç°å¼‚å¸¸å¤„ç†</span><br></code></pre></td></tr></tbody></table></figure><p>é‚£ä¹ˆ<code>sub_401D45</code>å‡½æ•°åˆ™æ˜¯<code>longjmp</code>ã€‚</p><p>åœ¨å‡½æ•°sub_402689ä¸­å®ç°åŠ å¯†æ“ä½œã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220418181345932.png" alt="image-20220418181345932"></p><p>å…¶ä¸­longjmpä¸å¤–å±‚å‡½æ•°çš„äº¤äº’ï¼Œä¾æ¬¡å°†å¤„ç†åè¾“å…¥å­—ç¬¦å¾ªç¯å·¦ç§»ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220418181815197.png" alt="image-20220418181815197"></p><p>å†…å­˜ä¸­å¦‚ä¸‹</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220418182740692.png" alt="image-20220418182740692"></p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c">var=<span class="hljs-number">0</span><span class="hljs-comment">//2 '01234567abcdefghijklmnopqrstuvwxyz'3</span><br>var=<span class="hljs-number">1</span><span class="hljs-comment">//'01234567abcdefghijklmnopqrstuvwxyz' 3 2</span><br>var=<span class="hljs-number">2</span><span class="hljs-comment">//'1234567abcdefghijklmnopqrstuvwxyz' 3 2 '0'</span><br>var=<span class="hljs-number">3</span><span class="hljs-comment">//'234567abcdefghijklmnopqrstuvwxyz' 3 2 '01'</span><br>...<br>var=<span class="hljs-number">34</span> <span class="hljs-comment">//'z' 3 2 '01234567abcdefghijklmnopqrstuvwxy'</span><br></code></pre></td></tr></tbody></table></figure><p>ç”Ÿæˆäº†ä¸€ç³»åˆ—çš„<code>tmp_str</code>æ•°ç»„ï¼Œæ¥ç€è¿›å…¥<code>sub_401F62</code>å‡½æ•°è¿›è¡Œå¤„ç†ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220419101201529.png" alt="image-20220419101201529"></p><blockquote><p>è¯¥å‡½æ•°æ˜¯å¯¹str_arrä¸­çš„å­—ç¬¦ä¸²ç»„è¿›è¡Œå‡åºçš„å¿«é€Ÿæ’åºï¼Œ=.= å½“æ—¶æ²¡è®¤å‡ºæ¥ã€‚ç¬¬ä¸€ä¸ªå­—ç¬¦ä»å°åˆ°å¤§ã€‚</p></blockquote><p>ä¹‹ååˆæŒ‰ç…§ç±»ä¼¼æ“ä½œå¾ªç¯å–å­—ç¬¦ï¼Œæ¯æ¬¡å–str_arr[i][0x21]ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220418204032667.png" alt="image-20220418204032667"></p><p>å†…å±‚é€šè¿‡<code>jmp_buf</code>å˜é‡envæ¥ä¿æŒä¸Šä¸‹æ–‡ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220418210002030.png" alt="image-20220418210002030"></p><p>å¾ªç¯0x22æ¬¡è·å–encï¼Œæœ€å<code>longjmp(env,0x23)</code>è°ƒåˆ°checkå‡½æ•°çš„æ¯”å¯¹å¤„,ç›¸ç­‰åˆ™è¿”å›å¹¶è¾“å‡º,åŠ å¯†ç®—æ³•å’Œæµ‹è¯•æ•°æ®å¦‚ä¸‹ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python">testinput=<span class="hljs-string">'01234567abcdefghijklmnopqrstuvwxyz'</span><br>testoutput=[<span class="hljs-number">0x79</span>, <span class="hljs-number">0x7A</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x32</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x64</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0x68</span>, <span class="hljs-number">0x69</span>, <span class="hljs-number">0x6A</span>, <span class="hljs-number">0x6B</span>, <span class="hljs-number">0x6C</span>, <span class="hljs-number">0x6D</span>, <span class="hljs-number">0x6E</span>, <span class="hljs-number">0x6F</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0x71</span>, <span class="hljs-number">0x72</span>, <span class="hljs-number">0x73</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x75</span>, <span class="hljs-number">0x76</span>]<br>s=<span class="hljs-built_in">list</span>(<span class="hljs-string">'\x02'</span>+<span class="hljs-string">'01234567abcdefghijklmnopqrstuvwxyz'</span>+<span class="hljs-string">'\x03'</span>)<br>s=[<span class="hljs-built_in">ord</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> s]<br>str_arr=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0x22</span>):<br>    str_arr.append(s[i:]+s[<span class="hljs-number">0</span>:i])<br><span class="hljs-comment">#qsort(str_arr) æœ‰å¿«é€Ÿæ’åº ä¸è¿‡æœ¬æ¬¡è¾“å…¥ä½“ç°ä¸å‡º å› ä¸ºæœ¬èº«å°±æ˜¯æœ‰åºçš„</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0x22</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(str_arr[i][<span class="hljs-number">0x21</span>]),end=<span class="hljs-string">' '</span>)<br><span class="hljs-comment">#å¦‚æœè¾“å…¥æ˜¯34ä½é‚£ä¹ˆè¡¥å……åå˜æˆ36ä½ä¼šä¸¢ä½ï¼Œæ‰€ä»¥æ­£ç¡®è¾“å…¥åº”è¯¥æ˜¯32ä½,ç§»ä½æ’åºåå–å‡ºæœ€åä¸€ä½ã€‚</span><br></code></pre></td></tr></tbody></table></figure><p><code>exp</code></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> copy<br>enc=[<span class="hljs-number">0x03</span>, <span class="hljs-number">0x6A</span>, <span class="hljs-number">0x6D</span>, <span class="hljs-number">0x47</span>, <span class="hljs-number">0x6E</span>, <span class="hljs-number">0x5F</span>, <span class="hljs-number">0x3D</span>, <span class="hljs-number">0x75</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0x5A</span>, <span class="hljs-number">0x4C</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0x4E</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0x46</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x52</span>, <span class="hljs-number">0x2B</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0x32</span>, <span class="hljs-number">0x71</span>, <span class="hljs-number">0x56</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x54</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x6B</span>]<br>c=copy.deepcopy(enc)<br>c.sort()<span class="hljs-comment">#æ’åºå°±èƒ½è·å¾—ç¬¬ä¸€åˆ—æ•°æ®,å·²çŸ¥æœ€åä¸€åˆ—æ•°æ®</span><br><span class="hljs-comment">#å› ä¸ºæ˜¯ 2å’Œ3ä¸­é—´åŒ…å«è¾“å…¥ æ‰€ä»¥å¦‚æœæ’åºåé¦–ä½ä¸º3 é‚£ä¹ˆæœ«å°¾ä¸ºä»–å‰ä¸€ä¸ªæ•°æ®ï¼Œä»å³å‘å·¦å¤åŸæ•°æ®ã€‚</span><br>m=[<span class="hljs-number">0</span>]*<span class="hljs-number">34</span><br>m[<span class="hljs-number">0</span>]=<span class="hljs-number">2</span><br>m[-<span class="hljs-number">1</span>]=<span class="hljs-number">3</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0x20</span>,-<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>):<br>    p=c.index(m[i+<span class="hljs-number">1</span>])<br>    m[i]=enc[p]<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">bytes</span>(m))<br><span class="hljs-comment">#*CTF{cwNG1paBu=6Vn2kxSCqm+_4LETvFRZDj}</span><br></code></pre></td></tr></tbody></table></figure><blockquote><p>è¿™æ¬¡çš„æµ‹è¯•è¾“å…¥å’Œç®—æ³•è¯†åˆ«ä¸Šå¤±è¯¯æœ‰ç‚¹å¤§ï¼Œå»ç¬¦å·çŒœçš„å‡½æ•°æœ‰ç‚¹åå·®ï¼ŒCçš„åŸºç¡€ç¡®å®è–„å¼±äº†ç‚¹ï¼Œæ²¡è¯†åˆ«setjmpå’Œlongjmpã€‚</p></blockquote><h3 id="ç¬¦å·æ¢å¤">ç¬¦å·æ¢å¤</h3><blockquote><p>å¯ä»¥ä½¿ç”¨<a href="https://github.com/aliyunav/Finger">Finger - ç¬¦å·æ¢å¤-github</a>æ¥æ¢å¤åº“å‡½æ•°ç¬¦å·ï¼ŒçœŸè„šæœ¬å°å­çš„ç¦åˆ©ï¼ŒåŸºæœ¬ä¸Šå¸¸ç”¨åº“å‡½æ•°éƒ½è¢«å¤åŸäº†,åˆ†æç›´æ¥ä¸Šé«˜é€Ÿã€‚</p></blockquote><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220419163311164.png" alt="image-20220419163311164"></p><p>æ¢å¤äº†ä¸€äº›åº“å‡½æ•°çš„ç¬¦å·ï¼Œå¢åŠ äº†ç¨‹åºçš„å¯è¯»æ€§ï¼ŒåŒæ—¶è°ƒè¯•æ—¶ä¹Ÿå¯ä»¥å¿«é€Ÿåˆ¤æ–­ä¸€äº›å¤„ç†ã€‚</p><h2 id="end">end</h2><blockquote><p>å”¯æœ‰è‡ªä¿¡å’ŒåšæŒï¼Œæ‰èƒ½å¾—åˆ°è‡ªå·±æƒ³è¦çš„ç»“æœã€‚ğŸ‘ğŸ‘ğŸ‘</p></blockquote><p><a href="https://www.52pojie.cn/thread-1623713-1-1.html#42357189_jump">zskyå¸ˆå‚…çš„blog-*CTF - RE</a></p><p><a href="https://blog.csdn.net/chenyiming_1990/article/details/8683413">setjmpå’Œlongjmpå‡½æ•°ä½¿ç”¨è¯¦è§£ - CSDN</a></p><p><a href="https://blog.csdn.net/origin_lee/article/details/45057507">setjmp/longjmpéå±€éƒ¨è·³è½¬å‡½æ•°åˆ†æ - jmp_bufç»“æ„ä½“</a></p>]]></content>
    
    
    <categories>
      
      <category>CTF-WP</category>
      
      <category>RE</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Wp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Android Native Reverse(...ing)</title>
    <link href="/2022/04/04/Android%20native%20%E9%80%86%E5%90%91/"/>
    <url>/2022/04/04/Android%20native%20%E9%80%86%E5%90%91/</url>
    
    <content type="html"><![CDATA[<h1>Android native é€†å‘</h1><h2 id="å‰ç½®çŸ¥è¯†">å‰ç½®çŸ¥è¯†</h2><p><code>NDK</code></p><p>NDK å³ Native Development Kitï¼Œæ˜¯ Android ä¸­çš„ä¸€ä¸ªå¼€å‘å·¥å…·åŒ…ï¼Œä½¿æ‚¨èƒ½å¤Ÿåœ¨ Android åº”ç”¨ä¸­ä½¿ç”¨ C å’Œ C++ ä»£ç ã€‚</p><p>ä½¿ç”¨NDKå¯ä»¥å¿«é€Ÿå¼€å‘ Cã€ C++ çš„åŠ¨æ€åº“ï¼Œå¹¶è‡ªåŠ¨å°† so å’Œåº”ç”¨ä¸€èµ·æ‰“åŒ…æˆ APKã€‚å³å¯é€šè¿‡ NDKä½¿ Java ä¸ Native ä»£ç ï¼ˆå¦‚ Cã€C++ï¼‰äº¤äº’ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/20200924220730991.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><code>JNI</code></p><p>JNI å³ Java Native Interfaceï¼Œæ˜¯ä¸€ç§ç¼–ç¨‹æ¡†æ¶ï¼Œä½¿å¾— Java è™šæ‹Ÿæœºä¸­çš„ Java ç¨‹åºå¯ä»¥è°ƒç”¨æœ¬åœ°åº”ç”¨æˆ–åº“ï¼Œä¹Ÿå¯ä»¥è¢«å…¶ä»–ç¨‹åºè°ƒç”¨ã€‚ æœ¬åœ°ç¨‹åºä¸€èˆ¬æ˜¯ç”¨å…¶å®ƒè¯­è¨€ï¼ˆCã€C++ æˆ–æ±‡ç¼–è¯­è¨€ç­‰ï¼‰ç¼–å†™çš„ï¼Œå¹¶ä¸”è¢«ç¼–è¯‘ä¸ºåŸºäºæœ¬æœºç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„ç¨‹åº</p><p>ä½¿ç”¨JNI é¦–å…ˆè¦å£°æ˜nativeæ–¹æ³•ï¼Œä¹‹åå®ç°nativeæ–¹æ³•ï¼Œå¹¶ç”Ÿæˆsoæ–‡ä»¶ï¼Œæœ€ç»ˆåŠ è½½soæ–‡ä»¶ï¼Œè°ƒç”¨nativeæ–¹æ³•ã€‚</p><blockquote><p>JNI æ˜¯ä¸€ä¸ªç¼–ç¨‹æ¡†æ¶ï¼Œæ˜¯ä¸€ä¸ªæŠ½è±¡çš„ä¸œè¥¿ï¼ŒNDK æ˜¯ä¸€ä¸ªå·¥å…·åŒ…</p></blockquote><p><code>ABI</code></p><p>ABI å³ Application Binary Interfaceã€‚æˆ‘ä»¬ä¸Šé¢è¯´äº†ï¼Œæ¯ä¸ªCPUç³»ç»Ÿåªèƒ½ä½¿ç”¨ç›¸å¯¹åº”çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¸åŒçš„ Android è®¾å¤‡ä½¿ç”¨ä¸åŒçš„ CPUï¼Œè€Œä¸åŒçš„ CPU æ”¯æŒä¸åŒçš„æŒ‡ä»¤é›†ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220331174010239.png" alt="image-20220331174010239"></p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220403183650728.png" alt="image-20220403183650728"></p><p><strong>åœ¨ Android æ‰‹æœºä¸Šå®‰è£…ä¸€ä¸ªåº”ç”¨æ—¶ï¼Œåªæœ‰æ‰‹æœºCPUæ¶æ„æ”¯æŒçš„ABIæ¶æ„å¯¹åº”çš„.soæ–‡ä»¶ä¼šè¢«å®‰è£…ã€‚å¦‚æœæ”¯æŒå¤šä¸ªABIæ¶æ„ï¼Œä¼šæŒ‰ç…§ä¼˜å…ˆçº§è¿›è¡Œå®‰è£…ã€‚x86æ¶æ„çš„æ¨¡æ‹Ÿå™¨ä¹Ÿèƒ½è¿è¡Œarmçš„ç¨‹åºæ˜¯å› ä¸ºå…¶ä¸­é—´å¯¹soæ–‡ä»¶è¿›è¡Œäº†è½¬æ¢ï¼Œæ‰€ä»¥åœ¨è°ƒè¯•æˆ–è€…æ˜¯ç”¨frida hook æ—¶ä¼šå› æ­¤å‡ºç°ä¸åŒ¹é…æˆ–æ‰¾ä¸åˆ°çš„é—®é¢˜ã€‚</strong></p><h2 id="JNIæ–¹æ³•çš„ä½¿ç”¨">JNIæ–¹æ³•çš„ä½¿ç”¨</h2><h3 id="é™æ€æ³¨å†Œ">é™æ€æ³¨å†Œ</h3><p>native å±‚çš„æ–¹æ³•åä¸ºï¼š<strong>Java_&lt;åŒ…å&gt;*&lt;ç±»å&gt;*&lt;æ–¹æ³•å&gt;ï¼ˆ__&lt;å‚æ•°&gt;ï¼‰</strong></p><p>linux: mkdir -p jni/com/example/task</p><p>æ³¨å†Œæ­¥éª¤å¦‚ä¸‹</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.task; <span class="hljs-comment">//åŒ…å</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">test</span> </span>{<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title">func</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a)</span></span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">func</span><span class="hljs-params">(String a)</span></span>; <br>    <span class="hljs-comment">//åªæœ‰å½“ native æ–¹æ³•å‡ºç°éœ€è¦é‡è½½çš„æ—¶å€™ï¼Œnative å±‚çš„æ–¹æ³•ååæ‰éœ€è¦è·Ÿä¸Šå‚æ•°</span><br><br>}<br><span class="hljs-comment">//javaå±‚ native æ–¹æ³•å£°æ˜ é€šå¸¸åœ¨ä¸€ä¸ªç±»ä¸­</span><br></code></pre></td></tr></tbody></table></figure><p>åœ¨<code>xxxx/jni/com/example/task</code>ç›®å½•ä¸‹ç¼–è¯‘javaæ–‡ä»¶</p><p>javac ç¼–è¯‘<code>test.java</code>æ–‡ä»¶ç”Ÿæˆ<code>test.class</code></p><p>è¿›å…¥åˆ° <code> xxx/jni</code> ç›®å½•ä¸‹ä½¿ç”¨å‘½ä»¤ï¼š  <strong>javah com.example.task.test</strong> ä¼šç”Ÿæˆ com_example_task_test.h æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* DO NOT EDIT THIS FILE - it is machine generated */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;jni.h&gt;</span></span><br><span class="hljs-comment">/* Header for class com_example_task_test */</span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> _Included_com_example_task_test</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> _Included_com_example_task_test</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> __cplusplus</span><br><span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> {<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * Class:     com_example_task_test</span><br><span class="hljs-comment"> * Method:    init</span><br><span class="hljs-comment"> * Signature: ()V</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function">JNIEXPORT <span class="hljs-keyword">void</span> JNICALL <span class="hljs-title">Java_com_example_task_test_init</span> </span><br><span class="hljs-function">  <span class="hljs-params">(JNIEnv *, jobject)</span></span>;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * Class:     com_example_task_test</span><br><span class="hljs-comment"> * Method:    func</span><br><span class="hljs-comment"> * Signature: (I)V</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function">JNIEXPORT <span class="hljs-keyword">void</span> JNICALL <span class="hljs-title">Java_com_example_task_test_func__I</span></span><br><span class="hljs-function">  <span class="hljs-params">(JNIEnv *, jobject, jint)</span></span>;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * Class:     com_example_task_test</span><br><span class="hljs-comment"> * Method:    func</span><br><span class="hljs-comment"> * Signature: (Ljava/lang/String;)Z</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function">JNIEXPORT jboolean JNICALL <span class="hljs-title">Java_com_example_task_test_func__Ljava_lang_String_2</span></span><br><span class="hljs-function">  <span class="hljs-params">(JNIEnv *, jobject, jstring)</span></span>;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> __cplusplus</span><br>}<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br></code></pre></td></tr></tbody></table></figure><blockquote><p>å¯ä»¥è§‚å¯Ÿ å‡½æ•°æ˜¯ java_åŒ…å_ç±»å_å‡½æ•°å å‚æ•°æ˜¯ <strong>JNIEnv</strong>* å’Œ <strong>jobject</strong> + é¢å¤–å‚æ•°</p></blockquote><p>å°†<code>com_example_task_test.h</code> ä¿®æ”¹ä¸º<code>Myjni.h</code> æˆ–å…¶ä»– æŒ‰ç…§è‡ªå·±å–œå¥½ğŸ‘¨â€ğŸ’»ã€‚</p><p>æ­¤æ—¶æˆ‘ä»¬åªæ‹¿åˆ°äº†åœ¨javaä¸­å£°æ˜çš„nativeå‡½æ•°ï¼Œè¿˜æ²¡æœ‰ç»™å‡ºå‡½æ•°ä½“ï¼Œæ•…ä¸‹ä¸€æ­¥æ˜¯é€šè¿‡c/c++å®Œå–„å‡½æ•°å¹¶ç¼–è¯‘å‡ºsoæ–‡ä»¶ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"MyJni.h"</span> <span class="hljs-comment">//å¯¼å…¥ä¿®æ”¹åçš„å¤´æ–‡ä»¶ ç¼–å†™å‡½æ•°å®ä½“</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><br>JNIEXPORT jboolean JNICALL Java_com_example_task_test_func__Ljava_lang_String_2 <span class="hljs-comment">//å¤´æ–‡ä»¶ä¸­å£°æ˜çš„nativeå‡½æ•°</span><br>  (JNIEnv *, jobject, jstring){<br>         <span class="hljs-keyword">char</span> *cstr=(<span class="hljs-keyword">char</span> *)(*env)-&gt;GetStringUTFChars(env,jstr,<span class="hljs-literal">NULL</span>); <span class="hljs-comment">//è·å–ä¼ å…¥çš„å­—ç¬¦</span><br>         <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%s\n"</span>,cstr);<br>}<br>....<br></code></pre></td></tr></tbody></table></figure><p>ä¹‹åé€šè¿‡gcc ç¼–è¯‘<code>MyJni.c</code>ç”Ÿæˆsoæ–‡ä»¶</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">gcc -fPIC -shared -o libMyJni.so MyJni.c -I xxxx/include<br></code></pre></td></tr></tbody></table></figure><blockquote><p>-I  xxxx/include æŒ‡å®šå¤´æ–‡ä»¶æœç´¢ç›®å½•ï¼Œxxxä¸ºjdkçš„å®‰è£…è·¯å¾„ï¼Œè¦ç”¨åˆ°Jni.hæ–‡ä»¶ ï¼Œ å¹¶ä¸”è¾“å‡ºsoæ–‡ä»¶å¿…é¡»ä»¥libå¼€å¤´</p></blockquote><p>å¦‚æœè¦æƒ³å®ä¾‹è¿è¡Œï¼Œ<code>test.java</code>ä¸­éœ€è¦è°ƒç”¨soæ–‡ä»¶,å¦‚ä¸‹ã€‚</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.task; <span class="hljs-comment">//åŒ…å</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">test</span> </span>{<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">func</span><span class="hljs-params">(String a)</span></span>; <br>    <span class="hljs-comment">//åªæœ‰å½“ native æ–¹æ³•å‡ºç°éœ€è¦é‡è½½çš„æ—¶å€™ï¼Œnative å±‚çš„æ–¹æ³•ååæ‰éœ€è¦è·Ÿä¸Šå‚æ•°</span><br>    <span class="hljs-keyword">static</span>{<br>            System.loadLibrary(<span class="hljs-string">"MyJni"</span>); <span class="hljs-comment">//åŠ è½½soæ–‡ä»¶</span><br>    }<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] argv)</span></span>{ <span class="hljs-comment">//ä¸»å‡½æ•°</span><br>                System.out.println(<span class="hljs-string">"hello"</span>);<br>                <span class="hljs-keyword">new</span> test().func(<span class="hljs-string">"jni callback!"</span>);<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure><p>å®Œæˆä¸Šè¿°æ­¥éª¤åå¯é€šè¿‡ <strong>java -Djava.library.path=xxx/jni/com/example/task/ com.example.task.test</strong>è¿›è¡Œè¿è¡Œæµ‹è¯•ã€‚</p><p>ä¸Šè¿°æ˜¯é™æ€æ³¨å†Œçš„æ–¹æ³•ï¼Œé™æ€æ³¨å†Œçš„å‡½æ•°åéƒ½æŒ‰ç…§<code>java_åŒ…å_ç±»å_æ–¹æ³•å</code>çš„æ ¼å¼æ¥å‘½åï¼Œé•¿åº¦æ¯”è¾ƒé•¿ï¼Œå¹¶ä¸”ç±»åæˆ–åŒ…åä¿®æ”¹åè¿˜è¦é‡å¤ä¸Šè¿°æ­¥éª¤ç”Ÿæˆæ–°çš„soæ–‡ä»¶ã€‚</p><h3 id="åŠ¨æ€æ³¨å†Œ">åŠ¨æ€æ³¨å†Œ</h3><p>åŠ¨æ€æ³¨å†Œéœ€è¦å°†nativeæ–¹æ³•æ„é€ æˆJNINativeMethodæ•°ç»„ï¼ŒJNINativeMethodç»“æ„ä½“å®šä¹‰å¦‚ä¸‹ã€‚</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">typedef struct {<br><br>    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* name; <span class="hljs-comment">// Javaå±‚nativeæ–¹æ³•åç§°</span><br><br>    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* signature; <span class="hljs-comment">// æ–¹æ³•ç­¾å</span><br><br>    <span class="hljs-keyword">void</span>*       fnPtr; <span class="hljs-comment">// nativeå±‚æ–¹æ³•æŒ‡é’ˆ</span><br>} JNINativeMethod;<br></code></pre></td></tr></tbody></table></figure><p><strong>ä¹‹åéœ€è¦é‡å†™JNI_OnLoadå‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šåœ¨ System.loadLibraryåŠ è½½å®Œsoæ–‡ä»¶åè¢«è°ƒç”¨ï¼Œåœ¨å…¶ä¸­å®ŒæˆåŠ¨æ€æ³¨å†Œã€‚</strong></p><p>ä¸€ä¸ªMyJni.cçš„ç»“æ„å¦‚ä¸‹ã€‚</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java">#include&lt;jni.h&gt;<br>#include&lt;stdio.h&gt;<br><span class="hljs-keyword">static</span> JNINativeMethod methods[] = {      <span class="hljs-comment">//JNINativeMethodæ•°ç»„ æ¯ä¸€é¡¹çš„å€¼ åŒ…æ‹¬ name sign å’Œ å‡½æ•°æŒ‡é’ˆ</span><br>        {<span class="hljs-string">"init"</span>, <span class="hljs-string">"()V"</span>, (<span class="hljs-keyword">void</span> *)c_init1},<br>        {<span class="hljs-string">"init"</span>, <span class="hljs-string">"(I)V"</span>, (<span class="hljs-keyword">void</span> *)c_init2},<br>        {<span class="hljs-string">"init"</span>, <span class="hljs-string">"(Ljava/lang/String;)Z"</span>, (<span class="hljs-keyword">void</span> *)c_init3},<br>        {<span class="hljs-string">"update"</span>, <span class="hljs-string">"()V"</span>, (<span class="hljs-keyword">void</span> *)c_update},<br>    .....<br>};<br><br>JNIEXPORT jint JNICALL  <span class="hljs-comment">//JNIEXPORT</span><br>JNI_OnLoad(JavaVM* vm, <span class="hljs-keyword">void</span>* reserved) { <span class="hljs-comment">//æ³¨æ„å‚æ•° JavaVM* vm å’Œ void* reserved </span><br>    JNIEnv *env = NULL;<br>    jint result = -<span class="hljs-number">1</span>;<br> <br>    <span class="hljs-comment">// è·å–JNI envå˜é‡</span><br>    <span class="hljs-keyword">if</span> (vm-&gt;GetEnv((<span class="hljs-keyword">void</span>**) &amp;env, JNI_VERSION_1_6) != JNI_OK) {<br>        <span class="hljs-comment">// å¤±è´¥è¿”å›-1</span><br>        <span class="hljs-keyword">return</span> result;<br>    }<br> <br>    <span class="hljs-comment">// è·å–nativeæ–¹æ³•æ‰€åœ¨ç±»</span><br>    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* className = <span class="hljs-string">"com/example/ndk/NativeTest"</span>;<br>    jclass clazz = env-&gt;FindClass(className);<br>    <span class="hljs-keyword">if</span> (clazz == NULL) {<br>        <span class="hljs-keyword">return</span> result;<br>    }<br> <br>    <span class="hljs-comment">// åŠ¨æ€æ³¨å†Œnativeæ–¹æ³•</span><br>    <span class="hljs-keyword">if</span> (env-&gt;RegisterNatives(clazz, methods, sizeof(methods) / sizeof(methods[<span class="hljs-number">0</span>])) &lt; <span class="hljs-number">0</span>) {<br>        <span class="hljs-keyword">return</span> result;<br>    }<br> <br>    <span class="hljs-comment">// è¿”å›æˆåŠŸ</span><br>    result = JNI_VERSION_1_6;<br>    <span class="hljs-keyword">return</span> result;<br>}<br><br>extern <span class="hljs-string">"C"</span> <span class="hljs-function">JNIEXPORT <span class="hljs-keyword">void</span> JNICALL</span><br><span class="hljs-function"><span class="hljs-title">c_init1</span><span class="hljs-params">(JNIEnv *env, jobject thiz)</span> </span>{<br>    <span class="hljs-comment">//  å‡½æ•°å®ä½“</span><br>}<br>...........<br><br></code></pre></td></tr></tbody></table></figure><p>å› ä¸º<code>JNI_OnLoad</code>æ˜¯å¯¼å‡ºå‡½æ•°ï¼Œæ‰€ä»¥IDAåœ¨exportsä¸­å¯ä»¥æ‰¾åˆ°ã€‚</p><p>å…¶ä¸­ï¼Œä¸»è¦ç”¨RegisterNativesè§£æ</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">jint <span class="hljs-title">RegisterNatives</span><span class="hljs-params">(jclass clazz, <span class="hljs-keyword">const</span> JNINativeMethod* methods, jint nMethods)</span><span class="hljs-comment">//å‚æ•°ä¾æ¬¡æ˜¯ nativeæ‰€åœ¨ç±» å‡½æ•°æ•°ç»„ å’Œ å‡½æ•°ä¸ªæ•°</span></span><br><span class="hljs-function"><span class="hljs-comment">//æ³¨å†ŒæˆåŠŸåˆ™è¿”å› 0,å¤±è´¥åˆ™è¿”å›ä¸€ä¸ªè´Ÿå€¼</span></span><br></code></pre></td></tr></tbody></table></figure><p>ä¸Šè¿°åªæ˜¯å¯¹JNIç¼–ç¨‹ç»“æ„æœ‰ä¸€å®šçš„äº†è§£ï¼Œå¦‚æœè¦æ·±å…¥çš„è¯è¿˜è¦ç³»ç»Ÿå­¦ä¹ ä¸€ä¸‹Androidå¼€å‘å’Œjavaç­‰ğŸ˜”ã€‚</p><h2 id="libxxx-soæ–‡ä»¶å‡½æ•°ä¿®å¤">libxxx.soæ–‡ä»¶å‡½æ•°ä¿®å¤</h2><p>ğŸ‘€æ˜“å¿½ç•¥ç‚¹ï¼šsoæ–‡ä»¶æ˜¯ä¸€ä¸ªelfæ ¼å¼çš„æ–‡ä»¶ï¼Œåœ¨soè¢«åŠ è½½ä¹‹å‰ï¼Œä¼šæ‰§è¡Œinitæ®µçš„ä»£ç ,åœ¨ç»“æŸçš„æ—¶å€™ï¼Œä¼šæ‰§è¡Œfiniæ®µçš„ä»£ç ã€‚æ‰€ä»¥åœ¨init_arrayä¸­å¯èƒ½ä¼šæœ‰smcæ•°æ®è§£å¯†çš„ä»£ç ï¼Œå¾€å¾€å­˜åœ¨ç€æ•°æ®è§£å¯†ã€‚</p><blockquote><p>é™æ€æ³¨å†Œçš„nativeå‡½æ•°å› ä¸ºå‘½åè§„èŒƒå¾ˆå®¹æ˜“è¯†åˆ«ï¼Œæ‰€ä»¥éš¾ç‚¹åœ¨åŠ¨æ€æ³¨å†Œçš„å‡½æ•°ã€‚</p></blockquote><p>jadxä¸­æŸ¥çœ‹nativeå£°æ˜ï¼Œå¹¶ä¸”ä¹‹åä¼šè°ƒç”¨checkå‡½æ•°ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220401003254289.png" alt="image-20220401003254289"></p><p>æ‰“å¼€lib.soæ–‡ä»¶ï¼Œå…¶ä¸­nativeçš„checkå‡½æ•°é€šè¿‡åŠ¨æ€æ³¨å†Œï¼Œå› ä¸ºå¯¼å‡ºè¡¨ä¸­æ— xxxx_checkå‡½æ•°ã€‚å¯è§JNI_OnLoadå‡½æ•°æœ¬èº«çš„å‚æ•°æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯å…¶ä¸­çš„å±€éƒ¨å˜é‡ç±»å‹å´ä¸æ­£ç¡®ğŸ˜­ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220331230040806.png" alt="image-20220331230040806"></p><p>æ ¹æ®ä¸Šæ–‡æ‰€è¿°åŠ¨æ€æ³¨å†Œçš„æ­¥éª¤(è·å–JNIçš„envå˜é‡ï¼Œè·å–åŒ…å«nativeçš„ç±»ï¼Œé€šè¿‡RegisterNativeså’Œmethodæ•°ç»„æ¥åŠ¨æ€æ³¨å†Œ)ï¼Œè°ƒæ•´å˜é‡ä¿®å¤å‡½æ•°ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">jint <span class="hljs-title">JNI_OnLoad</span><span class="hljs-params">(JavaVM *vm, <span class="hljs-keyword">void</span> *reserved)</span></span><br><span class="hljs-function"></span>{<br>  jint v3; <span class="hljs-comment">// w19</span><br>  JNIEnv *v5; <span class="hljs-comment">// x20</span><br>  jclass v6; <span class="hljs-comment">// x0</span><br>  JNIEnv *v7[<span class="hljs-number">2</span>]; <span class="hljs-comment">// [xsp+0h] [xbp-30h] BYREF</span><br><br>  v3 = <span class="hljs-number">65542</span>;<br>  v7[<span class="hljs-number">1</span>] = *(JNIEnv **)(_ReadStatusReg(ARM64_SYSREG(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">13</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>)) + <span class="hljs-number">40</span>);<br>  v7[<span class="hljs-number">0</span>] = <span class="hljs-number">0LL</span>;<br>  sub_1724();                                   <span class="hljs-comment">// åè°ƒè¯•</span><br>  <span class="hljs-keyword">if</span> ( (*vm)-&gt;GetEnv(vm, (<span class="hljs-keyword">void</span> **)v7, <span class="hljs-number">65542LL</span>) )<span class="hljs-comment">// é€šè¿‡vmè·å–JNI envå˜é‡å­˜åˆ°v7</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>  v5 = v7[<span class="hljs-number">0</span>];<br>  v6 = (*v7[<span class="hljs-number">0</span>])-&gt;FindClass(v7[<span class="hljs-number">0</span>], class_name);  <span class="hljs-comment">// com/test/hufu22/TestActivity</span><br>  <span class="hljs-keyword">if</span> ( !v6<br>    || (((__int64 (__fastcall *)(JNIEnv *, jclass, <span class="hljs-keyword">char</span> **, __int64))(*v5)-&gt;RegisterNatives)(v5, v6, &amp;method, <span class="hljs-number">1LL</span>) &amp; <span class="hljs-number">0x80000000</span>) != <span class="hljs-number">0</span> )<br>  {<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;                                  <span class="hljs-comment">// åŠ¨æ€æ³¨å†Œäº†ä¸€ä¸ªå‡½æ•° å¹¶ä¸”åœ¨TestActivityç±»ä¸­çš„è°ƒç”¨</span><br>  }<br>  <span class="hljs-keyword">return</span> v3;<br>}<br></code></pre></td></tr></tbody></table></figure><p>ä¿®æ”¹ä¹‹åï¼Œå³å¯ç›´è§‚çœ‹å‡ºæ˜¯å¯¹ä¸€ä¸ªå‡½æ•°è¿›è¡Œäº†åŠ¨æ€æ³¨å†Œï¼Œè·Ÿè¿›methodå˜é‡ï¼Œè§‚å¯Ÿå…¶3ä¸ªå€¼ï¼Œæ˜¯ç»è¿‡smcä¿®æ”¹çš„ï¼Œæ‰‹åŠ¨ä¿®ä¸€ä¸‹ï¼Œå¦‚ä¸‹ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220331231932296.png" alt="image-20220331231932296"></p><p><strong>åŠ¨æ€æ³¨å†Œçš„checkå‡½æ•°å·²ç»æ‰¾åˆ°ï¼Œæ¥ä¸‹æ¥å°±è¦é€†å‘åˆ†æå‡½æ•°é€»è¾‘ï¼Œä¸è¿‡åœ¨æ­¤ä¹‹å‰ï¼Œ.init_arrayçš„å†…å®¹éœ€è¦è§£å†³ï¼Œå› ä¸ºæœ¬é¢˜ä¸­å‘ç°å…¶ä¸­å­˜åœ¨è§£å¯†ä»£ç ï¼Œå¯¹ä¸€äº›é™æ€æ•°æ®è¿›è¡Œäº†ä¿®æ”¹ã€‚</strong></p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220331234953540.png" alt="image-20220331234953540"></p><p>æ ¹æ®jadxä¸­checkå‡½æ•°çš„å‚æ•°å’ŒJNIå‡½æ•°çš„ç»“æ„ä¿®å¤checkå‡½æ•°ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220403203347019.png" alt="image-20220403203347019"></p><blockquote><p>å¯¹äºInitæ®µå­˜åœ¨å­—ç¬¦è§£å¯†çš„soæ–‡ä»¶ï¼Œå¯ä»¥ç”¨frida hook dumpå‡ºsoï¼Œè¿™æ ·æ‹¿åˆ°å°±æ˜¯å­—ç¬¦ä¸²è§£å¯†åçš„soæ–‡ä»¶ï¼Œå¯æƒœğŸ‘¦æ‰‹ä¸Šæ²¡æœ‰rootæœºï¼Œæš‚ä¸”ç¡¬æ€¼ã€‚</p></blockquote><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220403210636506.png" alt="image-20220403210636506"></p><p>é¦–å…ˆå¯¹ä¼ å…¥å­—ç¬¦è¿›è¡Œbase64è§£å¯†ï¼Œè§£å¯†å‡½æ•°ä¹Ÿæ˜¯é€šè¿‡ç´¢å¼•è¡¨æ˜ å°„æ¥å®ç°çš„ï¼Œæ‰“å°å‡ºç´¢å¼•è¡¨ï¼Œb64è¡¨è¢«ä¿®æ”¹ï¼Œè¿™å’ŒRE2 shellcodeä¸­æ‰€ç”¨å‡½æ•°ä¸€è‡´ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">a=[...] <span class="hljs-comment">#åˆ é™¤æœ«å°¾é‡å¤0</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">64</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(a.index(i)),end=<span class="hljs-string">''</span>)<br><span class="hljs-comment">#zTsI01htNUF/VoE4uQnpyA9bCqD53fgiBd6GXcKHLjJv7Pm2rSkMlxwW8OeRZa+Y</span><br></code></pre></td></tr></tbody></table></figure><p>ä¹‹åè¿›å…¥ç¬¬ä¸€ä¸ªå¤„ç†å‡½æ•°ï¼Œ<code>pre_getstr</code>é€šè¿‡äº¤å‰å¼•ç”¨çŸ¥æ˜¯javaå±‚è°ƒç”¨prenativeå‡½æ•°ä¼ å…¥çš„å­—ç¬¦ä¸²ï¼Œåˆ†æçŸ¥è¯¥å‡½æ•°ä¸ºAES128çš„ç§˜é’¥æ‰©å±•ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220403210433884.png" alt="image-20220403210433884"></p><p>ä¸è¿‡è¿™é‡Œçš„sboxç»è¿‡æ¢è¡¨äº†ï¼Œæ¥ä¸‹æ¥æ˜¯<code>sub_2DE8</code>å‡½æ•°ï¼Œæ˜¯AESçš„åŠ å¯†ä¸»ä½“ã€‚ç”±æ§åˆ¶æµç¨‹å›¾çŸ¥ï¼Œä»–åœ¨è¿›è¡ŒåŠ å¯†çš„æ—¶å€™æ²¡æœ‰ç”¨å¾ªç¯ï¼Œä»£ç å¤ç”¨å¯¼è‡´å‡½æ•°æ¯”è¾ƒå¤§ï¼Œæ¯”è¾ƒéš¾è¯»ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220403224816348.png" alt="image-20220403224816348"></p><p>ç±»ä¼¼è¿™ç§å—ä¸»è¦è¿›è¡Œè½®ç§˜é’¥åŠ å’Œè¡Œä½ç§»ï¼Œä¹‹å<code>sub_2668</code>æ‰§è¡Œåˆ—æ··æ·†ï¼Œç”¨åˆ°äº†ä¸€ä¸ªæ•°ç»„</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220404000101335.png" alt="image-20220404000101335"></p><p>é€šè¿‡<code>IDAPYTHON</code> dumpå‡ºæ•°ç»„ï¼Œæ ¹æ®æ•°ç»„å»githubä¸Šæœä¸€ä¸‹ï¼Œæ‰¾åˆ°äº†ç±»ä¼¼ç¬¦å·çš„æºç <a href="https://github.com/microsoft/LWE_Library/blob/master/src/aes/aes_c.c">aes_c.c - github</a>,è¿™æ®µé€»è¾‘ä¹Ÿä¸»è¦ç”¨äºåˆ—æ··æ·†ä¸­ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">s1=[<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x06</span>,<span class="hljs-number">0x08</span>,<span class="hljs-number">0x0a</span>,<span class="hljs-number">0x0c</span>,<span class="hljs-number">0x0e</span>,<span class="hljs-number">0x10</span>,<span class="hljs-number">0x12</span>,<span class="hljs-number">0x14</span>,<span class="hljs-number">0x16</span>,<span class="hljs-number">0x18</span>,<span class="hljs-number">0x1a</span>,<span class="hljs-number">0x1c</span>,<span class="hljs-number">0x1e</span>,<span class="hljs-number">0x20</span>,<span class="hljs-number">0x22</span>,<span class="hljs-number">0x24</span>,<span class="hljs-number">0x26</span>,<span class="hljs-number">0x28</span>,<span class="hljs-number">0x2a</span>,<span class="hljs-number">0x2c</span>,<span class="hljs-number">0x2e</span>,<span class="hljs-number">0x30</span>,<span class="hljs-number">0x32</span>,<span class="hljs-number">0x34</span>,<span class="hljs-number">0x36</span>,<span class="hljs-number">0x38</span>,<span class="hljs-number">0x3a</span>,<span class="hljs-number">0x3c</span>,<span class="hljs-number">0x3e</span>,<span class="hljs-number">0x40</span>,<span class="hljs-number">0x42</span>,<span class="hljs-number">0x44</span>,<span class="hljs-number">0x46</span>,<span class="hljs-number">0x48</span>,<span class="hljs-number">0x4a</span>,<span class="hljs-number">0x4c</span>,<span class="hljs-number">0x4e</span>,<span class="hljs-number">0x50</span>,<span class="hljs-number">0x52</span>,<span class="hljs-number">0x54</span>,<span class="hljs-number">0x56</span>,<span class="hljs-number">0x58</span>,<span class="hljs-number">0x5a</span>,<span class="hljs-number">0x5c</span>,<span class="hljs-number">0x5e</span>,<span class="hljs-number">0x60</span>,<span class="hljs-number">0x62</span>,<span class="hljs-number">0x64</span>,<span class="hljs-number">0x66</span>,<span class="hljs-number">0x68</span>,<span class="hljs-number">0x6a</span>,<span class="hljs-number">0x6c</span>,<span class="hljs-number">0x6e</span>,<span class="hljs-number">0x70</span>,<span class="hljs-number">0x72</span>,<span class="hljs-number">0x74</span>,<span class="hljs-number">0x76</span>,<span class="hljs-number">0x78</span>,<span class="hljs-number">0x7a</span>,<span class="hljs-number">0x7c</span>,<span class="hljs-number">0x7e</span>,<span class="hljs-number">0x80</span>,<span class="hljs-number">0x82</span>,<span class="hljs-number">0x84</span>,<span class="hljs-number">0x86</span>,<span class="hljs-number">0x88</span>,<span class="hljs-number">0x8a</span>,<span class="hljs-number">0x8c</span>,<span class="hljs-number">0x8e</span>,<span class="hljs-number">0x90</span>,<span class="hljs-number">0x92</span>,<span class="hljs-number">0x94</span>,<span class="hljs-number">0x96</span>,<span class="hljs-number">0x98</span>,<span class="hljs-number">0x9a</span>,<span class="hljs-number">0x9c</span>,<span class="hljs-number">0x9e</span>,<span class="hljs-number">0xa0</span>,<span class="hljs-number">0xa2</span>,<span class="hljs-number">0xa4</span>,<span class="hljs-number">0xa6</span>,<span class="hljs-number">0xa8</span>,<span class="hljs-number">0xaa</span>,<span class="hljs-number">0xac</span>,<span class="hljs-number">0xae</span>,<span class="hljs-number">0xb0</span>,<span class="hljs-number">0xb2</span>,<span class="hljs-number">0xb4</span>,<span class="hljs-number">0xb6</span>,<span class="hljs-number">0xb8</span>,<span class="hljs-number">0xba</span>,<span class="hljs-number">0xbc</span>,<span class="hljs-number">0xbe</span>,<span class="hljs-number">0xc0</span>,<span class="hljs-number">0xc2</span>,<span class="hljs-number">0xc4</span>,<span class="hljs-number">0xc6</span>,<span class="hljs-number">0xc8</span>,<span class="hljs-number">0xca</span>,<span class="hljs-number">0xcc</span>,<span class="hljs-number">0xce</span>,<span class="hljs-number">0xd0</span>,<span class="hljs-number">0xd2</span>,<span class="hljs-number">0xd4</span>,<span class="hljs-number">0xd6</span>,<span class="hljs-number">0xd8</span>,<span class="hljs-number">0xda</span>,<span class="hljs-number">0xdc</span>,<span class="hljs-number">0xde</span>,<span class="hljs-number">0xe0</span>,<span class="hljs-number">0xe2</span>,<span class="hljs-number">0xe4</span>,<span class="hljs-number">0xe6</span>,<span class="hljs-number">0xe8</span>,<span class="hljs-number">0xea</span>,<span class="hljs-number">0xec</span>,<span class="hljs-number">0xee</span>,<span class="hljs-number">0xf0</span>,<span class="hljs-number">0xf2</span>,<span class="hljs-number">0xf4</span>,<span class="hljs-number">0xf6</span>,<span class="hljs-number">0xf8</span>,<span class="hljs-number">0xfa</span>,<span class="hljs-number">0xfc</span>,<span class="hljs-number">0xfe</span>,<span class="hljs-number">0x1b</span>,<span class="hljs-number">0x19</span>,<span class="hljs-number">0x1f</span>,<span class="hljs-number">0x1d</span>,<span class="hljs-number">0x13</span>,<span class="hljs-number">0x11</span>,<span class="hljs-number">0x17</span>,<span class="hljs-number">0x15</span>,<span class="hljs-number">0x0b</span>,<span class="hljs-number">0x09</span>,<span class="hljs-number">0x0f</span>,<span class="hljs-number">0x0d</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x01</span>,<span class="hljs-number">0x07</span>,<span class="hljs-number">0x05</span>,<span class="hljs-number">0x3b</span>,<span class="hljs-number">0x39</span>,<span class="hljs-number">0x3f</span>,<span class="hljs-number">0x3d</span>,<span class="hljs-number">0x33</span>,<span class="hljs-number">0x31</span>,<span class="hljs-number">0x37</span>,<span class="hljs-number">0x35</span>,<span class="hljs-number">0x2b</span>,<span class="hljs-number">0x29</span>,<span class="hljs-number">0x2f</span>,<span class="hljs-number">0x2d</span>,<span class="hljs-number">0x23</span>,<span class="hljs-number">0x21</span>,<span class="hljs-number">0x27</span>,<span class="hljs-number">0x25</span>,<span class="hljs-number">0x5b</span>,<span class="hljs-number">0x59</span>,<span class="hljs-number">0x5f</span>,<span class="hljs-number">0x5d</span>,<span class="hljs-number">0x53</span>,<span class="hljs-number">0x51</span>,<span class="hljs-number">0x57</span>,<span class="hljs-number">0x55</span>,<span class="hljs-number">0x4b</span>,<span class="hljs-number">0x49</span>,<span class="hljs-number">0x4f</span>,<span class="hljs-number">0x4d</span>,<span class="hljs-number">0x43</span>,<span class="hljs-number">0x41</span>,<span class="hljs-number">0x47</span>,<span class="hljs-number">0x45</span>,<span class="hljs-number">0x7b</span>,<span class="hljs-number">0x79</span>,<span class="hljs-number">0x7f</span>,<span class="hljs-number">0x7d</span>,<span class="hljs-number">0x73</span>,<span class="hljs-number">0x71</span>,<span class="hljs-number">0x77</span>,<span class="hljs-number">0x75</span>,<span class="hljs-number">0x6b</span>,<span class="hljs-number">0x69</span>,<span class="hljs-number">0x6f</span>,<span class="hljs-number">0x6d</span>,<span class="hljs-number">0x63</span>,<span class="hljs-number">0x61</span>,<span class="hljs-number">0x67</span>,<span class="hljs-number">0x65</span>,<span class="hljs-number">0x9b</span>,<span class="hljs-number">0x99</span>,<span class="hljs-number">0x9f</span>,<span class="hljs-number">0x9d</span>,<span class="hljs-number">0x93</span>,<span class="hljs-number">0x91</span>,<span class="hljs-number">0x97</span>,<span class="hljs-number">0x95</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x89</span>,<span class="hljs-number">0x8f</span>,<span class="hljs-number">0x8d</span>,<span class="hljs-number">0x83</span>,<span class="hljs-number">0x81</span>,<span class="hljs-number">0x87</span>,<span class="hljs-number">0x85</span>,<span class="hljs-number">0xbb</span>,<span class="hljs-number">0xb9</span>,<span class="hljs-number">0xbf</span>,<span class="hljs-number">0xbd</span>,<span class="hljs-number">0xb3</span>,<span class="hljs-number">0xb1</span>,<span class="hljs-number">0xb7</span>,<span class="hljs-number">0xb5</span>,<span class="hljs-number">0xab</span>,<span class="hljs-number">0xa9</span>,<span class="hljs-number">0xaf</span>,<span class="hljs-number">0xad</span>,<span class="hljs-number">0xa3</span>,<span class="hljs-number">0xa1</span>,<span class="hljs-number">0xa7</span>,<span class="hljs-number">0xa5</span>,<span class="hljs-number">0xdb</span>,<span class="hljs-number">0xd9</span>,<span class="hljs-number">0xdf</span>,<span class="hljs-number">0xdd</span>,<span class="hljs-number">0xd3</span>,<span class="hljs-number">0xd1</span>,<span class="hljs-number">0xd7</span>,<span class="hljs-number">0xd5</span>,<span class="hljs-number">0xcb</span>,<span class="hljs-number">0xc9</span>,<span class="hljs-number">0xcf</span>,<span class="hljs-number">0xcd</span>,<span class="hljs-number">0xc3</span>,<span class="hljs-number">0xc1</span>,<span class="hljs-number">0xc7</span>,<span class="hljs-number">0xc5</span>,<span class="hljs-number">0xfb</span>,<span class="hljs-number">0xf9</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xfd</span>,<span class="hljs-number">0xf3</span>,<span class="hljs-number">0xf1</span>,<span class="hljs-number">0xf7</span>,<span class="hljs-number">0xf5</span>,<span class="hljs-number">0xeb</span>,<span class="hljs-number">0xe9</span>,<span class="hljs-number">0xef</span>,<span class="hljs-number">0xed</span>,<span class="hljs-number">0xe3</span>,<span class="hljs-number">0xe1</span>,<span class="hljs-number">0xe7</span>,<span class="hljs-number">0xe5</span>]<br>s2=[<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x06</span>,<span class="hljs-number">0x05</span>,<span class="hljs-number">0x0c</span>,<span class="hljs-number">0x0f</span>,<span class="hljs-number">0x0a</span>,<span class="hljs-number">0x09</span>,<span class="hljs-number">0x18</span>,<span class="hljs-number">0x1b</span>,<span class="hljs-number">0x1e</span>,<span class="hljs-number">0x1d</span>,<span class="hljs-number">0x14</span>,<span class="hljs-number">0x17</span>,<span class="hljs-number">0x12</span>,<span class="hljs-number">0x11</span>,<span class="hljs-number">0x30</span>,<span class="hljs-number">0x33</span>,<span class="hljs-number">0x36</span>,<span class="hljs-number">0x35</span>,<span class="hljs-number">0x3c</span>,<span class="hljs-number">0x3f</span>,<span class="hljs-number">0x3a</span>,<span class="hljs-number">0x39</span>,<span class="hljs-number">0x28</span>,<span class="hljs-number">0x2b</span>,<span class="hljs-number">0x2e</span>,<span class="hljs-number">0x2d</span>,<span class="hljs-number">0x24</span>,<span class="hljs-number">0x27</span>,<span class="hljs-number">0x22</span>,<span class="hljs-number">0x21</span>,<span class="hljs-number">0x60</span>,<span class="hljs-number">0x63</span>,<span class="hljs-number">0x66</span>,<span class="hljs-number">0x65</span>,<span class="hljs-number">0x6c</span>,<span class="hljs-number">0x6f</span>,<span class="hljs-number">0x6a</span>,<span class="hljs-number">0x69</span>,<span class="hljs-number">0x78</span>,<span class="hljs-number">0x7b</span>,<span class="hljs-number">0x7e</span>,<span class="hljs-number">0x7d</span>,<span class="hljs-number">0x74</span>,<span class="hljs-number">0x77</span>,<span class="hljs-number">0x72</span>,<span class="hljs-number">0x71</span>,<span class="hljs-number">0x50</span>,<span class="hljs-number">0x53</span>,<span class="hljs-number">0x56</span>,<span class="hljs-number">0x55</span>,<span class="hljs-number">0x5c</span>,<span class="hljs-number">0x5f</span>,<span class="hljs-number">0x5a</span>,<span class="hljs-number">0x59</span>,<span class="hljs-number">0x48</span>,<span class="hljs-number">0x4b</span>,<span class="hljs-number">0x4e</span>,<span class="hljs-number">0x4d</span>,<span class="hljs-number">0x44</span>,<span class="hljs-number">0x47</span>,<span class="hljs-number">0x42</span>,<span class="hljs-number">0x41</span>,<span class="hljs-number">0xc0</span>,<span class="hljs-number">0xc3</span>,<span class="hljs-number">0xc6</span>,<span class="hljs-number">0xc5</span>,<span class="hljs-number">0xcc</span>,<span class="hljs-number">0xcf</span>,<span class="hljs-number">0xca</span>,<span class="hljs-number">0xc9</span>,<span class="hljs-number">0xd8</span>,<span class="hljs-number">0xdb</span>,<span class="hljs-number">0xde</span>,<span class="hljs-number">0xdd</span>,<span class="hljs-number">0xd4</span>,<span class="hljs-number">0xd7</span>,<span class="hljs-number">0xd2</span>,<span class="hljs-number">0xd1</span>,<span class="hljs-number">0xf0</span>,<span class="hljs-number">0xf3</span>,<span class="hljs-number">0xf6</span>,<span class="hljs-number">0xf5</span>,<span class="hljs-number">0xfc</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xfa</span>,<span class="hljs-number">0xf9</span>,<span class="hljs-number">0xe8</span>,<span class="hljs-number">0xeb</span>,<span class="hljs-number">0xee</span>,<span class="hljs-number">0xed</span>,<span class="hljs-number">0xe4</span>,<span class="hljs-number">0xe7</span>,<span class="hljs-number">0xe2</span>,<span class="hljs-number">0xe1</span>,<span class="hljs-number">0xa0</span>,<span class="hljs-number">0xa3</span>,<span class="hljs-number">0xa6</span>,<span class="hljs-number">0xa5</span>,<span class="hljs-number">0xac</span>,<span class="hljs-number">0xaf</span>,<span class="hljs-number">0xaa</span>,<span class="hljs-number">0xa9</span>,<span class="hljs-number">0xb8</span>,<span class="hljs-number">0xbb</span>,<span class="hljs-number">0xbe</span>,<span class="hljs-number">0xbd</span>,<span class="hljs-number">0xb4</span>,<span class="hljs-number">0xb7</span>,<span class="hljs-number">0xb2</span>,<span class="hljs-number">0xb1</span>,<span class="hljs-number">0x90</span>,<span class="hljs-number">0x93</span>,<span class="hljs-number">0x96</span>,<span class="hljs-number">0x95</span>,<span class="hljs-number">0x9c</span>,<span class="hljs-number">0x9f</span>,<span class="hljs-number">0x9a</span>,<span class="hljs-number">0x99</span>,<span class="hljs-number">0x88</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x8e</span>,<span class="hljs-number">0x8d</span>,<span class="hljs-number">0x84</span>,<span class="hljs-number">0x87</span>,<span class="hljs-number">0x82</span>,<span class="hljs-number">0x81</span>,<span class="hljs-number">0x9b</span>,<span class="hljs-number">0x98</span>,<span class="hljs-number">0x9d</span>,<span class="hljs-number">0x9e</span>,<span class="hljs-number">0x97</span>,<span class="hljs-number">0x94</span>,<span class="hljs-number">0x91</span>,<span class="hljs-number">0x92</span>,<span class="hljs-number">0x83</span>,<span class="hljs-number">0x80</span>,<span class="hljs-number">0x85</span>,<span class="hljs-number">0x86</span>,<span class="hljs-number">0x8f</span>,<span class="hljs-number">0x8c</span>,<span class="hljs-number">0x89</span>,<span class="hljs-number">0x8a</span>,<span class="hljs-number">0xab</span>,<span class="hljs-number">0xa8</span>,<span class="hljs-number">0xad</span>,<span class="hljs-number">0xae</span>,<span class="hljs-number">0xa7</span>,<span class="hljs-number">0xa4</span>,<span class="hljs-number">0xa1</span>,<span class="hljs-number">0xa2</span>,<span class="hljs-number">0xb3</span>,<span class="hljs-number">0xb0</span>,<span class="hljs-number">0xb5</span>,<span class="hljs-number">0xb6</span>,<span class="hljs-number">0xbf</span>,<span class="hljs-number">0xbc</span>,<span class="hljs-number">0xb9</span>,<span class="hljs-number">0xba</span>,<span class="hljs-number">0xfb</span>,<span class="hljs-number">0xf8</span>,<span class="hljs-number">0xfd</span>,<span class="hljs-number">0xfe</span>,<span class="hljs-number">0xf7</span>,<span class="hljs-number">0xf4</span>,<span class="hljs-number">0xf1</span>,<span class="hljs-number">0xf2</span>,<span class="hljs-number">0xe3</span>,<span class="hljs-number">0xe0</span>,<span class="hljs-number">0xe5</span>,<span class="hljs-number">0xe6</span>,<span class="hljs-number">0xef</span>,<span class="hljs-number">0xec</span>,<span class="hljs-number">0xe9</span>,<span class="hljs-number">0xea</span>,<span class="hljs-number">0xcb</span>,<span class="hljs-number">0xc8</span>,<span class="hljs-number">0xcd</span>,<span class="hljs-number">0xce</span>,<span class="hljs-number">0xc7</span>,<span class="hljs-number">0xc4</span>,<span class="hljs-number">0xc1</span>,<span class="hljs-number">0xc2</span>,<span class="hljs-number">0xd3</span>,<span class="hljs-number">0xd0</span>,<span class="hljs-number">0xd5</span>,<span class="hljs-number">0xd6</span>,<span class="hljs-number">0xdf</span>,<span class="hljs-number">0xdc</span>,<span class="hljs-number">0xd9</span>,<span class="hljs-number">0xda</span>,<span class="hljs-number">0x5b</span>,<span class="hljs-number">0x58</span>,<span class="hljs-number">0x5d</span>,<span class="hljs-number">0x5e</span>,<span class="hljs-number">0x57</span>,<span class="hljs-number">0x54</span>,<span class="hljs-number">0x51</span>,<span class="hljs-number">0x52</span>,<span class="hljs-number">0x43</span>,<span class="hljs-number">0x40</span>,<span class="hljs-number">0x45</span>,<span class="hljs-number">0x46</span>,<span class="hljs-number">0x4f</span>,<span class="hljs-number">0x4c</span>,<span class="hljs-number">0x49</span>,<span class="hljs-number">0x4a</span>,<span class="hljs-number">0x6b</span>,<span class="hljs-number">0x68</span>,<span class="hljs-number">0x6d</span>,<span class="hljs-number">0x6e</span>,<span class="hljs-number">0x67</span>,<span class="hljs-number">0x64</span>,<span class="hljs-number">0x61</span>,<span class="hljs-number">0x62</span>,<span class="hljs-number">0x73</span>,<span class="hljs-number">0x70</span>,<span class="hljs-number">0x75</span>,<span class="hljs-number">0x76</span>,<span class="hljs-number">0x7f</span>,<span class="hljs-number">0x7c</span>,<span class="hljs-number">0x79</span>,<span class="hljs-number">0x7a</span>,<span class="hljs-number">0x3b</span>,<span class="hljs-number">0x38</span>,<span class="hljs-number">0x3d</span>,<span class="hljs-number">0x3e</span>,<span class="hljs-number">0x37</span>,<span class="hljs-number">0x34</span>,<span class="hljs-number">0x31</span>,<span class="hljs-number">0x32</span>,<span class="hljs-number">0x23</span>,<span class="hljs-number">0x20</span>,<span class="hljs-number">0x25</span>,<span class="hljs-number">0x26</span>,<span class="hljs-number">0x2f</span>,<span class="hljs-number">0x2c</span>,<span class="hljs-number">0x29</span>,<span class="hljs-number">0x2a</span>,<span class="hljs-number">0x0b</span>,<span class="hljs-number">0x08</span>,<span class="hljs-number">0x0d</span>,<span class="hljs-number">0x0e</span>,<span class="hljs-number">0x07</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x01</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x13</span>,<span class="hljs-number">0x10</span>,<span class="hljs-number">0x15</span>,<span class="hljs-number">0x16</span>,<span class="hljs-number">0x1f</span>,<span class="hljs-number">0x1c</span>,<span class="hljs-number">0x19</span>,<span class="hljs-number">0x1a</span>]<br></code></pre></td></tr></tbody></table></figure><p>å¦‚ä¸‹å›¾ï¼Œç”¨åˆ°äº†ä¸¤ä¸ªè¡¨æ¥åˆ—æ··æ·†ï¼Œç‰¹å¾æ¯”è¾ƒæ˜æ˜¾ï¼Œä¸€èˆ¬è¿™ç§ä½¿ç”¨æ•°ç»„æ¥å®ç°çš„ï¼Œå¯ä»¥åœ¨githubä¸Šæ‰¾åˆ°åˆ°è››ä¸é©¬è¿¹ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220404005222022.png" alt="image-20220404005222022"></p><p>é€šè¿‡äº¤å‰å¼•ç”¨å’Œç¬¬ä¸‰ä¸ªå‚æ•°128å¯çŸ¥è°ƒç”¨äº†9æ¬¡ï¼Œå¯¹åº”AESä¸­é—´çš„9è½®ï¼Œæ‰€ä»¥ä¸Šè¿°AESå•çº¯é­”æ”¹äº†sboxï¼Œå…¶ä½™ç®—æ³•ä¸å˜ã€‚</p><blockquote><p>åˆ°æ­¤ï¼Œä¸€ä¸ªåŠ¨æ€æ³¨å†Œçš„å‡½æ•°åˆ†æå®Œæ¯•ï¼Œä»ä¿®å¤JNIå’Œæ³¨å†Œä¿¡æ¯ï¼Œå†åˆ°å®šä½å‡½æ•°é€†å‘é€»è¾‘ï¼Œæœ€åé€†å‘è¿˜åŸå³å¯ğŸ’ªã€‚</p></blockquote><p>ğŸ˜´è‡³äºåç»­å¦‚ä½•ï¼Œæœªå®Œå¾…ç»­ã€‚ã€‚ã€‚ã€‚</p><p>å‚è€ƒ:</p><p><a href="https://blog.csdn.net/hello_1995/article/details/109393760">NDK å…¥é—¨æŒ‡å—</a></p><p><a href="https://blog.csdn.net/hello_1995/article/details/109393760">NDK å¼€å‘ä¹‹ JNI æ–¹æ³•é™æ€æ³¨å†Œä¸åŠ¨æ€æ³¨å†Œ</a></p><p><a href="https://blog.csdn.net/yangguo_2011/article/details/17379297">java jniç¼–ç¨‹è¯¦ç»†æ­¥éª¤åŠæ³¨æ„ç»†èŠ‚</a></p><p><a href="https://www.programminghunter.com/article/13461090681/">Fridaç¯å¢ƒæ­å»º-åŸºäºpython3.7</a></p>]]></content>
    
    
    <categories>
      
      <category>Android</category>
      
    </categories>
    
    
    <tags>
      
      <tag>RE</tag>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Androidé€†å‘ç¯å¢ƒæ­å»º(æŒç»­æ›´æ–°ä¸­...)</title>
    <link href="/2022/04/03/Android%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
    <url>/2022/04/03/Android%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<h1>Androidé€†å‘ç¯å¢ƒæ­å»º</h1><blockquote><p>è®°å½•åœ¨Android å­¦ä¹ ä¸­å·¥å…·çš„é…ç½®åŠç›¸å…³ç¯å¢ƒçš„æ­å»ºã€‚</p></blockquote><h2 id="Fridaçš„å®‰è£…">Fridaçš„å®‰è£…</h2><blockquote><p>è¿‡ç¨‹éå¸¸çš„æ›²æŠ˜ï¼Œå¥½åœ¨æœ€ç»ˆæ˜¯è£…ä¸Šäº†çš„ï¼Œæˆ–è®¸ä½ åšæŒèµ°çš„è·¯ï¼Œä»–å§‹ç»ˆå°±æ˜¯ä¸ªä¼˜é›…çš„é”™è¯¯ï¼Œæ¢¦é†’äº†ï¼Œè¿˜è¦ç»§ç»­èµ°ğŸš©ã€‚</p></blockquote><h3 id="Frida-ä¸‹è½½">Frida ä¸‹è½½</h3><p>ç½‘ä¸Šå¾ˆå¤šæ•™ç¨‹éƒ½æ˜¯ç›´æ¥<code>pip install frida</code> å’Œ<code>pip install frida-tools</code>å³å¯ï¼Œå¯æ˜¯æˆ‘åœ¨å®‰è£…æ—¶å´ä¸æ˜¯å¦‚æ­¤ã€‚<strong>(è®°å¾—å…³æ‰æ¢¯å­ï¼Œå¦åˆ™ä¼šå‡ºé”™)</strong></p><blockquote><p>å…¶å®åæ¥åœ¨è£…å¥½å å­¦ä¹ ç”¨æ³•çš„æ—¶çœ‹åˆ°å¾ˆå¤šå‰è¾ˆåœ¨å®‰è£…æ—¶å€™éƒ½æœ‰å¼ºè°ƒç‰ˆæœ¬é—®é¢˜ï¼Œåªèƒ½æ€ªè‡ªå·±å½“æ—¶æœ‰ç‚¹æ€¥èºï¼Œæ¼æ‰äº†è®¸å¤šç»†èŠ‚ğŸ˜ã€‚</p></blockquote><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220401233143141.png" alt="image-20220401233143141"></p><p>è¿™æ˜¯æˆ‘å®‰è£…æˆåŠŸåç”¨python3.10è¿è¡Œæ—¶çš„æŠ¥é”™(éƒ¨åˆ†)ï¼Œå…¶ä½™ç‰ˆæœ¬ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå¯¹æ­¤æˆ‘æµ‹è¯•äº†python3.7-3.10é—´çš„ç‰ˆæœ¬ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220401233315327.png" alt="image-20220401233315327"></p><p>åœ¨ä½¿ç”¨python3.8å’Œpython2.7å®‰è£…æ—¶ï¼Œå‘ç°å…¶ç¼“å­˜ä¸­çš„åº“éƒ½æ˜¯åŒä¸€ä¸ªç‰ˆæœ¬<code>frida-15.1.17</code>è¿™åœ¨pypiä¸Šæ ‡æ³¨æ˜¯é’ˆå¯¹3.10çš„,ç„¶åé”™è¯¯æ˜¯åœ¨setup.pyæ‰€ä»¥æ˜¯ç‰ˆæœ¬å¤„ç†ä¸å½“,ä¸è¿‡python3.10ä¹Ÿè¿è¡Œå‡ºé”™å°±æœ‰ç‚¹æ„å¤–ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220401234359678.png" alt="image-20220401234359678"></p><p>ä»–è¿™ä¸€æ­¥å…¶å®æ˜¯ä¸‹è½½äº† <code>frida-15.1.17.tar.gz</code> , <a href="http://xn--setup-4n1hg0rx93at61crfxbxjr.py">å¹¶è¿è¡Œå…¶ä¸­çš„setup.py</a> ,æ•…å¯ä»¥ç›´æ¥åœ¨ç½‘ä¸Šä¸‹è½½ä¸€ä¸ªå¯¹åº”python3.7ç‰ˆæœ¬çš„fridaæ–‡ä»¶ ,<a href="http://xn--setup-r96h474gtsi6t8eyyp.py">æ‰‹åŠ¨æ¥è¿è¡Œsetup.py</a>ã€‚</p><p>python3.7å¯¹åº”win-amd64ç‰ˆæœ¬  <a href="https://files.pythonhosted.org/packages/0a/4b/b191420bd34215377f72e04593619d9266d5e3e33f6cf48c8e827dcecb89/frida-12.8.20.tar.gz">frida-12.8.20.tar.gz </a> ,ä¹‹ååœ¨ä»»æ„ç›®å½•è§£å‹ï¼Œå¹¶åœ¨å‘½ä»¤è¡Œä¾æ¬¡è¿è¡Œå¦‚ä¸‹æŒ‡ä»¤ã€‚</p><ol><li><p><strong>python3.7 <a href="http://setup.py">setup.py</a> install</strong></p><p>è¯¥æ­¥è¿‡åä¼šåœ¨Python37\Lib\site-packages ç›®å½•ä¸‹ç”Ÿæˆfrida-12.8.20-py3.7-win-amd64.eggï¼Œåœ¨è¿è¡Œçš„æœ€åä¸€æ­¥å¯èƒ½éœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´ã€‚</p><p>ä¹‹åä¸è¦å†å»pip install frida ï¼Œæ¥ç€å»å®‰è£… frida-toolsï¼Œä¸è¿‡ç›´æ¥pip ä¹Ÿä¼šæœ‰æŠ¥é”™ã€‚</p></li><li><p><strong>pip3.7 install  frida-tools==7.2.1</strong></p></li></ol><p>â€‹æŒ‡å®šfrida-toolsçš„ç‰ˆæœ¬ä¸º7.2.1ï¼Œæ¥ç€ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œå‡ºç°successå°±ç®—æˆåŠŸã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220402000244440.png" alt="image-20220402000244440"></p><p>ä¹‹åå®‰è£…frida-server ç‰ˆæœ¬è¦å’Œfridaä¸€è‡´ <code>frida --version</code> ï¼Œåˆ°<a href="https://github.com/frida/frida/releases?page=8">frida-github</a>å®‰è£…å¯¹åº”ç‰ˆæœ¬çš„serverã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220403004209807.png" alt="image-20220403004209807"></p><blockquote><p>adb shell getprop ro.product.cpu.abi   æŸ¥çœ‹æ‰‹æœºcpuç‰ˆæœ¬ä¸‹è½½å¯¹åº”çš„serveræ¶æ„</p></blockquote><p>ä¸‹è½½è§£å‹åï¼Œå°†æ–‡ä»¶é‡å‘½åä¸º <code>frida-server</code> ï¼Œæˆ–è€…åŠ ä¸Šå¯¹åº”çš„æ¶æ„ï¼Œ<strong>å¤œç¥æ¨¡æ‹Ÿå™¨çš„è¯é€‰Android-x86</strong>ã€‚</p><h3 id="adbè°ƒè¯•ç¯å¢ƒ">adbè°ƒè¯•ç¯å¢ƒ</h3><p>é¦–å…ˆè¿›å…¥å¤œç¥æ¨¡æ‹Ÿå™¨çš„binç›®å½•ï¼Œæ‰“å¼€ç»ˆç«¯ã€‚</p><ol><li>nox_adb.exe connect 127.0.0.1:62001 æ¨¡æ‹Ÿå™¨è¿åˆ°62001è¿™ä¸ªç«¯å£ä¸Š</li><li>åœ¨éå¤œç¥binç›®å½•çš„ç»ˆç«¯ä¸‹ è¿è¡Œ adb connect 127.0.0.1:62001</li><li>adb devices æ£€æµ‹æ˜¯å¦è¿æ¥</li></ol><blockquote><p>å¦‚æœå…¶ä¸­å‡ºç°ä¸åŒ¹é…çš„é—®é¢˜ï¼Œå°±åˆ°Android_SDKç›®å½•ä¸‹æŠŠadb.exeå¤åˆ¶åˆ°å¤œç¥æ¨¡æ‹Ÿå™¨çš„binç›®å½•ï¼Œé‡å‘½åä¸ºnox_adb.exeä¹‹åå†è¿›è¡Œä¸Šè¿°æ­¥éª¤ã€‚</p></blockquote><p>é…ç½®å¥½å¤œç¥åï¼Œå°†<code>frida-server</code>ä¼ åˆ°å…¶<code>\data\local\tmp</code>ç›®å½•ä¸‹ï¼Œä¿®æ”¹æƒé™å¹¶è¿è¡Œã€‚</p><ol><li><strong>adb push ./frida-server /data/local/tmp</strong></li><li><strong>adb shell</strong></li><li><strong>cd data/local/tmp</strong></li><li><strong>chmod 777 frida-server</strong></li><li><strong>./frida-server</strong></li><li><strong>adb tcp:27042 tcp:27042 è¿›è¡Œç«¯å£è½¬å‘</strong></li></ol><p>å¤œç¥æ¨¡æ‹Ÿå™¨ä¸­æ‰“å¼€ä¸€ä¸ªappç¨‹åºï¼Œåœ¨ä¸»æœºä¸Šé€šè¿‡<code>frida-ps -U</code>æŸ¥çœ‹USBè°ƒè¯•è¿›ç¨‹ï¼Œå‘ç°è‡ªå·±å¯åŠ¨çš„ç¨‹åºåŒ…å³ä¸ºæˆåŠŸğŸ˜ƒã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220403004501603.png" alt="image-20220403004501603"></p><p>ä½¿ç”¨<code>firda</code>hookåŒ…ï¼Œ<strong>frida-trace -i â€œopenâ€ -U com.test.hufu22</strong>ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220403104658735.png" alt="image-20220403104658735"></p><blockquote><p>å½“ç„¶åŸºäºfridaçš„ä½¿ç”¨è¿˜æœ‰å¾…è¿›ä¸€æ­¥çš„å­¦ä¹ ï¼Œä½¿ç”¨å¤œç¥æ¨¡æ‹Ÿå™¨ç­‰ä¹Ÿåªèƒ½æ˜¯æ­£å¯¹ç¨‹åºä¸­å¸¦äº†x86çš„soæ–‡ä»¶æ‰èƒ½è¿›è¡ŒIDAè°ƒè¯•å’ŒFrida hookï¼Œè¦æƒ³ç”¨äºå®æˆ˜å¿…é¡»è¦é…å¤‡rootæœºã€‚</p></blockquote><p>æœ€ç»ˆç®€ä»‹ä¸€ä¸‹:fridaæ˜¯ä¸€æ¬¾åŸºäºpython + javascript çš„hookæ¡†æ¶ï¼Œå¯è¿è¡Œåœ¨androidã€iosã€linuxã€winosxç­‰å„å¹³å°ï¼Œä¸»è¦ä½¿ç”¨åŠ¨æ€äºŒè¿›åˆ¶æ’æ¡©æŠ€æœ¯ã€‚</p><h3 id="Objectionå®‰è£…">Objectionå®‰è£…</h3><p>objectionæ˜¯ä¸€ä¸ªåŸºäºFridaå¼€å‘çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå®ƒå¯ä»¥å¾ˆæ–¹ä¾¿çš„Hook Javaå‡½æ•°å’Œç±»ï¼Œå¹¶è¾“å‡ºå‚æ•°ï¼Œè°ƒç”¨æ ˆã€‚å…¶gitåœ°å€ä¸º<a href="https://github.com/sensepost/objection/releases?page=2">objection-github-release</a>ã€‚</p><figure class="highlight cmd"><table><tbody><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><pre><code class="hljs cmd">frida --version #æ‰“å°fridaç‰ˆæœ¬  <span class="hljs-number">12</span>.<span class="hljs-number">11</span>.<span class="hljs-number">18</span><br></code></pre></td></tr></tbody></table></figure><blockquote><p>å®‰è£…å¯¹ç‰ˆæœ¬ä¹Ÿåˆè¦æ±‚ï¼Œå¦‚æœfridaå®‰è£…çš„æ˜¯12.11.18 ï¼Œé‚£ä¹ˆå®‰è£…çš„ç‰ˆæœ¬åœ¨1.8.4 ~ 1.9.0å·¦å³ï¼Œæ›´å¤šå¯ä»¥æ ¹æ®fridaç‰ˆæœ¬çš„å‘è¡Œæ—¶é—´å»objectionæ‰¾é åä¸€ç‚¹çš„ç‰ˆæœ¬ã€‚</p></blockquote><figure class="highlight cmd"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">pip3.<span class="hljs-number">7</span> install objection==<span class="hljs-number">1</span>.<span class="hljs-number">9</span>.<span class="hljs-number">0</span> #ç›´æ¥æŒ‡å®šç›¸åº”ç‰ˆæœ¬å³å¯<br></code></pre></td></tr></tbody></table></figure><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220403195842070.png" alt="image-20220403195842070"></p><p><a href="https://chowdera.com/2021/09/20210926150657751D.html">frida install and å¤œç¥æ¨¡æ‹Ÿå™¨</a></p><p><a href="https://www.cxybb.com/article/freeking101/106965168">Androidé€†å‘-firda Hook æ¡†æ¶</a></p><p><a href="https://www.codeleading.com/article/77291460162/">Python-HOOKç¥å™¨-Fridaå­¦ä¹ </a></p>]]></content>
    
    
    <categories>
      
      <category>Android</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Android</tag>
      
      <tag>Tools</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>RE_Challenge</title>
    <link href="/2022/03/28/RE_Challenge/"/>
    <url>/2022/03/28/RE_Challenge/</url>
    
    <content type="html"><![CDATA[<blockquote><p>ä¸»è¦æ˜¯ä»¥è™ç¬¦å’Œè¿‘æœŸå›½é™…èµ›çš„é¢˜ä¸ºä¸»ï¼Œæ¢³ç†ä¸€ä¸‹å­¦åˆ°çš„æ–¹æ³•å’ŒæŠ€å·§ã€‚</p></blockquote><h2 id="è™ç¬¦">è™ç¬¦</h2><h3 id="fype">fype</h3><p>åŸºäºlibbpfç¼–å†™çš„bpfç¨‹åºé€†å‘ï¼ŒåŸç†ç±»ä¼¼hookã€‚ä¸»è¦åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯bpfä»£ç ï¼Œä¸€éƒ¨åˆ†æ˜¯ç”¨æˆ·ä»£ç ã€‚æœ¬é¢˜æ˜¯<a href="https://github.com/libbpf/libbpf-bootstrap"> libbpf-bootstrap</a>ç»“æ„ä¸‹çš„uprobeæ¨¡æ¿ï¼Œç”¨äºå¯¹ç¨‹åºå†…å‡½æ•°è¿›è¡Œhook(æˆ–ç§°è·Ÿè¸ª)ã€‚</p><p><code>uprobe.bpf.c</code></p><figure class="highlight c"><table><tbody><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// SPDX-License-Identifier: GPL-2.0 OR BSD-3-Clause</span><br><span class="hljs-comment">/* Copyright (c) 2020 Facebook */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;linux/bpf.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;linux/ptrace.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bpf/bpf_helpers.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bpf/bpf_tracing.h&gt;</span></span><br><br><span class="hljs-keyword">char</span> LICENSE[] SEC(<span class="hljs-string">"license"</span>) = <span class="hljs-string">"Dual BSD/GPL"</span>;<br><br>SEC(<span class="hljs-string">"uprobe/func"</span>)<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">BPF_KPROBE</span><span class="hljs-params">(uprobe, <span class="hljs-keyword">int</span> a, <span class="hljs-keyword">int</span> b)</span></span><br><span class="hljs-function"></span>{<br>bpf_printk(<span class="hljs-string">"UPROBE ENTRY: a = %d, b = %d\n"</span>, a, b);<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}<br><br>SEC(<span class="hljs-string">"uretprobe/func"</span>)<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">BPF_KRETPROBE</span><span class="hljs-params">(uretprobe, <span class="hljs-keyword">int</span> ret)</span></span><br><span class="hljs-function"></span>{<br>bpf_printk(<span class="hljs-string">"UPROBE EXIT: return = %d\n"</span>, ret);<br>    <span class="hljs-comment">//ç±»ä¼¼printf æŠŠæ ¼å¼åŒ–å­—ç¬¦ä¸²æ”¾å…¥ /sys/kernel/debug/tracing/trace_pipe æ–‡ä»¶ä¸­ï¼Œéœ€è¦sudo å³rootæƒé™ä¸‹è¿è¡Œ</span><br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}<br><span class="hljs-comment">//LICENSEå˜é‡å®šä¹‰äº†BPFä»£ç çš„è®¸å¯è¯ã€‚æŒ‡å®šè®¸å¯è¯æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œç”±å†…æ ¸å¼ºåˆ¶æ‰§è¡Œã€‚æŸäº› BPF åŠŸèƒ½ä¸å¯ç”¨äºé GPL å…¼å®¹ä»£ç ã€‚</span><br><span class="hljs-comment">//å…¶ä¸­uprobe/func ä¸ºè¿›å…¥å‡½æ•° , uretprobe/funcä¸ºé€€å‡ºå‡½æ•°ã€‚</span><br></code></pre></td></tr></tbody></table></figure><p>BPFç¨‹åºä¸€èˆ¬éœ€è¦4ä¸ªæ­¥éª¤ï¼Œå³åˆ›å»ºå¹¶æ‰“å¼€<code>open</code>ã€åŠ è½½å¹¶éªŒè¯<code>loda</code>ã€é™„åŠ <code>attach</code>ã€é€€å‡º<code>destroy</code>ã€‚</p><p>bpfç¨‹åºç”¨æˆ·ä»£ç æ¨¡æ¿å‡½æ•°</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs c">libbpf_set_print(libbpf_print_fn);<span class="hljs-comment">//è®¾ç½®æ—¥å¿—è¾“å‡ºå‡½æ•°libbpf_print_fn</span><br><br>bump_memlock_rlimit();<span class="hljs-comment">//æé«˜å†…æ ¸å†…éƒ¨ç”¨æˆ·çš„å†…å­˜æƒé™ï¼Œä¸ºbpfç¨‹åºçš„æ‰§è¡Œåšå‡†å¤‡</span><br><br>fype(name)_bpf__open_and_load();<span class="hljs-comment">//åŠ è½½bpfå­—èŠ‚ç æ–‡ä»¶åˆ°å†…æ ¸ä¸­</span><br><span class="hljs-comment">//åˆç»†åˆ†ä¸ºå¦‚ä¸‹ä¸¤ä¸ªå‡½æ•°</span><br><br>fpbe_bpf *obj=fpbe_bpf__open();<span class="hljs-comment">//åˆ›å»ºå¹¶æ‰“å¼€bpf</span><br><span class="hljs-comment">//-- fpbe_bpf__create_skeleton(obj)</span><br><span class="hljs-comment">//bpftool ä¼šæ ¹æ® bpf å­—èŠ‚ç æ–‡ä»¶ï¼ˆxxx.bpf.oï¼‰ç”Ÿæˆå¯¹åº”çš„ skeleton æ–‡ä»¶â€”â€”xxx.skel.hã€‚è¿™ä¸ªæ–‡ä»¶ä¸­åŒ…å«äº†å…³é”®çš„å‡½æ•°å’Œç»“æ„ä½“ã€‚æ¯”å¦‚ï¼Œè¿™ä¸ªæ–‡ä»¶ä¸­åŒ…å«äº† xxx.bpf.o æ–‡ä»¶çš„å†…å®¹ã€‚</span><br><span class="hljs-comment">//è¿™ä¸ªå‡½æ•°çš„å†…å®¹ååˆ†å…³é”®</span><br><br>fpbe_bpf__load(obj);<span class="hljs-comment">//è¿›è¡Œcheck</span><br><br>bpf_program__attach_uprobe() <span class="hljs-comment">//ç”¨äºç»‘å®š uprobe å’Œ uretprobe è¿½è¸ªç›®æ ‡çš„ä¿¡æ¯</span><br><span class="hljs-comment">//å¦‚ä¸‹  æœ€åä¸€ä¸ªå‚æ•°æ˜¯å‡½æ•°åç§» base_addrè°ƒè¯•ä¸º0x400000å³Imagebase</span><br>obj-&gt;links.uprobe = bpf_program__attach_uprobe(<br>                              obj-&gt;progs.uprobe,<br>                              <span class="hljs-number">0</span>,<br>                              <span class="hljs-number">0</span>,<br>                              <span class="hljs-string">"/proc/self/exe"</span>,<span class="hljs-comment">//è·Ÿè¸ªç¨‹åº</span><br>                              (<span class="hljs-keyword">size_t</span>)uprobed_function - base_addr);<span class="hljs-comment">//è·Ÿè¸ªå‡½æ•°</span><br><br>fpbe_bpf__destroy(obj);<span class="hljs-comment">//é€€å‡º</span><br></code></pre></td></tr></tbody></table></figure><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220325212024715.png" alt="image-20220325212024715"></p><p>äº†è§£è¿‡bpfç¨‹åºçš„æ¡†æ¶ä¹‹åï¼Œå†åˆ†æç¨‹åºå°±æ¯”è¾ƒæ¸…æ™°äº†ã€‚å°†é’©å­æŒ‚åœ¨äº†å½“å‰ç¨‹åºçš„uprobedå‡½æ•°ä¸Šï¼Œè¯¥å‡½æ•°å†…å®¹ä¸ºhash checkï¼Œå¯¹flagçš„å†…å®¹è¿›è¡Œæ£€æµ‹ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220325212213296.png" alt="image-20220325212213296"></p><p>æ•…å…³é”®å¤„ç†åœ¨bpfä»£ç ï¼Œå¤„ç†åçš„ç»“æœå†è¿›è¡Œæ¯”å¯¹ï¼Œæˆ‘ä»¬åªéœ€æ‹¿åˆ°bpfå­—èŠ‚ç åæ±‡ç¼–é€†å‡ºé€»è¾‘é—®é¢˜å°±è§£å†³äº†ã€‚</p><p>æ–¹æ³•ä¸€:</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220326000537317.png" alt="image-20220326000537317"></p><p><strong>å¯ä»¥ç›´æ¥åœ¨create_skeletonä¸‹æ‰¾åˆ°ebpfå­—èŠ‚ç æ–‡ä»¶(elf)ï¼Œç”¨ipython dumpï¼Œå½“ç„¶æœ€åçœ‹äº†wpå‘ç°binwalkç›´æ¥åˆ†ç¦»æ˜¯ä¸€ç§ä¸é”™çš„æ–¹æ³•ã€‚</strong></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> idautils<br>adr=<span class="hljs-number">0x00000000004F4018</span><br><span class="hljs-built_in">len</span>=<span class="hljs-number">1648</span><br>f=<span class="hljs-built_in">open</span>(<span class="hljs-string">r'G:\dump'</span>,<span class="hljs-string">'wb'</span>)<br>s=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>):<br>    s.append(Byte(adr+i))<br>f.write(<span class="hljs-built_in">bytes</span>(s))<br>f.close()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">'ok'</span>)<br></code></pre></td></tr></tbody></table></figure><p>åˆ†ç¦»å‡ºçš„æ˜¯bpfå­—èŠ‚ç ï¼ŒIDAæ— æ³•ç›´æ¥åæ±‡ç¼–ï¼Œéœ€è¦æ‰¾åˆ°ç›¸åº”çš„è§£é‡Šå™¨ã€‚</p><p><a href="https://github.com/saaph/eBPF_processor">saaph/eBPF_processor . disassemble eBPF bytecode</a></p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220326001348915.png" alt="image-20220326001348915"></p><p>é…ç½®å¥½åæ‰“å¼€dumpå‡ºçš„æ–‡ä»¶ï¼Œé€‰æ‹©EBPFï¼Œå³å¯å¯¹å­—èŠ‚ç åæ±‡ç¼–ï¼ŒæŸ¥çœ‹æ±‡ç¼–ä»£ç å³å¯ï¼Œä¸»è¦æ˜¯æ±‚è§£çº¿æ€§æ–¹ç¨‹ç»„ï¼Œz3å³å¯ï¼Œé€šè¿‡hashæ¥check flagæ˜¯å¦æ­£ç¡®</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220326001641632.png" alt="image-20220326001641632"></p><p><code>exp</code></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> z3 <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> sha256<br>a=[Int(<span class="hljs-string">'a{}'</span>.<span class="hljs-built_in">format</span>(i)) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>)]<br>s=Solver()<br>s.add(a[<span class="hljs-number">3</span>]*<span class="hljs-number">0x6DC0</span>+a[<span class="hljs-number">2</span>]*<span class="hljs-number">0xfb88</span>+a[<span class="hljs-number">1</span>]*<span class="hljs-number">0x71fb</span>+a[<span class="hljs-number">0</span>]*<span class="hljs-number">0xcc8e</span>==<span class="hljs-number">0xBE18A1735995</span>)<br>s.add(a[<span class="hljs-number">3</span>]*<span class="hljs-number">0xF1BF</span>+a[<span class="hljs-number">2</span>]*<span class="hljs-number">0x6AE5</span>+a[<span class="hljs-number">1</span>]*<span class="hljs-number">0xADD3</span>+a[<span class="hljs-number">0</span>]*<span class="hljs-number">0x9284</span>==<span class="hljs-number">0xA556E5540340</span>)<br>s.add(a[<span class="hljs-number">3</span>]*<span class="hljs-number">0xDD85</span>+a[<span class="hljs-number">2</span>]*<span class="hljs-number">0x8028</span>+a[<span class="hljs-number">1</span>]*<span class="hljs-number">0x652D</span>+a[<span class="hljs-number">0</span>]*<span class="hljs-number">0xE712</span>==<span class="hljs-number">0xA6F374484DA3</span>)<br>s.add(a[<span class="hljs-number">3</span>]*<span class="hljs-number">0x822C</span>+a[<span class="hljs-number">2</span>]*<span class="hljs-number">0xCA43</span>+a[<span class="hljs-number">1</span>]*<span class="hljs-number">0x7C8E</span>+a[<span class="hljs-number">0</span>]*<span class="hljs-number">0xF23A</span>==<span class="hljs-number">0xB99C485A7277</span>)<br>s.check()<br>ans=s.model()<br>res=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>    res.append(<span class="hljs-built_in">int</span>.to_bytes(ans[a[i]].as_long(),<span class="hljs-number">4</span>,<span class="hljs-string">'little'</span>).decode())<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>,-<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>):<br>    <span class="hljs-built_in">print</span>(res[i],end=<span class="hljs-string">''</span>)<br><span class="hljs-built_in">print</span>()<br><span class="hljs-built_in">print</span>(sha256(<span class="hljs-string">b'0vR3sAlbs8pD2h53'</span>).hexdigest())<br><span class="hljs-comment">#0vR3sAlbs8pD2h53</span><br></code></pre></td></tr></tbody></table></figure><p>æ–¹æ³•äºŒ:</p><p>ä½¿ç”¨bpftoolï¼Œbpftoolæ˜¯ä¸€ä¸ªç”¨æ¥æ£€æŸ¥ BPF ç¨‹åºå’Œæ˜ å°„çš„å†…æ ¸å·¥å…·ã€‚</p><p><code>bpftool prog</code> å¯ä»¥ç”¨æ¥æ£€æŸ¥ç³»ç»Ÿä¸­è¿è¡Œç¨‹åºçš„æƒ…å†µ</p><p><code>bpf prog dump </code>è·å–åˆ°äº†ç¨‹åºæ ‡è¯†ç¬¦åï¼Œå¯ä»¥æ‰§è¡Œ bpf prog dump æ¥è·å–æ•´ä¸ªç¨‹åºçš„æ•°æ®,èƒ½å¤Ÿçœ‹åˆ°ç”±ç¼–è¯‘å™¨ç”Ÿæˆçš„å­—èŠ‚ç ã€‚</p><p>å½“ç„¶æ‹¿åˆ°ç¼–è¯‘å™¨ç”Ÿæˆçš„å­—èŠ‚ç å·²ç»å¯è¯»äº†ï¼Œå¦‚æœä»£ç é‡å¤§çš„è¯ï¼Œåˆ™éœ€è¦ä¿®æ”¹ä¸€ä¸‹æ ¼å¼ä¹‹åç”¨Cé‡æ–°ç¼–è¯‘ï¼Œè¯¦è§<a href="https://blog.shi1011.cn/ctf/2259">Mas0n</a>å¸ˆå‚…çš„åšæ³•ã€‚</p><p>å‚è€ƒ:</p><p><a href="https://github.com/libbpf/libbpf-bootstrap">git-libbpf-bootstrap source</a></p><p><a href="https://zhuanlan.zhihu.com/p/467647354">ebpf:åŸºäº uprobe çš„è‡ªå®šä¹‰ä¾‹ç¨‹</a></p><h3 id="the-shellcode">the shellcode</h3><p>èµ›åå¤ç°ï¼Œç¨‹åºåŠ äº†<code>Themida / Winlicense v3.0.0.0 - 3.0.4.0</code>å¼ºä¿æŠ¤å£³ï¼Œç¡¬è„±æ¯”è¾ƒå›°éš¾ï¼Œå¹¶ä¸”å£³ä»£ç æœ‰åè°ƒè¯•ï¼Œå¯ä»¥å…ˆè¿è¡Œï¼Œä¹‹åIDA attachæ¥è¿›è¡Œè°ƒè¯•ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220323165537110.png" alt="image-20220323165537110"></p><p>å°†the shellç¨‹åºä»£ç æ®µçš„æ•°æ®ç”¨IDA pythonæ‰¹é‡è½¬ä¸ºä»£ç ï¼Œå¤§å°0x12f7ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> idaapi<br>adr=<span class="hljs-number">0x00631000</span><br>size=<span class="hljs-number">0x12f7</span><br>end=adr+size<br><span class="hljs-keyword">while</span> adr&lt;end:<br>    idaapi.create_insn(adr)<br>    insn=idaapi.insn_t()<br>    <span class="hljs-built_in">len</span>=idaapi.decode_insn(insn,adr)<br>    adr+=<span class="hljs-built_in">len</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">'ok'</span>)<br><span class="hljs-comment"># è‡ªåŠ¨åŒ–è½¬data ä¸º code</span><br></code></pre></td></tr></tbody></table></figure><p>ä¹‹åé€šè¿‡è¿è¡Œæ—¶çš„è¾“å‡ºå­—ç¬¦å®šä½å…³é”®å¤„ç†å‡½æ•°ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220321234631973.png" alt=""></p><p>é¦–å…ˆå¯¹opcodeè¿›è¡Œbase64è§£å¯†ï¼Œè§£å¯†å‡½æ•°é€šè¿‡ å¯†æ–‡&lt;-&gt;ç´¢å¼•è¡¨ä¸‹æ ‡ çš„æ–¹å¼å®ç°ï¼Œä¹‹ååˆå‘ç°äº†ä½è¿ç®—å’Œé­”æ”¹xxTeaã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> b64encode<br>s=<span class="hljs-string">b'abc'</span><br><span class="hljs-built_in">print</span>(b64encode(s))<br>c=<span class="hljs-string">b'YWJj'</span><br>table=[<span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x40</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x3E</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x3F</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0x3A</span>, <span class="hljs-number">0x3B</span>, <span class="hljs-number">0x3C</span>, <span class="hljs-number">0x3D</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0x04</span>, <span class="hljs-number">0x05</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x07</span>, <span class="hljs-number">0x08</span>, <span class="hljs-number">0x09</span>, <span class="hljs-number">0x0A</span>, <span class="hljs-number">0x0B</span>, <span class="hljs-number">0x0C</span>, <span class="hljs-number">0x0D</span>, <span class="hljs-number">0x0E</span>, <span class="hljs-number">0x0F</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0x13</span>, <span class="hljs-number">0x14</span>, <span class="hljs-number">0x15</span>, <span class="hljs-number">0x16</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0x18</span>, <span class="hljs-number">0x19</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x1A</span>, <span class="hljs-number">0x1B</span>, <span class="hljs-number">0x1C</span>, <span class="hljs-number">0x1D</span>, <span class="hljs-number">0x1E</span>, <span class="hljs-number">0x1F</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x21</span>, <span class="hljs-number">0x22</span>, <span class="hljs-number">0x23</span>, <span class="hljs-number">0x24</span>, <span class="hljs-number">0x25</span>, <span class="hljs-number">0x26</span>, <span class="hljs-number">0x27</span>, <span class="hljs-number">0x28</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0x2A</span>, <span class="hljs-number">0x2B</span>, <span class="hljs-number">0x2C</span>, <span class="hljs-number">0x2D</span>, <span class="hljs-number">0x2E</span>, <span class="hljs-number">0x2F</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x32</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>]<br><span class="hljs-built_in">sum</span>=<span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> c:<br>    <span class="hljs-built_in">sum</span>=(<span class="hljs-built_in">sum</span>&lt;&lt;<span class="hljs-number">6</span>)+table[i]<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(<span class="hljs-built_in">sum</span>))<br><span class="hljs-comment">#base64è§£å¯†</span><br></code></pre></td></tr></tbody></table></figure><p>ä¹‹åæ˜¯é€å­—èŠ‚å¾ªç¯å·¦ç§»3</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; v2; ++i )<br>   v4-&gt;m128i_i8[i] = __ROL1__(v4-&gt;m128i_i8[i], <span class="hljs-number">3</span>);<br></code></pre></td></tr></tbody></table></figure><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220321234846646.png" alt="image-20220321234846646"></p><p>xxTeaå°†æ˜æ–‡å‰ä¸€é¡¹å³ç§»5æ”¹ä¸ºäº†å³ç§»6ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ut32 unsigned int</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> delta 0x9e3779b9</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">XXTea_Decrypt</span><span class="hljs-params">(ut32* enc, ut32 n, ut32* key)</span> </span>{<br>ut32 y, z, sum;<br>ut32 e, rounds;<br><span class="hljs-keyword">int</span> p;<br>rounds = <span class="hljs-number">6</span> + <span class="hljs-number">52</span> / n;<br>sum = delta * rounds;<br><br><span class="hljs-keyword">do</span> {<br>e = (sum &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">3</span>;<br><span class="hljs-keyword">for</span> (p = n - <span class="hljs-number">1</span>; p &gt; <span class="hljs-number">0</span>; p--) {<br>y = enc[(p + <span class="hljs-number">1</span>) % n];<br>z = enc[(p - <span class="hljs-number">1</span>)];<br>enc[p] -= (((z &gt;&gt; <span class="hljs-number">6</span> ^ y &lt;&lt; <span class="hljs-number">2</span>) + (y &gt;&gt; <span class="hljs-number">3</span> ^ z &lt;&lt; <span class="hljs-number">4</span>)) ^ ((sum ^ y) + (key[(p &amp; <span class="hljs-number">3</span>) ^ e] ^ z)));<br>}<br>y = enc[<span class="hljs-number">1</span>];<br>z = enc[n - <span class="hljs-number">1</span>];<br>enc[<span class="hljs-number">0</span>] -= (((z &gt;&gt; <span class="hljs-number">6</span> ^ y &lt;&lt; <span class="hljs-number">2</span>) + (y &gt;&gt; <span class="hljs-number">3</span> ^ z &lt;&lt; <span class="hljs-number">4</span>)) ^ ((sum ^ y) + (key[(<span class="hljs-number">0</span> &amp; <span class="hljs-number">3</span>) ^ e] ^ z)));<br>sum -= delta;<br>} <span class="hljs-keyword">while</span> (--rounds);<br><br>}<br><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{<br>ut32 m[<span class="hljs-number">66</span>] = { <span class="hljs-number">0x4B6B89A1</span>, <span class="hljs-number">0x74C15453</span>, <span class="hljs-number">0x4092A06E</span>, <span class="hljs-number">0x429B0C07</span>, <span class="hljs-number">0x40281E84</span>, <span class="hljs-number">0x8B5B44C9</span>, <span class="hljs-number">0x66FEB37B</span>, <span class="hljs-number">0x3C77A603</span>,<br><span class="hljs-number">0x79C5892D</span>, <span class="hljs-number">0x0D7ADA97</span>, <span class="hljs-number">0x1D51AA56</span>, <span class="hljs-number">0x02D4D703</span>, <span class="hljs-number">0x4FA526BA</span>, <span class="hljs-number">0x32FAD64A</span>, <span class="hljs-number">0x0C0F6091</span>, <span class="hljs-number">0x562B7593</span>,<br><span class="hljs-number">0xDB9ADD67</span>, <span class="hljs-number">0x76165563</span>, <span class="hljs-number">0xA5F79315</span>, <span class="hljs-number">0x3AEB991D</span>, <span class="hljs-number">0x1AB721D4</span>, <span class="hljs-number">0xAACD9D2C</span>, <span class="hljs-number">0x825C2B27</span>, <span class="hljs-number">0x76A7761A</span>,<br><span class="hljs-number">0xB4005F18</span>, <span class="hljs-number">0x117F3763</span>, <span class="hljs-number">0x512CC540</span>, <span class="hljs-number">0xC594A16F</span>, <span class="hljs-number">0xD0E24F8C</span>, <span class="hljs-number">0x9CA3E2E9</span>, <span class="hljs-number">0x0A9CC2D5</span>, <span class="hljs-number">0x4629E61D</span>,<br><span class="hljs-number">0x637129E3</span>, <span class="hljs-number">0xCA4E8AD7</span>, <span class="hljs-number">0xF5DFAF71</span>, <span class="hljs-number">0x474E68AB</span>, <span class="hljs-number">0x542FBC3A</span>, <span class="hljs-number">0xD6741617</span>, <span class="hljs-number">0xAD0DBBE5</span>, <span class="hljs-number">0x62F7BBE3</span>,<br><span class="hljs-number">0xC8D68C07</span>, <span class="hljs-number">0x880E950E</span>, <span class="hljs-number">0xF80F25BA</span>, <span class="hljs-number">0x767A264C</span>, <span class="hljs-number">0x9A7CE014</span>, <span class="hljs-number">0x5C8BC9EE</span>, <span class="hljs-number">0x5D9EF7D4</span>, <span class="hljs-number">0xB999ACDE</span>,<br><span class="hljs-number">0xB2EC8E13</span>, <span class="hljs-number">0xEE68232D</span>, <span class="hljs-number">0x927C5FCE</span>, <span class="hljs-number">0xC9E3A85D</span>, <span class="hljs-number">0xAC74B56B</span>, <span class="hljs-number">0x42B6E712</span>, <span class="hljs-number">0xCD2898DA</span>, <span class="hljs-number">0xFCF11C58</span>,<br><span class="hljs-number">0xF57075EE</span>, <span class="hljs-number">0x5076E678</span>, <span class="hljs-number">0xD4D66A35</span>, <span class="hljs-number">0x95105AB9</span>, <span class="hljs-number">0x1BB04403</span>, <span class="hljs-number">0xB240B959</span>, <span class="hljs-number">0x7B4E261A</span>, <span class="hljs-number">0x23D129D8</span>,<br><span class="hljs-number">0xF5E752CD</span>, <span class="hljs-number">0x4EA78F70</span> };<br>ut32 k[<span class="hljs-number">4</span>] = { <span class="hljs-number">0x74</span>,<span class="hljs-number">0x6f</span>,<span class="hljs-number">0x72</span>,<span class="hljs-number">0x61</span> };<br>XXTea_Decrypt(m, <span class="hljs-number">66</span>, k);<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span> * <span class="hljs-number">66</span>; i++) {<br><span class="hljs-keyword">uint8_t</span> tmp = *((<span class="hljs-keyword">uint8_t</span>*)m + i);<br>*((<span class="hljs-keyword">uint8_t</span>*)m + i) = ((tmp &gt;&gt; <span class="hljs-number">3</span>) | (tmp &lt;&lt; <span class="hljs-number">5</span>)) &amp; <span class="hljs-number">0xff</span>;<br>}<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span> * <span class="hljs-number">66</span>; i++) {<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">"0x%x,"</span>, *((<span class="hljs-keyword">uint8_t</span>*)m + i));<br>}<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}<br><br>from base64 <span class="hljs-keyword">import</span> b64encode<br>code=[<span class="hljs-number">0x60</span>,<span class="hljs-number">0xfc</span>,<span class="hljs-number">0x68</span>,<span class="hljs-number">0x4c</span>,<span class="hljs-number">0x77</span>,<span class="hljs-number">0x26</span>,<span class="hljs-number">0x7</span>,<span class="hljs-number">0x33</span>,<span class="hljs-number">0xd2</span>,<span class="hljs-number">0x64</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x52</span>,<span class="hljs-number">0x30</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x52</span>,<span class="hljs-number">0xc</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x52</span>,<span class="hljs-number">0x14</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x72</span>,<span class="hljs-number">0x28</span>,<span class="hljs-number">0xf</span>,<span class="hljs-number">0xb7</span>,<span class="hljs-number">0x4a</span>,<span class="hljs-number">0x26</span>,<span class="hljs-number">0x33</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x33</span>,<span class="hljs-number">0xc0</span>,<span class="hljs-number">0xac</span>,<span class="hljs-number">0x3c</span>,<span class="hljs-number">0x61</span>,<span class="hljs-number">0x7c</span>,<span class="hljs-number">0x2</span>,<span class="hljs-number">0x2c</span>,<span class="hljs-number">0x20</span>,<span class="hljs-number">0xc1</span>,<span class="hljs-number">0xcf</span>,<span class="hljs-number">0xd</span>,<span class="hljs-number">0x3</span>,<span class="hljs-number">0xf8</span>,<span class="hljs-number">0xe2</span>,<span class="hljs-number">0xf0</span>,<span class="hljs-number">0x52</span>,<span class="hljs-number">0x57</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x52</span>,<span class="hljs-number">0x10</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x42</span>,<span class="hljs-number">0x3c</span>,<span class="hljs-number">0x3</span>,<span class="hljs-number">0xc2</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x40</span>,<span class="hljs-number">0x78</span>,<span class="hljs-number">0x85</span>,<span class="hljs-number">0xc0</span>,<span class="hljs-number">0xf</span>,<span class="hljs-number">0x84</span>,<span class="hljs-number">0xbe</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x3</span>,<span class="hljs-number">0xc2</span>,<span class="hljs-number">0x50</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x48</span>,<span class="hljs-number">0x18</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x58</span>,<span class="hljs-number">0x20</span>,<span class="hljs-number">0x3</span>,<span class="hljs-number">0xda</span>,<span class="hljs-number">0x83</span>,<span class="hljs-number">0xf9</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0xf</span>,<span class="hljs-number">0x84</span>,<span class="hljs-number">0xa9</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x49</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x34</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x3</span>,<span class="hljs-number">0xf2</span>,<span class="hljs-number">0x33</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x33</span>,<span class="hljs-number">0xc0</span>,<span class="hljs-number">0xac</span>,<span class="hljs-number">0xc1</span>,<span class="hljs-number">0xcf</span>,<span class="hljs-number">0xd</span>,<span class="hljs-number">0x3</span>,<span class="hljs-number">0xf8</span>,<span class="hljs-number">0x3a</span>,<span class="hljs-number">0xc4</span>,<span class="hljs-number">0x75</span>,<span class="hljs-number">0xf4</span>,<span class="hljs-number">0x3</span>,<span class="hljs-number">0x7c</span>,<span class="hljs-number">0x24</span>,<span class="hljs-number">0x4</span>,<span class="hljs-number">0x3b</span>,<span class="hljs-number">0x7c</span>,<span class="hljs-number">0x24</span>,<span class="hljs-number">0xc</span>,<span class="hljs-number">0x75</span>,<span class="hljs-number">0xd9</span>,<span class="hljs-number">0x33</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x33</span>,<span class="hljs-number">0xc9</span>,<span class="hljs-number">0x83</span>,<span class="hljs-number">0xc2</span>,<span class="hljs-number">0x50</span>,<span class="hljs-number">0xf</span>,<span class="hljs-number">0xb6</span>,<span class="hljs-number">0x4</span>,<span class="hljs-number">0xa</span>,<span class="hljs-number">0xc1</span>,<span class="hljs-number">0xcf</span>,<span class="hljs-number">0xd</span>,<span class="hljs-number">0x3</span>,<span class="hljs-number">0xf8</span>,<span class="hljs-number">0x41</span>,<span class="hljs-number">0x83</span>,<span class="hljs-number">0xf9</span>,<span class="hljs-number">0xe</span>,<span class="hljs-number">0x75</span>,<span class="hljs-number">0xf1</span>,<span class="hljs-number">0xc1</span>,<span class="hljs-number">0xcf</span>,<span class="hljs-number">0xd</span>,<span class="hljs-number">0x57</span>,<span class="hljs-number">0x33</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x33</span>,<span class="hljs-number">0xc9</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x54</span>,<span class="hljs-number">0x24</span>,<span class="hljs-number">0x3c</span>,<span class="hljs-number">0x52</span>,<span class="hljs-number">0xf</span>,<span class="hljs-number">0xb6</span>,<span class="hljs-number">0x1c</span>,<span class="hljs-number">0xe</span>,<span class="hljs-number">0xb8</span>,<span class="hljs-number">0x67</span>,<span class="hljs-number">0x66</span>,<span class="hljs-number">0x66</span>,<span class="hljs-number">0x66</span>,<span class="hljs-number">0xf7</span>,<span class="hljs-number">0xeb</span>,<span class="hljs-number">0xd1</span>,<span class="hljs-number">0xfa</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0xc2</span>,<span class="hljs-number">0xc1</span>,<span class="hljs-number">0xe8</span>,<span class="hljs-number">0x1f</span>,<span class="hljs-number">0x3</span>,<span class="hljs-number">0xc2</span>,<span class="hljs-number">0x8d</span>,<span class="hljs-number">0x4</span>,<span class="hljs-number">0x80</span>,<span class="hljs-number">0x2b</span>,<span class="hljs-number">0xd8</span>,<span class="hljs-number">0x5a</span>,<span class="hljs-number">0xf</span>,<span class="hljs-number">0xb6</span>,<span class="hljs-number">0x4</span>,<span class="hljs-number">0xa</span>,<span class="hljs-number">0x2b</span>,<span class="hljs-number">0xc3</span>,<span class="hljs-number">0xc1</span>,<span class="hljs-number">0xcf</span>,<span class="hljs-number">0xd</span>,<span class="hljs-number">0x3</span>,<span class="hljs-number">0xf8</span>,<span class="hljs-number">0x41</span>,<span class="hljs-number">0x83</span>,<span class="hljs-number">0xf9</span>,<span class="hljs-number">0xe</span>,<span class="hljs-number">0x75</span>,<span class="hljs-number">0xd4</span>,<span class="hljs-number">0xc1</span>,<span class="hljs-number">0xcf</span>,<span class="hljs-number">0xd</span>,<span class="hljs-number">0x3b</span>,<span class="hljs-number">0x3c</span>,<span class="hljs-number">0x24</span>,<span class="hljs-number">0x74</span>,<span class="hljs-number">0x16</span>,<span class="hljs-number">0x68</span>,<span class="hljs-number">0x25</span>,<span class="hljs-number">0x73</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0xc4</span>,<span class="hljs-number">0x68</span>,<span class="hljs-number">0x6e</span>,<span class="hljs-number">0x6f</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x54</span>,<span class="hljs-number">0x50</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x5c</span>,<span class="hljs-number">0x24</span>,<span class="hljs-number">0x48</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xd3</span>,<span class="hljs-number">0xeb</span>,<span class="hljs-number">0x14</span>,<span class="hljs-number">0x68</span>,<span class="hljs-number">0x25</span>,<span class="hljs-number">0x73</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0xc4</span>,<span class="hljs-number">0x68</span>,<span class="hljs-number">0x79</span>,<span class="hljs-number">0x65</span>,<span class="hljs-number">0x73</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x54</span>,<span class="hljs-number">0x50</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x5c</span>,<span class="hljs-number">0x24</span>,<span class="hljs-number">0x48</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xd3</span>,<span class="hljs-number">0x58</span>,<span class="hljs-number">0x58</span>,<span class="hljs-number">0x58</span>,<span class="hljs-number">0x58</span>,<span class="hljs-number">0x58</span>,<span class="hljs-number">0x58</span>,<span class="hljs-number">0x58</span>,<span class="hljs-number">0x58</span>,<span class="hljs-number">0x58</span>,<span class="hljs-number">0x61</span>,<span class="hljs-number">0xc3</span>,<span class="hljs-number">0x58</span>,<span class="hljs-number">0x5f</span>,<span class="hljs-number">0x5a</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x12</span>,<span class="hljs-number">0xe9</span>,<span class="hljs-number">0xb</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>]<br>print(b64encode(bytes(code)))<br><span class="hljs-string">""</span><span class="hljs-string">"shellcode</span><br><span class="hljs-string">YPxoTHcmBzPSZItSMItSDItSFItyKA+3SiYz/zPArDxhfAIsIMHPDQP44vBSV4tSEItCPAPCi0B4hcAPhL4AAAADwlCLSBiLWCAD2oP5AA+EqQAAAEmLNIsD8jP/M8Cswc8NA/g6xHX0A3wkBDt8JAx12TP/M8mDwlAPtgQKwc8NA/hBg/kOdfHBzw1XM/8zyYtUJDxSD7YcDrhnZmZm9+vR+ovCwegfA8KNBIAr2FoPtgQKK8PBzw0D+EGD+Q511MHPDTs8JHQWaCVzAACLxGhubwAAVFCLXCRI/9PrFGglcwAAi8RoeWVzAFRQi1wkSP/TWFhYWFhYWFhYYcNYX1qLEukL////    </span><br><span class="hljs-string">"</span><span class="hljs-string">""</span><br></code></pre></td></tr></tbody></table></figure><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220322001247766.png" alt="image-20220322001247766"></p><p>shellcode checkæˆåŠŸï¼Œä¹‹åå°±æ˜¯æ‰§è¡Œshellcodeæ¥è§£å¯†flagã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220323171640667.png" alt="image-20220323171640667"></p><p>ç”¨å‡½æ•°æŒ‡é’ˆæ¥è°ƒç”¨è§£å¯†çš„shellcodeï¼Œä»¥ä¾¿è¿›ä¸€æ­¥è°ƒè¯•ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;Windows.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">typedef</span> <span class="hljs-title">void</span> <span class="hljs-params">(*func)</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>(_cdecl*)(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>), <span class="hljs-keyword">char</span>*, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{<br><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> a[<span class="hljs-number">264</span>] = { <span class="hljs-number">0x60</span>,<span class="hljs-number">0xfc</span>,<span class="hljs-number">0x68</span>,<span class="hljs-number">0x4c</span>,<span class="hljs-number">0x77</span>,<span class="hljs-number">0x26</span>,<span class="hljs-number">0x7</span>,<span class="hljs-number">0x33</span>,<span class="hljs-number">0xd2</span>,<span class="hljs-number">0x64</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x52</span>,<span class="hljs-number">0x30</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x52</span>,<span class="hljs-number">0xc</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x52</span>,<span class="hljs-number">0x14</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x72</span>,<span class="hljs-number">0x28</span>,<span class="hljs-number">0xf</span>,<span class="hljs-number">0xb7</span>,<span class="hljs-number">0x4a</span>,<span class="hljs-number">0x26</span>,<span class="hljs-number">0x33</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x33</span>,<span class="hljs-number">0xc0</span>,<span class="hljs-number">0xac</span>,<span class="hljs-number">0x3c</span>,<span class="hljs-number">0x61</span>,<span class="hljs-number">0x7c</span>,<span class="hljs-number">0x2</span>,<span class="hljs-number">0x2c</span>,<span class="hljs-number">0x20</span>,<span class="hljs-number">0xc1</span>,<span class="hljs-number">0xcf</span>,<span class="hljs-number">0xd</span>,<span class="hljs-number">0x3</span>,<span class="hljs-number">0xf8</span>,<span class="hljs-number">0xe2</span>,<span class="hljs-number">0xf0</span>,<span class="hljs-number">0x52</span>,<span class="hljs-number">0x57</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x52</span>,<span class="hljs-number">0x10</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x42</span>,<span class="hljs-number">0x3c</span>,<span class="hljs-number">0x3</span>,<span class="hljs-number">0xc2</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x40</span>,<span class="hljs-number">0x78</span>,<span class="hljs-number">0x85</span>,<span class="hljs-number">0xc0</span>,<span class="hljs-number">0xf</span>,<span class="hljs-number">0x84</span>,<span class="hljs-number">0xbe</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x3</span>,<span class="hljs-number">0xc2</span>,<span class="hljs-number">0x50</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x48</span>,<span class="hljs-number">0x18</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x58</span>,<span class="hljs-number">0x20</span>,<span class="hljs-number">0x3</span>,<span class="hljs-number">0xda</span>,<span class="hljs-number">0x83</span>,<span class="hljs-number">0xf9</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0xf</span>,<span class="hljs-number">0x84</span>,<span class="hljs-number">0xa9</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x49</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x34</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x3</span>,<span class="hljs-number">0xf2</span>,<span class="hljs-number">0x33</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x33</span>,<span class="hljs-number">0xc0</span>,<span class="hljs-number">0xac</span>,<span class="hljs-number">0xc1</span>,<span class="hljs-number">0xcf</span>,<span class="hljs-number">0xd</span>,<span class="hljs-number">0x3</span>,<span class="hljs-number">0xf8</span>,<span class="hljs-number">0x3a</span>,<span class="hljs-number">0xc4</span>,<span class="hljs-number">0x75</span>,<span class="hljs-number">0xf4</span>,<span class="hljs-number">0x3</span>,<span class="hljs-number">0x7c</span>,<span class="hljs-number">0x24</span>,<span class="hljs-number">0x4</span>,<span class="hljs-number">0x3b</span>,<span class="hljs-number">0x7c</span>,<span class="hljs-number">0x24</span>,<span class="hljs-number">0xc</span>,<span class="hljs-number">0x75</span>,<span class="hljs-number">0xd9</span>,<span class="hljs-number">0x33</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x33</span>,<span class="hljs-number">0xc9</span>,<span class="hljs-number">0x83</span>,<span class="hljs-number">0xc2</span>,<span class="hljs-number">0x50</span>,<span class="hljs-number">0xf</span>,<span class="hljs-number">0xb6</span>,<span class="hljs-number">0x4</span>,<span class="hljs-number">0xa</span>,<span class="hljs-number">0xc1</span>,<span class="hljs-number">0xcf</span>,<span class="hljs-number">0xd</span>,<span class="hljs-number">0x3</span>,<span class="hljs-number">0xf8</span>,<span class="hljs-number">0x41</span>,<span class="hljs-number">0x83</span>,<span class="hljs-number">0xf9</span>,<span class="hljs-number">0xe</span>,<span class="hljs-number">0x75</span>,<span class="hljs-number">0xf1</span>,<span class="hljs-number">0xc1</span>,<span class="hljs-number">0xcf</span>,<span class="hljs-number">0xd</span>,<span class="hljs-number">0x57</span>,<span class="hljs-number">0x33</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x33</span>,<span class="hljs-number">0xc9</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x54</span>,<span class="hljs-number">0x24</span>,<span class="hljs-number">0x3c</span>,<span class="hljs-number">0x52</span>,<span class="hljs-number">0xf</span>,<span class="hljs-number">0xb6</span>,<span class="hljs-number">0x1c</span>,<span class="hljs-number">0xe</span>,<span class="hljs-number">0xb8</span>,<span class="hljs-number">0x67</span>,<span class="hljs-number">0x66</span>,<span class="hljs-number">0x66</span>,<span class="hljs-number">0x66</span>,<span class="hljs-number">0xf7</span>,<span class="hljs-number">0xeb</span>,<span class="hljs-number">0xd1</span>,<span class="hljs-number">0xfa</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0xc2</span>,<span class="hljs-number">0xc1</span>,<span class="hljs-number">0xe8</span>,<span class="hljs-number">0x1f</span>,<span class="hljs-number">0x3</span>,<span class="hljs-number">0xc2</span>,<span class="hljs-number">0x8d</span>,<span class="hljs-number">0x4</span>,<span class="hljs-number">0x80</span>,<span class="hljs-number">0x2b</span>,<span class="hljs-number">0xd8</span>,<span class="hljs-number">0x5a</span>,<span class="hljs-number">0xf</span>,<span class="hljs-number">0xb6</span>,<span class="hljs-number">0x4</span>,<span class="hljs-number">0xa</span>,<span class="hljs-number">0x2b</span>,<span class="hljs-number">0xc3</span>,<span class="hljs-number">0xc1</span>,<span class="hljs-number">0xcf</span>,<span class="hljs-number">0xd</span>,<span class="hljs-number">0x3</span>,<span class="hljs-number">0xf8</span>,<span class="hljs-number">0x41</span>,<span class="hljs-number">0x83</span>,<span class="hljs-number">0xf9</span>,<span class="hljs-number">0xe</span>,<span class="hljs-number">0x75</span>,<span class="hljs-number">0xd4</span>,<span class="hljs-number">0xc1</span>,<span class="hljs-number">0xcf</span>,<span class="hljs-number">0xd</span>,<span class="hljs-number">0x3b</span>,<span class="hljs-number">0x3c</span>,<span class="hljs-number">0x24</span>,<span class="hljs-number">0x74</span>,<span class="hljs-number">0x16</span>,<span class="hljs-number">0x68</span>,<span class="hljs-number">0x25</span>,<span class="hljs-number">0x73</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0xc4</span>,<span class="hljs-number">0x68</span>,<span class="hljs-number">0x6e</span>,<span class="hljs-number">0x6f</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x54</span>,<span class="hljs-number">0x50</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x5c</span>,<span class="hljs-number">0x24</span>,<span class="hljs-number">0x48</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xd3</span>,<span class="hljs-number">0xeb</span>,<span class="hljs-number">0x14</span>,<span class="hljs-number">0x68</span>,<span class="hljs-number">0x25</span>,<span class="hljs-number">0x73</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0xc4</span>,<span class="hljs-number">0x68</span>,<span class="hljs-number">0x79</span>,<span class="hljs-number">0x65</span>,<span class="hljs-number">0x73</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x54</span>,<span class="hljs-number">0x50</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x5c</span>,<span class="hljs-number">0x24</span>,<span class="hljs-number">0x48</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xd3</span>,<span class="hljs-number">0x58</span>,<span class="hljs-number">0x58</span>,<span class="hljs-number">0x58</span>,<span class="hljs-number">0x58</span>,<span class="hljs-number">0x58</span>,<span class="hljs-number">0x58</span>,<span class="hljs-number">0x58</span>,<span class="hljs-number">0x58</span>,<span class="hljs-number">0x58</span>,<span class="hljs-number">0x61</span>,<span class="hljs-number">0xc3</span>,<span class="hljs-number">0x58</span>,<span class="hljs-number">0x5f</span>,<span class="hljs-number">0x5a</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x12</span>,<span class="hljs-number">0xe9</span>,<span class="hljs-number">0xb</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span> };<br><span class="hljs-keyword">void</span>* data = VirtualAlloc(<span class="hljs-number">0</span>, <span class="hljs-number">264</span>, <span class="hljs-number">0x00001000</span>, <span class="hljs-number">0x40</span>);<br><span class="hljs-built_in">memcpy</span>(data, a, <span class="hljs-number">264</span> * <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>));<br>func test = (func)data;<br><span class="hljs-keyword">char</span> str[<span class="hljs-number">15</span>] = <span class="hljs-string">"aaaaaaaaaaaaaa"</span>;<br>test((<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>(_cdecl*)(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>))<span class="hljs-built_in">printf</span>,str,<span class="hljs-number">0</span>,<span class="hljs-number">264</span>,<span class="hljs-number">4096</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}<br></code></pre></td></tr></tbody></table></figure><p>ç¼–è¯‘æˆ<code>32ä½</code>å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè°ƒè¯•å®šä½åˆ°flagçš„checkç‚¹ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220323221616553.png" alt="image-20220323221616553"></p><p>å¯Ÿcheck_numå’Œv23çš„å˜åŒ–ï¼Œå‘ç°åŸºæœ¬ç»“æ„ä¸€è‡´ï¼Œæ•…åªè¦è®©v22[i]=flag[i]-v17[i]%5ï¼Œé‚£ä¹ˆv23æœ€ç»ˆç»“æœä¸€å®šå’Œcheck numç›¸åŒï¼Œæ‰€æœ‰æ•°æ®å‡å¯é€šè¿‡è°ƒè¯•è·å¾—ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> m<br>v17=<span class="hljs-string">'LoadLibraryExA'</span><br>v22=[<span class="hljs-number">0x69</span>, <span class="hljs-number">0x73</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0x72</span>, <span class="hljs-number">0x6F</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0x72</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0x6D</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0x6E</span>]<br>flag=<span class="hljs-string">''</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">14</span>):<br>       flag+=<span class="hljs-built_in">chr</span>(v22[i]+<span class="hljs-built_in">ord</span>(v17[i])%<span class="hljs-number">5</span>)<br></code></pre></td></tr></tbody></table></figure><p>å½“ç„¶githubä¸Šä¹Ÿèƒ½æ‰¾åˆ°é’ˆå¯¹<a href="https://github.com/ergrelet/unlicense">WinLicense/Themida 2.x å’Œ 3.xè„±å£³</a>çš„å·¥å…·ï¼Œä¸è¿‡attachè¿™ç§æ–¹æ³•æ›´è¶‹å‘äºé€šè§£ï¼Œå³å¯èƒ½é€‚ç”¨äºå¤šç§å£³å‹ã€‚</p><h2 id="foreign-challenges">foreign challenges</h2><blockquote><p>æµ…æµ…è®°å½•ä¸€ä¸‹è¿‘æœŸå›½é™…æ¯”èµ›ä¸Šçš„ä¸€äº›é¢˜ç›®ï¼Œå®¹æ˜“è¸©å‘æˆ–è€…è€ƒç‚¹æ¯”è¾ƒæ–°é¢–ã€‚</p></blockquote><h3 id="OFPPT-CTF-unicode">OFPPT-CTF . unicode</h3><p><code>unicode2utf-8</code></p><p>é¢˜ç›®ç»™äº†ä¸€ä¸ª<code>flag.jpg.utf8</code>çš„æ–‡ä»¶ï¼Œå°†å›¾ç‰‡å­˜ä¸ºäº†utf-8ç¼–ç çš„æ ¼å¼ã€‚<a href="https://www.utf8-chartable.de/unicode-utf8-table.pl?utf8=dec">unicode-utf-8å¯¹ç…§è¡¨</a></p><p>åªéœ€è¦å°†utf-8è¯»å…¥è½¬ä¸ºunicodeç¼–ç ï¼Œpython3çš„chrå’Œordå‡½æ•°é»˜è®¤æ˜¯ä»¥unicodeç¼–ç æ¥å¤„ç†å­—ç¬¦çš„ï¼Œæ‰€ä»¥åªéœ€ä»¥utf-8ç¼–ç æ ¼å¼è¯»å–æ•°æ®ï¼Œå†ç”¨ordéå†å°±æ‹¿åˆ°äº†å¯¹åº”çš„unicodeå€¼ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> codecs<br>f=codecs.<span class="hljs-built_in">open</span>(<span class="hljs-string">r'flag.jpg.utf8'</span>,<span class="hljs-string">'r'</span>,encoding=<span class="hljs-string">'utf-8'</span>).read()<br><span class="hljs-comment"># print(f)</span><br>s=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> f:<br>    s.append(<span class="hljs-built_in">ord</span>(i))<br>f=<span class="hljs-built_in">open</span>(<span class="hljs-string">r'flag.jpg'</span>,<span class="hljs-string">'wb'</span>).write(<span class="hljs-built_in">bytes</span>(s))<br></code></pre></td></tr></tbody></table></figure><blockquote><p>codecsæ˜¯pythonç”¨äºå¤„ç†æ–‡æœ¬ç¼–ç çš„åŒ…ï¼Œæ”¯æŒå¤šç§ç¼–ç ã€‚â€¦å…¶å®è¿™é¢˜æŒºå‘çš„â€¦</p></blockquote><h3 id="xxx-game">xxx_game</h3><p><code>pythonæ‰“åŒ…çš„elf files</code></p><blockquote><p>pythonæ‰“åŒ…çš„elfæ–‡ä»¶ï¼Œä¹‹å‰å¤šæ˜¯æ‰“åŒ…exeï¼Œå¹¶ä¸”pyinstalleræ‰“åŒ…çš„exeå›¾æ ‡å¾ˆå®¹æ˜“è¯†åˆ«ã€‚è¿˜æœ‰ä¸€ç§æ˜¯py2exeæ‰“åŒ…ï¼Œè¾ƒå‰è€…å‡ºç°é¢‘ç‡è¾ƒå°‘ï¼Œå¹¶ä¸”æ‰“åŒ…exeæ–‡ä»¶æŸ¥çœ‹stringsçª—å£ä¼šæœ‰PY2EXEçš„å­—ç¬¦ã€‚</p></blockquote><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220327210353884.png" alt="image-20220327210353884"></p><p>æ ¹æ®stringsçª—å£ä¸‹å¾ˆå¤špyå‘½åçš„å‡½æ•°ï¼Œæ‰€ä»¥è®¤ä¸ºæ˜¯ç»è¿‡äº†pycæ–‡ä»¶ç»è¿‡æ‰“åŒ…ç”Ÿæˆçš„exeï¼Œç›´æ¥ç”¨pyinstxtractorè§£åŒ…ä¼šå‡ºé”™ï¼Œæ­£ç¡®æ­¥éª¤å¦‚ä¸‹ã€‚</p><p>å‚è€ƒ<a href="https://github.com/extremecoders-re/pyinstxtractor/wiki/Extracting-Linux-ELF-binaries">Extracting Linux ELF binaries</a>ç¬¬ä¸€ç§ç®€å•çš„æ–¹æ³•ã€‚</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apl">#Using objcopy dump the section named pydata to a file.<br>objcopy --dump-section pydata=pydata.dump testfile.elf<br><br>#Now you can run pyinstxtractor on the dumped file.<br>python2 pyinstxtractor.py pydata.dump<br></code></pre></td></tr></tbody></table></figure><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220327211244130.png" alt="image-20220327211244130"></p><p>ä¹‹åé¡ºåºåŒæ‰“åŒ…exeçš„è§£æ³•ä¸€è‡´ã€‚</p><h3 id="picoCTF-game2">picoCTF_game2</h3><p><code>hide and exec code</code></p><blockquote><p>é€šè¿‡å¯¹ç§°åŠ å¯†ç®—æ³•æ¥è§£ç codeå¹¶æ‰§è¡Œï¼Œå½“ç„¶å¯ä»¥é€šè¿‡ç»™å‡ºé«˜ç‰ˆæœ¬çš„pycæ–‡ä»¶æ¥è®©è¿™ä¸ªé—®é¢˜æ›´æœ‰è¶£ã€‚</p></blockquote><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">from</span> cryptography.fernet <span class="hljs-keyword">import</span> Fernet<br><br>payload = <span class="hljs-string">b'gAAAAABiMD1Dt87s50caSunQlHoZqPOwtGNaQXexN-gjKwZeuLEN_-v6UcFJHVXOT4B6DcD1SB7cnd6yTcHg9e9LZCAeJY2cJ0r0sfyGPRiH60F-WbkyUjlAdDywI8RPdTpDYLuBmpZ_Kun-kHyTzMjeKR6R26Z4JITUS8n7Dj9X--9eNLajH6UuYD4GkjRACpsidl_8z33DlB86u_xDCMMm7HFK2oJTs8HG1fBex6enQsu0frUAJbx56DxhRvWawAysDMtLE50vaohrzkVV7Yaz4ClilwgfjQ=='</span><br><br>key_str = <span class="hljs-string">'correctstaplecorrectstaplecorrec'</span><br>key_base64 = base64.b64encode(key_str.encode())<br>f = Fernet(key_base64)<br>plain = f.decrypt(payload)<br><span class="hljs-built_in">print</span>(plain)<br><br><span class="hljs-comment"># exec(plain.decode())</span><br><span class="hljs-comment">#b"\npw = input('What\\'s the password? ')\n\nif pw == 'batteryhorse':\n  print('picoCTF{175_chr157m45_8aef58d2}')\nelse:\n  print('That password is incorrect.')\n\n"</span><br></code></pre></td></tr></tbody></table></figure><h3 id="Gandalf-Baba">Gandalf Baba</h3><p><code>apk-webview-js</code></p><p><code>webview</code>å°è£…çš„apkç¨‹åº,ä¸»è¦é€šè¿‡è°ƒç”¨jsæ¥è¿›è¡Œäº¤äº’ï¼Œéœ€è¦è¿›è¡Œgetä¼ å‚ï¼Œå¹¶ä¸”è¯·æ±‚å¤´æ»¡è¶³è¦æ±‚æ‰èƒ½getflagã€‚</p><p><strong>jsä»£ç åœ¨assetsæ–‡ä»¶ä¸‹ï¼Œå†…å®¹å¦‚ä¸‹ã€‚</strong></p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;script&gt;<br>User=MyInterface.GetUser();<br>Serial=MyInterface.GetSerial();<br>Model=MyInterface.GetModel();<br>Product=MyInterface.GetProduct();<br>Auth=MyInterface.GetAuth();<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">myFunction</span>(<span class="hljs-params"></span>) </span>{<br>  <span class="hljs-keyword">var</span> x = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"myTable"</span>).rows[<span class="hljs-number">1</span>].cells;<br>  x[<span class="hljs-number">0</span>].innerHTML =User ;<br><br>   <span class="hljs-keyword">var</span> y = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"myTable"</span>).rows[<span class="hljs-number">1</span>].cells;<br>  x[<span class="hljs-number">1</span>].innerHTML =Serial;<br><br>   <span class="hljs-keyword">var</span> z = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"myTable"</span>).rows[<span class="hljs-number">1</span>].cells;<br>  x[<span class="hljs-number">2</span>].innerHTML =Model ;<br>   <span class="hljs-keyword">var</span> a = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"myTable"</span>).rows[<span class="hljs-number">1</span>].cells;<br>  x[<span class="hljs-number">3</span>].innerHTML =Product ;<br><br>     <span class="hljs-keyword">var</span> b = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"myTable"</span>).rows[<span class="hljs-number">1</span>].cells;<br>  x[<span class="hljs-number">4</span>].innerHTML =Auth ;<br>}<br>&lt;/script&gt;<br></code></pre></td></tr></tbody></table></figure><p>å…¶ä¸­å¹¶æ²¡æœ‰è°ƒç”¨å…³é”®çš„flagå‡½æ•°ï¼Œæ•…å¯ä»¥æ·»åŠ è¯¥å‡½æ•°å¹¶é‡æ–°æ‰“åŒ…ç­¾åï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥é€†å‘å…³é”®å‡½æ•°çš„é€»è¾‘ï¼Œè¿™é‡Œæˆ‘é‡‡ç”¨åè€…ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220327213347459.png" alt="image-20220327213347459"></p><p>å¯¹é¢˜ç›®ç»™å‡ºçš„ç½‘ç«™getä¼ å…¥å‚æ•°ï¼Œæ»¡è¶³å…¶è¯·æ±‚å¤´çš„å†…å®¹è¦æ±‚å³å¯ç»•è¿‡Gandalf BabaæˆåŠŸæ‹¿åˆ°flagã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python">a=<span class="hljs-string">'RheO5PB6mfL5N3YBH45e5XuCEaWpvWUFESqTYnZk'</span><br>c=[<span class="hljs-number">38</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">60</span>, <span class="hljs-number">93</span>, <span class="hljs-number">49</span>, <span class="hljs-number">50</span>, <span class="hljs-number">95</span>, <span class="hljs-number">25</span>, <span class="hljs-number">22</span>, <span class="hljs-number">45</span>, <span class="hljs-number">71</span>, <span class="hljs-number">47</span>, <span class="hljs-number">94</span>, <span class="hljs-number">60</span>, <span class="hljs-number">54</span>, <span class="hljs-number">45</span>, <span class="hljs-number">70</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(c)):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(c[i]^<span class="hljs-built_in">ord</span>(a[i])),end=<span class="hljs-string">''</span>)<br><span class="hljs-built_in">print</span>()<br>c=[<span class="hljs-number">80</span>, <span class="hljs-number">104</span>, <span class="hljs-number">97</span>, <span class="hljs-number">67</span>, <span class="hljs-number">36</span>, <span class="hljs-number">64</span>, <span class="hljs-number">66</span>, <span class="hljs-number">52</span>, <span class="hljs-number">97</span>, <span class="hljs-number">100</span>, <span class="hljs-number">64</span>, <span class="hljs-number">33</span>, <span class="hljs-number">70</span>, <span class="hljs-number">33</span>, <span class="hljs-number">72</span>, <span class="hljs-number">64</span>]<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">bytes</span>(c))<br><br><span class="hljs-keyword">import</span> requests <span class="hljs-keyword">as</span> req<br>headers = {<span class="hljs-string">'user-agent'</span>: <span class="hljs-string">'PhaC$@B4ad@!F!H@'</span>,<br>           <span class="hljs-string">'Accept-Language'</span>:<span class="hljs-string">"From JavaScript Interface"</span><br>           }<br><br>resp = req.get(<span class="hljs-string">"https://teambounters.com/shapa.php?theshapitparameter=givemeflag"</span>,headers=headers)<br><span class="hljs-built_in">print</span>(resp.text)<br><span class="hljs-comment">#å‚è€ƒ: https://geek-docs.com/python/python-tutorial/python-requests.html</span><br></code></pre></td></tr></tbody></table></figure><blockquote><p>è™ç¬¦çš„Contra 2048ä¹Ÿé‡‡ç”¨çš„webviewå°è£…ï¼Œå¯¹jså’Œæ¶ˆæ¯å¤„ç†ç›®å‰è¿˜ä¸æ˜¯å¤ªäº†è§£ï¼Œä¹‹åä¼šç»™å‡ºå¤ç°ã€‚</p></blockquote><h3 id="amazing-code">amazing_code</h3><p><code>Evm Opcodes</code></p><p>æ‰“å¼€é™„ä»¶ï¼ŒEvm Opcodeï¼Œä¸€èˆ¬å‡ºç°åœ¨æ™ºèƒ½åˆçº¦çš„é€†å‘ï¼Œç›®å‰æ˜¯æœ‰å·¥å…·å¯ä»¥åšåˆ°åç¼–è¯‘çš„æ‰€ä»¥æ— éœ€ç¡¬è¯»ã€‚<a href="https://github.com/wolflo/evm-opcodes">github- Evm Opcodeå¯¹ç…§ HEX</a></p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c">PUSH1<span class="hljs-number">0x80</span><br>PUSH1<span class="hljs-number">0x40</span><br>MSTORE<br>PUSH1<span class="hljs-number">0x20</span><br>PUSH1<span class="hljs-number">0xf8</span><br>SHL<br>PUSH1<span class="hljs-number">0x00</span><br>DUP1<br>PUSH2<span class="hljs-number">0x0100</span><br>EXP<br>...<br></code></pre></td></tr></tbody></table></figure><p>å…ˆå°†opcodeè½¬ä¸º16è¿›åˆ¶æ•°æ®ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pyevmasm <span class="hljs-keyword">import</span> assemble_hex<br><br>op=[<span class="hljs-string">'PUSH1'</span>, <span class="hljs-string">'MSTORE'</span>, <span class="hljs-string">'SHL'</span>, <span class="hljs-string">'DUP1'</span>, <span class="hljs-string">'PUSH2'</span>, <span class="hljs-string">'EXP'</span>, <span class="hljs-string">'DUP2'</span>, <span class="hljs-string">'SLOAD'</span>, <span class="hljs-string">'MUL'</span>, <span class="hljs-string">'NOT'</span>, <span class="hljs-string">'AND'</span>, <span class="hljs-string">'SWAP1'</span>, <span class="hljs-string">'DUP4'</span>, <span class="hljs-string">'SHR'</span>, <span class="hljs-string">'OR'</span>, <span class="hljs-string">'SSTORE'</span>, <span class="hljs-string">'POP'</span>, <span class="hljs-string">'DIV'</span>, <span class="hljs-string">'XOR'</span>, <span class="hljs-string">'CALLVALUE'</span>, <span class="hljs-string">'ISZERO'</span>, <span class="hljs-string">'JUMPI'</span>, <span class="hljs-string">'REVERT'</span>, <span class="hljs-string">'JUMPDEST'</span>, <span class="hljs-string">'CODECOPY'</span>, <span class="hljs-string">'RETURN'</span>, <span class="hljs-string">'INVALID'</span>, <span class="hljs-string">'CALLDATASIZE'</span>, <span class="hljs-string">'LT'</span>, <span class="hljs-string">'CALLDATALOAD'</span>, <span class="hljs-string">'PUSH4'</span>, <span class="hljs-string">'GT'</span>, <span class="hljs-string">'EQ'</span>, <span class="hljs-string">'JUMP'</span>, <span class="hljs-string">'MLOAD'</span>, <span class="hljs-string">'SWAP2'</span>, <span class="hljs-string">'SUB'</span>, <span class="hljs-string">'PUSH32'</span>, <span class="hljs-string">'DUP3'</span>, <span class="hljs-string">'ADD'</span>, <span class="hljs-string">'DUP5'</span>, <span class="hljs-string">'SWAP3'</span>, <span class="hljs-string">'LOG2'</span>, <span class="hljs-string">'PUSH5'</span>, <span class="hljs-string">'SLT'</span>, <span class="hljs-string">'SHA3'</span>, <span class="hljs-string">'PUSH19'</span>, <span class="hljs-string">'CALLER'</span>, <span class="hljs-string">'SDIV'</span>, <span class="hljs-string">'LOG4'</span>, <span class="hljs-string">'PUSH17'</span>]<br>tb=[<span class="hljs-number">0x60</span>+i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>)]<br>k=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> op:<br>    <span class="hljs-keyword">try</span>:<br>        k.append(<span class="hljs-built_in">int</span>(assemble_hex(i),<span class="hljs-number">16</span>))<br>    <span class="hljs-keyword">except</span>:<br>        k.append(tb[<span class="hljs-built_in">int</span>(i[<span class="hljs-number">4</span>:])-<span class="hljs-number">1</span>])<br>table=<span class="hljs-built_in">dict</span>(<span class="hljs-built_in">zip</span>(op,k))<br><span class="hljs-built_in">print</span>(table) <span class="hljs-comment">#æ ¹æ®ç”¨åˆ°çš„opç”Ÿæˆå­—å…¸</span><br><br>table={<span class="hljs-string">'PUSH1'</span>: <span class="hljs-number">96</span>, <span class="hljs-string">'MSTORE'</span>: <span class="hljs-number">82</span>, <span class="hljs-string">'SHL'</span>: <span class="hljs-number">27</span>, <span class="hljs-string">'DUP1'</span>: <span class="hljs-number">128</span>, <span class="hljs-string">'PUSH2'</span>: <span class="hljs-number">97</span>, <span class="hljs-string">'EXP'</span>: <span class="hljs-number">10</span>, <span class="hljs-string">'DUP2'</span>: <span class="hljs-number">129</span>, <span class="hljs-string">'SLOAD'</span>: <span class="hljs-number">84</span>, <span class="hljs-string">'MUL'</span>: <span class="hljs-number">2</span>, <span class="hljs-string">'NOT'</span>: <span class="hljs-number">25</span>, <span class="hljs-string">'AND'</span>: <span class="hljs-number">22</span>, <span class="hljs-string">'SWAP1'</span>: <span class="hljs-number">144</span>, <span class="hljs-string">'DUP4'</span>: <span class="hljs-number">131</span>, <span class="hljs-string">'SHR'</span>: <span class="hljs-number">28</span>, <span class="hljs-string">'OR'</span>: <span class="hljs-number">23</span>, <span class="hljs-string">'SSTORE'</span>: <span class="hljs-number">85</span>, <span class="hljs-string">'POP'</span>: <span class="hljs-number">80</span>, <span class="hljs-string">'DIV'</span>: <span class="hljs-number">4</span>, <span class="hljs-string">'XOR'</span>: <span class="hljs-number">24</span>, <span class="hljs-string">'CALLVALUE'</span>: <span class="hljs-number">52</span>, <span class="hljs-string">'ISZERO'</span>: <span class="hljs-number">21</span>, <span class="hljs-string">'JUMPI'</span>: <span class="hljs-number">87</span>, <span class="hljs-string">'REVERT'</span>: <span class="hljs-number">253</span>, <span class="hljs-string">'JUMPDEST'</span>: <span class="hljs-number">91</span>, <span class="hljs-string">'CODECOPY'</span>: <span class="hljs-number">57</span>, <span class="hljs-string">'RETURN'</span>: <span class="hljs-number">243</span>, <span class="hljs-string">'INVALID'</span>: <span class="hljs-number">254</span>, <span class="hljs-string">'CALLDATASIZE'</span>: <span class="hljs-number">54</span>, <span class="hljs-string">'LT'</span>: <span class="hljs-number">16</span>, <span class="hljs-string">'CALLDATALOAD'</span>: <span class="hljs-number">53</span>, <span class="hljs-string">'PUSH4'</span>: <span class="hljs-number">99</span>, <span class="hljs-string">'GT'</span>: <span class="hljs-number">17</span>, <span class="hljs-string">'EQ'</span>: <span class="hljs-number">20</span>, <span class="hljs-string">'JUMP'</span>: <span class="hljs-number">86</span>, <span class="hljs-string">'MLOAD'</span>: <span class="hljs-number">81</span>, <span class="hljs-string">'SWAP2'</span>: <span class="hljs-number">145</span>, <span class="hljs-string">'SUB'</span>: <span class="hljs-number">3</span>, <span class="hljs-string">'PUSH32'</span>: <span class="hljs-number">127</span>, <span class="hljs-string">'DUP3'</span>: <span class="hljs-number">130</span>, <span class="hljs-string">'ADD'</span>: <span class="hljs-number">1</span>, <span class="hljs-string">'DUP5'</span>: <span class="hljs-number">132</span>, <span class="hljs-string">'SWAP3'</span>: <span class="hljs-number">146</span>, <span class="hljs-string">'LOG2'</span>: <span class="hljs-number">162</span>, <span class="hljs-string">'PUSH5'</span>: <span class="hljs-number">100</span>, <span class="hljs-string">'SLT'</span>: <span class="hljs-number">18</span>, <span class="hljs-string">'SHA3'</span>: <span class="hljs-number">32</span>, <span class="hljs-string">'PUSH19'</span>: <span class="hljs-number">114</span>, <span class="hljs-string">'CALLER'</span>: <span class="hljs-number">51</span>, <span class="hljs-string">'SDIV'</span>: <span class="hljs-number">5</span>, <span class="hljs-string">'LOG4'</span>: <span class="hljs-number">164</span>, <span class="hljs-string">'PUSH17'</span>: <span class="hljs-number">112</span>}<br>f=<span class="hljs-built_in">open</span>(<span class="hljs-string">r'amazing_code'</span>,<span class="hljs-string">'r'</span>)<br>byt=<span class="hljs-string">''</span><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    buf=f.readline()<br>    <span class="hljs-keyword">if</span> buf:<br>        stu=buf.replace(<span class="hljs-string">'\n'</span>,<span class="hljs-string">''</span>).split(<span class="hljs-string">''</span>)<br>        <span class="hljs-keyword">try</span>:<br>            byt+=<span class="hljs-built_in">hex</span>(table[stu[<span class="hljs-number">0</span>]])[<span class="hljs-number">2</span>:].zfill(<span class="hljs-number">2</span>)+stu[<span class="hljs-number">1</span>].replace(<span class="hljs-string">'0x'</span>,<span class="hljs-string">''</span>)<br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-keyword">pass</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">break</span><br><span class="hljs-built_in">print</span>(byt)<br></code></pre></td></tr></tbody></table></figure><p>å¾—åˆ°çš„16è¿›åˆ¶æ•°æ®å¯ä»¥é€šè¿‡<a href="https://ethervm.io/decompile">Online Solidity Decompiler</a>åœ¨çº¿åç¼–è¯‘ï¼Œç»“æœå¯èƒ½æœ‰äº›åå·®æ¯”è¾ƒéš¾è¯»ï¼Œå…³é”®éƒ¨åˆ†è¿˜æ˜¯è¦å‚è€ƒå­—èŠ‚ç æ–‡ä»¶ã€‚</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><code class="hljs solidity">contract Contract {<br>    function main() {<br>        memory[0x40:0x60] = 0x80;<br>        storage[0x00] = (storage[0x00] &amp; ~0xff) | ((0x20 &lt;&lt; 0xf8) &gt;&gt; 0xf8);<br>        storage[0x00] = (storage[0x00] &amp; ~(0xff * 0x0100 ** 0x01)) | ((0x53 &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x01;<br>        storage[0x00] = (storage[0x00] &amp; ~(0xff * 0x0100 ** 0x02)) | ((0x6f &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x02;<br>        storage[0x00] = (storage[0x00] &amp; ~(0xff * 0x0100 ** 0x03)) | ((0x6c &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x03;<br>        storage[0x00] = (storage[0x00] &amp; ~(0xff * 0x0100 ** 0x04)) | ((0x69 &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x04;<br>        storage[0x00] = (storage[0x00] &amp; ~(0xff * 0x0100 ** 0x05)) | ((0x64 &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x05;<br>        storage[0x00] = (storage[0x00] &amp; ~(0xff * 0x0100 ** 0x06)) | ((0x60 &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x06;<br>        storage[0x00] = (storage[0x00] &amp; ~(0xff * 0x0100 ** 0x07)) | ((0x74 &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x07;<br>        storage[0x00] = (storage[0x00] &amp; ~(0xff * 0x0100 ** 0x08)) | ((0x79 &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x08;<br>        storage[0x00] = (storage[0x00] &amp; ~(0xff * 0x0100 ** 0x09)) | ((0x5f &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x09;<br>        storage[0x00] = (storage[0x00] &amp; ~(0xff * 0x0100 ** 0x0a)) | ((0x42 &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x0a;<br>        storage[0x00] = (storage[0x00] &amp; ~(0xff * 0x0100 ** 0x0b)) | ((0x69 &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x0b;<br>        storage[0x00] = (storage[0x00] &amp; ~(0xff * 0x0100 ** 0x0c)) | ((0x74 &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x0c;<br>        storage[0x00] = (storage[0x00] &amp; ~(0xff * 0x0100 ** 0x0d)) | ((0x77 &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x0d;<br>        storage[0x00] = (storage[0x00] &amp; ~(0xff * 0x0100 ** 0x0e)) | ((0x69 &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x0e;<br>        storage[0x00] = (storage[0x00] &amp; ~(0xff * 0x0100 ** 0x0f)) | ((0x73 &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x0f;<br>        storage[0x00] = (storage[0x00] &amp; ~(0xff * 0x0100 ** 0x10)) | ((0x65 &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x10;<br>        storage[0x00] = (storage[0x00] &amp; ~(0xff * 0x0100 ** 0x11)) | ((0x5f &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x11;<br>        storage[0x00] = (storage[0x00] &amp; ~(0xff * 0x0100 ** 0x12)) | ((0x4f &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x12;<br>        storage[0x00] = (storage[0x00] &amp; ~(0xff * 0x0100 ** 0x13)) | ((0x70 &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x13;<br>        storage[0x00] = (storage[0x00] &amp; ~(0xff * 0x0100 ** 0x14)) | ((0x65 &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x14;<br>        storage[0x00] = (storage[0x00] &amp; ~(0xff * 0x0100 ** 0x15)) | ((0x72 &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x15;<br>        storage[0x00] = (storage[0x00] &amp; ~(0xff * 0x0100 ** 0x16)) | ((0x61 &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x16;<br>        storage[0x00] = (storage[0x00] &amp; ~(0xff * 0x0100 ** 0x17)) | ((0x74 &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x17;<br>        storage[0x00] = (storage[0x00] &amp; ~(0xff * 0x0100 ** 0x18)) | ((0x69 &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x18;<br>        storage[0x00] = (storage[0x00] &amp; ~(0xff * 0x0100 ** 0x19)) | ((0x6f &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x19;<br>        storage[0x00] = (storage[0x00] &amp; ~(0xff * 0x0100 ** 0x1a)) | ((0x6e &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x1a;<br>        storage[0x00] = (storage[0x00] &amp; ~(0xff * 0x0100 ** 0x1b)) | 0x00;<br>        storage[0x00] = (storage[0x00] &amp; ~(0xff * 0x0100 ** 0x1c)) | 0x00;<br>        storage[0x00] = (storage[0x00] &amp; ~(0xff * 0x0100 ** 0x1d)) | 0x00;<br>        storage[0x00] = (storage[0x00] &amp; ~(0xff * 0x0100 ** 0x1e)) | 0x00;<br>        storage[0x00] = (storage[0x00] &amp; ~(0xff * 0x0100 ** 0x1f)) | 0x00;<br>        storage[0x01] = (storage[0x01] &amp; ~0xff) | ((0x62 &lt;&lt; 0xf8) &gt;&gt; 0xf8);<br>        storage[0x01] = (storage[0x01] &amp; ~(0xff * 0x0100 ** 0x01)) | ((0x10 &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x01;<br>        storage[0x01] = (storage[0x01] &amp; ~(0xff * 0x0100 ** 0x02)) | ((0x3b &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x02;<br>        storage[0x01] = (storage[0x01] &amp; ~(0xff * 0x0100 ** 0x03)) | ((0x2a &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x03;<br>        storage[0x01] = (storage[0x01] &amp; ~(0xff * 0x0100 ** 0x04)) | ((0x12 &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x04;<br>        storage[0x01] = (storage[0x01] &amp; ~(0xff * 0x0100 ** 0x05)) | ((0x26 &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x05;<br>        storage[0x01] = (storage[0x01] &amp; ~(0xff * 0x0100 ** 0x06)) | ((0x09 &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x06;<br>        storage[0x01] = (storage[0x01] &amp; ~(0xff * 0x0100 ** 0x07)) | 0x00;<br>        storage[0x01] = (storage[0x01] &amp; ~(0xff * 0x0100 ** 0x08)) | ((0x26 &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x08;<br>        storage[0x01] = (storage[0x01] &amp; ~(0xff * 0x0100 ** 0x09)) | ((0x10 &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x09;<br>        storage[0x01] = (storage[0x01] &amp; ~(0xff * 0x0100 ** 0x0a)) | ((0x32 &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x0a;<br>        storage[0x01] = (storage[0x01] &amp; ~(0xff * 0x0100 ** 0x0b)) | ((0x0c &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x0b;<br>        storage[0x01] = (storage[0x01] &amp; ~(0xff * 0x0100 ** 0x0c)) | ((0x06 &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x0c;<br>        storage[0x01] = (storage[0x01] &amp; ~(0xff * 0x0100 ** 0x0d)) | ((0x16 &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x0d;<br>        storage[0x01] = (storage[0x01] &amp; ~(0xff * 0x0100 ** 0x0e)) | ((0x1d &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x0e;<br>        storage[0x01] = (storage[0x01] &amp; ~(0xff * 0x0100 ** 0x0f)) | ((0x1a &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x0f;<br>        storage[0x01] = (storage[0x01] &amp; ~(0xff * 0x0100 ** 0x10)) | ((0x0a &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x10;<br>        storage[0x01] = (storage[0x01] &amp; ~(0xff * 0x0100 ** 0x11)) | ((0x31 &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x11;<br>        storage[0x01] = (storage[0x01] &amp; ~(0xff * 0x0100 ** 0x12)) | ((0x3c &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x12;<br>        storage[0x01] = (storage[0x01] &amp; ~(0xff * 0x0100 ** 0x13)) | ((0x2f &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x13;<br>        storage[0x01] = (storage[0x01] &amp; ~(0xff * 0x0100 ** 0x14)) | ((0x2c &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x14;<br>        storage[0x01] = (storage[0x01] &amp; ~(0xff * 0x0100 ** 0x15)) | ((0x1c &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x15;<br>        storage[0x01] = (storage[0x01] &amp; ~(0xff * 0x0100 ** 0x16)) | ((0x3e &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x16;<br>        storage[0x01] = (storage[0x01] &amp; ~(0xff * 0x0100 ** 0x17)) | ((0x27 &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x17;<br>        storage[0x01] = (storage[0x01] &amp; ~(0xff * 0x0100 ** 0x18)) | ((0x06 &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x18;<br>        storage[0x01] = (storage[0x01] &amp; ~(0xff * 0x0100 ** 0x19)) | ((0x03 &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x19;<br>        storage[0x01] = (storage[0x01] &amp; ~(0xff * 0x0100 ** 0x1a)) | ((0x07 &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x1a;<br>        storage[0x01] = (storage[0x01] &amp; ~(0xff * 0x0100 ** 0x1b)) | ((0x64 &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x1b;<br>        storage[0x01] = (storage[0x01] &amp; ~(0xff * 0x0100 ** 0x1c)) | ((0x69 &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x1c;<br>        storage[0x01] = (storage[0x01] &amp; ~(0xff * 0x0100 ** 0x1d)) | ((0x74 &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x1d;<br>        storage[0x01] = (storage[0x01] &amp; ~(0xff * 0x0100 ** 0x1e)) | ((0x79 &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x1e;<br>        storage[0x01] = (storage[0x01] &amp; ~(0xff * 0x0100 ** 0x1f)) | ((0x7d &lt;&lt; 0xf8) &gt;&gt; 0xf8) * 0x0100 ** 0x1f;<br>        storage[0x02] = (((storage[0x00] &lt;&lt; 0xf8) ~ (storage[0x01] &lt;&lt; 0xf8)) &gt;&gt; 0xf8) | (storage[0x02] &amp; ~0xff);<br>        storage[0x02] = (((storage[0x00] / 0x0100 ** 0x01 &lt;&lt; 0xf8) ~ (storage[0x01] / 0x0100 ** 0x01 &lt;&lt; 0xf8)) &gt;&gt; 0xf8) * 0x0100 ** 0x01 | (storage[0x02] &amp; ~(0xff * 0x0100 ** 0x01));<br>        storage[0x02] = (((storage[0x00] / 0x0100 ** 0x02 &lt;&lt; 0xf8) ~ (storage[0x01] / 0x0100 ** 0x02 &lt;&lt; 0xf8)) &gt;&gt; 0xf8) * 0x0100 ** 0x02 | (storage[0x02] &amp; ~(0xff * 0x0100 ** 0x02));<br>        storage[0x02] = (((storage[0x00] / 0x0100 ** 0x03 &lt;&lt; 0xf8) ~ (storage[0x01] / 0x0100 ** 0x03 &lt;&lt; 0xf8)) &gt;&gt; 0xf8) * 0x0100 ** 0x03 | (storage[0x02] &amp; ~(0xff * 0x0100 ** 0x03));<br>        storage[0x02] = (((storage[0x00] / 0x0100 ** 0x04 &lt;&lt; 0xf8) ~ (storage[0x01] / 0x0100 ** 0x04 &lt;&lt; 0xf8)) &gt;&gt; 0xf8) * 0x0100 ** 0x04 | (storage[0x02] &amp; ~(0xff * 0x0100 ** 0x04));<br>        storage[0x02] = (((storage[0x00] / 0x0100 ** 0x05 &lt;&lt; 0xf8) ~ (storage[0x01] / 0x0100 ** 0x05 &lt;&lt; 0xf8)) &gt;&gt; 0xf8) * 0x0100 ** 0x05 | (storage[0x02] &amp; ~(0xff * 0x0100 ** 0x05));<br>        storage[0x02] = (((storage[0x00] / 0x0100 ** 0x06 &lt;&lt; 0xf8) ~ (storage[0x01] / 0x0100 ** 0x06 &lt;&lt; 0xf8)) &gt;&gt; 0xf8) * 0x0100 ** 0x06 | (storage[0x02] &amp; ~(0xff * 0x0100 ** 0x06));<br>        storage[0x02] = (((storage[0x00] / 0x0100 ** 0x07 &lt;&lt; 0xf8) ~ (storage[0x01] / 0x0100 ** 0x07 &lt;&lt; 0xf8)) &gt;&gt; 0xf8) * 0x0100 ** 0x07 | (storage[0x02] &amp; ~(0xff * 0x0100 ** 0x07));<br>        storage[0x02] = (((storage[0x00] / 0x0100 ** 0x08 &lt;&lt; 0xf8) ~ (storage[0x01] / 0x0100 ** 0x08 &lt;&lt; 0xf8)) &gt;&gt; 0xf8) * 0x0100 ** 0x08 | (storage[0x02] &amp; ~(0xff * 0x0100 ** 0x08));<br>        storage[0x02] = (((storage[0x00] / 0x0100 ** 0x09 &lt;&lt; 0xf8) ~ (storage[0x01] / 0x0100 ** 0x09 &lt;&lt; 0xf8)) &gt;&gt; 0xf8) * 0x0100 ** 0x09 | (storage[0x02] &amp; ~(0xff * 0x0100 ** 0x09));<br>        storage[0x02] = (((storage[0x00] / 0x0100 ** 0x0a &lt;&lt; 0xf8) ~ (storage[0x01] / 0x0100 ** 0x0a &lt;&lt; 0xf8)) &gt;&gt; 0xf8) * 0x0100 ** 0x0a | (storage[0x02] &amp; ~(0xff * 0x0100 ** 0x0a));<br>        storage[0x02] = (((storage[0x00] / 0x0100 ** 0x0b &lt;&lt; 0xf8) ~ (storage[0x01] / 0x0100 ** 0x0b &lt;&lt; 0xf8)) &gt;&gt; 0xf8) * 0x0100 ** 0x0b | (storage[0x02] &amp; ~(0xff * 0x0100 ** 0x0b));<br>        storage[0x02] = (((storage[0x00] / 0x0100 ** 0x0c &lt;&lt; 0xf8) ~ (storage[0x01] / 0x0100 ** 0x0c &lt;&lt; 0xf8)) &gt;&gt; 0xf8) * 0x0100 ** 0x0c | (storage[0x02] &amp; ~(0xff * 0x0100 ** 0x0c));<br>        storage[0x02] = (((storage[0x00] / 0x0100 ** 0x0d &lt;&lt; 0xf8) ~ (storage[0x01] / 0x0100 ** 0x0d &lt;&lt; 0xf8)) &gt;&gt; 0xf8) * 0x0100 ** 0x0d | (storage[0x02] &amp; ~(0xff * 0x0100 ** 0x0d));<br>        storage[0x02] = (((storage[0x00] / 0x0100 ** 0x0e &lt;&lt; 0xf8) ~ (storage[0x01] / 0x0100 ** 0x0e &lt;&lt; 0xf8)) &gt;&gt; 0xf8) * 0x0100 ** 0x0e | (storage[0x02] &amp; ~(0xff * 0x0100 ** 0x0e));<br>        storage[0x02] = (((storage[0x00] / 0x0100 ** 0x0f &lt;&lt; 0xf8) ~ (storage[0x01] / 0x0100 ** 0x0f &lt;&lt; 0xf8)) &gt;&gt; 0xf8) * 0x0100 ** 0x0f | (storage[0x02] &amp; ~(0xff * 0x0100 ** 0x0f));<br>        storage[0x02] = (((storage[0x00] / 0x0100 ** 0x10 &lt;&lt; 0xf8) ~ (storage[0x01] / 0x0100 ** 0x10 &lt;&lt; 0xf8)) &gt;&gt; 0xf8) * 0x0100 ** 0x10 | (storage[0x02] &amp; ~(0xff * 0x0100 ** 0x10));<br>        storage[0x02] = (((storage[0x00] / 0x0100 ** 0x11 &lt;&lt; 0xf8) ~ (storage[0x01] / 0x0100 ** 0x11 &lt;&lt; 0xf8)) &gt;&gt; 0xf8) * 0x0100 ** 0x11 | (storage[0x02] &amp; ~(0xff * 0x0100 ** 0x11));<br>        storage[0x02] = (((storage[0x00] / 0x0100 ** 0x12 &lt;&lt; 0xf8) ~ (storage[0x01] / 0x0100 ** 0x12 &lt;&lt; 0xf8)) &gt;&gt; 0xf8) * 0x0100 ** 0x12 | (storage[0x02] &amp; ~(0xff * 0x0100 ** 0x12));<br>        storage[0x02] = (((storage[0x00] / 0x0100 ** 0x13 &lt;&lt; 0xf8) ~ (storage[0x01] / 0x0100 ** 0x13 &lt;&lt; 0xf8)) &gt;&gt; 0xf8) * 0x0100 ** 0x13 | (storage[0x02] &amp; ~(0xff * 0x0100 ** 0x13));<br>        storage[0x02] = (((storage[0x00] / 0x0100 ** 0x14 &lt;&lt; 0xf8) ~ (storage[0x01] / 0x0100 ** 0x14 &lt;&lt; 0xf8)) &gt;&gt; 0xf8) * 0x0100 ** 0x14 | (storage[0x02] &amp; ~(0xff * 0x0100 ** 0x14));<br>        storage[0x02] = (((storage[0x00] / 0x0100 ** 0x15 &lt;&lt; 0xf8) ~ (storage[0x01] / 0x0100 ** 0x15 &lt;&lt; 0xf8)) &gt;&gt; 0xf8) * 0x0100 ** 0x15 | (storage[0x02] &amp; ~(0xff * 0x0100 ** 0x15));<br>        storage[0x02] = (((storage[0x00] / 0x0100 ** 0x16 &lt;&lt; 0xf8) ~ (storage[0x01] / 0x0100 ** 0x16 &lt;&lt; 0xf8)) &gt;&gt; 0xf8) * 0x0100 ** 0x16 | (storage[0x02] &amp; ~(0xff * 0x0100 ** 0x16));<br>        storage[0x02] = (((storage[0x00] / 0x0100 ** 0x17 &lt;&lt; 0xf8) ~ (storage[0x01] / 0x0100 ** 0x17 &lt;&lt; 0xf8)) &gt;&gt; 0xf8) * 0x0100 ** 0x17 | (storage[0x02] &amp; ~(0xff * 0x0100 ** 0x17));<br>        storage[0x02] = (((storage[0x00] / 0x0100 ** 0x18 &lt;&lt; 0xf8) ~ (storage[0x01] / 0x0100 ** 0x18 &lt;&lt; 0xf8)) &gt;&gt; 0xf8) * 0x0100 ** 0x18 | (storage[0x02] &amp; ~(0xff * 0x0100 ** 0x18));<br>        storage[0x02] = (((storage[0x00] / 0x0100 ** 0x19 &lt;&lt; 0xf8) ~ (storage[0x01] / 0x0100 ** 0x19 &lt;&lt; 0xf8)) &gt;&gt; 0xf8) * 0x0100 ** 0x19 | (storage[0x02] &amp; ~(0xff * 0x0100 ** 0x19));<br>        storage[0x02] = (((storage[0x00] / 0x0100 ** 0x1a &lt;&lt; 0xf8) ~ (storage[0x01] / 0x0100 ** 0x1a &lt;&lt; 0xf8)) &gt;&gt; 0xf8) * 0x0100 ** 0x1a | (storage[0x02] &amp; ~(0xff * 0x0100 ** 0x1a));<br>        storage[0x02] = (((storage[0x00] / 0x0100 ** 0x1b &lt;&lt; 0xf8) ~ (storage[0x01] / 0x0100 ** 0x1b &lt;&lt; 0xf8)) &gt;&gt; 0xf8) * 0x0100 ** 0x1b | (storage[0x02] &amp; ~(0xff * 0x0100 ** 0x1b));<br>        storage[0x02] = (((storage[0x00] / 0x0100 ** 0x1c &lt;&lt; 0xf8) ~ (storage[0x01] / 0x0100 ** 0x1c &lt;&lt; 0xf8)) &gt;&gt; 0xf8) * 0x0100 ** 0x1c | (storage[0x02] &amp; ~(0xff * 0x0100 ** 0x1c));<br>        storage[0x02] = (((storage[0x00] / 0x0100 ** 0x1d &lt;&lt; 0xf8) ~ (storage[0x01] / 0x0100 ** 0x1d &lt;&lt; 0xf8)) &gt;&gt; 0xf8) * 0x0100 ** 0x1d | (storage[0x02] &amp; ~(0xff * 0x0100 ** 0x1d));<br>        storage[0x02] = (((storage[0x00] / 0x0100 ** 0x1e &lt;&lt; 0xf8) ~ (storage[0x01] / 0x0100 ** 0x1e &lt;&lt; 0xf8)) &gt;&gt; 0xf8) * 0x0100 ** 0x1e | (storage[0x02] &amp; ~(0xff * 0x0100 ** 0x1e));<br>        storage[0x02] = (((storage[0x00] / 0x0100 ** 0x1f &lt;&lt; 0xf8) ~ (storage[0x01] / 0x0100 ** 0x1f &lt;&lt; 0xf8)) &gt;&gt; 0xf8) * 0x0100 ** 0x1f | (storage[0x02] &amp; ~(0xff * 0x0100 ** 0x1f));<br>        var var0 = msg.value;<br>    <br>        if (var0) { revert(memory[0x00:0x00]); }<br>    <br>        memory[0x00:0x089f] = code[0x0f39:0x17d8];<br>        return memory[0x00:0x089f];<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure><p><code>analyse this code</code></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python">storage=[<span class="hljs-number">0</span>]<br>storage[<span class="hljs-number">0x00</span>] = (storage[<span class="hljs-number">0x00</span>] &amp; ~<span class="hljs-number">0xff</span>) | ((<span class="hljs-number">0x20</span> &lt;&lt; <span class="hljs-number">0xf8</span>) &gt;&gt; <span class="hljs-number">0xf8</span>);<br>storage[<span class="hljs-number">0x00</span>] = (storage[<span class="hljs-number">0x00</span>] &amp; ~(<span class="hljs-number">0xff</span> * <span class="hljs-number">0x0100</span> ** <span class="hljs-number">0x01</span>)) | ((<span class="hljs-number">0x53</span> &lt;&lt; <span class="hljs-number">0xf8</span>) &gt;&gt; <span class="hljs-number">0xf8</span>) * <span class="hljs-number">0x0100</span> ** <span class="hljs-number">0x01</span>;<br>storage[<span class="hljs-number">0x00</span>] = (storage[<span class="hljs-number">0x00</span>] &amp; ~(<span class="hljs-number">0xff</span> * <span class="hljs-number">0x0100</span> ** <span class="hljs-number">0x02</span>)) | ((<span class="hljs-number">0x6f</span> &lt;&lt; <span class="hljs-number">0xf8</span>) &gt;&gt; <span class="hljs-number">0xf8</span>) * <span class="hljs-number">0x0100</span> ** <span class="hljs-number">0x02</span>;<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(storage[<span class="hljs-number">0</span>]))<br><span class="hljs-comment">#0x6f5320</span><br><span class="hljs-comment">#æ­¤ç±»ä»£ç æ˜¯åœ¨èµ‹å€¼æŒ‰ç…§å°ç«¯åº æœ€ås[0]å’Œs[1]éƒ½å˜æˆäº†32å­—èŠ‚å¤§å°çš„å˜é‡</span><br><span class="hljs-comment">#ä¹‹åå¯¹s[0]å’Œs[1]ç»“æœè¿›è¡Œå¼‚æˆ–æ“ä½œï¼Œå­˜åœ¨s[2]ä¸­</span><br>storage[<span class="hljs-number">0x02</span>] = (((storage[<span class="hljs-number">0x00</span>] &lt;&lt; <span class="hljs-number">0xf8</span>) ~ (storage[<span class="hljs-number">0x01</span>] &lt;&lt; <span class="hljs-number">0xf8</span>)) &gt;&gt; <span class="hljs-number">0xf8</span>) | (storage[<span class="hljs-number">0x02</span>] &amp; ~<span class="hljs-number">0xff</span>);<br><span class="hljs-comment">#å…¶ä¸­~è¡¨ç¤ºxor</span><br></code></pre></td></tr></tbody></table></figure><p>å¯ä»¥è¿”å›å­—èŠ‚ç æŸ¥çœ‹ ~ åˆ°åº•å¯¹åº”ç€ä»€ä¹ˆæ“ä½œ XOR å’Œ NOTçš„hexååˆ†æ¥è¿‘ï¼Œå¯èƒ½åç¼–è¯‘å™¨å†…éƒ¨å‡ºäº†ç‚¹é—®é¢˜ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220327232655873.png" alt="image-20220327232655873"></p><p><code>exp</code></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">a=[<span class="hljs-number">0x20</span>,<span class="hljs-number">0x53</span>,<span class="hljs-number">0x6f</span>,<span class="hljs-number">0x6c</span>,<span class="hljs-number">0x69</span>,<span class="hljs-number">0x64</span>,<span class="hljs-number">0x60</span>,<span class="hljs-number">0x74</span>,<span class="hljs-number">0x79</span>,<span class="hljs-number">0x5f</span>,<span class="hljs-number">0x42</span>,<span class="hljs-number">0x69</span>,<span class="hljs-number">0x74</span>,<span class="hljs-number">0x77</span>,<span class="hljs-number">0x69</span>,<span class="hljs-number">0x73</span>,<span class="hljs-number">0x65</span>,<span class="hljs-number">0x5f</span>,<span class="hljs-number">0x4f</span>,<span class="hljs-number">0x70</span>,<span class="hljs-number">0x65</span>,<span class="hljs-number">0x72</span>,<span class="hljs-number">0x61</span>,<span class="hljs-number">0x74</span>,<span class="hljs-number">0x69</span>,<span class="hljs-number">0x6f</span>,<span class="hljs-number">0x6e</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>]<br>b=[<span class="hljs-number">0x62</span>,<span class="hljs-number">0x10</span>,<span class="hljs-number">0x3b</span>,<span class="hljs-number">0x2a</span>,<span class="hljs-number">0x12</span>,<span class="hljs-number">0x26</span>,<span class="hljs-number">0x09</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x26</span>,<span class="hljs-number">0x10</span>,<span class="hljs-number">0x32</span>,<span class="hljs-number">0x0c</span>,<span class="hljs-number">0x06</span>,<span class="hljs-number">0x16</span>,<span class="hljs-number">0x1d</span>,<span class="hljs-number">0x1a</span>,<span class="hljs-number">0x0a</span>,<span class="hljs-number">0x31</span>,<span class="hljs-number">0x3c</span>,<span class="hljs-number">0x2f</span>,<span class="hljs-number">0x2c</span>,<span class="hljs-number">0x1c</span>,<span class="hljs-number">0x3e</span>,<span class="hljs-number">0x27</span>,<span class="hljs-number">0x06</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x07</span>,<span class="hljs-number">0x64</span>,<span class="hljs-number">0x69</span>,<span class="hljs-number">0x74</span>,<span class="hljs-number">0x79</span>,<span class="hljs-number">0x7d</span>]<br><span class="hljs-keyword">for</span> i,j <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(a,b):<br>       <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(i^j),end=<span class="hljs-string">''</span>)<br><span class="hljs-comment">#BCTF{Bit_Operations_In_Solidity}</span><br></code></pre></td></tr></tbody></table></figure><h2 id="The-End">The End</h2><p>è¿˜æœ‰ä¸€äº›é¢˜è®°ä¸å¤ªæ¸…äº†ï¼Œå…ˆæš‚æ—¶æ•´ç†è¿™äº›ã€‚æœ€è¿‘è¿˜é‡åˆ°è®¸å¤šéå†å’Œæœç´¢çš„ç®—æ³•é¢˜ï¼Œå¦‚èµ°å›¾å’Œdfsç­‰ï¼Œèƒ½è¿˜åŸæ­£å‘ç®—æ³•ï¼Œè§£ä¸å‡ºå°±å¾ˆéš¾å—å¹¶ä¸”æ— ä»ä¸‹æ‰‹ï¼Œæ‰‹æ’¸å…šè¡¨ç¤ºæ²¡æœºä¼šã€‚</p><p>æ‘¸çš„<code>Rust</code>å’Œ<code>IOT</code>ä¹‹åä¹Ÿä¼šæ•´ç†ä¸€ä¸‹ï¼ŒRustå°±æ˜¯ç¡¬è°ƒï¼ŒIOTè¦ç†Ÿæ‚‰ä¿¡å·ç”¨åˆ°çš„åè®®å’Œä¸€äº›åˆ†æå·¥å…·ç­‰ã€‚</p><blockquote><p>åšå®¢ç”±äºå¤§åˆ›(å…¶å®å»æ˜¯å³¡è°·æƒ³å½“yewang)ç­‰åŸå› å¥½ä¹…æ²¡æ›´äº†ï¼Œæœ€è¿‘è®¸å¤šç¡¬æ ¸èµ›é¢˜è¿˜æ²¡æœ‰å¤ç°ï¼ŒçœŸæ˜¯é•¿è·¯æ¼«æ¼«ï¼Œå­¦æ— æ­¢å¢ƒ(è¶Šæ‘†è¶Šçƒ‚)å•Šï¼</p></blockquote><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/20220113025224690.gif" alt="20220113025224690"></p>]]></content>
    
    
    <categories>
      
      <category>CTF Memory</category>
      
    </categories>
    
    
    <tags>
      
      <tag>RE</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>VNCTF2022</title>
    <link href="/2022/02/12/VNCTF2022/"/>
    <url>/2022/02/12/VNCTF2022/</url>
    
    <content type="html"><![CDATA[<blockquote><p>ä¸­é—´æœ‰å¾ˆå¤šå¤±è¯¯ï¼Œæ²¡ç»†å¿ƒçœ‹ç®—æ³•ç›´æ¥çŒœäº†ï¼Œè¿˜è¢«ç¬¦å·æ•°ç‹ ç‹ å‘äº†ä¸€ç¬”ã€‚</p></blockquote><h2 id="WEB">WEB</h2><h3 id="GameV4-0">GameV4.0</h3><blockquote><p>ç­¾åˆ°é¢˜ï¼ŒF12åœ¨datajsä¸­å‘ç°flagçš„base64å­—ç¬¦ä¸²</p></blockquote><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220212231433347.png" alt="image-20220212231433347"></p><p>base64+URLè§£ç å³å¯</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><pre><code class="hljs c">VNCTF{Welcome_to_VNCTF2022}<br></code></pre></td></tr></tbody></table></figure><h2 id="Crypto-2">Crypto</h2><h3 id="ezmath">ezmath</h3><p>è§£å†³å¦‚ä¸‹æ–¹ç¨‹ï¼Œæç¤ºçŸ¥é“ç¬¬ä¸€ä¸ªæ˜¯15å³n=4,å¯å¾—å¦‚ä¸‹ç­‰å¼<br>$$<br>2^n -1 mod 15==0 \quad ==&gt; \quad 2^n mod 15==1<br>$$</p><blockquote><p>nä»4å¼€å§‹ï¼Œå·¦å³ä¸¤ä¾§å–å¤šå°‘æ¬¡æ–¹éƒ½å¯ä»¥ æ•…ç¬¬kä¸ª nå°±æ˜¯4*k  k=1,2,3,4â€¦</p></blockquote><p>expå¦‚ä¸‹ï¼Œè®°å¾—å½“æ—¶æ‰‹åŠ¨è¾“å…¥æ•°æ®æµ‹è¯•ä¸è¡Œï¼Œç”¨pwntoolå°±å¯ä»¥äº†ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">from hashlib <span class="hljs-keyword">import</span> sha256</span><br><span class="hljs-function">from pwn <span class="hljs-keyword">import</span> *</span><br><span class="hljs-function"></span><br><span class="hljs-function">def <span class="hljs-title">check</span><span class="hljs-params">(s,enc)</span>:</span><br><span class="hljs-function">    table </span>= <span class="hljs-string">'0123456789abcdefghijklmnopqrstuvwxyz'</span> + <span class="hljs-string">'abcdefghijklmnopqrstuvwxyz'</span>.upper()<br>    ans=<span class="hljs-string">''</span><br><span class="hljs-string">    for i in table:</span><br><span class="hljs-string">        for j in table:</span><br><span class="hljs-string">            for k in table:</span><br><span class="hljs-string">                for l in table:</span><br><span class="hljs-string">                    a = i + j + k + l + s</span><br><span class="hljs-string">                    if sha256(a.encode()).hexdigest() == enc:</span><br><span class="hljs-string">                        ans+=a[:4]</span><br><span class="hljs-string">                        print(ans)</span><br><span class="hljs-string">                        return (ans)</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">r=remote('</span>node4.buuoj.cn<span class="hljs-number">'</span>,<span class="hljs-number">28687</span>)<br>p=r.recvuntil(<span class="hljs-string">':'</span>).decode()[<span class="hljs-number">3</span>:].replace(<span class="hljs-string">' == '</span>,<span class="hljs-string">'#'</span>)<br>s=p[p.index(<span class="hljs-string">'+'</span>)+<span class="hljs-number">1</span>:p.index(<span class="hljs-string">')'</span>)]<br>enc=p[p.index(<span class="hljs-string">'#'</span>)+<span class="hljs-number">1</span>:p.index(<span class="hljs-string">'\n'</span>)]<br>tmp=check(s,enc)<br>r.sendline(tmp)<br><span class="hljs-keyword">for</span> i in range(<span class="hljs-number">777</span>):<br>    a=r.recvline().decode().split(<span class="hljs-string">' '</span>)<br>    num=<span class="hljs-keyword">int</span>(a[<span class="hljs-number">4</span>][:a[<span class="hljs-number">4</span>].index(<span class="hljs-string">'t'</span>)])<br>    r.sendline(str(<span class="hljs-keyword">int</span>(num)*<span class="hljs-number">4</span>))<br>    r.recvline()<br>r.interactive()<br><span class="hljs-meta">#flag{7e625b4e-fdec-47aa-8808-c59157d0bb1d}</span><br></code></pre></td></tr></tbody></table></figure><h2 id="RE">RE</h2><blockquote><p>æœ‰ç‚¹å°é—æ†¾ï¼Œè´¥åœ¨äº†Cçš„ç¬¦å·æ•°å¤„ç†ä¸Š æœ€åä¸€é¢˜å•å•SM4ç§˜é’¥æ‰©å°±å†™äº†å¥½ä¹…ï¼Œèµ›åpythonå†™ç›´æ¥å‡ºäº†ï¼Œç™¾æ„Ÿäº¤å¯„G_G</p></blockquote><h3 id="BabyMaze">BabyMaze</h3><blockquote><p>python3.8 ä¸å¯ç›´æ¥uncompyleåç¼–è¯‘  ç”¨py38çš„disæˆ–decompy++éƒ½å¯ä»¥åæ±‡ç¼–</p></blockquote><p>è¿™é‡Œç”¨decompy++  æ‰§è¡Œ .\pycdas BabyMaze.pyc &gt; code.txt</p><p><strong>éƒ¨åˆ†ä»£ç å¦‚ä¸‹</strong></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><code class="hljs python">BabyMaze.pyc (Python <span class="hljs-number">3.8</span>)<br>[Code]<br>    File Name: .\BabyMaze.py<br>    Object Name: &lt;module&gt;<br>    Arg Count: <span class="hljs-number">0</span><br>    Pos Only Arg Count: <span class="hljs-number">0</span><br>    KW Only Arg Count: <span class="hljs-number">0</span><br>    Locals: <span class="hljs-number">0</span><br>    Stack Size: <span class="hljs-number">61</span><br>    Flags: <span class="hljs-number">0x00000040</span> (CO_NOFREE)<br>    [Names]<br>        <span class="hljs-string">'_map'</span><br>        <span class="hljs-string">'maze'</span><br>        <span class="hljs-string">'main'</span><br>        <span class="hljs-string">'__name__'</span><br>    [Var Names]<br>    [Free Vars]<br>    [Cell Vars]<br>    [Constants]<br>        <span class="hljs-number">1</span><br>        <span class="hljs-number">5</span><br>        <span class="hljs-number">0</span><br>        <span class="hljs-number">7</span><br>        [Code]<br>            File Name: .\BabyMaze.py<br>            Object Name: maze<br>            Arg Count: <span class="hljs-number">0</span><br>            Pos Only Arg Count: <span class="hljs-number">0</span><br>            KW Only Arg Count: <span class="hljs-number">0</span><br>            Locals: <span class="hljs-number">4</span><br>            Stack Size: <span class="hljs-number">3</span><br>            Flags: <span class="hljs-number">0x00000043</span> (CO_OPTIMIZED | CO_NEWLOCALS | CO_NOFREE)<br>            [Names]<br>                <span class="hljs-string">'input'</span><br>                <span class="hljs-string">'range'</span><br>                <span class="hljs-string">'len'</span><br>                <span class="hljs-string">'_map'</span><br>            [Var Names]<br>                <span class="hljs-string">'x'</span><br>                <span class="hljs-string">'y'</span><br>                <span class="hljs-string">'step'</span><br>                <span class="hljs-string">'i'</span><br>            [Free Vars]<br>            [Cell Vars]<br>            [Constants]<br>                <span class="hljs-literal">None</span><br>                <span class="hljs-number">1</span><br>                <span class="hljs-string">'w'</span><br>                <span class="hljs-string">'s'</span><br>                <span class="hljs-string">'a'</span><br>                <span class="hljs-string">'d'</span><br>                <span class="hljs-literal">False</span><br>                <span class="hljs-number">29</span><br>                <span class="hljs-literal">True</span><br>            [Disassembly]<br>                <span class="hljs-number">0</span>       LOAD_CONST              <span class="hljs-number">1</span>: <span class="hljs-number">1</span><br>                <span class="hljs-number">2</span>       STORE_FAST              <span class="hljs-number">0</span>: x<br>                <span class="hljs-number">4</span>       LOAD_CONST              <span class="hljs-number">1</span>: <span class="hljs-number">1</span><br>                <span class="hljs-number">6</span>       STORE_FAST              <span class="hljs-number">1</span>: y<br>                <span class="hljs-number">8</span>       LOAD_GLOBAL             <span class="hljs-number">0</span>: <span class="hljs-built_in">input</span><br>                <span class="hljs-number">10</span>      CALL_FUNCTION           <span class="hljs-number">0</span><br>                <span class="hljs-number">12</span>      STORE_FAST              <span class="hljs-number">2</span>: step<br>                <span class="hljs-number">14</span>      LOAD_GLOBAL             <span class="hljs-number">1</span>: <span class="hljs-built_in">range</span><br>                <span class="hljs-number">16</span>      LOAD_GLOBAL             <span class="hljs-number">2</span>: <span class="hljs-built_in">len</span><br>                <span class="hljs-number">18</span>      LOAD_FAST               <span class="hljs-number">2</span>: step<br>                <span class="hljs-number">20</span>      CALL_FUNCTION           <span class="hljs-number">1</span><br>                <span class="hljs-number">22</span>      CALL_FUNCTION           <span class="hljs-number">1</span><br>                <span class="hljs-number">24</span>      GET_ITER                <br>                <span class="hljs-number">26</span>      FOR_ITER                <span class="hljs-number">142</span> (to <span class="hljs-number">170</span>)<br>                <span class="hljs-number">28</span>      STORE_FAST              <span class="hljs-number">3</span>: i<br>                <span class="hljs-number">30</span>      LOAD_FAST               <span class="hljs-number">2</span>: step<br>                <span class="hljs-number">32</span>      LOAD_FAST               <span class="hljs-number">3</span>: i<br>                <span class="hljs-number">34</span>      BINARY_SUBSCR           <br>                <span class="hljs-number">36</span>      LOAD_CONST              <span class="hljs-number">2</span>: <span class="hljs-string">'w'</span><br>                <span class="hljs-number">38</span>      COMPARE_OP              <span class="hljs-number">2</span> (==)<br>                <span class="hljs-number">40</span>      POP_JUMP_IF_FALSE       <span class="hljs-number">52</span><br>                <span class="hljs-number">42</span>      LOAD_FAST               <span class="hljs-number">0</span>: x<br>                <span class="hljs-number">44</span>      LOAD_CONST              <span class="hljs-number">1</span>: <span class="hljs-number">1</span><br>                <span class="hljs-number">46</span>      INPLACE_SUBTRACT        <br>                <span class="hljs-number">48</span>      STORE_FAST              <span class="hljs-number">0</span>: x<br>                <span class="hljs-number">50</span>      JUMP_FORWARD            <span class="hljs-number">72</span> (to <span class="hljs-number">124</span>)<br>                <span class="hljs-number">52</span>      LOAD_FAST               <span class="hljs-number">2</span>: step<br>                <span class="hljs-number">54</span>      LOAD_FAST               <span class="hljs-number">3</span>: i<br>                <span class="hljs-number">56</span>      BINARY_SUBSCR           <br>                <span class="hljs-number">58</span>      LOAD_CONST              <span class="hljs-number">3</span>: <span class="hljs-string">'s'</span><br>                <span class="hljs-number">60</span>      COMPARE_OP              <span class="hljs-number">2</span> (==)<br>                <span class="hljs-number">62</span>      POP_JUMP_IF_FALSE       <span class="hljs-number">74</span><br>                <span class="hljs-number">64</span>      LOAD_FAST               <span class="hljs-number">0</span>: x<br>                <span class="hljs-number">66</span>      LOAD_CONST              <span class="hljs-number">1</span>: <span class="hljs-number">1</span><br>                <span class="hljs-number">68</span>      INPLACE_ADD             <br>                <span class="hljs-number">70</span>      STORE_FAST              <span class="hljs-number">0</span>: x<br>                <span class="hljs-number">72</span>      JUMP_FORWARD            <span class="hljs-number">50</span> (to <span class="hljs-number">124</span>)<br>                <span class="hljs-number">74</span>      LOAD_FAST               <span class="hljs-number">2</span>: step<br>                <span class="hljs-number">76</span>      LOAD_FAST               <span class="hljs-number">3</span>: i<br>                <span class="hljs-number">78</span>      BINARY_SUBSCR           <br>                <span class="hljs-number">80</span>      LOAD_CONST              <span class="hljs-number">4</span>: <span class="hljs-string">'a'</span><br>                <span class="hljs-number">82</span>      COMPARE_OP              <span class="hljs-number">2</span> (==)<br>                <span class="hljs-number">84</span>      POP_JUMP_IF_FALSE       <span class="hljs-number">96</span><br>                <span class="hljs-number">86</span>      LOAD_FAST               <span class="hljs-number">1</span>: y<br>                <span class="hljs-number">88</span>      LOAD_CONST              <span class="hljs-number">1</span>: <span class="hljs-number">1</span><br>                <span class="hljs-number">90</span>      INPLACE_SUBTRACT        <br>                <span class="hljs-number">92</span>      STORE_FAST              <span class="hljs-number">1</span>: y<br>                <span class="hljs-number">94</span>      JUMP_FORWARD            <span class="hljs-number">28</span> (to <span class="hljs-number">124</span>)<br>                <span class="hljs-number">96</span>      LOAD_FAST               <span class="hljs-number">2</span>: step<br>                <span class="hljs-number">98</span>      LOAD_FAST               <span class="hljs-number">3</span>: i<br>                <span class="hljs-number">100</span>     BINARY_SUBSCR           <br>                <span class="hljs-number">102</span>     LOAD_CONST              <span class="hljs-number">5</span>: <span class="hljs-string">'d'</span><br>                <span class="hljs-number">104</span>     COMPARE_OP              <span class="hljs-number">2</span> (==)<br>                <span class="hljs-number">106</span>     POP_JUMP_IF_FALSE       <span class="hljs-number">118</span><br>                <span class="hljs-number">108</span>     LOAD_FAST               <span class="hljs-number">1</span>: y<br>                <span class="hljs-number">110</span>     LOAD_CONST              <span class="hljs-number">1</span>: <span class="hljs-number">1</span><br>                <span class="hljs-number">112</span>     INPLACE_ADD             <br>                <span class="hljs-number">114</span>     STORE_FAST              <span class="hljs-number">1</span>: y<br>                <span class="hljs-number">116</span>     JUMP_FORWARD            <span class="hljs-number">6</span> (to <span class="hljs-number">124</span>)<br>                <span class="hljs-number">118</span>     POP_TOP                 <br>                <span class="hljs-number">120</span>     LOAD_CONST              <span class="hljs-number">6</span>: <span class="hljs-literal">False</span><br>                <span class="hljs-number">122</span>     RETURN_VALUE            <br>                <span class="hljs-number">124</span>     LOAD_GLOBAL             <span class="hljs-number">3</span>: _<span class="hljs-built_in">map</span><br>                <span class="hljs-number">126</span>     LOAD_FAST               <span class="hljs-number">0</span>: x<br>                <span class="hljs-number">128</span>     BINARY_SUBSCR           <br>                <span class="hljs-number">130</span>     LOAD_FAST               <span class="hljs-number">1</span>: y<br>                <span class="hljs-number">132</span>     BINARY_SUBSCR           <br>                <span class="hljs-number">134</span>     LOAD_CONST              <span class="hljs-number">1</span>: <span class="hljs-number">1</span><br>                <span class="hljs-number">136</span>     COMPARE_OP              <span class="hljs-number">2</span> (==)<br>                <span class="hljs-number">138</span>     POP_JUMP_IF_FALSE       <span class="hljs-number">146</span><br>                <span class="hljs-number">140</span>     POP_TOP                 <br>                <span class="hljs-number">142</span>     LOAD_CONST              <span class="hljs-number">6</span>: <span class="hljs-literal">False</span><br>                <span class="hljs-number">144</span>     RETURN_VALUE            <br>                <span class="hljs-number">146</span>     LOAD_FAST               <span class="hljs-number">0</span>: x<br>                <span class="hljs-number">148</span>     LOAD_CONST              <span class="hljs-number">7</span>: <span class="hljs-number">29</span><br>                <span class="hljs-number">150</span>     COMPARE_OP              <span class="hljs-number">2</span> (==)<br>                <span class="hljs-number">152</span>     POP_JUMP_IF_FALSE       <span class="hljs-number">26</span><br>                <span class="hljs-number">154</span>     LOAD_FAST               <span class="hljs-number">1</span>: y<br>                <span class="hljs-number">156</span>     LOAD_CONST              <span class="hljs-number">7</span>: <span class="hljs-number">29</span><br>                <span class="hljs-number">158</span>     COMPARE_OP              <span class="hljs-number">2</span> (==)<br>                <span class="hljs-number">160</span>     POP_JUMP_IF_FALSE       <span class="hljs-number">26</span><br>                <span class="hljs-number">162</span>     POP_TOP                 <br>                <span class="hljs-number">164</span>     LOAD_CONST              <span class="hljs-number">8</span>: <span class="hljs-literal">True</span><br>                <span class="hljs-number">166</span>     RETURN_VALUE            <br>                <span class="hljs-number">168</span>     JUMP_ABSOLUTE           <span class="hljs-number">26</span><br>                <span class="hljs-number">170</span>     LOAD_CONST              <span class="hljs-number">0</span>: <span class="hljs-literal">None</span><br>                <span class="hljs-number">172</span>     RETURN_VALUE            <br></code></pre></td></tr></tbody></table></figure><p><strong>å…¶ä½™ä¸»è¦æ˜¯mapæ•°ç»„ï¼Œå‚è€ƒpyå­—èŠ‚ç å®˜ç½‘å†™å‡ºä¼ªç </strong></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python">x=<span class="hljs-number">1</span><br>y=<span class="hljs-number">1</span><br>step=<span class="hljs-built_in">input</span>()<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(step)):<br>    <span class="hljs-keyword">if</span> step[i]==<span class="hljs-string">'w'</span>:<br>        x-=<span class="hljs-number">1</span><br>    <span class="hljs-keyword">elif</span> step[i]==<span class="hljs-string">'s'</span>:<br>        x+=<span class="hljs-number">1</span><br>    <span class="hljs-keyword">elif</span> step[i]==<span class="hljs-string">'a'</span>:<br>        y-=<span class="hljs-number">1</span><br>    <span class="hljs-keyword">elif</span> step[i]==<span class="hljs-string">'d'</span>:<br>        y+=<span class="hljs-number">1</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">'noo'</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">map</span>[<span class="hljs-number">31</span>*x+y]==<span class="hljs-number">1</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">'noo'</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">if</span> x==<span class="hljs-number">29</span> <span class="hljs-keyword">and</span> y==<span class="hljs-number">29</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">'yes'</span>)<br></code></pre></td></tr></tbody></table></figure><p><code>solve maze problem</code></p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;iostream&gt;</span></span><br><span class="hljs-keyword">uint8_t</span> <span class="hljs-built_in">map</span>[<span class="hljs-number">961</span>] = { <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">7</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>};<br><span class="hljs-keyword">uint8_t</span> ans[<span class="hljs-number">256</span>] = { <span class="hljs-number">0</span> };<br><span class="hljs-keyword">uint8_t</span> visit[<span class="hljs-number">961</span>] = { <span class="hljs-number">0</span> };<br><span class="hljs-keyword">uint8_t</span> next[<span class="hljs-number">4</span>] = { <span class="hljs-number">119</span>,<span class="hljs-number">115</span>,<span class="hljs-number">97</span>,<span class="hljs-number">100</span> };<br><span class="hljs-keyword">uint32_t</span> step = <span class="hljs-number">0</span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">maze</span><span class="hljs-params">(<span class="hljs-keyword">uint32_t</span> x, <span class="hljs-keyword">uint32_t</span> y)</span> </span>{<br>visit[<span class="hljs-number">31</span> * x + y] = <span class="hljs-number">1</span>;<br><span class="hljs-keyword">uint32_t</span> tx, ty;<br><span class="hljs-keyword">if</span> (x == <span class="hljs-number">29</span> &amp;&amp; y == <span class="hljs-number">29</span>) {<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">"yes\n"</span>);<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; step; i++)<br>{<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">"%c"</span>, ans[i]);<br>}<br><br><span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>}<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++) {<br><span class="hljs-keyword">switch</span> (next[i])<br>{<br><span class="hljs-keyword">case</span> <span class="hljs-number">119</span>:<br>tx = x - <span class="hljs-number">1</span>;<br>ty = y;<br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-number">115</span>:<br>tx = x + <span class="hljs-number">1</span>;<br>ty = y;<br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-number">97</span>:<br>ty = y - <span class="hljs-number">1</span>;<br>tx = x;<br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-number">100</span>:<br>ty = y + <span class="hljs-number">1</span>;<br>tx = x;<br><span class="hljs-keyword">break</span>;<br>}<br><br><span class="hljs-keyword">if</span> ((tx &gt;= <span class="hljs-number">0</span> &amp;&amp; tx &lt; <span class="hljs-number">31</span>) &amp;&amp; (ty &gt;= <span class="hljs-number">0</span> &amp;&amp; ty &lt; <span class="hljs-number">31</span>) &amp;&amp; <span class="hljs-built_in">map</span>[<span class="hljs-number">31</span> * tx + ty] != <span class="hljs-number">1</span> &amp;&amp; visit[<span class="hljs-number">31</span> * tx + ty] == <span class="hljs-number">0</span>) {<br>ans[step] = next[i];<br>step += <span class="hljs-number">1</span>;<br>maze(tx, ty);<br>step -= <span class="hljs-number">1</span>;<br>}<br>}<br><span class="hljs-keyword">return</span>;<br>}<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{<br>maze(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}<br><span class="hljs-comment">//print('VNCTF{'+md5('ssssddssaassddddwwwwddwwddddddwwddddddssddwwddddddddssssaawwaassaassaassddssaassaawwwwwwaaaaaaaassaassddddwwddssddssssaassddssssaaaaaawwddwwaawwwwaassssssssssssddddssddssddddddddwwaaaaaawwwwddssddwwwwwwwwddssddssssssssddddss'.encode()).hexdigest()+'}')</span><br><span class="hljs-comment">//VNCTF{801f190737434100e7d2790bd5b0732e}</span><br></code></pre></td></tr></tbody></table></figure><h3 id="cmç‹—">cmç‹—</h3><blockquote><p>goçš„è™šæ‹Ÿæœº ç´¢æ€§æ˜¯æ¨¡æ‹Ÿçš„æ±‡ç¼–å¤§è‡´ç›¸åŒï¼Œç¡¬é™æ€åˆ†æè¿˜æ˜¯å¯ä»¥å‡ºçš„</p></blockquote><p><code>VM_Init</code> å°†ä¸€äº›å‡½æ•°åœ°å€å­˜åœ¨æŸåç§»å¤„ï¼ŒV1ç»“æ„ä½“æœ‰ç‚¹å¤§ï¼Œæ²¡å»å®šä¹‰ã€‚</p><p><code>VM_run</code></p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220212233121694.png" alt="image-20220212233121694"></p><p><strong>æ ¹æ®VM_Runå¯çŸ¥æŒ‡ä»¤é•¿åº¦æ˜¯3Byteï¼Œå¹¶ä¸”0xFF4åç§»å¤„æ˜¯eipï¼Œ0x1000åç§»æ˜¯opcodeï¼Œæ¥ä¸‹æ¥æ˜¯å¯¹20ä¸ªfunçš„åˆ†æ</strong></p><blockquote><p>ä¸ºäº†å‡å°‘å·¥ä½œé‡å¯ä»¥æå‰å¯¹opcodeçš„åœ°å€ç è¿›è¡Œéå†ï¼Œåªè§£é‡Šç”¨åˆ°çš„æŒ‡ä»¤å³å¯</p></blockquote><p>éƒ¨åˆ†å‡½æ•°</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs c">__int64 __usercall main___ptr_MzVm__init_func2@&lt;rax&gt;(__int64 a1)<br>{<span class="hljs-comment">//é«˜32ä½ä¸ºRnum ä½32ä½ä¸ºLnum</span><br>  __int64 v1; <span class="hljs-comment">// rdx</span><br>  __int64 v2; <span class="hljs-comment">// rdx</span><br>  __int64 result; <span class="hljs-comment">// rax</span><br>  __int64 v4; <span class="hljs-comment">// [rsp+0h] [rbp-18h]</span><br><br>  v2 = *(_QWORD *)(v1 + <span class="hljs-number">8</span>);                     <span class="hljs-comment">// mov r[Lnum],Rnum</span><br>  result = (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)a1;<br>  <span class="hljs-keyword">if</span> ( (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)a1 &gt;= <span class="hljs-number">0x15</span>uLL )<br>    runtime_panicIndex(v4);<br>  *(_DWORD *)(v2 + <span class="hljs-number">4LL</span> * (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)a1) = HIDWORD(a1);<span class="hljs-comment">// 0x14ä¸ªå¯„å­˜å™¨ Lnum,Rnum</span><br>  <span class="hljs-keyword">return</span> result;<br>}<br><br><span class="hljs-keyword">unsigned</span> __int64 __usercall main___ptr_MzVm__init_func6@&lt;rax&gt;(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> a1)<br>{<br>  __int64 v1; <span class="hljs-comment">// rdx</span><br>  __int64 v2; <span class="hljs-comment">// rdx</span><br>  <span class="hljs-keyword">unsigned</span> __int64 result; <span class="hljs-comment">// rax</span><br>  __int64 v4; <span class="hljs-comment">// [rsp+0h] [rbp-18h]</span><br><br>  v2 = *(_QWORD *)(v1 + <span class="hljs-number">8</span>);<br>  result = (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)(*(_DWORD *)(v2 + <span class="hljs-number">0xFF8</span>) - <span class="hljs-number">1</span>);<br>  *(_DWORD *)(v2 + <span class="hljs-number">0xFF8</span>) = result;<br>  <span class="hljs-keyword">if</span> ( a1 &gt;= <span class="hljs-number">0x15</span>uLL )<br>    runtime_panicIndex(v4);<br>  <span class="hljs-keyword">if</span> ( result &gt;= <span class="hljs-number">0x3E8</span> )<br>    runtime_panicIndex(v4);<br>  *(_DWORD *)(v2 + <span class="hljs-number">4</span> * result + <span class="hljs-number">84</span>) = *(_DWORD *)(v2 + <span class="hljs-number">4LL</span> * a1);<span class="hljs-comment">// push r[Lnum]</span><br>  <span class="hljs-keyword">return</span> result;<br>}<br><br>__int64 __usercall main___ptr_MzVm__init_func13@&lt;rax&gt;(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> a1)<br>{<br>  __int64 v1; <span class="hljs-comment">// rdx</span><br>  __int64 v2; <span class="hljs-comment">// rdx</span><br>  __int64 result; <span class="hljs-comment">// rax</span><br>  __int64 v4; <span class="hljs-comment">// [rsp+0h] [rbp-18h]</span><br><br>  v2 = *(_QWORD *)(v1 + <span class="hljs-number">8</span>);<br>  <span class="hljs-keyword">if</span> ( a1 &gt;= <span class="hljs-number">0x15</span>uLL )<br>    runtime_panicIndex(v4);<br>  result = (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)(<span class="hljs-number">3</span> * *(_DWORD *)(v2 + <span class="hljs-number">4LL</span> * a1));<span class="hljs-comment">// jmp r[Lnum]</span><br>  *(_DWORD *)(v2 + <span class="hljs-number">0xFF4</span>) = result;<br>  <span class="hljs-keyword">return</span> result;<br>}<br></code></pre></td></tr></tbody></table></figure><blockquote><p>è®°ä½å‡ ä¸ªé‡è¦çš„åç§»ï¼Œå‰©ä¸‹çš„çŒœç»“åˆè°ƒè¯•å¾ˆå¿«å°±èƒ½äº†è§£å‡½æ•°åŠŸèƒ½</p></blockquote><p><code>parser</code></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs python">op=[opcode...]<br>f=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(op),<span class="hljs-number">3</span>):<br>   <span class="hljs-keyword">if</span> op[i]+<span class="hljs-number">1</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> f:<br>       f.append(op[i]+<span class="hljs-number">1</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">bytes</span>.fromhex(<span class="hljs-string">'61336366'</span>))<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(op),<span class="hljs-number">3</span>):<br><br>    adr=op[i]+<span class="hljs-number">1</span><br>    Lnum=op[i+<span class="hljs-number">1</span>]<br>    Rnum=op[i+<span class="hljs-number">2</span>]<br><br>    <span class="hljs-keyword">if</span> adr==<span class="hljs-number">1</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">"%s: "</span>%<span class="hljs-built_in">hex</span>(i)+<span class="hljs-string">f"nop"</span>)<br>    <span class="hljs-keyword">elif</span> adr==<span class="hljs-number">2</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">"%s: "</span>%<span class="hljs-built_in">hex</span>(i)+<span class="hljs-string">f"mov r[<span class="hljs-subst">{Lnum}</span>],<span class="hljs-subst">{<span class="hljs-built_in">hex</span>(Rnum)}</span>"</span>)<br>    <span class="hljs-keyword">elif</span> adr==<span class="hljs-number">3</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">"%s: "</span>%<span class="hljs-built_in">hex</span>(i)+<span class="hljs-string">f"mov r[<span class="hljs-subst">{Lnum}</span>],r[<span class="hljs-subst">{Rnum}</span>]"</span>)<br>    <span class="hljs-keyword">elif</span> adr==<span class="hljs-number">6</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">"%s: "</span>%<span class="hljs-built_in">hex</span>(i)+<span class="hljs-string">f"push r[<span class="hljs-subst">{Lnum}</span>]"</span>)<br>    <span class="hljs-keyword">elif</span> adr==<span class="hljs-number">7</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">"%s: "</span>%<span class="hljs-built_in">hex</span>(i)+<span class="hljs-string">f"pop r[<span class="hljs-subst">{Lnum}</span>]"</span>)<br>    <span class="hljs-keyword">elif</span> adr==<span class="hljs-number">8</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">"%s: "</span>%<span class="hljs-built_in">hex</span>(i)+<span class="hljs-string">f"add r[<span class="hljs-subst">{Lnum}</span>],r[<span class="hljs-subst">{Rnum}</span>]"</span>)<br>    <span class="hljs-keyword">elif</span> adr==<span class="hljs-number">9</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">"%s: "</span>%<span class="hljs-built_in">hex</span>(i)+<span class="hljs-string">f"sub r[<span class="hljs-subst">{Lnum}</span>],r[<span class="hljs-subst">{Rnum}</span>]"</span>)<br>    <span class="hljs-keyword">elif</span> adr==<span class="hljs-number">10</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">"%s: "</span>%<span class="hljs-built_in">hex</span>(i)+<span class="hljs-string">f"div r[<span class="hljs-subst">{Lnum}</span>],r[<span class="hljs-subst">{Rnum}</span>]"</span>)<br>    <span class="hljs-keyword">elif</span> adr==<span class="hljs-number">11</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">"%s: "</span>%<span class="hljs-built_in">hex</span>(i)+<span class="hljs-string">f"mul r[<span class="hljs-subst">{Lnum}</span>],r[<span class="hljs-subst">{Rnum}</span>]"</span>)<br>    <span class="hljs-keyword">elif</span> adr==<span class="hljs-number">12</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">"%s: "</span>%<span class="hljs-built_in">hex</span>(i)+<span class="hljs-string">f"xor r[<span class="hljs-subst">{Lnum}</span>],r[<span class="hljs-subst">{Rnum}</span>]"</span>)<br>    <span class="hljs-keyword">elif</span> adr==<span class="hljs-number">13</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">"%s: "</span>%<span class="hljs-built_in">hex</span>(i)+<span class="hljs-string">f"jmp r[<span class="hljs-subst">{Lnum}</span>]"</span>)<br>    <span class="hljs-keyword">elif</span> adr==<span class="hljs-number">15</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">"%s: "</span>%<span class="hljs-built_in">hex</span>(i)+<span class="hljs-string">f"cmp r[<span class="hljs-subst">{Lnum}</span>],r[<span class="hljs-subst">{Rnum}</span>] -- jnz r[19]"</span>)<br>    <span class="hljs-keyword">elif</span> adr==<span class="hljs-number">0x62</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">"%s: "</span>%<span class="hljs-built_in">hex</span>(i)+<span class="hljs-string">f"getchar(r[<span class="hljs-subst">{Lnum}</span>])"</span>)<br>    <span class="hljs-keyword">elif</span> adr==<span class="hljs-number">0x63</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">"%s: "</span>%<span class="hljs-built_in">hex</span>(i)+<span class="hljs-string">f'putchar(r[<span class="hljs-subst">{Lnum}</span>)]'</span>)<br>    <span class="hljs-keyword">elif</span> adr==<span class="hljs-number">0x64</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">"%s: "</span>%<span class="hljs-built_in">hex</span>(i)+<span class="hljs-string">f"exit()"</span>)<br></code></pre></td></tr></tbody></table></figure><p><code>ä¼ªç </code></p><blockquote><p>æˆªå–ç‰‡æ®µï¼Œå‰é¢çš„putchar è¾“å‡º VNCTFâ€¦å•¥çš„</p></blockquote><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs assembly">0xcc: mov r[19],0x49<br>0xcf: mov r[3],0x0<br>0xd2: mov r[1],0x2b     #é•¿åº¦0x2b<br>0xd5: mov r[2],0x1<br>0xd8: getchar(r[0])<br>0xdb: push r[0]         #è¾“å…¥è¿›æ ˆ<br>0xde: sub r[1],r[2]<br>0xe1: cmp r[1],r[3] -- jnz r[19]<br></code></pre></td></tr></tbody></table></figure><p><code>arry2int</code></p><p>4ä¸ªByteè½¬ä¸º int</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-number">0xe4</span>: mov r[<span class="hljs-number">0</span>],<span class="hljs-number">0x0</span><br><span class="hljs-number">0xe7</span>: push r[<span class="hljs-number">0</span>]<br><span class="hljs-number">0xea</span>: nop<br><span class="hljs-number">0xed</span>: nop<br><span class="hljs-number">0xf0</span>: pop r[<span class="hljs-number">0</span>]<br><span class="hljs-number">0xf3</span>: mov r[<span class="hljs-number">5</span>],<span class="hljs-number">0x100</span><br><span class="hljs-number">0xf6</span>: mul r[<span class="hljs-number">0</span>],r[<span class="hljs-number">5</span>]<br><span class="hljs-number">0xf9</span>: mov r[<span class="hljs-number">6</span>],r[<span class="hljs-number">0</span>]<br><span class="hljs-number">0xfc</span>: pop r[<span class="hljs-number">0</span>]<br><span class="hljs-number">0xff</span>: add r[<span class="hljs-number">6</span>],r[<span class="hljs-number">0</span>]<br><span class="hljs-number">0x102</span>: mov r[<span class="hljs-number">0</span>],r[<span class="hljs-number">6</span>]<br><span class="hljs-number">0x105</span>: mul r[<span class="hljs-number">0</span>],r[<span class="hljs-number">5</span>]<br><span class="hljs-number">0x108</span>: mov r[<span class="hljs-number">6</span>],r[<span class="hljs-number">0</span>]<br><span class="hljs-number">0x10b</span>: pop r[<span class="hljs-number">0</span>]<br><span class="hljs-number">0x10e</span>: add r[<span class="hljs-number">6</span>],r[<span class="hljs-number">0</span>]<br><span class="hljs-number">0x111</span>: mov r[<span class="hljs-number">0</span>],r[<span class="hljs-number">6</span>]<br><span class="hljs-number">0x114</span>: mul r[<span class="hljs-number">0</span>],r[<span class="hljs-number">5</span>]<br><span class="hljs-number">0x117</span>: mov r[<span class="hljs-number">6</span>],r[<span class="hljs-number">0</span>]<br><span class="hljs-number">0x11a</span>: pop r[<span class="hljs-number">0</span>]<br><span class="hljs-number">0x11d</span>: add r[<span class="hljs-number">6</span>],r[<span class="hljs-number">0</span>]<br><span class="hljs-number">0x120</span>: nop<br></code></pre></td></tr></tbody></table></figure><p><code>Tea</code></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs assembly">0x3f9: mov r[3],0x9e3779b9 ;delta<br>0x3fc: mov r[4],0x95c4c    ;key<br>0x3ff: mov r[5],0x871d<br>0x402: mov r[6],0x1a7b7<br>0x405: mov r[7],0x12c7c7<br>0x408: mov r[8],0x0<br>0x40b: mov r[17],0x10<br>0x40e: mov r[18],0x20<br>0x411: mov r[19],0x160<br>0x414: mov r[10],0x0<br>0x417: mov r[11],0x20<br>0x41a: mov r[12],0x1<br>0x41d: add r[8],r[3]<br>0x420: mov r[0],r[2]<br>0x423: mul r[0],r[17]<br>0x426: add r[0],r[4]<br>0x429: mov r[14],r[0]<br>0x42c: mov r[0],r[2]<br>0x42f: add r[0],r[8]<br>0x432: mov r[15],r[0]<br>0x435: mov r[0],r[2]<br>0x438: div r[0],r[18]<br>0x43b: add r[0],r[5]<br>0x43e: mov r[16],r[0]<br>0x441: mov r[0],r[14]<br>0x444: xor r[0],r[15]<br>0x447: xor r[0],r[16]<br>0x44a: add r[1],r[0]<br>0x44d: mov r[0],r[1]<br>0x450: mul r[0],r[17]<br>0x453: add r[0],r[6]<br>0x456: mov r[14],r[0]<br>0x459: mov r[0],r[1]<br>0x45c: add r[0],r[8]<br>0x45f: mov r[15],r[0]<br>0x462: mov r[0],r[1]<br>0x465: div r[0],r[18]<br>0x468: add r[0],r[7]<br>0x46b: mov r[16],r[0]<br>0x46e: mov r[0],r[14]<br>0x471: xor r[0],r[15]<br>0x474: xor r[0],r[16]<br>0x477: add r[2],r[0]<br>0x47a: sub r[11],r[12]<br>0x47d: cmp r[11],r[10] -- jnz r[19]<br>0x480: jmp r[20]<br>0x483: nop<br></code></pre></td></tr></tbody></table></figure><p>æ„Ÿè°¢ä½œè€…Teaä¸é­”æ”¹ä¹‹æ©</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-number">0x348</span>: mov r[<span class="hljs-number">20</span>],<span class="hljs-number">0x11c</span><br><span class="hljs-number">0x34b</span>: mov r[<span class="hljs-number">0</span>],<span class="hljs-number">0x154</span><br><span class="hljs-number">0x34e</span>: jmp r[<span class="hljs-number">0</span>]<br><span class="hljs-number">0x351</span>: mov r[<span class="hljs-number">0</span>],<span class="hljs-number">0xe8d1d5df</span><br><span class="hljs-number">0x354</span>: mov r[<span class="hljs-number">19</span>],<span class="hljs-number">0x183</span><br><span class="hljs-number">0x357</span>: mov r[<span class="hljs-number">20</span>],<span class="hljs-number">0x153</span><br><span class="hljs-number">0x35a</span>: cmp r[<span class="hljs-number">1</span>],r[<span class="hljs-number">0</span>] -- jnz r[<span class="hljs-number">19</span>]<br><span class="hljs-number">0x35d</span>: mov r[<span class="hljs-number">0</span>],<span class="hljs-number">0xf5e3c114</span><br><span class="hljs-number">0x360</span>: cmp r[<span class="hljs-number">2</span>],r[<span class="hljs-number">0</span>] -- jnz r[<span class="hljs-number">19</span>]<br><span class="hljs-number">0x363</span>: pop r[<span class="hljs-number">1</span>]<br><span class="hljs-number">0x366</span>: pop r[<span class="hljs-number">2</span>]<br><span class="hljs-number">0x369</span>: mov r[<span class="hljs-number">20</span>],<span class="hljs-number">0x127</span><br><span class="hljs-number">0x36c</span>: mov r[<span class="hljs-number">0</span>],<span class="hljs-number">0x154</span><br><span class="hljs-number">0x36f</span>: jmp r[<span class="hljs-number">0</span>]<br><span class="hljs-number">0x372</span>: mov r[<span class="hljs-number">0</span>],<span class="hljs-number">0x228ec216</span><br><span class="hljs-number">0x375</span>: mov r[<span class="hljs-number">19</span>],<span class="hljs-number">0x183</span><br><span class="hljs-number">0x378</span>: mov r[<span class="hljs-number">20</span>],<span class="hljs-number">0x153</span><br><span class="hljs-number">0x37b</span>: cmp r[<span class="hljs-number">1</span>],r[<span class="hljs-number">0</span>] -- jnz r[<span class="hljs-number">19</span>]<br><span class="hljs-number">0x37e</span>: mov r[<span class="hljs-number">0</span>],<span class="hljs-number">0x89d45a61</span><br><span class="hljs-number">0x381</span>: cmp r[<span class="hljs-number">2</span>],r[<span class="hljs-number">0</span>] -- jnz r[<span class="hljs-number">19</span>]<br><span class="hljs-number">0x384</span>: pop r[<span class="hljs-number">1</span>]<br><span class="hljs-number">0x387</span>: pop r[<span class="hljs-number">2</span>]<br><span class="hljs-number">0x38a</span>: mov r[<span class="hljs-number">20</span>],<span class="hljs-number">0x132</span><br><span class="hljs-number">0x38d</span>: mov r[<span class="hljs-number">0</span>],<span class="hljs-number">0x154</span><br><span class="hljs-number">0x390</span>: jmp r[<span class="hljs-number">0</span>]<br><span class="hljs-number">0x393</span>: mov r[<span class="hljs-number">0</span>],<span class="hljs-number">0x655b8f69</span><br><span class="hljs-number">0x396</span>: mov r[<span class="hljs-number">19</span>],<span class="hljs-number">0x183</span><br><span class="hljs-number">0x399</span>: mov r[<span class="hljs-number">20</span>],<span class="hljs-number">0x153</span><br><span class="hljs-number">0x39c</span>: cmp r[<span class="hljs-number">1</span>],r[<span class="hljs-number">0</span>] -- jnz r[<span class="hljs-number">19</span>]<br><span class="hljs-number">0x39f</span>: mov r[<span class="hljs-number">0</span>],<span class="hljs-number">0x2484a07a</span><br><span class="hljs-number">0x3a2</span>: cmp r[<span class="hljs-number">2</span>],r[<span class="hljs-number">0</span>] -- jnz r[<span class="hljs-number">19</span>]<br><span class="hljs-number">0x3a5</span>: pop r[<span class="hljs-number">1</span>]<br><span class="hljs-number">0x3a8</span>: pop r[<span class="hljs-number">2</span>]<br><span class="hljs-number">0x3ab</span>: mov r[<span class="hljs-number">20</span>],<span class="hljs-number">0x13d</span><br><span class="hljs-number">0x3ae</span>: mov r[<span class="hljs-number">0</span>],<span class="hljs-number">0x154</span><br><span class="hljs-number">0x3b1</span>: jmp r[<span class="hljs-number">0</span>]<br><span class="hljs-number">0x3b4</span>: mov r[<span class="hljs-number">0</span>],<span class="hljs-number">0xd9e5e7f8</span><br><span class="hljs-number">0x3b7</span>: mov r[<span class="hljs-number">19</span>],<span class="hljs-number">0x183</span><br><span class="hljs-number">0x3ba</span>: mov r[<span class="hljs-number">20</span>],<span class="hljs-number">0x153</span><br><span class="hljs-number">0x3bd</span>: cmp r[<span class="hljs-number">1</span>],r[<span class="hljs-number">0</span>] -- jnz r[<span class="hljs-number">19</span>]<br><span class="hljs-number">0x3c0</span>: mov r[<span class="hljs-number">0</span>],<span class="hljs-number">0x3a441532</span><br><span class="hljs-number">0x3c3</span>: cmp r[<span class="hljs-number">2</span>],r[<span class="hljs-number">0</span>] -- jnz r[<span class="hljs-number">19</span>]<br><span class="hljs-number">0x3c6</span>: pop r[<span class="hljs-number">1</span>]<br><span class="hljs-number">0x3c9</span>: pop r[<span class="hljs-number">2</span>]<br><span class="hljs-number">0x3cc</span>: mov r[<span class="hljs-number">20</span>],<span class="hljs-number">0x148</span><br><span class="hljs-number">0x3cf</span>: mov r[<span class="hljs-number">0</span>],<span class="hljs-number">0x154</span><br><span class="hljs-number">0x3d2</span>: jmp r[<span class="hljs-number">0</span>]<br><span class="hljs-number">0x3d5</span>: mov r[<span class="hljs-number">0</span>],<span class="hljs-number">0x91ab7e88</span><br><span class="hljs-number">0x3d8</span>: mov r[<span class="hljs-number">19</span>],<span class="hljs-number">0x183</span><br><span class="hljs-number">0x3db</span>: mov r[<span class="hljs-number">20</span>],<span class="hljs-number">0x153</span><br><span class="hljs-number">0x3de</span>: cmp r[<span class="hljs-number">1</span>],r[<span class="hljs-number">0</span>] -- jnz r[<span class="hljs-number">19</span>]<br><span class="hljs-number">0x3e1</span>: mov r[<span class="hljs-number">0</span>],<span class="hljs-number">0x69fc64bc</span><br><span class="hljs-number">0x3e4</span>: cmp r[<span class="hljs-number">2</span>],r[<span class="hljs-number">0</span>] -- jnz r[<span class="hljs-number">19</span>]<br><span class="hljs-number">0x3e7</span>: pop r[<span class="hljs-number">1</span>]<br><span class="hljs-number">0x3ea</span>: mov r[<span class="hljs-number">0</span>],<span class="hljs-number">0x7d3765</span><br><span class="hljs-number">0x3ed</span>: cmp r[<span class="hljs-number">1</span>],r[<span class="hljs-number">0</span>] -- jnz r[<span class="hljs-number">19</span>]<br><span class="hljs-number">0x3f0</span>: mov r[<span class="hljs-number">0</span>],<span class="hljs-number">0x189</span><br><span class="hljs-number">0x3f3</span>: jmp r[<span class="hljs-number">0</span>]<br><span class="hljs-number">0x3f6</span>: <span class="hljs-built_in">exit</span>()<br></code></pre></td></tr></tbody></table></figure><p>é•¿åº¦44ï¼Œè½¬ä¸ºintæ˜¯11ä¸ªï¼Œå‰10ä¸ªä¸¤ä¸¤ä¸€ç»„Teaï¼Œæœ€åä¸€ä¸ªä¸å¤„ç†ï¼Œè§£å¯†å³å¯ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ut32 unsigned int</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> delta 0x9E3779B9</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Tea_Decrypt</span><span class="hljs-params">(ut32* enc, ut32* k)</span> </span>{<br>ut32 sum = delta * <span class="hljs-number">0x20</span>;<br>ut32 v0 = enc[<span class="hljs-number">0</span>];<br>ut32 v1 = enc[<span class="hljs-number">1</span>];<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">0x20</span>; i++) {<br>v1 -= ((v0 &lt;&lt; <span class="hljs-number">4</span>) + k[<span class="hljs-number">2</span>]) ^ (v0 + sum) ^ ((v0 &gt;&gt; <span class="hljs-number">5</span>) + k[<span class="hljs-number">3</span>]);<br>v0 -= ((v1 &lt;&lt; <span class="hljs-number">4</span>) + k[<span class="hljs-number">0</span>]) ^ (v1 + sum) ^ ((v1 &gt;&gt; <span class="hljs-number">5</span>) + k[<span class="hljs-number">1</span>]);<br>sum -= delta;<br>}<br>enc[<span class="hljs-number">0</span>] = v0;<br>enc[<span class="hljs-number">1</span>] = v1;<br>}<br><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{<br>ut32 m[<span class="hljs-number">2</span>] = { <span class="hljs-number">0xe8d1d5df</span>,<span class="hljs-number">0xf5e3c114</span> }; <span class="hljs-comment">//ä¾æ¬¡å¯†æ–‡</span><br>ut32 k[<span class="hljs-number">4</span>] = { <span class="hljs-number">0x95c4c</span>,<span class="hljs-number">0x871d</span>,<span class="hljs-number">0x1a7b7</span>,<span class="hljs-number">0x12c7c7</span>};<br>Tea_Decrypt(m, k);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">"%x %x"</span>, m[<span class="hljs-number">0</span>], m[<span class="hljs-number">1</span>]);<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}<br><span class="hljs-comment">//å¸¸è§„Teaè§£å¯†</span><br><span class="hljs-comment">//VNCTF{ecd63ae5-8945-4ac4-b5a5-34fc3ade81e7}</span><br></code></pre></td></tr></tbody></table></figure><h3 id="cm1">cm1</h3><blockquote><p>Androidé¢˜ä¸»è¦é€»è¾‘åœ¨éšè—çš„ä¸€ä¸ªdexæ–‡ä»¶ä¸­</p></blockquote><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220212234819160.png" alt="image-20220212234819160" style="zoom:80%;"><p>ä¸»è¦æ˜¯copyfileè¿™ä¸ªå‡½æ•°</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">copyFiles</span><span class="hljs-params">(android.content.Context r6, java.lang.String r7, java.io.File r8)</span> </span>{<br><br>        java.lang.String r0 = <span class="hljs-string">"vn2022"</span><br>        <span class="hljs-keyword">byte</span>[] r0 = r0.getBytes()<br>        r1 = <span class="hljs-number">0</span><br>        android.content.Context r6 = r6.getApplicationContext()     <span class="hljs-comment">// Catch: IOException -&gt; 0x005a, all -&gt; 0x0056</span><br>        android.content.res.AssetManager r6 = r6.getAssets()     <span class="hljs-comment">// Catch: IOException -&gt; 0x005a, all -&gt; 0x0056</span><br>        java.io.InputStream r6 = r6.open(r7)     <span class="hljs-comment">// Catch: IOException -&gt; 0x005a, all -&gt; 0x0056</span><br>        java.io.FileOutputStream r7 = <span class="hljs-keyword">new</span> java.io.FileOutputStream     <span class="hljs-comment">// Catch: IOException -&gt; 0x0052, all -&gt; 0x004f</span><br>        java.lang.String r8 = r8.getAbsolutePath()     <span class="hljs-comment">// Catch: IOException -&gt; 0x0052, all -&gt; 0x004f</span><br>        r7.&lt;init&gt;(r8)     <span class="hljs-comment">// Catch: IOException -&gt; 0x0052, all -&gt; 0x004f</span><br>        r8 = <span class="hljs-number">1024</span>(<span class="hljs-number">0x400</span>, <span class="hljs-keyword">float</span>:<span class="hljs-number">1.435E-42</span>)<br>        <span class="hljs-keyword">byte</span>[] r8 = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[r8]     <span class="hljs-comment">// Catch: IOException -&gt; 0x004d, all -&gt; 0x004b</span><br>    L_0x0020:<br>        <span class="hljs-keyword">int</span> r1 = r6.read(r8)     <span class="hljs-comment">// Catch: IOException -&gt; 0x004d, all -&gt; 0x004b</span><br>        r2 = -<span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span> (r1 == r2) goto L_0x003f<br>        r2 = <span class="hljs-number">0</span><br>        r3 = <span class="hljs-number">0</span><br>    L_0x0029:<br>        <span class="hljs-keyword">if</span> (r3 &gt;= r1) goto L_0x003b<br>        <span class="hljs-keyword">byte</span> r4 = r8[r3]     <span class="hljs-comment">// Catch: IOException -&gt; 0x004d, all -&gt; 0x004b</span><br>        <span class="hljs-keyword">int</span> r5 = r0.length     <span class="hljs-comment">// Catch: IOException -&gt; 0x004d, all -&gt; 0x004b</span><br>        <span class="hljs-keyword">int</span> r5 = r3 % r5<br>        <span class="hljs-keyword">byte</span> r5 = r0[r5]     <span class="hljs-comment">// Catch: IOException -&gt; 0x004d, all -&gt; 0x004b</span><br>        r4 = r4 ^ r5<br>        r4 = r4 &amp; <span class="hljs-number">255</span>(<span class="hljs-number">0xff</span>, <span class="hljs-keyword">float</span>:<span class="hljs-number">3.57E-43</span>)<br>        <span class="hljs-keyword">byte</span> r4 = (<span class="hljs-keyword">byte</span>) r4     <span class="hljs-comment">// Catch: IOException -&gt; 0x004d, all -&gt; 0x004b</span><br>        r8[r3] = r4     <span class="hljs-comment">// Catch: IOException -&gt; 0x004d, all -&gt; 0x004b</span><br>        <span class="hljs-keyword">int</span> r3 = r3 + <span class="hljs-number">1</span><br>        goto L_0x0029<br>    L_0x003b:<br>        r7.write(r8, r2, r1)     <span class="hljs-comment">// Catch: IOException -&gt; 0x004d, all -&gt; 0x004b</span><br>        goto L_0x0020<br><br></code></pre></td></tr></tbody></table></figure><blockquote><p>æœ‰ç‚¹å°å‘ï¼Œè¿™é‡Œæ˜¯1024byteè¯»å–ä¸€æ¬¡ï¼Œæ¯æ¬¡é‡æ–°å¼€å§‹ä¸vn2022å¼‚æˆ–ï¼Œä¸æ˜¯ç›´æ¥å¼‚æˆ– (å‘æ­»äº†,ç²—å¿ƒ)</p></blockquote><p><code>re dex</code></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python">key=<span class="hljs-string">b'vn2022'</span><br>f1=<span class="hljs-built_in">open</span>(<span class="hljs-string">r'ooo'</span>,<span class="hljs-string">'rb+'</span>)<br>f2=<span class="hljs-built_in">open</span>(<span class="hljs-string">r'111'</span>,<span class="hljs-string">'wb+'</span>)<br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    t=[]<br>    s=f1.read(<span class="hljs-number">1024</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(s)==<span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(s)):<br>       t.append(s[i]^key[i%<span class="hljs-built_in">len</span>(key)])<br>    f2.write(<span class="hljs-built_in">bytes</span>(t))<br></code></pre></td></tr></tbody></table></figure><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220212235258147.png" alt="image-20220212235258147"></p><blockquote><p>ä¸»ä½“æ˜¯XXteaï¼Œå…¶ä½™å°±æ˜¯ä¸€äº› arry2int å°ç«¯åºå˜åŒ– ï¼Œè¯·å‡ºç¥–ä¼ çš„XXTeaè„šæœ¬å³å¯ï¼Œdeltaæ²¡é­”æ”¹(-æ³•è½¬ä¸º+æ³•è¡¥ç æ˜¯ä¸€æ ·çš„)</p></blockquote><p>è·å–keyå’Œenc,å…¶å®å°±æ˜¯å°ç«¯åºè½¬int</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br>a=<span class="hljs-string">b'H4pPY_VNCTF!!OvO'</span><br>r=[<span class="hljs-number">0</span>]*<span class="hljs-number">4</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">16</span>):<br>    i2 = i &gt;&gt; <span class="hljs-number">2</span><br>    r[i2] = r[i2] | ((a[i] &amp; <span class="hljs-number">255</span>) &lt;&lt; ((i &amp; <span class="hljs-number">3</span>) &lt;&lt; <span class="hljs-number">3</span>))<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> r:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(i),end=<span class="hljs-string">','</span>)<br><br><span class="hljs-built_in">print</span>()<br>enc=[<span class="hljs-number">0</span>]*<span class="hljs-number">11</span><br>c=[<span class="hljs-number">0x44</span> ,<span class="hljs-number">0x27</span> ,<span class="hljs-number">0xffffffa4</span> ,<span class="hljs-number">0x6c</span> ,<span class="hljs-number">0xffffffae</span> ,<span class="hljs-number">0xffffffee</span> ,<span class="hljs-number">0x48</span> ,<span class="hljs-number">0xffffffc9</span> ,<span class="hljs-number">0x4a</span> ,<span class="hljs-number">0xffffffc8</span> ,<span class="hljs-number">0x26</span> ,<span class="hljs-number">0x0b</span> ,<span class="hljs-number">0x3c</span> ,<span class="hljs-number">0x54</span> ,<span class="hljs-number">0x61</span> ,<span class="hljs-number">0xffffffd8</span> ,<span class="hljs-number">0x57</span> ,<span class="hljs-number">0x47</span> ,<span class="hljs-number">0x63</span> ,<span class="hljs-number">0xffffffae</span> ,<span class="hljs-number">0x78</span> ,<span class="hljs-number">0x68</span> ,<span class="hljs-number">0x2f</span> ,<span class="hljs-number">0xffffffb9</span> ,<span class="hljs-number">0xffffffc6</span> ,<span class="hljs-number">0xffffffc7</span> ,<span class="hljs-number">0x00</span> ,<span class="hljs-number">0x21</span> ,<span class="hljs-number">0x2a</span> ,<span class="hljs-number">0x26</span> ,<span class="hljs-number">0xffffffd4</span> ,<span class="hljs-number">0xffffffd9</span> ,<span class="hljs-number">0xffffffc4</span> ,<span class="hljs-number">0x71</span> ,<span class="hljs-number">0xfffffffe</span> ,<span class="hljs-number">0x5c</span> ,<span class="hljs-number">0xffffffb5</span> ,<span class="hljs-number">0x76</span> ,<span class="hljs-number">0xffffffb3</span> ,<span class="hljs-number">0x32</span> ,<span class="hljs-number">0xffffff87</span> ,<span class="hljs-number">0x2b</span> ,<span class="hljs-number">0x20</span> ,<span class="hljs-number">0xffffff96</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(c)):<br>    i2 = i &gt;&gt; <span class="hljs-number">2</span><br>    enc[i2] = enc[i2] | ((c[i] &amp; <span class="hljs-number">255</span>) &lt;&lt; ((i &amp; <span class="hljs-number">3</span>) &lt;&lt; <span class="hljs-number">3</span>))<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> enc:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(i),end=<span class="hljs-string">','</span>)<br><span class="hljs-built_in">print</span>()<br>key=[<span class="hljs-number">0x50703448</span>,<span class="hljs-number">0x4e565f59</span>,<span class="hljs-number">0x21465443</span>,<span class="hljs-number">0x4f764f21</span>]<br>enc=[<span class="hljs-number">0x6ca42744</span>,<span class="hljs-number">0xc948eeae</span>,<span class="hljs-number">0xb26c84a</span>,<span class="hljs-number">0xd861543c</span>,<span class="hljs-number">0xae634757</span>,<span class="hljs-number">0xb92f6878</span>,<span class="hljs-number">0x2100c7c6</span>,<span class="hljs-number">0xd9d4262a</span>,<span class="hljs-number">0x5cfe71c4</span>,<span class="hljs-number">0x32b376b5</span>,<span class="hljs-number">0x96202b87</span>]<br></code></pre></td></tr></tbody></table></figure><p><code>XXtea</code></p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs c"><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdint.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DELTA 0x9e3779b9</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MX (((z&gt;&gt;5^y<span class="hljs-meta-string">&lt;&lt;2) + (y&gt;</span>&gt;3^z&lt;&lt;4)) ^ ((sum^y) + (key[(p&amp;3)^e] ^ z)))</span><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">btea</span><span class="hljs-params">(<span class="hljs-keyword">uint32_t</span>* v, <span class="hljs-keyword">int</span> n, <span class="hljs-keyword">uint32_t</span> <span class="hljs-keyword">const</span> key[<span class="hljs-number">4</span>])</span> </span>{<br>    <span class="hljs-keyword">uint32_t</span> y, z, sum;<br>    <span class="hljs-keyword">unsigned</span> p, rounds, e;<br>    <span class="hljs-keyword">if</span> (n &gt; <span class="hljs-number">1</span>) {          <span class="hljs-comment">/* Coding Part */</span><br>        rounds = <span class="hljs-number">6</span> + <span class="hljs-number">52</span> / n; <span class="hljs-comment">//åŠ å¯†è½®æ•°</span><br>        sum = <span class="hljs-number">0</span>;<br>        z = v[n - <span class="hljs-number">1</span>];<br>        <span class="hljs-keyword">do</span> {<br>            sum += DELTA;<br>            e = (sum &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">3</span>;<br>            <span class="hljs-keyword">for</span> (p = <span class="hljs-number">0</span>; p &lt; n - <span class="hljs-number">1</span>; p++) {<br>                y = v[p + <span class="hljs-number">1</span>];<br>                z = v[p] += MX;<br>            }<br>            y = v[<span class="hljs-number">0</span>];<br>            z = v[n - <span class="hljs-number">1</span>] += MX;<br>        } <span class="hljs-keyword">while</span> (--rounds);<br>    }<br><br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (n &lt; <span class="hljs-number">-1</span>) {  <span class="hljs-comment">/* Decoding Part */</span><br>        n = -n;<br>        rounds = <span class="hljs-number">6</span> + <span class="hljs-number">52</span> / n;<br>        sum = rounds * DELTA;<br>        y = v[<span class="hljs-number">0</span>];<br>        <span class="hljs-keyword">do</span> {<br>            e = (sum &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">3</span>;<br>            <span class="hljs-keyword">for</span> (p = n - <span class="hljs-number">1</span>; p &gt; <span class="hljs-number">0</span>; p--) {<br>                z = v[p - <span class="hljs-number">1</span>];<br>                y = v[p] -= MX;<br>            }<br>            z = v[n - <span class="hljs-number">1</span>];<br>            y = v[<span class="hljs-number">0</span>] -= MX;<br>            sum -= DELTA;<br>        } <span class="hljs-keyword">while</span> (--rounds);<br>    }<br>}<br><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{<br>    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> m[<span class="hljs-number">11</span>] = { <span class="hljs-number">0x6ca42744</span>,<span class="hljs-number">0xc948eeae</span>,<span class="hljs-number">0xb26c84a</span>,<span class="hljs-number">0xd861543c</span>,<span class="hljs-number">0xae634757</span>,<span class="hljs-number">0xb92f6878</span>,<span class="hljs-number">0x2100c7c6</span>,<span class="hljs-number">0xd9d4262a</span>,<span class="hljs-number">0x5cfe71c4</span>,<span class="hljs-number">0x32b376b5</span>,<span class="hljs-number">0x96202b87</span> };<br>    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> k[<span class="hljs-number">4</span>] = { <span class="hljs-number">0x50703448</span>,<span class="hljs-number">0x4e565f59</span>,<span class="hljs-number">0x21465443</span>,<span class="hljs-number">0x4f764f21</span> };<br>    btea(m, <span class="hljs-number">-11</span>, k);<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">11</span>; i++) {<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">"0x%x ,"</span>,m[i]);<br>}<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}<br><br><span class="hljs-comment">//VNCTF{93ee7688-f216-42cb-a5c2-191ff4e412ba} </span><br></code></pre></td></tr></tbody></table></figure><h3 id="æ—¶ç©ºé£è¡Œ">æ—¶ç©ºé£è¡Œ</h3><blockquote><p>å¤ªé—æ†¾äº†ï¼Œè¢«C++çš„ç¬¦å·ææ‡µé€¼äº†</p></blockquote><p>é¦–å…ˆæ˜¯æ±‚æ—¥æœŸ,å¤„ç†å‡½æ•°ç±»ä¼¼SM4çš„ç§˜é’¥æ‰©å±•ï¼Œä¸è¿‡Lå‡½æ•°é­”æ”¹äº†</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> __fastcall <span class="hljs-title">SM4_keyInit</span><span class="hljs-params">(_DWORD *a1, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> *a2)</span></span><br><span class="hljs-function"></span>{<br>  <span class="hljs-keyword">int</span> v2; <span class="hljs-comment">// esi</span><br>  <span class="hljs-keyword">int</span> v3; <span class="hljs-comment">// ebx</span><br>  <span class="hljs-keyword">int</span> v4[<span class="hljs-number">36</span>]; <span class="hljs-comment">// [rsp+20h] [rbp-B0h]</span><br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> v5; <span class="hljs-comment">// [rsp+B0h] [rbp-20h]</span><br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> v6; <span class="hljs-comment">// [rsp+B4h] [rbp-1Ch]</span><br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> v7; <span class="hljs-comment">// [rsp+B8h] [rbp-18h]</span><br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> v8; <span class="hljs-comment">// [rsp+BCh] [rbp-14h]</span><br>  <span class="hljs-keyword">int</span> i; <span class="hljs-comment">// [rsp+CCh] [rbp-4h]</span><br><br>  v5 = _byteswap_ulong(*a2);<br>  v6 = _byteswap_ulong(a2[<span class="hljs-number">1</span>]);<br>  v7 = _byteswap_ulong(a2[<span class="hljs-number">2</span>]);<br>  v8 = _byteswap_ulong(a2[<span class="hljs-number">3</span>]);<br>  v4[<span class="hljs-number">0</span>] = v5 ^ <span class="hljs-number">0xA3B1BAC6</span>;<br>  v4[<span class="hljs-number">1</span>] = v6 ^ <span class="hljs-number">0x56AA3350</span>;<br>  v4[<span class="hljs-number">2</span>] = v7 ^ <span class="hljs-number">0x677D9197</span>;<br>  v4[<span class="hljs-number">3</span>] = v8 ^ <span class="hljs-number">0xB27022DC</span>;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">31</span>; ++i )<br>  {<br>    v2 = i + <span class="hljs-number">4</span>;<br>    v3 = v4[i];<br>    v4[v2] = sub_401A3B(v4[i + <span class="hljs-number">3</span>] ^ v4[i + <span class="hljs-number">2</span>] ^ (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)v4[i + <span class="hljs-number">1</span>] ^ CK[i]) ^ v3;<br>    a1[i] = v4[i + <span class="hljs-number">4</span>];<br>  }<br>}<br><br><span class="hljs-function">__int64 __fastcall <span class="hljs-title">sub_401A3B</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a1)</span></span><br><span class="hljs-function"></span>{<br>  <span class="hljs-keyword">return</span> a1 ^ (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)(__ROL4__(a1, <span class="hljs-number">13</span>) ^ __ROR4__(a1, <span class="hljs-number">9</span>));<br>}<br></code></pre></td></tr></tbody></table></figure><p>ç»™å‡ºäº†Rkeyçš„å4ä½ï¼Œç›´æ¥é€†åºå¾€å‰æ¨å³å¯ï¼Œä¸»è¦åŠ å¯†æ˜¯å¼‚æˆ–ï¼Œå…·æœ‰å¯¹ç§°æ€§ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">L</span>(<span class="hljs-params">a</span>):</span><br>    x=((a&lt;&lt;<span class="hljs-number">13</span>)|(a&gt;&gt;(<span class="hljs-number">32</span>-<span class="hljs-number">13</span>)))&amp;<span class="hljs-number">0xffffffff</span><br>    y=((a&gt;&gt;<span class="hljs-number">9</span>)|(a&lt;&lt;(<span class="hljs-number">32</span>-<span class="hljs-number">9</span>)))&amp;<span class="hljs-number">0xffffffff</span><br>    <span class="hljs-keyword">return</span> x^y^a<br>FK=[<span class="hljs-number">0xa3b1bac6</span>, <span class="hljs-number">0x56aa3350</span>, <span class="hljs-number">0x677d9197</span>, <span class="hljs-number">0xb27022dc</span>]<br>CK=[<span class="hljs-number">0x00070E15</span>, <span class="hljs-number">0x1C232A31</span>, <span class="hljs-number">0x383F464D</span>, <span class="hljs-number">0x545B6269</span>, <span class="hljs-number">0x70777E85</span>, <span class="hljs-number">0x8C939AA1</span>, <span class="hljs-number">0xA8AFB6BD</span>, <span class="hljs-number">0xC4CBD2D9</span>,<br>    <span class="hljs-number">0xE0E7EEF5</span>, <span class="hljs-number">0xFC030A11</span>, <span class="hljs-number">0x181F262D</span>, <span class="hljs-number">0x343B4249</span>, <span class="hljs-number">0x50575E65</span>, <span class="hljs-number">0x6C737A81</span>, <span class="hljs-number">0x888F969D</span>, <span class="hljs-number">0xA4ABB2B9</span>,<br>    <span class="hljs-number">0xC0C7CED5</span>, <span class="hljs-number">0xDCE3EAF1</span>, <span class="hljs-number">0xF8FF060D</span>, <span class="hljs-number">0x141B2229</span>, <span class="hljs-number">0x30373E45</span>, <span class="hljs-number">0x4C535A61</span>, <span class="hljs-number">0x686F767D</span>, <span class="hljs-number">0x848B9299</span>,<br>    <span class="hljs-number">0xA0A7AEB5</span>, <span class="hljs-number">0xBCC3CAD1</span>, <span class="hljs-number">0xD8DFE6ED</span>, <span class="hljs-number">0xF4FB0209</span>, <span class="hljs-number">0x10171E25</span>, <span class="hljs-number">0x2C333A41</span>, <span class="hljs-number">0x484F565D</span>, <span class="hljs-number">0x646B7279</span>]<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">change</span>(<span class="hljs-params">k</span>):</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>        k[i]^=FK[i]<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>):<br>        tmp=L(k[i+<span class="hljs-number">1</span>]^k[i+<span class="hljs-number">2</span>]^k[i+<span class="hljs-number">3</span>]^CK[i])<br>        k.append(tmp^k[i])<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>,<span class="hljs-number">36</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(k[i]),end=<span class="hljs-string">','</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">reverse</span>():</span><br>    k=[<span class="hljs-number">0</span>]*<span class="hljs-number">36</span><br>    k[<span class="hljs-number">32</span>] = <span class="hljs-number">0xFD07C452</span><br>    k[<span class="hljs-number">33</span>] = <span class="hljs-number">0xEC90A488</span><br>    k[<span class="hljs-number">34</span>] = <span class="hljs-number">0x68D33CD1</span><br>    k[<span class="hljs-number">35</span>] = <span class="hljs-number">0x96F64587</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">31</span>,-<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>):<br>        tmp=L(k[i+<span class="hljs-number">1</span>]^k[i+<span class="hljs-number">2</span>]^k[i+<span class="hljs-number">3</span>]^CK[i])<br>        k[i]=tmp^k[i+<span class="hljs-number">4</span>]<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>        k[i] ^= FK[i]<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-built_in">int</span>.to_bytes(k[i],<span class="hljs-number">4</span>,<span class="hljs-string">'big'</span>).decode(),end=<span class="hljs-string">''</span>)<br><br>reverse()<br><span class="hljs-comment">#20211205</span><br></code></pre></td></tr></tbody></table></figure><p>ä¹‹ååˆè¿›è¡Œè¾“å…¥ï¼Œç¬¬ä¸€æ¬¡å¤„ç†å‡½æ•°ç±»ä¼¼AESç§˜é’¥æ‰©å±•</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs c">  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">5</span>; ++i )<br>    a1[i] = sub_401E21((<span class="hljs-keyword">char</span> *)(<span class="hljs-number">4</span> * i + a2));   <span class="hljs-comment">// å¤§ç«¯åº</span><br>  v5 = <span class="hljs-number">6</span>;<br>  v3 = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">while</span> ( v5 &lt;= <span class="hljs-number">65</span> )<br>  {<br>    <span class="hljs-keyword">if</span> ( v5 % <span class="hljs-number">6</span> )<br>    {<br>      a1[v5] = a1[v5 - <span class="hljs-number">6</span>] ^ a1[v5 - <span class="hljs-number">1</span>];<br>    }<br>    <span class="hljs-keyword">else</span><br>    {<br>      v2 = a1[v5 - <span class="hljs-number">6</span>];<br>      a1[v5] = v2 ^ sub_401FFB(a1[v5 - <span class="hljs-number">1</span>], v3++);<br>    }<br>    ++v5;<br>  }<br>}<br><br><span class="hljs-function">__int64 __fastcall <span class="hljs-title">sub_401FFB</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> a1, <span class="hljs-keyword">int</span> a2)</span></span><br><span class="hljs-function"></span>{<br>  <span class="hljs-keyword">char</span> v3[<span class="hljs-number">28</span>]; <span class="hljs-comment">// [rsp+20h] [rbp-20h] BYREF</span><br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> v4; <span class="hljs-comment">// [rsp+3Ch] [rbp-4h]</span><br><br>  int_to_array(a1, v3);                         <span class="hljs-comment">// å¤§ç«¯</span><br>  shift_left1(v3, <span class="hljs-number">1</span>i64);<span class="hljs-comment">//å·¦ç§»ä¸€</span><br>  v4 = array_to_int(v3);<span class="hljs-comment">// å¤§ç«¯</span><br>  <span class="hljs-keyword">return</span> v4 ^ round_key[a2];<span class="hljs-comment">//å¼‚æˆ–è½®ç§˜é’¥</span><br>}<br></code></pre></td></tr></tbody></table></figure><p>ä¹‹åè½¬ä¸ºå°ç«¯åºè¿›è¡Œä¸€ä¸ªä¸å¯é€†çš„å¼‚æˆ–å¤„ç†ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">5</span>; ++i )                    <span class="hljs-comment">// æ‰©å±•ä¸º66 v5æ˜¯24ä¸ªå­—èŠ‚</span><br>{<br>  v4[<span class="hljs-number">4</span> * i] = (<span class="hljs-keyword">unsigned</span> __int8)ext_key[i + <span class="hljs-number">60</span>];<br>  v4[<span class="hljs-number">4</span> * i + <span class="hljs-number">1</span>] = (<span class="hljs-keyword">unsigned</span> __int8)BYTE1(ext_key[i + <span class="hljs-number">60</span>]);<br>  v4[<span class="hljs-number">4</span> * i + <span class="hljs-number">2</span>] = (<span class="hljs-keyword">unsigned</span> __int8)BYTE2(ext_key[i + <span class="hljs-number">60</span>]);<br>  v4[<span class="hljs-number">4</span> * i + <span class="hljs-number">3</span>] = HIBYTE(ext_key[i + <span class="hljs-number">60</span>]);<br>}                                             <span class="hljs-comment">// v4æ˜¯æœ€åä¸€è½®key</span><br><span class="hljs-keyword">for</span> ( i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">23</span>; ++i )<br>  v4[i - <span class="hljs-number">1</span>] ^= (v4[i - <span class="hljs-number">1</span>] % <span class="hljs-number">0x12</span>u + v4[i] + <span class="hljs-number">5</span>) ^ <span class="hljs-number">0x41</span>;<br></code></pre></td></tr></tbody></table></figure><p><strong>ä¹‹å‰é‡åˆ°è¿‡ç±»ä¼¼ä¸å¯é€†çš„å¤„ç†ï¼Œå¯ä»¥ç”¨dfsçˆ†ç ´æ‰€æœ‰ç»“æœã€‚</strong></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> struct, copy<br><span class="hljs-comment">#key1='20211205'</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">arr2int</span>(<span class="hljs-params">k</span>):</span>      <span class="hljs-comment">#å°ç«¯</span><br>    m=[<span class="hljs-number">0</span>]*(<span class="hljs-built_in">len</span>(k)//<span class="hljs-number">4</span>)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(k)):<br>        m[i//<span class="hljs-number">4</span>]|=k[i]&lt;&lt;((i&amp;<span class="hljs-number">3</span>)*<span class="hljs-number">8</span>)<br>    <span class="hljs-keyword">return</span> m<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">F</span>(<span class="hljs-params">a,<span class="hljs-built_in">round</span></span>):</span><br>    s=<span class="hljs-built_in">hex</span>(a)[<span class="hljs-number">2</span>:].zfill(<span class="hljs-number">8</span>)<br>    k=[]<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">8</span>,<span class="hljs-number">2</span>): <span class="hljs-comment">#å¤§ç«¯åº</span><br>       k.append(<span class="hljs-built_in">int</span>(s[i:i+<span class="hljs-number">2</span>],<span class="hljs-number">16</span>))<br>    m=[<span class="hljs-number">0</span>]*<span class="hljs-number">4</span><br>    m[<span class="hljs-number">0</span>]=k[<span class="hljs-number">1</span>]<br>    m[<span class="hljs-number">1</span>]=k[<span class="hljs-number">2</span>]<br>    m[<span class="hljs-number">2</span>]=k[<span class="hljs-number">3</span>]<br>    m[<span class="hljs-number">3</span>]=k[<span class="hljs-number">0</span>]<br><br>    ans=<span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>        ans|=m[i]&lt;&lt;((<span class="hljs-number">3</span>-i)*<span class="hljs-number">8</span>)<br><br>    <span class="hljs-keyword">return</span> ans^rk[<span class="hljs-built_in">round</span>]<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dfs_get_cipher2</span>(<span class="hljs-params">k</span>):</span>                                 <span class="hljs-comment"># é€’å½’æšä¸¾æ‰€å¯èƒ½çš„å¯†æ–‡</span><br>    <span class="hljs-keyword">if</span> k == <span class="hljs-number">0</span>:<br>        cipher_list.append(copy.deepcopy(c))<br>        <span class="hljs-keyword">return</span><br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0x100</span>):<br>        <span class="hljs-keyword">if</span> final[k-<span class="hljs-number">1</span>] ==  j^(j%<span class="hljs-number">0x12</span>+c[k] + <span class="hljs-number">5</span>)^<span class="hljs-number">0x41</span> :<br>            c[k-<span class="hljs-number">1</span>] = j<br>            dfs_get_cipher2(k-<span class="hljs-number">1</span>)<br><br>final = <span class="hljs-string">b'%\x15\xdf\xa2\xc0\x93\xad\x14F\xc5\x0f.\x9a\xeb0\xf8 \xe9\xcb\x88\xc6\xbe\x8d\xe3'</span><br>c = [-<span class="hljs-number">1</span>] * <span class="hljs-number">24</span><br>c[<span class="hljs-number">23</span>] = final[<span class="hljs-number">23</span>]<br>cipher_list = []<br>dfs_get_cipher2(<span class="hljs-number">23</span>)<br>k=cipher_list[<span class="hljs-number">0</span>]<br><br>rk=[<span class="hljs-number">0x01000000</span>, <span class="hljs-number">0x02000000</span>, <span class="hljs-number">0x04000000</span>, <span class="hljs-number">0x08000000</span>, <span class="hljs-number">0x10000000</span>, <span class="hljs-number">0x20000000</span>, <span class="hljs-number">0x40000000</span>, <span class="hljs-number">0x80000000</span>, <span class="hljs-number">0x1B000000</span>, <span class="hljs-number">0x36000000</span>]<br><span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> cipher_list:    <br>    m=arr2int(k)<br>    ff=[<span class="hljs-number">0</span>]*<span class="hljs-number">60</span><br>    ff.extend(m)<br><br>    v3=<span class="hljs-number">9</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">59</span>,-<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">if</span> i%<span class="hljs-number">6</span>!=<span class="hljs-number">0</span>:<br>            ff[i]=ff[i+<span class="hljs-number">6</span>]^ff[i+<span class="hljs-number">5</span>]<br>        <span class="hljs-keyword">else</span>:<br>            ff[i]=ff[i+<span class="hljs-number">6</span>]^F(ff[i+<span class="hljs-number">5</span>],v3)<br>            v3-=<span class="hljs-number">1</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">6</span>):<br>       <span class="hljs-keyword">try</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-built_in">int</span>.to_bytes(ff[i],<span class="hljs-number">4</span>,<span class="hljs-string">'big'</span>).decode(),end=<span class="hljs-string">''</span>)<br>       <span class="hljs-keyword">except</span>:<br>           <span class="hljs-keyword">break</span><br>    <span class="hljs-built_in">print</span>()<br><span class="hljs-comment">#VNCTF{TimeFlightMachine}  çˆ†ç ´ç­›é€‰ç»“æœ</span><br><br><span class="hljs-comment">#VNCTF{TimeFl20211205ightMachine}</span><br></code></pre></td></tr></tbody></table></figure><blockquote><p>åŠ å¯†éƒ½æ˜¯å¼‚æˆ–ï¼Œç¬¬ä¸€æ­¥AESç§˜é’¥æ‰©å±•ä¹Ÿæ¯”è¾ƒå®¹æ˜“</p></blockquote><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220213000738274.png" alt="image-20220213000738274" style="zoom:80%;"><p>ä¸è™šæ­¤è¡Œï¼Œåˆ«ç­‰å¶æ¯èã€‚</p><blockquote><p>é•¿è·¯æ¼«æ¼«ï¼Œå†å›é¦–ï¼Œä¾æ—§æ˜¯æ˜”æ—¥é›¶è§£å°‘å¹´ï¼Œå½“ä¸å›å…±å‹‰ï¼Œç»§ç»­å¯»æ‰¾æ–°çš„ç­”æ¡ˆã€‚</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>CTF-WP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Wp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>RE-VMæŠ€æœ¯å…¥é—¨</title>
    <link href="/2022/01/29/RE-VM%E6%8A%80%E6%9C%AF%E5%85%A5%E9%97%A8/"/>
    <url>/2022/01/29/RE-VM%E6%8A%80%E6%9C%AF%E5%85%A5%E9%97%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="VMæŠ€æœ¯çš„åŸç†">VMæŠ€æœ¯çš„åŸç†</h2><p><strong>è™šæ‹Ÿæœºä¿æŠ¤æ˜¯é€šè¿‡å¼€å‘è€…è‡ªå®šçš„ä¸€å¥—opcodeï¼Œç”±è™šæ‹Ÿæœºçš„dispatcherè§£é‡Šæ‰§è¡Œï¼Œä»è€Œèµ·åˆ°ä»£ç æ··æ·†ã€å¢åŠ é€†å‘éš¾åº¦çš„æŠ€æœ¯ã€‚</strong></p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/2055422-20200604223943869-170147777.png" alt="img"></p><p><strong>VM_start:æ˜¯å¯¹è™šæ‹Ÿæœºçš„åˆå§‹åŒ–ã€‚</strong></p><p><strong>VM_dispatcher: è°ƒåº¦å™¨ï¼Œè§£é‡Šop_code,å¹¶é€‰æ‹©ç›¸åº”çš„å‡½æ•°æ‰§è¡Œ,ä¸€èˆ¬ä¸ºswitchè¯­å¥ï¼Œæ ¹æ®åœ°å€ç åˆ¤æ–­ã€‚</strong></p><p><strong>VM_code:ç¨‹åºå¯æ‰§è¡Œä»£ç å½¢æˆçš„æ“ä½œç ã€‚</strong></p><blockquote><p>é€šè¿‡å¯¹HWS-2022çš„babyVMæ¥åˆæ¶‰VMä¿æŠ¤çš„é€†å‘åˆ†æã€‚</p></blockquote><h2 id="BabyVM">BabyVM</h2><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220128224102355.png" alt="image-20220128224102355"></p><p>é¦–å…ˆèŠ±æŒ‡ä»¤ï¼Œé€šè¿‡jz å’Œ jnz è¿ç”¨å®ç°jmpçš„åŠŸèƒ½ï¼Œæœ¬é¢˜å¤šæ¬¡è¿ç”¨è¯¥èŠ±æŒ‡ä»¤ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> idautils<br>adr=<span class="hljs-number">0x00412CC0</span><br>end=<span class="hljs-number">0x00413991</span> <br>tmp=get_bytes(adr,end-adr)<br>tmp=tmp.replace(<span class="hljs-string">b'\x74\x03\x75\x01\xE8'</span>,<span class="hljs-string">b'\x90'</span>*<span class="hljs-number">5</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(tmp)):<br>    PatchByte(adr+i,tmp[i])<br><span class="hljs-built_in">print</span>(<span class="hljs-string">'ok'</span>)    <br></code></pre></td></tr></tbody></table></figure><h3 id="VM-Dispatcher">VM_Dispatcher</h3><p>ä¿®å¤å¥½åå¯ä»¥ç›´æ¥çœ‹åˆ°VM_Dispatcherå‡½æ•°å†…å®¹ï¼Œæ ¹æ®opcodeä¸­çš„åœ°å€ç ä»¥switchå’Œcaseè¯­å¥æ¥æ‰§è¡Œã€‚</p><p>é€šè¿‡åˆ†æä»£ç æ¥ç¡®å®šå˜é‡çš„ç‰¹æ®Šç”¨é€”ï¼Œå¹¶ä¸”å®šä¹‰ç›¸åº”ç»“æ„ä½“ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> __cdecl <span class="hljs-title">VM_Dispatch</span><span class="hljs-params">(_DWORD *a1)</span></span><br><span class="hljs-function"></span>{<br>  __int64 *v1; <span class="hljs-comment">// eax</span><br>  <span class="hljs-keyword">unsigned</span> __int64 v2; <span class="hljs-comment">// kr00_8</span><br>  <span class="hljs-keyword">int</span> v3; <span class="hljs-comment">// eax</span><br>  <span class="hljs-keyword">int</span> v4; <span class="hljs-comment">// ecx</span><br>  <span class="hljs-keyword">int</span> v5; <span class="hljs-comment">// eax</span><br>  <span class="hljs-keyword">int</span> v6; <span class="hljs-comment">// esi</span><br>  <span class="hljs-keyword">int</span> v7; <span class="hljs-comment">// eax</span><br>  <span class="hljs-keyword">int</span> v8; <span class="hljs-comment">// ecx</span><br>  <span class="hljs-keyword">int</span> v9; <span class="hljs-comment">// eax</span><br>  <span class="hljs-keyword">int</span> v10; <span class="hljs-comment">// ecx</span><br>  <span class="hljs-keyword">int</span> v11; <span class="hljs-comment">// esi</span><br>  <span class="hljs-keyword">int</span> v12; <span class="hljs-comment">// ecx</span><br>  <span class="hljs-keyword">int</span> v13; <span class="hljs-comment">// esi</span><br>  <span class="hljs-keyword">int</span> v14; <span class="hljs-comment">// eax</span><br>  <span class="hljs-keyword">int</span> v15; <span class="hljs-comment">// edx</span><br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> v16; <span class="hljs-comment">// ecx</span><br>  <span class="hljs-keyword">int</span> v17; <span class="hljs-comment">// edx</span><br>  __int64 v18; <span class="hljs-comment">// kr08_8</span><br>  <span class="hljs-keyword">int</span> v19; <span class="hljs-comment">// eax</span><br>  __int64 v20; <span class="hljs-comment">// rdi</span><br>  __int64 v21; <span class="hljs-comment">// rdi</span><br>  <span class="hljs-keyword">int</span> v22; <span class="hljs-comment">// eax</span><br>  __int64 v23; <span class="hljs-comment">// kr10_8</span><br>  <span class="hljs-keyword">int</span> v24; <span class="hljs-comment">// eax</span><br>  __int64 v25; <span class="hljs-comment">// rdi</span><br>  __int64 v26; <span class="hljs-comment">// rdi</span><br>  <span class="hljs-keyword">int</span> v27; <span class="hljs-comment">// eax</span><br>  <span class="hljs-keyword">int</span> v28; <span class="hljs-comment">// eax</span><br>  <span class="hljs-keyword">int</span> v29; <span class="hljs-comment">// eax</span><br>  __int64 v30; <span class="hljs-comment">// rax</span><br>  __int64 v31; <span class="hljs-comment">// rax</span><br>  <span class="hljs-keyword">int</span> v32; <span class="hljs-comment">// esi</span><br>  __int64 v33; <span class="hljs-comment">// rax</span><br>  __int64 v34; <span class="hljs-comment">// rax</span><br>  <span class="hljs-keyword">int</span> v35; <span class="hljs-comment">// esi</span><br>  <span class="hljs-keyword">unsigned</span> __int64 v36; <span class="hljs-comment">// rax</span><br>  <span class="hljs-keyword">unsigned</span> __int64 v37; <span class="hljs-comment">// rax</span><br>  <span class="hljs-keyword">int</span> v38; <span class="hljs-comment">// esi</span><br>  <span class="hljs-keyword">unsigned</span> __int64 v39; <span class="hljs-comment">// rax</span><br>  <span class="hljs-keyword">unsigned</span> __int64 v40; <span class="hljs-comment">// rax</span><br>  <span class="hljs-keyword">int</span> v41; <span class="hljs-comment">// esi</span><br>  <span class="hljs-keyword">int</span> v42; <span class="hljs-comment">// edi</span><br>  <span class="hljs-keyword">int</span> v43; <span class="hljs-comment">// eax</span><br>  <span class="hljs-keyword">int</span> v44; <span class="hljs-comment">// esi</span><br>  <span class="hljs-keyword">int</span> v45; <span class="hljs-comment">// eax</span><br>  <span class="hljs-keyword">int</span> v46; <span class="hljs-comment">// edi</span><br>  <span class="hljs-keyword">int</span> v47; <span class="hljs-comment">// eax</span><br>  <span class="hljs-keyword">int</span> v48; <span class="hljs-comment">// esi</span><br>  <span class="hljs-keyword">int</span> v49; <span class="hljs-comment">// eax</span><br>  <span class="hljs-keyword">int</span> v50; <span class="hljs-comment">// edi</span><br>  <span class="hljs-keyword">int</span> v51; <span class="hljs-comment">// eax</span><br>  <span class="hljs-keyword">int</span> v52; <span class="hljs-comment">// esi</span><br>  <span class="hljs-keyword">int</span> v53; <span class="hljs-comment">// eax</span><br>  __int64 v54; <span class="hljs-comment">// kr18_8</span><br>  <span class="hljs-keyword">int</span> v55; <span class="hljs-comment">// eax</span><br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> v56; <span class="hljs-comment">// eax</span><br>  __int64 v57; <span class="hljs-comment">// [esp-10h] [ebp-134h]</span><br>  __int64 v58; <span class="hljs-comment">// [esp-10h] [ebp-134h]</span><br>  __int64 v59; <span class="hljs-comment">// [esp-8h] [ebp-12Ch]</span><br>  <span class="hljs-keyword">int</span> v60; <span class="hljs-comment">// [esp+10h] [ebp-114h]</span><br>  __int64 Inst_op; <span class="hljs-comment">// [esp+108h] [ebp-1Ch]</span><br>  __int64 Lnum; <span class="hljs-comment">// [esp+110h] [ebp-14h]</span><br>  <span class="hljs-keyword">unsigned</span> __int64 Rnum; <span class="hljs-comment">// [esp+118h] [ebp-Ch]</span><br><br>  LODWORD(Reg.RIP) = <span class="hljs-number">0</span>;<br>  HIDWORD(Reg.RIP) = <span class="hljs-number">0</span>;<br>LABEL_2:<br>  <span class="hljs-keyword">while</span> ( a1[<span class="hljs-number">6</span> * LODWORD(Reg.RIP)] != <span class="hljs-number">0x19</span> )    <span class="hljs-comment">// REG15 æ˜¯EIP</span><br>  {<br>    v1 = (__int64 *)&amp;a1[<span class="hljs-number">6</span> * LODWORD(Reg.RIP)];  <span class="hljs-comment">// 4x6=24å­—èŠ‚ æŒ‡ä»¤é•¿åº¦ ä½16å­—èŠ‚åˆ†ä¸ºä¸¤ä¸ªæ“ä½œæ•°</span><br>    Inst_op = *v1;<br>    Lnum = v1[<span class="hljs-number">1</span>];<br>    Rnum = v1[<span class="hljs-number">2</span>];<br>    v2 = __PAIR64__(HIDWORD(Reg.RIP), LODWORD(Reg.RIP)++) + <span class="hljs-number">1</span>;<span class="hljs-comment">// ä¿®æ”¹PC å³EIP</span><br>    HIDWORD(Reg.RIP) = HIDWORD(v2);<br>    <span class="hljs-keyword">switch</span> ( (<span class="hljs-keyword">int</span>)Inst_op )<br>    {<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<br>        *(_QWORD *)(Mem + <span class="hljs-number">8</span> * LODWORD(Reg.R[Lnum])) = Rnum;<span class="hljs-comment">// mov Mem[Reg[Lnum]],Rnum</span><br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>        v5 = Lnum;<br>        LODWORD(Reg.R[v5]) = Rnum;<br>        HIDWORD(Reg.R[v5]) = HIDWORD(Rnum);     <span class="hljs-comment">// mov Reg[Lnum],Rnum</span><br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>        v9 = Lnum;                              <span class="hljs-comment">// mov Reg[Lnum],Reg[Rnum]</span><br>        LODWORD(Reg.R[v9]) = Reg.R[Rnum];<br>        HIDWORD(Reg.R[v9]) = HIDWORD(Reg.R[Rnum]);<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<br>        v6 = <span class="hljs-number">8</span> * LODWORD(Reg.R[Rnum]);          <span class="hljs-comment">// mov Reg[Lnum],Mem[Reg[Rnum]]</span><br>        v7 = Lnum;<br>        v8 = Mem;<br>        LODWORD(Reg.R[v7]) = *(_DWORD *)(Mem + v6);<br>        HIDWORD(Reg.R[v7]) = *(_DWORD *)(v8 + v6 + <span class="hljs-number">4</span>);<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:<br>        v3 = <span class="hljs-number">8</span> * LODWORD(Reg.R[Lnum]);<br>        v4 = Mem;<br>        *(_DWORD *)(Mem + v3) = Reg.R[Rnum];<br>        *(_DWORD *)(v4 + v3 + <span class="hljs-number">4</span>) = HIDWORD(Reg.R[Rnum]);<span class="hljs-comment">// mov Mem[Reg[Lnum]],Reg[Rnum]</span><br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:<br>        v10 = Reg.R[<span class="hljs-number">4</span>];                         <span class="hljs-comment">// Reg[4]åˆå§‹åŒ–æ—¶ä¸º0x100 ç±»ä¼¼ESP</span><br>        v60 = __CFADD__(v10, <span class="hljs-number">1</span>) + HIDWORD(Reg.R[<span class="hljs-number">4</span>]);<span class="hljs-comment">// push Reg[Lnum]</span><br>        LODWORD(Reg.R[<span class="hljs-number">4</span>]) = v10 + <span class="hljs-number">1</span>;<br>        HIDWORD(Reg.R[<span class="hljs-number">4</span>]) = v60;<br>        v11 = <span class="hljs-number">8</span> * (v10 + <span class="hljs-number">1</span>);<br>        v12 = Buffer;<br>        *(_DWORD *)(Buffer + v11) = Reg.R[Lnum];<br>        *(_DWORD *)(v12 + v11 + <span class="hljs-number">4</span>) = HIDWORD(Reg.R[Lnum]);<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">6</span>:<br>        v13 = <span class="hljs-number">8</span> * LODWORD(Reg.R[<span class="hljs-number">4</span>]);<br>        v14 = Lnum;<br>        v15 = Buffer;<br>        LODWORD(Reg.R[v14]) = *(_DWORD *)(Buffer + v13);<span class="hljs-comment">// pop Reg[Lnum]</span><br>        HIDWORD(Reg.R[v14]) = *(_DWORD *)(v15 + v13 + <span class="hljs-number">4</span>);<br>        v16 = Reg.R[<span class="hljs-number">4</span>];<br>        v17 = (__PAIR64__(HIDWORD(Reg.R[<span class="hljs-number">4</span>]), v16) - <span class="hljs-number">1</span>) &gt;&gt; <span class="hljs-number">32</span>;<br>        LODWORD(Reg.R[<span class="hljs-number">4</span>]) = v16 - <span class="hljs-number">1</span>;<br>        HIDWORD(Reg.R[<span class="hljs-number">4</span>]) = v17;<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">7</span>:<br>        v18 = Rnum + __PAIR64__(HIDWORD(Reg.R[Lnum]), Reg.R[Lnum]);<span class="hljs-comment">// add Reg[Lnum],Rnum</span><br>        v19 = Lnum;<br>        LODWORD(Reg.R[v19]) = Rnum + LODWORD(Reg.R[Lnum]);<br>        HIDWORD(Reg.R[v19]) = HIDWORD(v18);<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">8</span>:                                   <span class="hljs-comment">// add Reg[Lnum],Reg[Rnum]</span><br>        LODWORD(v20) = Reg.R[Lnum];<br>        HIDWORD(v20) = HIDWORD(Reg.R[Lnum]);<br>        v21 = __PAIR64__(HIDWORD(Reg.R[Rnum]), Reg.R[Rnum]) + v20;<br>        v22 = Lnum;<br>        LODWORD(Reg.R[v22]) = v21;<br>        HIDWORD(Reg.R[v22]) = HIDWORD(v21);<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">9</span>:<br>        v23 = __PAIR64__(HIDWORD(Reg.R[Lnum]), Reg.R[Lnum]) - Rnum;<span class="hljs-comment">// sub Reg[Lnum],Rnum</span><br>        v24 = Lnum;<br>        LODWORD(Reg.R[v24]) = LODWORD(Reg.R[Lnum]) - Rnum;<br>        HIDWORD(Reg.R[v24]) = HIDWORD(v23);<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">0xA</span>:<br>        LODWORD(v25) = Reg.R[Lnum];<br>        HIDWORD(v25) = HIDWORD(Reg.R[Lnum]);<br>        v26 = v25 - __PAIR64__(HIDWORD(Reg.R[Rnum]), Reg.R[Rnum]);<span class="hljs-comment">// sub Reg[Lnum],Reg[Rnum]</span><br>        v27 = Lnum;<br>        LODWORD(Reg.R[v27]) = v26;<br>        HIDWORD(Reg.R[v27]) = HIDWORD(v26);<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">0xB</span>:<br>        HIDWORD(v57) = HIDWORD(Reg.R[Lnum]);    <span class="hljs-comment">// mul Reg[Lnum],Rnum</span><br>        LODWORD(v57) = Reg.R[Lnum];<br>        v28 = Lnum;<br>        LODWORD(Reg.R[v28]) = v57 * Rnum;<br>        HIDWORD(Reg.R[v28]) = (v57 * Rnum) &gt;&gt; <span class="hljs-number">32</span>;<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">0xC</span>:<br>        HIDWORD(v59) = HIDWORD(Reg.R[Rnum]);<br>        LODWORD(v59) = Reg.R[Rnum];<br>        HIDWORD(v58) = HIDWORD(Reg.R[Lnum]);<br>        LODWORD(v58) = Reg.R[Lnum];<br>        v29 = Lnum;<br>        LODWORD(Reg.R[v29]) = v58 * v59;<br>        HIDWORD(Reg.R[v29]) = (<span class="hljs-keyword">unsigned</span> __int64)(v58 * v59) &gt;&gt; <span class="hljs-number">32</span>;<span class="hljs-comment">// mul Reg[Lnum],Reg[Rnum]</span><br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">0xD</span>:<br>        LODWORD(v30) = Reg.R[Lnum];<br>        HIDWORD(v30) = HIDWORD(Reg.R[Lnum]);<br>        v31 = v30 &lt;&lt; Rnum;<br>        v32 = v31;<br>        LODWORD(v31) = <span class="hljs-number">8</span> * Lnum;<br>        *(_DWORD *)((<span class="hljs-keyword">char</span> *)Reg.R + v31) = v32;<br>        *(_DWORD *)((<span class="hljs-keyword">char</span> *)Reg.R + v31 + <span class="hljs-number">4</span>) = HIDWORD(v31);<span class="hljs-comment">// shl Reg[Lnum],Rnum</span><br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">0xE</span>:<br>        LODWORD(v33) = Reg.R[Lnum];<br>        HIDWORD(v33) = HIDWORD(Reg.R[Lnum]);<br>        v34 = v33 &lt;&lt; LODWORD(Reg.R[Rnum]);<br>        v35 = v34;<br>        LODWORD(v34) = <span class="hljs-number">8</span> * Lnum;<br>        *(_DWORD *)((<span class="hljs-keyword">char</span> *)Reg.R + v34) = v35;<br>        *(_DWORD *)((<span class="hljs-keyword">char</span> *)Reg.R + v34 + <span class="hljs-number">4</span>) = HIDWORD(v34);<span class="hljs-comment">// shl Reg[Lnum],Reg[Rnum]</span><br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">0xF</span>:<br>        LODWORD(v36) = Reg.R[Lnum];             <span class="hljs-comment">// shr Reg[Lnum],Rnum</span><br>        HIDWORD(v36) = HIDWORD(Reg.R[Lnum]);<br>        v37 = v36 &gt;&gt; Rnum;<br>        v38 = v37;<br>        LODWORD(v37) = <span class="hljs-number">8</span> * Lnum;<br>        *(_DWORD *)((<span class="hljs-keyword">char</span> *)Reg.R + v37) = v38;<br>        *(_DWORD *)((<span class="hljs-keyword">char</span> *)Reg.R + v37 + <span class="hljs-number">4</span>) = HIDWORD(v37);<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">0x10</span>:                                <span class="hljs-comment">// shr Reg[Lnum],Reg[Rnum]</span><br>        LODWORD(v39) = Reg.R[Lnum];<br>        HIDWORD(v39) = HIDWORD(Reg.R[Lnum]);<br>        v40 = v39 &gt;&gt; LODWORD(Reg.R[Rnum]);<br>        v41 = v40;<br>        LODWORD(v40) = <span class="hljs-number">8</span> * Lnum;<br>        *(_DWORD *)((<span class="hljs-keyword">char</span> *)Reg.R + v40) = v41;<br>        *(_DWORD *)((<span class="hljs-keyword">char</span> *)Reg.R + v40 + <span class="hljs-number">4</span>) = HIDWORD(v40);<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">0x11</span>:<br>        v42 = HIDWORD(Rnum) ^ HIDWORD(Reg.R[Lnum]);<br>        v43 = Lnum;<br>        LODWORD(Reg.R[v43]) = Rnum ^ LODWORD(Reg.R[Lnum]);<span class="hljs-comment">// xor Reg[Lnum],Rnum</span><br>        HIDWORD(Reg.R[v43]) = v42;<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">0x12</span>:<br>        v44 = HIDWORD(Reg.R[Rnum]) ^ HIDWORD(Reg.R[Lnum]);<span class="hljs-comment">// xor Reg[Lnum],Reg[Rnum]</span><br>        v45 = Lnum;<br>        LODWORD(Reg.R[v45]) = LODWORD(Reg.R[Rnum]) ^ LODWORD(Reg.R[Lnum]);<br>        HIDWORD(Reg.R[v45]) = v44;<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">0x13</span>:<br>        v46 = HIDWORD(Rnum) | HIDWORD(Reg.R[Lnum]);<span class="hljs-comment">// or Reg[Lnum],Rnum</span><br>        v47 = Lnum;<br>        LODWORD(Reg.R[v47]) = Rnum | LODWORD(Reg.R[Lnum]);<br>        HIDWORD(Reg.R[v47]) = v46;<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">0x14</span>:<br>        v48 = HIDWORD(Reg.R[Rnum]) | HIDWORD(Reg.R[Lnum]);<span class="hljs-comment">// or Reg[Lnum],Reg[Rnum]</span><br>        v49 = Lnum;<br>        LODWORD(Reg.R[v49]) = LODWORD(Reg.R[Rnum]) | LODWORD(Reg.R[Lnum]);<br>        HIDWORD(Reg.R[v49]) = v48;<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">0x15</span>:<br>        v50 = HIDWORD(Rnum) &amp; HIDWORD(Reg.R[Lnum]);<span class="hljs-comment">// and Reg[Lnum],Rnum</span><br>        v51 = Lnum;<br>        LODWORD(Reg.R[v51]) = Rnum &amp; LODWORD(Reg.R[Lnum]);<br>        HIDWORD(Reg.R[v51]) = v50;<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">0x16</span>:<br>        v52 = HIDWORD(Reg.R[Rnum]) &amp; HIDWORD(Reg.R[Lnum]);<span class="hljs-comment">// and Reg[Lnum],Reg[Rnum]</span><br>        v53 = Lnum;<br>        LODWORD(Reg.R[v53]) = Reg.R[Rnum] &amp; LODWORD(Reg.R[Lnum]);<br>        HIDWORD(Reg.R[v53]) = v52;<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">0x17</span>:<br>        v54 = getchar();                        <span class="hljs-comment">// Reg[Lnum]=getchar()</span><br>        v55 = Lnum;<br>        LODWORD(Reg.R[v55]) = v54;<br>        HIDWORD(Reg.R[v55]) = HIDWORD(v54);<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">0x18</span>:<br>        <span class="hljs-built_in">putchar</span>(Reg.R[Lnum]);                   <span class="hljs-comment">// putchar(Reg[Lnum])</span><br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">0x1A</span>:<br>        LOBYTE(cmp_bool) = __PAIR64__(HIDWORD(Reg.R[Lnum]), Reg.R[Lnum]) == Rnum;<span class="hljs-comment">// cmp Reg[Lnum],Rnum</span><br>        BYTE1(cmp_bool) = __PAIR64__(HIDWORD(Reg.R[Lnum]), Reg.R[Lnum]) &lt; Rnum;<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">0x1B</span>:<br>        LOBYTE(cmp_bool) = LODWORD(Reg.R[Lnum]) == LODWORD(Reg.R[Rnum]) &amp;&amp; HIDWORD(Reg.R[Lnum]) == HIDWORD(Reg.R[Rnum]);<span class="hljs-comment">// cmp Reg[Lnum],Reg[Rnum]</span><br>        v56 = HIDWORD(Reg.R[Lnum]);<br>        BYTE1(cmp_bool) = v56 &lt;= HIDWORD(Reg.R[Rnum])<br>                       &amp;&amp; (v56 &lt; HIDWORD(Reg.R[Rnum]) || LODWORD(Reg.R[Lnum]) &lt; LODWORD(Reg.R[Rnum]));<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">0x1C</span>:<br>        <span class="hljs-keyword">if</span> ( (<span class="hljs-keyword">unsigned</span> __int8)cmp_bool == <span class="hljs-number">1</span> )   <span class="hljs-comment">// je Lnum</span><br>        {<br>          LODWORD(Reg.RIP) = Lnum;<br>          HIDWORD(Reg.RIP) = HIDWORD(Lnum);<br>        }<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">0x1D</span>:<br>        LODWORD(Reg.RIP) = Lnum;                <span class="hljs-comment">// jmp Lnum</span><br>        HIDWORD(Reg.RIP) = HIDWORD(Lnum);<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">0x1E</span>:<br>        <span class="hljs-keyword">if</span> ( BYTE1(cmp_bool) == <span class="hljs-number">1</span> )             <span class="hljs-comment">// jb Lnum</span><br>        {<br>          LODWORD(Reg.RIP) = Lnum;<br>          HIDWORD(Reg.RIP) = HIDWORD(Lnum);<br>        }<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">0x1F</span>:<br>        <span class="hljs-keyword">if</span> ( !(_BYTE)cmp_bool )                 <span class="hljs-comment">// jne Lnum</span><br>        {<br>          LODWORD(Reg.RIP) = Lnum;<br>          HIDWORD(Reg.RIP) = HIDWORD(Lnum);<br>        }<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">default</span>:<br>        <span class="hljs-keyword">goto</span> LABEL_2;<br>    }<br>  }<br>}<br></code></pre></td></tr></tbody></table></figure><h3 id="IDAå®šä¹‰ç»“æ„ä½“">IDAå®šä¹‰ç»“æ„ä½“</h3><p>è§‚å¯Ÿå„caseå—ç”¨åˆ°çš„å˜é‡å’ŒåŠ¨ä½œï¼Œå› ä¸ºopcodeä¹Ÿæ˜¯è§£é‡Šä¸ºx86çš„æŒ‡ä»¤æ‰§è¡Œï¼Œæ•…è¦ç†Ÿæ‚‰å¸¸ç”¨çš„æ±‡ç¼–æŒ‡ä»¤ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c">v1 = (__int64 *)&amp;a1[<span class="hljs-number">6</span> * LODWORD(Reg.RIP)]; <br>Inst_op = *v1;<br>Lnum = v1[<span class="hljs-number">1</span>];<br>Rnum = v1[<span class="hljs-number">2</span>];<br>v2 = __PAIR64__(HIDWORD(Reg.RIP), LODWORD(Reg.RIP)++) + <span class="hljs-number">1</span>;<br></code></pre></td></tr></tbody></table></figure><p>ç»“åˆæŒ‡ä»¤æ ¼å¼ï¼Œåœ°å€ç å’Œæ“ä½œæ•°ï¼Œåœ¨switchå¼€å§‹å‰çš„åˆå§‹åŠ¨ä½œä¾¿èƒ½ç¡®å®šæŒ‡ä»¤é•¿åº¦ä¸º24Byteå¹¶ä¸”äº†è§£æ•°ç»„çš„å“ªä¸ªå€¼ä¸ºIPã€‚</p><blockquote><p>ç»“åˆåˆ†æç»“æœå®šä¹‰å¦‚ä¸‹ç»“æ„ä½“</p></blockquote><p>VMä¸­çš„å¯„å­˜å™¨ï¼Œæœªå®šä¹‰å‰IDAè¯†åˆ«ä¸ºäº†å¤§å°ä¸º32çš„intæ•°ç»„ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">VM_REG</span>{</span><br>_QWORD REG[<span class="hljs-number">15</span>];<span class="hljs-comment">//ä¹Ÿå¯ä»¥ä¿®æ”¹çš„æ›´è¯¦ç»†ï¼Œæ¯”å¦‚æœ‰æ§åˆ¶å †æ ˆçš„å¯„å­˜å™¨</span><br>_QWORD RIP;<br>}<br></code></pre></td></tr></tbody></table></figure><p>opcodeæŒ‡ä»¤æ ¼å¼,æŒ‡ä»¤é•¿åº¦ä¸º24å­—èŠ‚ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Inst</span>{</span><br>_QWORD adr;<br>    _QWORD Lnum;<br>    _QWORD Rnum;<br>}    <br></code></pre></td></tr></tbody></table></figure><h4 id="way-1">way-1</h4><p><strong>IDA å…·ä½“æ“ä½œï¼Œshift+F9 è¿›å…¥structçª—å£ï¼ŒæŒ‰Insertæ’å…¥ç»“æ„ä½“ï¼Œåœ¨è‡ªå·±å®šä¹‰ç»“æ„ä½“çš„endå¤„æŒ‰då°±èƒ½å¢åŠ å…ƒç´ ï¼Œé€šè¿‡Yé”®å¯ä»¥ä¿®æ”¹æ•°æ®çš„ç±»å‹ï¼Œä¾‹å¦‚æ•°ç»„ï¼Œ_DWORD,_QWORDç­‰,æœ€åå°†æƒ³å®šä¹‰ä¸ºç»“æ„ä½“çš„ä¸€ç‰‡ç©ºé—´çš„é¦–åœ°å€æ”¹ä¸ºè‡ªå·±å®šä¹‰çš„ç»“æ„ä½“ç±»å‹å³å¯ã€‚</strong></p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220128232054510.png" alt="image-20220128232054510"></p><h4 id="way-2">way-2</h4><p><strong>å¦:å¯¼å…¥è‡ªå·±å®šä¹‰å¥½çš„ç»“æ„ä½“ï¼Œshift + F1 ï¼Œä¹‹åinsertï¼ŒæŠŠå†™å¥½çš„cè¯­è¨€çš„ç»“æ„ä½“å¤åˆ¶è¿›å»å³å¯ã€‚</strong></p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220130212048340.png" alt="image-20220130212048340"></p><h3 id="VM-Start">VM_Start</h3><p>æ ¹æ®å¯¹VM_Dispatcherçš„äº¤å‰å¼•ç”¨å‘ç°æœ‰å››ç»„è°ƒç”¨ï¼Œå¹¶ä¸”åœ¨è¿½æº¯ä¸­å‘ç°VMåˆå§‹åŒ–çš„å‡½æ•°ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sub_412BB0</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>{<br>  __CheckForDebuggerJustMyCode(&amp;unk_421002);<br>  Buffer = (<span class="hljs-keyword">int</span>)<span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x8000</span>u);<br>  Mem = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x800000</span>u);<br>  j_memset(&amp;Reg, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(Reg));<br>  j_memset(&amp;cmp_bool, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(cmp_bool));<br>  LODWORD(Reg.R[<span class="hljs-number">4</span>]) = <span class="hljs-number">256</span>;<br>  HIDWORD(Reg.R[<span class="hljs-number">4</span>]) = <span class="hljs-number">0</span>;<br>  j_VM_Dispatch((<span class="hljs-keyword">int</span>)&amp;code_3);<br>  j_VM_Dispatch((<span class="hljs-keyword">int</span>)&amp;code_4);<br>}<br></code></pre></td></tr></tbody></table></figure><p>å¼€è¾Ÿäº†ç¼“å†²åŒºå’Œå†…å­˜ç©ºé—´ï¼Œè¿”å›äº†ç©ºé—´çš„æŒ‡é’ˆï¼Œå¹¶ä¸”å¯¹ç‰¹æ®Šå¯„å­˜å™¨èµ‹å€¼ï¼Œæ¯”å¦‚Reg.R[4]ï¼Œä¹‹ååœ¨æ“æ§åŠ¨æ€ç©ºé—´ä¸­ç”¨åˆ°ï¼Œç±»ä¼¼espã€‚</p><h3 id="VM-Parser">VM_Parser</h3><p>è¯¥é¢˜ç›®çš„opcodeæ¯”è¾ƒå¤šï¼Œå¹¶ä¸”æœ‰4ä¸ªåˆ†æ”¯è°ƒç”¨Dispatchï¼Œopcodeè¢«æ‹†åˆ†æˆå››ç»„ä¾æ¬¡æ‰§è¡Œï¼Œåœ¨å¯¹æ¯æ¡è™šæ‹Ÿæœºè§£é‡ŠæŒ‡ä»¤åˆ†æåä¾¿å¯ç¼–å†™parserè¿˜åŸä¸ºx86çš„æ··ç¼–ä»£ç ï¼Œè¿›è€Œåˆ†æå‡ºä¼ªä»£ç ã€‚</p><p>IDAPYTHON dumpå‡ºopcodeï¼Œç®€æ˜“è„šæœ¬å¦‚ä¸‹</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> idautils<br>adr=<span class="hljs-number">0x0041E000</span><br>end=<span class="hljs-number">0x0041E378</span><br>op=[]<br><span class="hljs-keyword">while</span>(<span class="hljs-literal">True</span>):<br>    op.append([Qword(adr),Qword(adr+<span class="hljs-number">8</span>),Qword(adr+<span class="hljs-number">16</span>)])<br>    <span class="hljs-keyword">if</span>(adr==end):<br>        <span class="hljs-built_in">print</span>(op)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">'yes'</span>)<br>        <span class="hljs-keyword">break</span><br>    adr+=<span class="hljs-number">24</span> <br></code></pre></td></tr></tbody></table></figure><p>æ ¹æ®VM_Dispatchå†™è¿˜åŸparser</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs python">code_1=[[<span class="hljs-number">18</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>], [<span class="hljs-number">18</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">18</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">18</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>], [<span class="hljs-number">18</span>, <span class="hljs-number">6</span>, <span class="hljs-number">6</span>], [<span class="hljs-number">18</span>, <span class="hljs-number">7</span>, <span class="hljs-number">7</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">105</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">110</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">112</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">117</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">6</span>, <span class="hljs-number">116</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">7</span>, <span class="hljs-number">32</span>], [<span class="hljs-number">24</span>, <span class="hljs-number">0</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">24</span>, <span class="hljs-number">1</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">24</span>, <span class="hljs-number">2</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">24</span>, <span class="hljs-number">3</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">24</span>, <span class="hljs-number">6</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">24</span>, <span class="hljs-number">7</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">102</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">108</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">97</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">103</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">6</span>, <span class="hljs-number">58</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">7</span>, <span class="hljs-number">32</span>], [<span class="hljs-number">24</span>, <span class="hljs-number">0</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">24</span>, <span class="hljs-number">1</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">24</span>, <span class="hljs-number">2</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">24</span>, <span class="hljs-number">3</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">24</span>, <span class="hljs-number">6</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">24</span>, <span class="hljs-number">7</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">18</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">23</span>, <span class="hljs-number">0</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">5</span>, <span class="hljs-number">0</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">26</span>, <span class="hljs-number">1</span>, <span class="hljs-number">38</span>], [<span class="hljs-number">30</span>, <span class="hljs-number">31</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">25</span>, <span class="hljs-number">18446744073709551615</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">18</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>]]<br><span class="hljs-comment">#è¾“å…¥å¹¶checké•¿åº¦</span><br>code_2=[[<span class="hljs-number">6</span>, <span class="hljs-number">0</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">26</span>, <span class="hljs-number">0</span>, <span class="hljs-number">125</span>], [<span class="hljs-number">28</span>, <span class="hljs-number">18</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">119</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">114</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">111</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">110</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">6</span>, <span class="hljs-number">103</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">7</span>, <span class="hljs-number">33</span>], [<span class="hljs-number">24</span>, <span class="hljs-number">0</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">24</span>, <span class="hljs-number">1</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">24</span>, <span class="hljs-number">2</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">24</span>, <span class="hljs-number">3</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">24</span>, <span class="hljs-number">6</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">24</span>, <span class="hljs-number">7</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">10</span>], [<span class="hljs-number">24</span>, <span class="hljs-number">0</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">25</span>, <span class="hljs-number">18446744073709551615</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">8</span>, <span class="hljs-number">256</span>], [<span class="hljs-number">26</span>, <span class="hljs-number">8</span>, <span class="hljs-number">225</span>], [<span class="hljs-number">30</span>, <span class="hljs-number">25</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">6</span>, <span class="hljs-number">0</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">4</span>, <span class="hljs-number">8</span>, <span class="hljs-number">0</span>], [<span class="hljs-number">9</span>, <span class="hljs-number">8</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">29</span>, <span class="hljs-number">19</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">6</span>, <span class="hljs-number">0</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">26</span>, <span class="hljs-number">0</span>, <span class="hljs-number">123</span>], [<span class="hljs-number">31</span>, <span class="hljs-number">3</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">6</span>, <span class="hljs-number">0</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">26</span>, <span class="hljs-number">0</span>, <span class="hljs-number">103</span>], [<span class="hljs-number">31</span>, <span class="hljs-number">3</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">6</span>, <span class="hljs-number">0</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">26</span>, <span class="hljs-number">0</span>, <span class="hljs-number">97</span>], [<span class="hljs-number">31</span>, <span class="hljs-number">3</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">6</span>, <span class="hljs-number">0</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">26</span>, <span class="hljs-number">0</span>, <span class="hljs-number">108</span>], [<span class="hljs-number">31</span>, <span class="hljs-number">3</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">6</span>, <span class="hljs-number">0</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">26</span>, <span class="hljs-number">0</span>, <span class="hljs-number">102</span>], [<span class="hljs-number">31</span>, <span class="hljs-number">3</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">18</span>, <span class="hljs-number">9</span>, <span class="hljs-number">9</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">10</span>, <span class="hljs-number">225</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">7</span>, <span class="hljs-number">9</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">10</span>], [<span class="hljs-number">17</span>, <span class="hljs-number">6</span>, <span class="hljs-number">66</span>], [<span class="hljs-number">13</span>, <span class="hljs-number">6</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">27</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>], [<span class="hljs-number">31</span>, <span class="hljs-number">3</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">9</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">10</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">26</span>, <span class="hljs-number">9</span>, <span class="hljs-number">32</span>], [<span class="hljs-number">30</span>, <span class="hljs-number">42</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">99</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">111</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">114</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">114</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">6</span>, <span class="hljs-number">101</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">7</span>, <span class="hljs-number">99</span>], [<span class="hljs-number">24</span>, <span class="hljs-number">0</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">24</span>, <span class="hljs-number">1</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">24</span>, <span class="hljs-number">2</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">24</span>, <span class="hljs-number">3</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">24</span>, <span class="hljs-number">6</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">24</span>, <span class="hljs-number">7</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">116</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">108</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">121</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">33</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">6</span>, <span class="hljs-number">10</span>], [<span class="hljs-number">24</span>, <span class="hljs-number">0</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">24</span>, <span class="hljs-number">1</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">24</span>, <span class="hljs-number">2</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">24</span>, <span class="hljs-number">3</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">24</span>, <span class="hljs-number">6</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">25</span>, <span class="hljs-number">18446744073709551615</span>, <span class="hljs-number">18446744073709551615</span>]]<br><span class="hljs-comment">#å¯¹è¾“å…¥å­—ç¬¦ä¸²è¿›è¡Œå¤„ç†</span><br>code_3=[[<span class="hljs-number">18</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">255</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">547</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">571</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">567</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">567</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">587</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">555</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">251</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">555</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">547</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">591</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">239</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">567</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">239</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">591</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">591</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">547</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">547</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">571</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">567</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">255</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">563</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">563</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">563</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">567</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">587</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">563</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">591</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">555</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">555</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">587</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">239</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">25</span>, <span class="hljs-number">18446744073709551615</span>, <span class="hljs-number">18446744073709551615</span>]]<br><span class="hljs-comment">#æ¯”å¯¹çš„å¯†æ–‡</span><br>code_4=[[<span class="hljs-number">18</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">9</span>, <span class="hljs-number">0</span>, <span class="hljs-number">99</span>], [<span class="hljs-number">4</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">26</span>, <span class="hljs-number">2</span>, <span class="hljs-number">32</span>], [<span class="hljs-number">30</span>, <span class="hljs-number">1</span>, <span class="hljs-number">18446744073709551615</span>], [<span class="hljs-number">25</span>, <span class="hljs-number">18446744073709551615</span>, <span class="hljs-number">18446744073709551615</span>]]<br><span class="hljs-comment">#å¯¹å¯†æ–‡å¤„ç†</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">VM_Parser</span>(<span class="hljs-params">op</span>):</span><br>    VM_Inst={<br>        <span class="hljs-number">0</span>:<span class="hljs-string">"mov Mem[Reg[{Lnum}]] , {Rnum}"</span>,<br>        <span class="hljs-number">1</span>:<span class="hljs-string">"mov Reg[{Lnum}] , {Rnum}"</span> ,<br>        <span class="hljs-number">2</span>:<span class="hljs-string">"mov Reg[{Lnum}] , Reg[{Rnum}]"</span> ,<br>        <span class="hljs-number">3</span>:<span class="hljs-string">"mov Reg[{Lnum}] , Mem[Reg[{Rnum}]]"</span>,<br>        <span class="hljs-number">4</span>:<span class="hljs-string">"mov Mem[Reg[{Lnum}]] , Reg[{Rnum}]"</span>,<br>        <span class="hljs-number">5</span>:<span class="hljs-string">"push Reg[{Lnum}]"</span>,<br>        <span class="hljs-number">6</span>:<span class="hljs-string">"pop  Reg[{Lnum}]"</span>,<br>        <span class="hljs-number">7</span>:<span class="hljs-string">"add Reg[{Lnum}] , {Rnum}"</span>,<br>        <span class="hljs-number">8</span>:<span class="hljs-string">"add Reg[{Lnum}] , Reg[{Rnum}]"</span>,<br>        <span class="hljs-number">9</span>:<span class="hljs-string">"sub Reg[{Lnum}] , {Rnum}"</span>,<br>        <span class="hljs-number">0xA</span>:<span class="hljs-string">"sub Reg[{Lnum}] , Reg[{Rnum}]"</span>,<br>        <span class="hljs-number">0xB</span>:<span class="hljs-string">"mul Reg[{Lnum}] , {Rnum}"</span>,<br>        <span class="hljs-number">0xC</span>:<span class="hljs-string">"mul Reg[{Lnum}] , Reg[{Rnum}]"</span>,<br>        <span class="hljs-number">0xD</span>:<span class="hljs-string">"shl Reg[{Lnum}] , {Rnum}"</span>,<br>        <span class="hljs-number">0xE</span>:<span class="hljs-string">"shl Reg[{Lnum}] , Reg[{Rnum}]"</span>,<br>        <span class="hljs-number">0xF</span>:<span class="hljs-string">"shr Reg[{Lnum}] , {Rnum}"</span>,<br>        <span class="hljs-number">0x11</span>:<span class="hljs-string">"xor Reg[{Lnum}] , {Rnum}"</span>,<br>        <span class="hljs-number">0x12</span>:<span class="hljs-string">"xor Reg[{Lnum}] , Reg[{Rnum}]"</span>,<br>        <span class="hljs-number">0x13</span>:<span class="hljs-string">"or  Reg[{Lnum}] , {Rnum}"</span>,<br>        <span class="hljs-number">0x14</span>:<span class="hljs-string">"or  Reg[{Lnum}] , Reg[{Rnum}]"</span>,<br>        <span class="hljs-number">0x15</span>:<span class="hljs-string">"and Reg[{Lnum}] , {Rnum}"</span>,<br>        <span class="hljs-number">0x16</span>:<span class="hljs-string">"and Reg[{Lnum}] , Reg[{Rnum}]"</span>,<br>        <span class="hljs-number">0x17</span>:<span class="hljs-string">"Reg[{Lnum}] = getchar()"</span>,<br>        <span class="hljs-number">0x18</span>:<span class="hljs-string">"putchar() = Reg[{Lnum}]"</span>,<br>        <span class="hljs-number">0x19</span>:<span class="hljs-string">"exit()"</span>,<br>        <span class="hljs-number">0x1A</span>:<span class="hljs-string">"cmp Reg[{Lnum}] , {Rnum}"</span>,<br>        <span class="hljs-number">0x1B</span>:<span class="hljs-string">"cmp Reg[{Lnum}] , Reg[{Rnum}]"</span>,<br>        <span class="hljs-number">0x1C</span>:<span class="hljs-string">"je  {Lnum}"</span>,<br>        <span class="hljs-number">0x1D</span>:<span class="hljs-string">"jmp {Lnum}"</span>,<br>        <span class="hljs-number">0x1E</span>: <span class="hljs-string">"jb  {Lnum}"</span>,<br>        <span class="hljs-number">0x1F</span>:<span class="hljs-string">"jne {Lnum}"</span><br><br>    }<br>    tmp = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(op)):<br>         Inst=op[i]<br>         adr=Inst[<span class="hljs-number">0</span>]<br>         Lnum=Inst[<span class="hljs-number">1</span>]<br>         Rnum=Inst[<span class="hljs-number">2</span>]<br>         <span class="hljs-comment">#if(adr==0): #dumpæ¯”å¯¹å¯†æ–‡</span><br>         <span class="hljs-comment">#   tmp.append(Rnum)</span><br>         <span class="hljs-built_in">print</span>(<span class="hljs-string">'%s: '</span>%<span class="hljs-built_in">hex</span>(i)+VM_Inst[adr].<span class="hljs-built_in">format</span>(Lnum=<span class="hljs-built_in">hex</span>(Lnum),Rnum=<span class="hljs-built_in">hex</span>(Rnum)).replace(<span class="hljs-string">'[0x'</span>,<span class="hljs-string">'['</span>))<br>    <span class="hljs-comment">#print(tmp)</span><br>VM_Parser(code_1)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">'------code_end------'</span>)<br>VM_Parser(code_2)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">'------code_end------'</span>)<br>VM_Parser(code_3)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">'------code_end------'</span>)<br>VM_Parser(code_4)<br></code></pre></td></tr></tbody></table></figure><h3 id="åˆ†æç®—æ³•">åˆ†æç®—æ³•</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-number">0x0</span>: <span class="hljs-keyword">xor</span> Reg[<span class="hljs-number">0</span>] , Reg[<span class="hljs-number">0</span>]<br><span class="hljs-number">0x1</span>: <span class="hljs-keyword">xor</span> Reg[<span class="hljs-number">1</span>] , Reg[<span class="hljs-number">1</span>]<br><span class="hljs-number">0x2</span>: <span class="hljs-keyword">xor</span> Reg[<span class="hljs-number">2</span>] , Reg[<span class="hljs-number">2</span>]<br><span class="hljs-number">0x3</span>: <span class="hljs-keyword">xor</span> Reg[<span class="hljs-number">3</span>] , Reg[<span class="hljs-number">3</span>]<br><span class="hljs-number">0x4</span>: <span class="hljs-keyword">xor</span> Reg[<span class="hljs-number">6</span>] , Reg[<span class="hljs-number">6</span>]<br><span class="hljs-number">0x5</span>: <span class="hljs-keyword">xor</span> Reg[<span class="hljs-number">7</span>] , Reg[<span class="hljs-number">7</span>]<br><span class="hljs-number">0x6</span>: mov Reg[<span class="hljs-number">0</span>] , <span class="hljs-number">0x69</span><br><span class="hljs-number">0x7</span>: mov Reg[<span class="hljs-number">1</span>] , <span class="hljs-number">0x6e</span><br><span class="hljs-number">0x8</span>: mov Reg[<span class="hljs-number">2</span>] , <span class="hljs-number">0x70</span><br><span class="hljs-number">0x9</span>: mov Reg[<span class="hljs-number">3</span>] , <span class="hljs-number">0x75</span><br><span class="hljs-number">0xa</span>: mov Reg[<span class="hljs-number">6</span>] , <span class="hljs-number">0x74</span><br><span class="hljs-number">0xb</span>: mov Reg[<span class="hljs-number">7</span>] , <span class="hljs-number">0x20</span><br><span class="hljs-number">0xc</span>: <span class="hljs-built_in">putchar</span>() = Reg[<span class="hljs-number">0</span>]<br><span class="hljs-number">0xd</span>: <span class="hljs-built_in">putchar</span>() = Reg[<span class="hljs-number">1</span>]<br><span class="hljs-number">0xe</span>: <span class="hljs-built_in">putchar</span>() = Reg[<span class="hljs-number">2</span>]<br><span class="hljs-number">0xf</span>: <span class="hljs-built_in">putchar</span>() = Reg[<span class="hljs-number">3</span>]<br><span class="hljs-number">0x10</span>: <span class="hljs-built_in">putchar</span>() = Reg[<span class="hljs-number">6</span>]<br><span class="hljs-number">0x11</span>: <span class="hljs-built_in">putchar</span>() = Reg[<span class="hljs-number">7</span>]<br><span class="hljs-number">0x12</span>: mov Reg[<span class="hljs-number">0</span>] , <span class="hljs-number">0x66</span><br><span class="hljs-number">0x13</span>: mov Reg[<span class="hljs-number">1</span>] , <span class="hljs-number">0x6c</span><br><span class="hljs-number">0x14</span>: mov Reg[<span class="hljs-number">2</span>] , <span class="hljs-number">0x61</span><br><span class="hljs-number">0x15</span>: mov Reg[<span class="hljs-number">3</span>] , <span class="hljs-number">0x67</span><br><span class="hljs-number">0x16</span>: mov Reg[<span class="hljs-number">6</span>] , <span class="hljs-number">0x3a</span><br><span class="hljs-number">0x17</span>: mov Reg[<span class="hljs-number">7</span>] , <span class="hljs-number">0x20</span><br><span class="hljs-number">0x18</span>: <span class="hljs-built_in">putchar</span>() = Reg[<span class="hljs-number">0</span>]<br><span class="hljs-number">0x19</span>: <span class="hljs-built_in">putchar</span>() = Reg[<span class="hljs-number">1</span>]<br><span class="hljs-number">0x1a</span>: <span class="hljs-built_in">putchar</span>() = Reg[<span class="hljs-number">2</span>]<br><span class="hljs-number">0x1b</span>: <span class="hljs-built_in">putchar</span>() = Reg[<span class="hljs-number">3</span>]<br><span class="hljs-number">0x1c</span>: <span class="hljs-built_in">putchar</span>() = Reg[<span class="hljs-number">6</span>]<br><span class="hljs-number">0x1d</span>: <span class="hljs-built_in">putchar</span>() = Reg[<span class="hljs-number">7</span>]<br><span class="hljs-number">0x1e</span>: <span class="hljs-keyword">xor</span> Reg[<span class="hljs-number">1</span>] , Reg[<span class="hljs-number">1</span>]<br><span class="hljs-number">0x1f</span>: Reg[<span class="hljs-number">0</span>] = getchar()<br><span class="hljs-number">0x20</span>: push Reg[<span class="hljs-number">0</span>]           <span class="hljs-comment">//flagå…¥æ ˆ</span><br><span class="hljs-number">0x21</span>: add Reg[<span class="hljs-number">1</span>] , <span class="hljs-number">0x1</span><br><span class="hljs-number">0x22</span>: cmp Reg[<span class="hljs-number">1</span>] , <span class="hljs-number">0x26</span>     <span class="hljs-comment">//checké•¿åº¦</span><br><span class="hljs-number">0x23</span>: jb  <span class="hljs-number">0x1f</span><br><span class="hljs-number">0x24</span>: <span class="hljs-built_in">exit</span>()<br><span class="hljs-number">0x25</span>: <span class="hljs-keyword">xor</span> Reg[<span class="hljs-number">2</span>] , Reg[<span class="hljs-number">2</span>]<br>------code_end------<br><span class="hljs-number">0x0</span>: pop  Reg[<span class="hljs-number">0</span>]             <span class="hljs-comment">//æ£€æµ‹flagå°¾éƒ¨æ˜¯å¦ä¸º}</span><br><span class="hljs-number">0x1</span>: cmp Reg[<span class="hljs-number">0</span>] , <span class="hljs-number">0x7d</span> <br><span class="hljs-number">0x2</span>: je  <span class="hljs-number">0x12</span><br><span class="hljs-number">0x3</span>: mov Reg[<span class="hljs-number">0</span>] , <span class="hljs-number">0x77</span> <br><span class="hljs-number">0x4</span>: mov Reg[<span class="hljs-number">1</span>] , <span class="hljs-number">0x72</span><br><span class="hljs-number">0x5</span>: mov Reg[<span class="hljs-number">2</span>] , <span class="hljs-number">0x6f</span><br><span class="hljs-number">0x6</span>: mov Reg[<span class="hljs-number">3</span>] , <span class="hljs-number">0x6e</span><br><span class="hljs-number">0x7</span>: mov Reg[<span class="hljs-number">6</span>] , <span class="hljs-number">0x67</span><br><span class="hljs-number">0x8</span>: mov Reg[<span class="hljs-number">7</span>] , <span class="hljs-number">0x21</span><br><span class="hljs-number">0x9</span>: <span class="hljs-built_in">putchar</span>() = Reg[<span class="hljs-number">0</span>]<br><span class="hljs-number">0xa</span>: <span class="hljs-built_in">putchar</span>() = Reg[<span class="hljs-number">1</span>]<br><span class="hljs-number">0xb</span>: <span class="hljs-built_in">putchar</span>() = Reg[<span class="hljs-number">2</span>]<br><span class="hljs-number">0xc</span>: <span class="hljs-built_in">putchar</span>() = Reg[<span class="hljs-number">3</span>]<br><span class="hljs-number">0xd</span>: <span class="hljs-built_in">putchar</span>() = Reg[<span class="hljs-number">6</span>]<br><span class="hljs-number">0xe</span>: <span class="hljs-built_in">putchar</span>() = Reg[<span class="hljs-number">7</span>]<br><span class="hljs-number">0xf</span>: mov Reg[<span class="hljs-number">0</span>] , <span class="hljs-number">0xa</span><br><span class="hljs-number">0x10</span>: <span class="hljs-built_in">putchar</span>() = Reg[<span class="hljs-number">0</span>]<br><span class="hljs-number">0x11</span>: <span class="hljs-built_in">exit</span>()<br><span class="hljs-number">0x12</span>: mov Reg[<span class="hljs-number">8</span>] , <span class="hljs-number">0x100</span><br><span class="hljs-number">0x13</span>: cmp Reg[<span class="hljs-number">8</span>] , <span class="hljs-number">0xe1</span><br><span class="hljs-number">0x14</span>: jb  <span class="hljs-number">0x19</span><br><span class="hljs-number">0x15</span>: pop  Reg[<span class="hljs-number">0</span>]<br><span class="hljs-number">0x16</span>: mov Mem[Reg[<span class="hljs-number">8</span>]] , Reg[<span class="hljs-number">0</span>]<br><span class="hljs-number">0x17</span>: sub Reg[<span class="hljs-number">8</span>] , <span class="hljs-number">0x1</span><br><span class="hljs-number">0x18</span>: jmp <span class="hljs-number">0x13</span><br><span class="hljs-number">0x19</span>: pop  Reg[<span class="hljs-number">0</span>]<br><span class="hljs-number">0x1a</span>: cmp Reg[<span class="hljs-number">0</span>] , <span class="hljs-number">0x7b</span><br><span class="hljs-number">0x1b</span>: jne <span class="hljs-number">0x3</span><br><span class="hljs-number">0x1c</span>: pop  Reg[<span class="hljs-number">0</span>]<br><span class="hljs-number">0x1d</span>: cmp Reg[<span class="hljs-number">0</span>] , <span class="hljs-number">0x67</span><br><span class="hljs-number">0x1e</span>: jne <span class="hljs-number">0x3</span><br><span class="hljs-number">0x1f</span>: pop  Reg[<span class="hljs-number">0</span>]<br><span class="hljs-number">0x20</span>: cmp Reg[<span class="hljs-number">0</span>] , <span class="hljs-number">0x61</span><br><span class="hljs-number">0x21</span>: jne <span class="hljs-number">0x3</span><br><span class="hljs-number">0x22</span>: pop  Reg[<span class="hljs-number">0</span>]<br><span class="hljs-number">0x23</span>: cmp Reg[<span class="hljs-number">0</span>] , <span class="hljs-number">0x6c</span><br><span class="hljs-number">0x24</span>: jne <span class="hljs-number">0x3</span><br><span class="hljs-number">0x25</span>: pop  Reg[<span class="hljs-number">0</span>]<br><span class="hljs-number">0x26</span>: cmp Reg[<span class="hljs-number">0</span>] , <span class="hljs-number">0x66</span>   <span class="hljs-comment">//æ£€æµ‹flagå¤´</span><br><span class="hljs-number">0x27</span>: jne <span class="hljs-number">0x3</span><br><span class="hljs-number">0x28</span>: <span class="hljs-keyword">xor</span> Reg[<span class="hljs-number">9</span>] , Reg[<span class="hljs-number">9</span>]<br><span class="hljs-number">0x29</span>: mov Reg[a] , <span class="hljs-number">0xe1</span><br><span class="hljs-number">0x2a</span>: mov Reg[<span class="hljs-number">7</span>] , Mem[Reg[<span class="hljs-number">9</span>]]<br><span class="hljs-number">0x2b</span>: mov Reg[<span class="hljs-number">6</span>] , Mem[Reg[a]]<br><span class="hljs-number">0x2c</span>: <span class="hljs-keyword">xor</span> Reg[<span class="hljs-number">6</span>] , <span class="hljs-number">0x42</span>            <span class="hljs-comment">//a[i]^=0x42 ä¹‹å a[i]&lt;&lt;=2</span><br><span class="hljs-number">0x2d</span>: shl Reg[<span class="hljs-number">6</span>] , <span class="hljs-number">0x2</span><br><span class="hljs-number">0x2e</span>: cmp Reg[<span class="hljs-number">6</span>] , Reg[<span class="hljs-number">7</span>]<br><span class="hljs-number">0x2f</span>: jne <span class="hljs-number">0x3</span><br><span class="hljs-number">0x30</span>: add Reg[<span class="hljs-number">9</span>] , <span class="hljs-number">0x1</span><br><span class="hljs-number">0x31</span>: add Reg[a] , <span class="hljs-number">0x1</span><br><span class="hljs-number">0x32</span>: cmp Reg[<span class="hljs-number">9</span>] , <span class="hljs-number">0x20</span>   <span class="hljs-comment">//flagçš„å†…å®¹è¿›è¡Œå˜æ¢</span><br><span class="hljs-number">0x33</span>: jb  <span class="hljs-number">0x2a</span><br><span class="hljs-number">0x34</span>: mov Reg[<span class="hljs-number">0</span>] , <span class="hljs-number">0x63</span><br><span class="hljs-number">0x35</span>: mov Reg[<span class="hljs-number">1</span>] , <span class="hljs-number">0x6f</span><br><span class="hljs-number">0x36</span>: mov Reg[<span class="hljs-number">2</span>] , <span class="hljs-number">0x72</span><br><span class="hljs-number">0x37</span>: mov Reg[<span class="hljs-number">3</span>] , <span class="hljs-number">0x72</span><br><span class="hljs-number">0x38</span>: mov Reg[<span class="hljs-number">6</span>] , <span class="hljs-number">0x65</span><br><span class="hljs-number">0x39</span>: mov Reg[<span class="hljs-number">7</span>] , <span class="hljs-number">0x63</span><br><span class="hljs-number">0x3a</span>: <span class="hljs-built_in">putchar</span>() = Reg[<span class="hljs-number">0</span>]<br><span class="hljs-number">0x3b</span>: <span class="hljs-built_in">putchar</span>() = Reg[<span class="hljs-number">1</span>]<br><span class="hljs-number">0x3c</span>: <span class="hljs-built_in">putchar</span>() = Reg[<span class="hljs-number">2</span>]<br><span class="hljs-number">0x3d</span>: <span class="hljs-built_in">putchar</span>() = Reg[<span class="hljs-number">3</span>]<br><span class="hljs-number">0x3e</span>: <span class="hljs-built_in">putchar</span>() = Reg[<span class="hljs-number">6</span>]<br><span class="hljs-number">0x3f</span>: <span class="hljs-built_in">putchar</span>() = Reg[<span class="hljs-number">7</span>]<br><span class="hljs-number">0x40</span>: mov Reg[<span class="hljs-number">0</span>] , <span class="hljs-number">0x74</span><br><span class="hljs-number">0x41</span>: mov Reg[<span class="hljs-number">1</span>] , <span class="hljs-number">0x6c</span><br><span class="hljs-number">0x42</span>: mov Reg[<span class="hljs-number">2</span>] , <span class="hljs-number">0x79</span><br><span class="hljs-number">0x43</span>: mov Reg[<span class="hljs-number">3</span>] , <span class="hljs-number">0x21</span><br><span class="hljs-number">0x44</span>: mov Reg[<span class="hljs-number">6</span>] , <span class="hljs-number">0xa</span><br><span class="hljs-number">0x45</span>: <span class="hljs-built_in">putchar</span>() = Reg[<span class="hljs-number">0</span>]<br><span class="hljs-number">0x46</span>: <span class="hljs-built_in">putchar</span>() = Reg[<span class="hljs-number">1</span>]<br><span class="hljs-number">0x47</span>: <span class="hljs-built_in">putchar</span>() = Reg[<span class="hljs-number">2</span>]<br><span class="hljs-number">0x48</span>: <span class="hljs-built_in">putchar</span>() = Reg[<span class="hljs-number">3</span>]<br><span class="hljs-number">0x49</span>: <span class="hljs-built_in">putchar</span>() = Reg[<span class="hljs-number">6</span>]<br><span class="hljs-number">0x4a</span>: <span class="hljs-built_in">exit</span>()<br>------code_end------<br><span class="hljs-number">0x0</span>: <span class="hljs-keyword">xor</span> Reg[<span class="hljs-number">2</span>] , Reg[<span class="hljs-number">2</span>]          <span class="hljs-comment">//æ¯”å¯¹å¯†æ–‡å­˜å…¥å†…å­˜</span><br><span class="hljs-number">0x1</span>: mov Mem[Reg[<span class="hljs-number">2</span>]] , <span class="hljs-number">0xff</span><br><span class="hljs-number">0x2</span>: add Reg[<span class="hljs-number">2</span>] , <span class="hljs-number">0x1</span><br><span class="hljs-number">0x3</span>: mov Mem[Reg[<span class="hljs-number">2</span>]] , <span class="hljs-number">0x223</span><br><span class="hljs-number">0x4</span>: add Reg[<span class="hljs-number">2</span>] , <span class="hljs-number">0x1</span><br><span class="hljs-number">0x5</span>: mov Mem[Reg[<span class="hljs-number">2</span>]] , <span class="hljs-number">0x23b</span><br><span class="hljs-number">0x6</span>: add Reg[<span class="hljs-number">2</span>] , <span class="hljs-number">0x1</span><br><span class="hljs-number">0x7</span>: mov Mem[Reg[<span class="hljs-number">2</span>]] , <span class="hljs-number">0x237</span><br><span class="hljs-number">0x8</span>: add Reg[<span class="hljs-number">2</span>] , <span class="hljs-number">0x1</span><br><span class="hljs-number">0x9</span>: mov Mem[Reg[<span class="hljs-number">2</span>]] , <span class="hljs-number">0x237</span><br><span class="hljs-number">0xa</span>: add Reg[<span class="hljs-number">2</span>] , <span class="hljs-number">0x1</span><br><span class="hljs-number">0xb</span>: mov Mem[Reg[<span class="hljs-number">2</span>]] , <span class="hljs-number">0x24b</span><br><span class="hljs-number">0xc</span>: add Reg[<span class="hljs-number">2</span>] , <span class="hljs-number">0x1</span><br><span class="hljs-number">0xd</span>: mov Mem[Reg[<span class="hljs-number">2</span>]] , <span class="hljs-number">0x22b</span><br><span class="hljs-number">0xe</span>: add Reg[<span class="hljs-number">2</span>] , <span class="hljs-number">0x1</span><br><span class="hljs-number">0xf</span>: mov Mem[Reg[<span class="hljs-number">2</span>]] , <span class="hljs-number">0xfb</span><br><span class="hljs-number">0x10</span>: add Reg[<span class="hljs-number">2</span>] , <span class="hljs-number">0x1</span><br><span class="hljs-number">0x11</span>: mov Mem[Reg[<span class="hljs-number">2</span>]] , <span class="hljs-number">0x22b</span><br><span class="hljs-number">0x12</span>: add Reg[<span class="hljs-number">2</span>] , <span class="hljs-number">0x1</span><br><span class="hljs-number">0x13</span>: mov Mem[Reg[<span class="hljs-number">2</span>]] , <span class="hljs-number">0x223</span><br><span class="hljs-number">0x14</span>: add Reg[<span class="hljs-number">2</span>] , <span class="hljs-number">0x1</span><br><span class="hljs-number">0x15</span>: mov Mem[Reg[<span class="hljs-number">2</span>]] , <span class="hljs-number">0x24f</span><br><span class="hljs-number">0x16</span>: add Reg[<span class="hljs-number">2</span>] , <span class="hljs-number">0x1</span><br><span class="hljs-number">0x17</span>: mov Mem[Reg[<span class="hljs-number">2</span>]] , <span class="hljs-number">0xef</span><br><span class="hljs-number">0x18</span>: add Reg[<span class="hljs-number">2</span>] , <span class="hljs-number">0x1</span><br><span class="hljs-number">0x19</span>: mov Mem[Reg[<span class="hljs-number">2</span>]] , <span class="hljs-number">0x237</span><br><span class="hljs-number">0x1a</span>: add Reg[<span class="hljs-number">2</span>] , <span class="hljs-number">0x1</span><br><span class="hljs-number">0x1b</span>: mov Mem[Reg[<span class="hljs-number">2</span>]] , <span class="hljs-number">0xef</span><br><span class="hljs-number">0x1c</span>: add Reg[<span class="hljs-number">2</span>] , <span class="hljs-number">0x1</span><br><span class="hljs-number">0x1d</span>: mov Mem[Reg[<span class="hljs-number">2</span>]] , <span class="hljs-number">0x24f</span><br><span class="hljs-number">0x1e</span>: add Reg[<span class="hljs-number">2</span>] , <span class="hljs-number">0x1</span><br><span class="hljs-number">0x1f</span>: mov Mem[Reg[<span class="hljs-number">2</span>]] , <span class="hljs-number">0x24f</span><br><span class="hljs-number">0x20</span>: add Reg[<span class="hljs-number">2</span>] , <span class="hljs-number">0x1</span><br><span class="hljs-number">0x21</span>: mov Mem[Reg[<span class="hljs-number">2</span>]] , <span class="hljs-number">0x223</span><br><span class="hljs-number">0x22</span>: add Reg[<span class="hljs-number">2</span>] , <span class="hljs-number">0x1</span><br><span class="hljs-number">0x23</span>: mov Mem[Reg[<span class="hljs-number">2</span>]] , <span class="hljs-number">0x223</span><br><span class="hljs-number">0x24</span>: add Reg[<span class="hljs-number">2</span>] , <span class="hljs-number">0x1</span><br><span class="hljs-number">0x25</span>: mov Mem[Reg[<span class="hljs-number">2</span>]] , <span class="hljs-number">0x23b</span><br><span class="hljs-number">0x26</span>: add Reg[<span class="hljs-number">2</span>] , <span class="hljs-number">0x1</span><br><span class="hljs-number">0x27</span>: mov Mem[Reg[<span class="hljs-number">2</span>]] , <span class="hljs-number">0x237</span><br><span class="hljs-number">0x28</span>: add Reg[<span class="hljs-number">2</span>] , <span class="hljs-number">0x1</span><br><span class="hljs-number">0x29</span>: mov Mem[Reg[<span class="hljs-number">2</span>]] , <span class="hljs-number">0xff</span><br><span class="hljs-number">0x2a</span>: add Reg[<span class="hljs-number">2</span>] , <span class="hljs-number">0x1</span><br><span class="hljs-number">0x2b</span>: mov Mem[Reg[<span class="hljs-number">2</span>]] , <span class="hljs-number">0x233</span><br><span class="hljs-number">0x2c</span>: add Reg[<span class="hljs-number">2</span>] , <span class="hljs-number">0x1</span><br><span class="hljs-number">0x2d</span>: mov Mem[Reg[<span class="hljs-number">2</span>]] , <span class="hljs-number">0x233</span><br><span class="hljs-number">0x2e</span>: add Reg[<span class="hljs-number">2</span>] , <span class="hljs-number">0x1</span><br><span class="hljs-number">0x2f</span>: mov Mem[Reg[<span class="hljs-number">2</span>]] , <span class="hljs-number">0x233</span><br><span class="hljs-number">0x30</span>: add Reg[<span class="hljs-number">2</span>] , <span class="hljs-number">0x1</span><br><span class="hljs-number">0x31</span>: mov Mem[Reg[<span class="hljs-number">2</span>]] , <span class="hljs-number">0x237</span><br><span class="hljs-number">0x32</span>: add Reg[<span class="hljs-number">2</span>] , <span class="hljs-number">0x1</span><br><span class="hljs-number">0x33</span>: mov Mem[Reg[<span class="hljs-number">2</span>]] , <span class="hljs-number">0x24b</span><br><span class="hljs-number">0x34</span>: add Reg[<span class="hljs-number">2</span>] , <span class="hljs-number">0x1</span><br><span class="hljs-number">0x35</span>: mov Mem[Reg[<span class="hljs-number">2</span>]] , <span class="hljs-number">0x233</span><br><span class="hljs-number">0x36</span>: add Reg[<span class="hljs-number">2</span>] , <span class="hljs-number">0x1</span><br><span class="hljs-number">0x37</span>: mov Mem[Reg[<span class="hljs-number">2</span>]] , <span class="hljs-number">0x24f</span><br><span class="hljs-number">0x38</span>: add Reg[<span class="hljs-number">2</span>] , <span class="hljs-number">0x1</span><br><span class="hljs-number">0x39</span>: mov Mem[Reg[<span class="hljs-number">2</span>]] , <span class="hljs-number">0x22b</span><br><span class="hljs-number">0x3a</span>: add Reg[<span class="hljs-number">2</span>] , <span class="hljs-number">0x1</span><br><span class="hljs-number">0x3b</span>: mov Mem[Reg[<span class="hljs-number">2</span>]] , <span class="hljs-number">0x22b</span><br><span class="hljs-number">0x3c</span>: add Reg[<span class="hljs-number">2</span>] , <span class="hljs-number">0x1</span><br><span class="hljs-number">0x3d</span>: mov Mem[Reg[<span class="hljs-number">2</span>]] , <span class="hljs-number">0x24b</span><br><span class="hljs-number">0x3e</span>: add Reg[<span class="hljs-number">2</span>] , <span class="hljs-number">0x1</span><br><span class="hljs-number">0x3f</span>: mov Mem[Reg[<span class="hljs-number">2</span>]] , <span class="hljs-number">0xef</span><br><span class="hljs-number">0x40</span>: add Reg[<span class="hljs-number">2</span>] , <span class="hljs-number">0x1</span><br><span class="hljs-number">0x41</span>: <span class="hljs-built_in">exit</span>()<br>------code_end------<br><span class="hljs-number">0x0</span>: <span class="hljs-keyword">xor</span> Reg[<span class="hljs-number">2</span>] , Reg[<span class="hljs-number">2</span>]        <span class="hljs-comment">//å°†å¯†æ–‡a[i]-=0x63</span><br><span class="hljs-number">0x1</span>: mov Reg[<span class="hljs-number">0</span>] , Mem[Reg[<span class="hljs-number">2</span>]]<br><span class="hljs-number">0x2</span>: sub Reg[<span class="hljs-number">0</span>] , <span class="hljs-number">0x63</span><br><span class="hljs-number">0x3</span>: mov Mem[Reg[<span class="hljs-number">2</span>]] , Reg[<span class="hljs-number">0</span>]<br><span class="hljs-number">0x4</span>: add Reg[<span class="hljs-number">2</span>] , <span class="hljs-number">0x1</span><br><span class="hljs-number">0x5</span>: cmp Reg[<span class="hljs-number">2</span>] , <span class="hljs-number">0x20</span><br><span class="hljs-number">0x6</span>: jb  <span class="hljs-number">0x1</span><br><span class="hljs-number">0x7</span>: <span class="hljs-built_in">exit</span>()<br></code></pre></td></tr></tbody></table></figure><p>å®é™…æ‰§è¡Œæ—¶å…ˆå­˜å…¥å¯†æ–‡å¹¶ä¸”å¤„ç†ï¼Œå†è¾“å…¥flagç»è¿‡å¤„ç†åæ¯”å¯¹ï¼Œé€»è¾‘å¦‚ä¸Šï¼Œç®€å•é€†å‘ç®—æ³•å³å¯ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">enc=[<span class="hljs-number">255</span>, <span class="hljs-number">547</span>, <span class="hljs-number">571</span>, <span class="hljs-number">567</span>, <span class="hljs-number">567</span>, <span class="hljs-number">587</span>, <span class="hljs-number">555</span>, <span class="hljs-number">251</span>, <span class="hljs-number">555</span>, <span class="hljs-number">547</span>, <span class="hljs-number">591</span>, <span class="hljs-number">239</span>, <span class="hljs-number">567</span>, <span class="hljs-number">239</span>, <span class="hljs-number">591</span>, <span class="hljs-number">591</span>, <span class="hljs-number">547</span>, <span class="hljs-number">547</span>, <span class="hljs-number">571</span>, <span class="hljs-number">567</span>, <span class="hljs-number">255</span>, <span class="hljs-number">563</span>, <span class="hljs-number">563</span>, <span class="hljs-number">563</span>, <span class="hljs-number">567</span>, <span class="hljs-number">587</span>, <span class="hljs-number">563</span>, <span class="hljs-number">591</span>, <span class="hljs-number">555</span>, <span class="hljs-number">555</span>, <span class="hljs-number">587</span>, <span class="hljs-number">239</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(enc)):<br>    tmp=enc[i]-<span class="hljs-number">0x63</span><br>    tmp&gt;&gt;=<span class="hljs-number">2</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(tmp^<span class="hljs-number">0x42</span>),end=<span class="hljs-string">''</span>)<br><span class="hljs-comment">#flag{e247780d029a7a992247e6667869008a}</span><br></code></pre></td></tr></tbody></table></figure><h2 id="æ€»ç»“-2">æ€»ç»“</h2><p>â€‹<strong>åœ¨è¿›è¡ŒVMé€†å‘åˆ†ææ—¶ï¼Œé¦–å…ˆè¦äº†è§£VMä¿æŠ¤çš„è¿è¡Œæµç¨‹ï¼Œå…³é”®ç‚¹åœ¨äºDispatcherä¸­çš„æŒ‡ä»¤è§£è¯»å’Œç¨‹åºæµç¨‹çš„åˆ†æï¼Œè¿™å…¶ä¸­çš„å·¥ä½œé‡ä¸€èˆ¬æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œå¹¶ä¸”æ¯”è¾ƒåƒæ±‡ç¼–ï¼ŒåŒæ—¶è¦æ³¨æ„VMä¸­æŒ‡ä»¤æ ¼å¼ï¼Œå¯„å­˜å™¨çš„ç»“æ„ä½“å®šä¹‰ï¼Œè¿™æ ·å¯ä»¥ä¼˜åŒ–ä¼ªç ï¼ŒåŠ é€Ÿåˆ†æã€‚</strong></p><p>â€‹   <strong>Parserçš„ç¼–å†™å°±æ˜¯ç”¨pythonå°†opè¯‘ç ä¸ºx86çš„æ±‡ç¼–ï¼Œå†è¿›è¡Œç®—æ³•åˆ†æï¼Œè¿™ä¸ªè¿‡ç¨‹åº”è¯¥éœ€è¦åˆ·é¢˜æ¥ç»ƒçš„ï¼Œä¸è¿‡è¯¥é¢˜çš„parseræ¯”è¾ƒç®€å•ã€‚</strong></p><blockquote><p><strong>IDAçš„å®å®šä¹‰ å’Œ IDAPYTHONçš„ä½¿ç”¨è¿˜è¦è¿›ä¸€æ­¥åŠ æ·±ï¼Œåˆ†æVMè€å¿ƒååˆ†é‡è¦ï¼Œè™šæ‹ŸåŒ–å±‚åº¦é«˜æ—¶åŠ¨è°ƒå’Œé™æ€ç»“åˆæ•ˆç‡ä¼šæ›´é«˜ã€‚</strong></p></blockquote><p>å‚è€ƒ:</p><p><a href="https://www.cnblogs.com/0xHack/p/9399321.html">IDAPYTHONå¸¸ç”¨å‘½ä»¤</a></p><p><a href="https://blog.shi1011.cn/ctf/2077">https://blog.shi1011.cn/ctf/2077</a></p><p><a href="https://www.cnblogs.com/nigacat/p/13039289.html">https://www.cnblogs.com/nigacat/p/13039289.html</a></p>]]></content>
    
    
    <categories>
      
      <category>RE</category>
      
    </categories>
    
    
    <tags>
      
      <tag>RE</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022HWSå†¬ä»¤è¥-Wp</title>
    <link href="/2022/01/26/2022HWS%E5%86%AC%E4%BB%A4%E8%90%A5-Wp/"/>
    <url>/2022/01/26/2022HWS%E5%86%AC%E4%BB%A4%E8%90%A5-Wp/</url>
    
    <content type="html"><![CDATA[<blockquote><p>é¢˜ç›®è´¨é‡è›®ä¸é”™çš„ï¼Œå­¦åˆ°äº†å¾ˆå¤šä¸œè¥¿ï¼ŒREæ˜¯2é“VMçš„é¢˜ï¼Œä¸€é“èŠ±æŒ‡ä»¤+ollvmæ··æ·†ï¼Œä¹Ÿæœ‰ä¸¤é“Androidé¢˜åœ¨Miscå’ŒCryptoä¸­ï¼Œæœ€åˆºæ¿€çš„æ˜¯è·æ¯”èµ›ç»“æŸè¿˜æœ‰ä¸¤åˆ†é’Ÿæ—¶è§£å‡ºäº†RE3ã€‚</p></blockquote><h1>ä¸€ã€Misc</h1><h2 id="badPDF">badPDF</h2><p>æ‹¿åˆ°æ–‡ä»¶æ‹–å…¥010editorä¸­ï¼Œå‘ç°æ˜¯4c 00å¼€å¤´ï¼Œæ˜¯winä¸‹å¿«æ·æ–¹å¼çš„æ ‡å¿—ï¼Œå¹¶ä¸”æœ¬èº«åç¼€ä¸º.linkæ–‡ä»¶ã€‚</p><p>é€šè¿‡æœç´¢æ‰¾åˆ°ä¸€ç¯‡æ–‡ç« https://www.sohu.com/a/387683719_476857</p><p>å¾—çŸ¥æ˜¯2020å¹´ä¸€ä¸ªç—…æ¯’çš„å¼±åŒ–æ ·æœ¬ï¼Œåˆ©ç”¨LNKå¿«æ·æ–¹å¼ä¼ªè£…nCov-19ç–«æƒ…çš„æ¶æ„æ”»å‡»ã€‚</p><p>å¤§è‡´æµç¨‹æ˜¯è¿è¡Œæ—¶ä¼šåœ¨AppData/Local/Tempç›®å½•ä¸‹åŠ è½½jsã€exeæ–‡ä»¶ç­‰ç”¨äºä¸‹ä¸€æ¬¡æ”»å‡»ã€‚è¯¥é™„ä»¶çš„æ‰§è¡Œæµç¨‹ä¸æ‰€è¿°ç—…æ¯’æ ·æœ¬ç±»ä¼¼ï¼Œå…³é”®ç‚¹åœ¨äºæ‹¿åˆ°WsmPty.xslæ–‡ä»¶ï¼ŒæŸ¥çœ‹jså¯çŸ¥ä»–å†™åœ¨äº†\AppData\Local\Temp\cscript.exeç›®å½•ä¸‹ï¼Œè¿è¡Œfakepdfï¼Œåœ¨xslåŠ è½½åˆ°ç›®å½•ä¸‹æ—¶ç”¨notepadæ‰“å¼€ï¼Œå†…å®¹å¦‚ä¸‹ã€‚</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version='1.0'?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">stylesheet</span></span><br><span class="hljs-tag"><span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.w3.org/1999/XSL/Transform"</span> <span class="hljs-attr">xmlns:ms</span>=<span class="hljs-string">"urn:schemas-microsoft-com:xslt"</span></span><br><span class="hljs-tag"><span class="hljs-attr">xmlns:user</span>=<span class="hljs-string">"placeholder"</span></span><br><span class="hljs-tag"><span class="hljs-attr">version</span>=<span class="hljs-string">"1.0"</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">output</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"text"</span>/&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">ms:script</span> <span class="hljs-attr">implements-prefix</span>=<span class="hljs-string">"user"</span> <span class="hljs-attr">language</span>=<span class="hljs-string">"VBScript"</span>&gt;</span><br> &lt;![CDATA[<br> rBOH7OLTCVxzkH=HrtvBsRh3gNUbe("676d60667a64333665326564333665326564333665326536653265643336656564333665327c"):execute(rBOH7OLTCVxzkH):function HrtvBsRh3gNUbe(bhhz6HalbOkrki):for rBOH7OLTCVxzkH=1 to len(bhhz6HalbOkrki)step 2:HrtvBsRh3gNUbe=HrtvBsRh3gNUbe&amp;chr(asc(chr("&amp;h"&amp;mid(bhhz6HalbOkrki,rBOH7OLTCVxzkH,2)))xor 1):next:end function:<br> ]]&gt; <span class="hljs-tag">&lt;/<span class="hljs-name">ms:script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">stylesheet</span>&gt;</span><br><br></code></pre></td></tr></tbody></table></figure><p>å¯è§æŒ‰ç…§VBSè„šæœ¬æ­£å¸¸æ‰§è¡Œå°±èƒ½æ‹¿åˆ°flagä¸²ï¼ŒåŠ å¯†å¾ˆå®¹æ˜“hex_to_stråä¸1å¼‚æˆ–å³å¯ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">a=<span class="hljs-built_in">bytes</span>.fromhex(<span class="hljs-string">'676d60667a64333665326564333665326564333665326536653265643336656564333665327c'</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(a)):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(a[i]^<span class="hljs-number">1</span>),end=<span class="hljs-string">''</span>)<br><span class="hljs-comment">#flag{e27d3de27d3de27d3d7d3de27dde27d3}</span><br></code></pre></td></tr></tbody></table></figure><h2 id="gogogo">gogogo</h2><p>è€ƒç‚¹æ˜¯æ‹¼å›¾ã€å–è¯å’ŒAztec</p><p>é¦–å…ˆæ˜¯puzzleï¼Œä¸€å…±æœ‰256ä¸ªåˆ†è¾¨ç‡ä¸º160x100ï¼Œå¦‚æœç”¨gapsçš„è¯éœ€è¦æ˜¯æ­£æ–¹å½¢ï¼Œæ‰€ä»¥å…ˆç”¨convertå¼ºè¡Œè½¬åˆ†è¾¨ç‡ä¸º160x160ã€‚</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apl">find ./ -name '*.png'  -exec convert -resize 160x160! {} {} \; <br></code></pre></td></tr></tbody></table></figure><p>ä¹‹åmontageæŒ‡ä»¤å°†å›¾ç‰‡æ‹¼æ¥</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apl">montage *png -tile 16x16 -geometry +0+0 out.png<br></code></pre></td></tr></tbody></table></figure><p>ä¹‹åç›´æ¥gapsè‡ªåŠ¨åŒ–æ‹¼å³å¯ sizeå‚æ•°é€‰160</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apl">gaps --image=out.png --generations=20 --population=256 --size=160<br></code></pre></td></tr></tbody></table></figure><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220123203055938.png" alt="image-20220123203055938"></p><p>æ‹¿åˆ°passwd: 3e8f092d4d7b80ce338d6e238efb01</p><p>ä¹‹åè¿˜æœ‰2.rawæ–‡ä»¶ï¼Œå› ä¸ºæˆ‘ä»¬æœ‰ä¸ªpasswdæ‰€ä»¥çŒœæµ‹æœ‰zipæ–‡ä»¶ï¼Œç›´æ¥filescanæ‰¾zip</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apl">volatility -f 2.raw imageinfo #WinXPSP2x86<br>volatility -f 2.raw --profile=WinXPSP2x86 filescan | grep "zip"<br>volatility -f 2.raw --profile=WinXPSP2x86  dumpfiles -Q [csgo.zipåç§»] -D .<br></code></pre></td></tr></tbody></table></figure><p>èƒ½å¯¼å‡ºä¸€ä¸ªcsgo.zipï¼Œå¹¶ä¸”èƒ½ç”¨puzzleå¾—åˆ°çš„passwdè§£å‹ï¼Œæ‹¿åˆ°äºŒå¼ å›¾ç‰‡(foremoståˆ†ç¦»csgo.pngå¾—åˆ°)</p><p>ä¸€ä¸ªæ˜¯é˜¿å…¹ç‰¹å…‹çš„å›¾ç‰‡ï¼Œä¸€ä¸ªæ˜¯æ²¡æœ‰å®šä½ç¬¦çš„å›¾ç‰‡ç ï¼Œç™¾åº¦èƒ½ç¡®å®šæ˜¯Aztecï¼Œé‚£ä¸ªæªåçš„è°éŸ³æ˜¯æç¤ºï¼Œå•Šè¿™ã€‚</p><p>ç½‘ä¸Šç”Ÿæˆä¸€ä¸ªæ ‡å‡†çš„Aztecç ï¼Œä¿®å¤å®šä½ç¬¦å³å¯ï¼Œå¾¡ç”¨PDFä¿®å¤ï¼Œä¸ä¼šPS :)ã€‚</p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220123204323061.png" alt="image-20220123204323061" style="zoom:80%;"><h1>äºŒã€Crypto</h1><h2 id="babyrsa">babyrsa</h2><p>ç­¾åˆ°é¢˜ï¼Œnèƒ½åœ¨çº¿åˆ†è§£ï¼Œæ­£å¸¸rsaè§£å¯†å³å¯ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> gmpy2<br>n=<span class="hljs-number">13123058934861171416713230498081453101147538789122070079961388806126697916963123413431108069961369055630747412550900239402710827847917960870358653962948282381351741121884528399369764530446509936240262290248305226552117100584726616255292963971141510518678552679033220315246377746270515853987903184512948801397452104554589803725619076066339968999308910127885089547678968793196148780382182445270838659078189316664538631875879022325427220682805580410213245364855569367702919157881367085677283124732874621569379901272662162025780608669577546548333274766058755786449491277002349918598971841605936268030140638579388226573929</span><br>e=<span class="hljs-number">2199344405076718723439776106818391416986774637417452818162477025957976213477191723664184407417234793814926418366905751689789699138123658292718951547073938244835923378103264574262319868072792187129755570696127796856136279813658923777933069924139862221947627969330450735758091555899551587605175567882253565613163972396640663959048311077691045791516671857020379334217141651855658795614761069687029140601439597978203375244243343052687488606544856116827681065414187957956049947143017305483200122033343857370223678236469887421261592930549136708160041001438350227594265714800753072939126464647703962260358930477570798420877</span><br>c=<span class="hljs-number">1492164290534197296766878830710549288168716657792979479408332026408553210558539364503279432780006256047888761718878241924947937039103166564146378209168719163067531460700424309878383312837345239570897122826051628153030129647363574035072755426112229160684859510640271933580581310029921376842631120847546030843821787623965614564745724229763999106839802052036834811357341644073138100679508864747009014415530176077648226083725813290110828240582884113726976794751006967153951269748482024859714451264220728184903144004573228365893961477199925864862018084224563883101101842275596219857205470076943493098825250412323522013524</span><br>p=<span class="hljs-number">98197216341757567488149177586991336976901080454854408243068885480633972200382596026756300968618883148721598031574296054706280190113587145906781375704611841087782526897314537785060868780928063942914187241017272444601926795083433477673935377466676026146695321415853502288291409333200661670651818749836420808033</span><br>q=<span class="hljs-number">133639826298015917901017908376475546339925646165363264658181838203059432536492968144231040597990919971381628901127402671873954769629458944972912180415794436700950304720548263026421362847590283353425105178540468631051824814390421486132775876582962969734956410033443729557703719598998956317920674659744121941513</span><br>d=gmpy2.invert(e,(p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>))<br><span class="hljs-built_in">print</span>(long_to_bytes(<span class="hljs-built_in">pow</span>(c,d,n)))<br><span class="hljs-comment">#hwctf{01d_Curs3_c4Me_Again}</span><br></code></pre></td></tr></tbody></table></figure><h2 id="crypto-Elgamal">crypto_Elgamal</h2><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">assert</span> ( A * s0 + B ) % q == s1<br><span class="hljs-keyword">assert</span> ( A * s1 + B ) % q == s2<br><span class="hljs-keyword">assert</span> ( A * s2 + B ) % q == s3<br><span class="hljs-keyword">assert</span> ( A * s3 + B ) % q == s4<br></code></pre></td></tr></tbody></table></figure><p>ç¬¬ä¸€æ®µæ˜¯LCGï¼ŒæœªçŸ¥å‚æ•°æ˜¯Aã€Bã€q</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python">s0 = <span class="hljs-number">543263588863771657634119</span><br>s1 = <span class="hljs-number">628899245716105951093835</span><br>s2 = <span class="hljs-number">78708024695487418261582</span><br>s3 = <span class="hljs-number">598971435111109998816796</span><br>s4 = <span class="hljs-number">789474285039501272453373</span><br>s=[s0,s1,s2,s3,s4]<br>t=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(s)-<span class="hljs-number">1</span>):<br>    t.append(s[i+<span class="hljs-number">1</span>]-s[i])<br><span class="hljs-built_in">print</span>(t)<br><br>nn=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">3</span>):<br>    nn.append(<span class="hljs-built_in">abs</span>(t[i+<span class="hljs-number">1</span>]*t[i-<span class="hljs-number">1</span>]-t[i]*t[i]))<br><span class="hljs-built_in">print</span>(nn)<br>q=gmpy2.gcd(nn[<span class="hljs-number">0</span>],nn[<span class="hljs-number">1</span>])<br><span class="hljs-comment">#791763770658839585424113</span><br></code></pre></td></tr></tbody></table></figure><p>ç°åœ¨æˆ‘ä»¬æ‹¿åˆ°(g, h, A, B, p, q),ä¹‹åæ˜¯ElGamalè§£å¯†ï¼Œå¯çŸ¥ä»–åœ¨ç”Ÿæˆræ—¶ä¹Ÿæ˜¯çº¿æ€§åŒä½™ï¼Œå¹¶ä¸”å‚æ•°æˆ‘ä»¬å·²çŸ¥ã€‚</p><p>å‚è€ƒ:2018 Code Blue lagalem</p><p><a href="https://ctf-wiki.org/crypto/asymmetric/discrete-log/elgamal/#2018-code-blue-lagalem">https://ctf-wiki.org/crypto/asymmetric/discrete-log/elgamal/#2018-code-blue-lagalem</a></p><p>å³</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">tmp = gmpy2.powmod(c2, A, p) * gmpy2.powmod(h, B, p) * gmpy2.invert(c2_, p)<br>tmp = tmp % p<br>gg, x, y = gmpy2.gcdext(A - <span class="hljs-number">1</span>, p - <span class="hljs-number">1</span>)<br><span class="hljs-built_in">print</span>(gg)<br>m = gmpy2.powmod(tmp, x, p)<br><span class="hljs-built_in">print</span>(long_to_bytes(m))<br></code></pre></td></tr></tbody></table></figure><p>å¦‚æœæ˜¯ç›´æ¥è§£å‡ºçš„qè¿™é‡Œçš„ggåˆ™æ˜¯7438ï¼Œå³æˆ‘ä»¬æ±‚å‡ºçš„m æ˜¯ pow(m,7438,p)è€Œ7438æ˜¯p-1çš„å› æ•°ï¼Œæ‰€ä»¥rsaä¹Ÿä¸å¯è§£ï¼Œå¯çŸ¥åœ¨æ¨å¯¼ä¸­å¦‚æœæˆ‘ä»¬å–q`=k*qï¼Œé‚£ä¹ˆAå’ŒBçš„å€¼ä¼šå˜å¤§ï¼Œä½†æ˜¯LCGçš„ç»“æœä¸ä¼šæ”¹å˜ï¼Œè€Œæˆ‘ä»¬æ¨å¯¼ä¸­ç”¨åˆ°äº†Aå’ŒBçš„å€¼æ¥æ±‚tå’Œggï¼Œå½“æˆ‘ä»¬æ”¹å˜qæ—¶ï¼Œggçš„å€¼ä¹Ÿåœ¨æ”¹å˜ï¼Œæ•…å½“ggè¶³å¤Ÿå°ï¼Œä¸º1æ—¶ï¼Œåˆ™pow(tmp,x,p) = flagã€‚</p><p>ç»¼ä¸Šexpä¸º:</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><br><br>s0 = <span class="hljs-number">543263588863771657634119</span><br>s1 = <span class="hljs-number">628899245716105951093835</span><br>s2 = <span class="hljs-number">78708024695487418261582</span><br>s3 = <span class="hljs-number">598971435111109998816796</span><br>s4 = <span class="hljs-number">789474285039501272453373</span><br><br>s=[s0,s1,s2,s3,s4]<br>t=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(s)-<span class="hljs-number">1</span>):<br>    t.append(s[i+<span class="hljs-number">1</span>]-s[i])<br><span class="hljs-built_in">print</span>(t)<br><br>nn=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">3</span>):<br>    nn.append(<span class="hljs-built_in">abs</span>(t[i+<span class="hljs-number">1</span>]*t[i-<span class="hljs-number">1</span>]-t[i]*t[i]))<br><span class="hljs-built_in">print</span>(nn)<br><span class="hljs-comment">#[258157280800981693845036338952604472521614296785, 375487011827303788911792498742822292475328703777]</span><br><span class="hljs-comment">#q=gmpy2.gcd(nn[0],nn[1])</span><br>q=<span class="hljs-number">375487011827303788911792498742822292475328703777</span>*<span class="hljs-number">3</span> <span class="hljs-comment">#ä»nnçš„å…ƒç´ ä¸­å–å†æ•°ä¹˜å³å¯ï¼Œä½†è¦ä¿è¯æ±‚Aæ—¶é€†å…ƒå­˜åœ¨ã€‚</span><br><br>A=gmpy2.invert(s1-s0,q)*(s2-s1) %q<br>B=(s1-A*s[<span class="hljs-number">0</span>])%q<br><br><br>p = <span class="hljs-number">65211247300401312530078141569304950676358489059623557848188896752173856845051471066071652073612337629832155846984721797768267868868902023383604553319793550396610085424563231688918357710337401138108050205457200940158475922063279384491022916790549837379548978141370347556053597178221402425212594060342213485311</span><br>g = <span class="hljs-number">27642593390439430783453736408814717946185190497201679721975757020767271070510268596627490205095779429964809833535285315202625851326460572368018875381603399143376574281200028337681552876140857556460885848491160812604549770668188783258592940823128376128198726254875984002214053523752696104568469730021811399216</span><br>h = <span class="hljs-number">54585833166051670245656045196940486576634589000609010947618047461787934106392112227019662788387352615714332234871251868259282522817042504587428441746855906297390193418159792477477443129333707197013251839952389651332058368911829464978546505729530760951698134101053626585254469108630886768357270544236516534904</span><br><br><br>c1 = <span class="hljs-number">60724920570148295800083597588524297283595971970237964464679084640302395172192639331196385150232229004030419122038089044697951208850497923486467859070476427472465291810423905736825272208842988090394035980454248119048131354993356125895595138979611664707727518852984351599604226889848831071126576874892808080133</span><br>c2 = <span class="hljs-number">48616294792900599931167965577794374684760165574922600262773518630884983374432147726140430372696876107933565006549344582099592376234783044818320678499613925823621554608542446585829308488452057340023780821973913517239972817669309837103043456714481646128392677624092659929248296869048674230341175765084122344264</span><br>c1_ = <span class="hljs-number">42875731538109170678735196002365281622531058597803022779529275736483962610547258618168523955709341579773947887175626960699426438456382655370090748369934296474999389316334717699127421889816721511602392591677377678759026657582648354688447456509292302633971842316239774410380221303269351351929586256938787054867</span><br>c2_ = <span class="hljs-number">64829024929257668640929285124747107162970460545535885047576569803424908055130477684809317765011143527867645692710091307694839524199204611328374569742391489915929451079830143261799375621377093290249652912850024319433129432676683899459510155157108727860920017105870104383111111395351496171846620163716404148070</span><br><br>tmp = gmpy2.powmod(c2, A, p) * gmpy2.powmod(h, B, p) * gmpy2.invert(c2_, p)<br>tmp = tmp % p<br>gg, x, y = gmpy2.gcdext(A - <span class="hljs-number">1</span>, p - <span class="hljs-number">1</span>)<br><span class="hljs-built_in">print</span>(gg)<br>m = gmpy2.powmod(tmp, x, p)<br><span class="hljs-built_in">print</span>(long_to_bytes(m))<br><br><span class="hljs-comment">#19e9f185e6a680324cedd6e6d9382743</span><br></code></pre></td></tr></tbody></table></figure><h1>ä¸‰ã€REVERSE</h1><h2 id="EasyVM">EasyVM</h2><p>ä¿®å¤èŠ±æŒ‡ä»¤ï¼Œpatch callçš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œä¹‹åè§‚å¯Ÿæ§åˆ¶æµï¼Œå°è¯•ååœ¨exceptå¼‚å¸¸å¤„ç†å—å‘ç°å…³é”®å‡½æ•°sub_4012F0</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">sub_4012F0</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>{<br>  _DWORD *v0; <span class="hljs-comment">// eax</span><br>  <span class="hljs-keyword">int</span> (__thiscall ***v1)(_DWORD, <span class="hljs-keyword">void</span> *, <span class="hljs-keyword">void</span> *, _DWORD, _BYTE *); <span class="hljs-comment">// ebx</span><br>  _BYTE *v2; <span class="hljs-comment">// eax</span><br>  <span class="hljs-keyword">char</span> flag[<span class="hljs-number">256</span>]; <span class="hljs-comment">// [esp+8h] [ebp-100h] BYREF</span><br><br>  v0 = (_DWORD *)sub_401889(<span class="hljs-number">0x24</span>u);<br>  <span class="hljs-keyword">if</span> ( v0 )<br>  {<br>    *v0 = &amp;off_40A0D0;<br>    v0[<span class="hljs-number">1</span>] = <span class="hljs-number">0</span>;<br>    v0[<span class="hljs-number">2</span>] = <span class="hljs-number">0</span>;<br>    v0[<span class="hljs-number">3</span>] = <span class="hljs-number">0</span>;<br>    v0[<span class="hljs-number">4</span>] = <span class="hljs-number">0</span>;<br>    v0[<span class="hljs-number">5</span>] = <span class="hljs-number">0</span>;<br>    v0[<span class="hljs-number">6</span>] = <span class="hljs-number">0</span>;<br>    v0[<span class="hljs-number">7</span>] = <span class="hljs-number">0</span>;<br>    v0[<span class="hljs-number">8</span>] = <span class="hljs-number">0</span>;<br>    v1 = (<span class="hljs-keyword">int</span> (__thiscall ***)(_DWORD, <span class="hljs-keyword">void</span> *, <span class="hljs-keyword">void</span> *, _DWORD, _BYTE *))v0;<br>  }<br>  <span class="hljs-keyword">else</span><br>  {<br>    v1 = <span class="hljs-number">0</span>;<br>  }<br>  <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%s"</span>, flag);<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">strlen</span>(flag) == <span class="hljs-number">42</span> )<br>  {<br>    v2 = sub_4011E0(flag);<br>    <span class="hljs-keyword">if</span> ( (**v1)(v1, &amp;unk_40B030, &amp;unk_40B050, <span class="hljs-number">0</span>, v2) )<br>      sub_4016F9((<span class="hljs-keyword">int</span>)aCongratulation);<br>    <span class="hljs-keyword">else</span><br>      sub_4016F9((<span class="hljs-keyword">int</span>)aUnfortunatelyI);<br>  }<br>  <span class="hljs-keyword">else</span><br>  {<br>    sub_4016F9((<span class="hljs-keyword">int</span>)aVerificationFa);<br>  }<br>  system(Command);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}<br></code></pre></td></tr></tbody></table></figure><p>å¯çŸ¥flagé•¿åº¦ä¸º42ä½ï¼ŒåŠ å¯†æµç¨‹æ˜¯sub_4011E0 å’Œ v1æŒ‡å‘çš„å‡½æ•°ã€‚</p><p>sub_4011E0æ˜¯ä¸ªé­”æ”¹çš„base64ï¼Œä¿®æ”¹äº†è¡¨çš„å€¼é€šè¿‡å¼‚æˆ–ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c">{<br>  v6 += <span class="hljs-number">4</span>;<br>  v8 = *((<span class="hljs-keyword">unsigned</span> __int8 *)v7 - <span class="hljs-number">1</span>);<br>  v7 += <span class="hljs-number">3</span>;<br>  v4[v6 - <span class="hljs-number">4</span>] = aAbcdefghijklmn[v8 &gt;&gt; <span class="hljs-number">2</span>] ^ <span class="hljs-number">0xA</span>;<br>  v4[v6 - <span class="hljs-number">3</span>] = aAbcdefghijklmn[(*((<span class="hljs-keyword">unsigned</span> __int8 *)v7 - <span class="hljs-number">3</span>) &gt;&gt; <span class="hljs-number">4</span>) | (<span class="hljs-number">16</span> * (*(v7 - <span class="hljs-number">4</span>) &amp; <span class="hljs-number">3</span>))] ^ <span class="hljs-number">0xB</span>;/<br>  v4[v6 - <span class="hljs-number">2</span>] = aAbcdefghijklmn[(*((<span class="hljs-keyword">unsigned</span> __int8 *)v7 - <span class="hljs-number">2</span>) &gt;&gt; <span class="hljs-number">6</span>) | (<span class="hljs-number">4</span> * (*(v7 - <span class="hljs-number">3</span>) &amp; <span class="hljs-number">0xF</span>))] ^ <span class="hljs-number">0xC</span>;<br>  v4[v6 - <span class="hljs-number">1</span>] = aAbcdefghijklmn[*(v7 - <span class="hljs-number">2</span>) &amp; <span class="hljs-number">0x3F</span>] ^ <span class="hljs-number">0xD</span>;<br>}<br></code></pre></td></tr></tbody></table></figure><p>v1æŒ‡å‘çš„å‡½æ•°æ˜¯è™šæ‹Ÿæœºå¤„ç†å‡½æ•°ï¼Œä¼ å…¥çš„å‚æ•°ä¾æ¬¡ä¸ºopcodeï¼Œå¯†æ–‡å’Œç»è¿‡base64å¤„ç†åçš„å¯†æ–‡ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220123205320141.png" alt="image-20220123205320141"></p><p>ç»“åˆåŠ¨æ€è°ƒè¯•å¯çŸ¥æ˜¯æŒ‰å­—èŠ‚å¤„ç†ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œå½“å‰ç›´æ¥ä¸å‰ä¸€ä¸ªå¤„ç†åçš„å­—èŠ‚å¼‚æˆ–ååœ¨å¼‚æˆ–0xeeåœ¨å’Œå¯†æ–‡æ¯”è¾ƒ(ç¬¬ä¸€ä¸ªå­—èŠ‚å¼‚æˆ–0å¼‚æˆ–0xee)</p><p>ç»¼ä¸Šç¼–å†™exp</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64<br>enc=[<span class="hljs-number">0</span>,<span class="hljs-number">0xBE</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0xAC</span>, <span class="hljs-number">0x27</span>, <span class="hljs-number">0x99</span>, <span class="hljs-number">0x4F</span>, <span class="hljs-number">0xDE</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0xEE</span>, <span class="hljs-number">0x5F</span>, <span class="hljs-number">0xDA</span>, <span class="hljs-number">0x0B</span>, <span class="hljs-number">0xB5</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0xB8</span>, <span class="hljs-number">0x68</span>, <span class="hljs-number">0xC2</span>, <span class="hljs-number">0x4E</span>, <span class="hljs-number">0x9C</span>, <span class="hljs-number">0x4A</span>, <span class="hljs-number">0xE1</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0xF0</span>, <span class="hljs-number">0x22</span>, <span class="hljs-number">0x8A</span>, <span class="hljs-number">0x3B</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0x5B</span>, <span class="hljs-number">0xE5</span>, <span class="hljs-number">0x54</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0x68</span>, <span class="hljs-number">0xD5</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0xD4</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0xAD</span>, <span class="hljs-number">0x0B</span>, <span class="hljs-number">0xD8</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0xF9</span>, <span class="hljs-number">0x58</span>, <span class="hljs-number">0xE0</span>, <span class="hljs-number">0x6F</span>, <span class="hljs-number">0xC5</span>, <span class="hljs-number">0x4A</span>, <span class="hljs-number">0xFD</span>, <span class="hljs-number">0x2F</span>, <span class="hljs-number">0x84</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x85</span>, <span class="hljs-number">0x52</span>, <span class="hljs-number">0xFB</span>, <span class="hljs-number">0x73</span>, <span class="hljs-number">0xD7</span>, <span class="hljs-number">0x0D</span>, <span class="hljs-number">0xE3</span>]<br>m=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">56</span>,<span class="hljs-number">0</span>,-<span class="hljs-number">1</span>):<br>    m.append(enc[i]^enc[i-<span class="hljs-number">1</span>]^<span class="hljs-number">0xee</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">bytes</span>(m)[::-<span class="hljs-number">1</span>])<br><br>a=<span class="hljs-built_in">bytes</span>(m)[::-<span class="hljs-number">1</span>]<br>s=<span class="hljs-string">''</span><br>key=[<span class="hljs-number">0xa</span>,<span class="hljs-number">0xb</span>,<span class="hljs-number">0xc</span>,<span class="hljs-number">0xd</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(a)):<br>    s+=<span class="hljs-built_in">chr</span>(a[i]^key[i%<span class="hljs-number">4</span>])<br><span class="hljs-built_in">print</span>(base64.b64decode(s.encode()))<br><span class="hljs-comment">#flag{2586dc76-98d5-44e2-ad58-d06e6559d82a}</span><br></code></pre></td></tr></tbody></table></figure><h2 id="babyre-2">babyre</h2><p>å¼€å±€å¤šç§èŠ±æŒ‡ä»¤ï¼Œç®€å•çš„è·³è½¬ç›´æ¥nopå³å¯ï¼Œæœ‰ä¸¤ç§ä¼šå½±å“åç¼–è¯‘å¹¶ä¸”æ¯”è¾ƒæœ‰è¶£ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c">.text:<span class="hljs-number">00401838</span>                 push    eax<br>.text:<span class="hljs-number">00401839</span>                 mov     eax, <span class="hljs-number">7F</span>h<br>.text:<span class="hljs-number">0040183</span>E                 test    eax, eax<br>.text:<span class="hljs-number">00401840</span>                 jz      <span class="hljs-keyword">short</span> loc_401847<br>.text:<span class="hljs-number">00401842</span>                 call    near ptr loc_401847+<span class="hljs-number">1</span><br>.text:<span class="hljs-number">00401847</span><br>.text:<span class="hljs-number">00401847</span> loc_401847:                             ; CODE XREF: .text:<span class="hljs-number">00401840</span>â†‘j<br>.text:<span class="hljs-number">00401847</span>                                         ; .text:<span class="hljs-number">00401842</span>â†‘p<br>.text:<span class="hljs-number">00401847</span>                 call    fword ptr [eax+<span class="hljs-number">58</span>h]<br> <span class="hljs-comment">//nopä¸€ä¸ªå­—èŠ‚å</span><br>.text:<span class="hljs-number">00401848</span> loc_401848:                             ; CODE XREF: .text:<span class="hljs-number">00401842</span>â†‘p<br>.text:<span class="hljs-number">00401848</span>                 pop     eax<br>.text:<span class="hljs-number">00401849</span>                 pop     eax<br></code></pre></td></tr></tbody></table></figure><p>ç¬¬ä¸€ç§åˆ†æçŸ¥eaxè¢«èµ‹0x7fåjzè·³è½¬æ’ä¸æˆç«‹ï¼Œæ•…é€šè¿‡callæ¥è·³è½¬ï¼Œä¼šå‹å…¥åœ°å€è¿›æ ˆï¼Œnopä¸‹é¢callçš„ç¬¬ä¸€ä¸ªå­—èŠ‚åå‡ºç°popï¼Œå…¶å®æ˜¯æ¢å¤eaxå€¼ï¼Œæ‰€ä»¥ä»push eax åˆ°pop eaxå…¨nopæ‰å³å¯ã€‚</p><p>ç¬¬äºŒç§æ›´å¤æ‚ä¸€ç‚¹ï¼Œä¸è¿‡ä¹Ÿæœ‰pushå’Œpopæ¢å¤ç°åœºï¼Œå…¨nopæ‰å³å¯ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c">.text:<span class="hljs-number">00401</span>A28                 push    eax<br>.text:<span class="hljs-number">00401</span>A29                 push    ecx<br>.text:<span class="hljs-number">00401</span>A2A                 call    sub_4010A0<br>.text:<span class="hljs-number">00401</span>A2F                 add     eax, <span class="hljs-number">15</span>h<br>.text:<span class="hljs-number">00401</span>A32                 push    eax<br>.text:<span class="hljs-number">00401</span>A33                 pop     eax<br>.text:<span class="hljs-number">00401</span>A34                 mov     ecx, <span class="hljs-number">0F</span>FFFFFFFh<br>.text:<span class="hljs-number">00401</span>A39                 <span class="hljs-keyword">xor</span>     eax, ecx<br>.text:<span class="hljs-number">00401</span>A3B                 push    eax<br>.text:<span class="hljs-number">00401</span>A3C                 pop     ecx<br>.text:<span class="hljs-number">00401</span>A3D                 <span class="hljs-keyword">not</span>     ecx<br>.text:<span class="hljs-number">00401</span>A3F                 push    ecx<br>.text:<span class="hljs-number">00401</span>A40                 retn<br>.text:<span class="hljs-number">00401</span>A40 ; ---------------------------------------------------------------------------<br>.text:<span class="hljs-number">00401</span>A41                 db <span class="hljs-number">7</span>Eh, <span class="hljs-number">0F</span>Fh, <span class="hljs-number">15</span>h<br>.text:<span class="hljs-number">00401</span>A44 ; ---------------------------------------------------------------------------<br>.text:<span class="hljs-number">00401</span>A44                 pop     ecx<br>.text:<span class="hljs-number">00401</span>A45                 pop     eax<br></code></pre></td></tr></tbody></table></figure><p>ç®€æ˜“ç‰ˆIPYTHONè„šæœ¬æ‰‹åŠ¨å»é™¤ï¼Œç”Ÿæˆpatchæ–‡ä»¶ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">adr1=<span class="hljs-number">0x00401A28</span><br>adr2=<span class="hljs-number">0x00401A46</span><br><span class="hljs-keyword">for</span> ad <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(adr1,adr2):<br>    PatchByte(ad,<span class="hljs-number">0x90</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">'yes'</span>)<br></code></pre></td></tr></tbody></table></figure><p>ä¹‹åæŸ¥çœ‹æ§åˆ¶æµï¼Œå‘ç°ollvmæ··æ·†çš„ç‰¹å¾ï¼Œèµ·åˆæƒ³æ‰¾ä¸ªè‡ªåŠ¨åŒ–çš„è„šæœ¬ï¼Œå¯æƒœæ²¡æ‰¾åˆ°!</p><p><a href="https://www.52pojie.cn/thread-1488350-1-1.html">https://www.52pojie.cn/thread-1488350-1-1.html</a></p><p>åŸºæœ¬æ€è·¯æ˜¯ï¼Œæ¯ä¸ªçœŸå®å—çš„é¦–åœ°å€ä¸‹æ–­ç‚¹ï¼Œè¿è¡Œå¹¶è®°å½•æ¥è¿˜åŸï¼Œå› ä¸ºæˆ‘ä»¬ä¸»è¦å…³æ³¨è¾“å…¥çš„å˜åŒ–æ‰€ä»¥ï¼Œåœ¨æ‰€æœ‰è¾“å…¥çš„åœ°æ–¹ä¸‹æ–­ç‚¹ï¼Œä¹‹åè°ƒè¯•ï¼Œå¤šæ¬¡å°è¯•åæ‰§è¡Œå¦‚ä¸‹ã€‚</p><p><strong>ç¬¬ä¸€å—</strong></p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//v31çš„åˆå€¼ä¸º0</span><br>v31 = ~*(_DWORD *)&amp;input_str[<span class="hljs-number">4</span> * v30] &amp; v31 | ~v31 &amp; *(_DWORD *)&amp;input_str[<span class="hljs-number">4</span> * v30];<br>v32 = ~*(_DWORD *)&amp;input_str[<span class="hljs-number">4</span> * v30];  <span class="hljs-comment">// v30è¡¨ç¤ºä¸‹æ ‡</span><br></code></pre></td></tr></tbody></table></figure><p>è¯¥å—ä¸ºä¸æˆ–éæ¥å®ç°å¼‚æˆ–ï¼Œv31ä¾æ¬¡ä¸æ‰€æœ‰è¾“å…¥å¼‚æˆ–(4byteä¸€ç»„)ã€‚</p><p><strong>ç¬¬äºŒå—</strong></p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c">*(_DWORD *)&amp;input_str[<span class="hljs-number">4</span> * v29] = ~*(_DWORD *)&amp;input_str[<span class="hljs-number">4</span> * v29] &amp; v31 | ~v31 &amp; *(_DWORD *)&amp;input_str[<span class="hljs-number">4</span> * v29];<br>v32 = v29;<span class="hljs-comment">//ä¸‹æ ‡</span><br></code></pre></td></tr></tbody></table></figure><p>è¯¥å—ä¸ºè¾“å…¥4byteä¸€ç»„ä¾æ¬¡ä¸v31å¼‚æˆ–ã€‚</p><p><strong>ç¬¬ä¸‰å—</strong></p><figure class="highlight apache"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">input_str</span>[<span class="hljs-number">32</span>] = (input_str[v<span class="hljs-number">28</span>] &amp; <span class="hljs-number">0</span>x<span class="hljs-number">98</span> | ~input_str[v<span class="hljs-number">28</span>] &amp; <span class="hljs-number">0</span>x<span class="hljs-number">67</span>) ^ (input_str[<span class="hljs-number">32</span>] &amp; <span class="hljs-number">0</span>x<span class="hljs-number">98</span> | ~input_str[<span class="hljs-number">32</span>] &amp; <span class="hljs-number">0</span>x<span class="hljs-number">67</span>);<br></code></pre></td></tr></tbody></table></figure><p>æŠŠè¿›è¿‡å¼‚æˆ–åçš„æ‰€æœ‰å­—èŠ‚å¼‚æˆ–åˆ°ä¸€èµ·å¡«å……ä¸º33ä½ï¼Œç”¨äºæ¥ä¸‹æ¥çš„base64è¿ç®—ã€‚</p><p><strong>ç¬¬å››å—</strong></p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c">v15 = v24 &amp; <span class="hljs-number">0xF4</span> | ~v24 &amp; <span class="hljs-number">0xF0C4020B</span>;<br>input_str[v20] = v15 ^ (input_str[v20] &amp; <span class="hljs-number">0xF4</span> | ~input_str[v20] &amp; <span class="hljs-number">0xB</span>);<br>input_str[v20 + <span class="hljs-number">1</span>] = ~v23 &amp; input_str[v20 + <span class="hljs-number">1</span>] | ~input_str[v20 + <span class="hljs-number">1</span>] &amp; v23;<br>LOBYTE(v15) = ~v22 &amp; *(_BYTE *)(v20 + <span class="hljs-number">10825322</span>) | ~*(_BYTE *)(v20 + <span class="hljs-number">10825322</span>) &amp; v22;<br>*(_BYTE *)(v20 + <span class="hljs-number">10825322</span>) = v15;<br> v32 = v15;<br></code></pre></td></tr></tbody></table></figure><p>è¿™ä¸€å—æ¯”è¾ƒå¤æ‚ï¼Œç»“åˆåŠ¨æ€è°ƒè¯•ï¼Œè§‚å¯Ÿè¾“å…¥çš„å˜åŒ–ï¼Œå‘ç°æ˜¯3ä¸ªä¸€ç»„ä¸3ä¸ªæ•°å¼‚æˆ–ï¼Œè€Œå¼‚æˆ–çš„ä¸‰ä¸ªæ•°æ˜¯å‰ä¸€ä¸ªæ•°æ®base64åŠ å¯†æ—¶è½¬åŒ–ä¸ºçš„å‰3ä¸ªä¸‹æ ‡ã€‚</p><p>åœ¨æ‰§è¡Œæ—¶è¿™ä¸ªå¼‚æˆ–æ˜¯ä»å½“å‰å¼€å§‹ï¼Œä¹‹åæ‰€æœ‰ä¸‰ä¸ªä¸€ç»„ä¸è¯¥ç»„è½¬åŒ–çš„keyå¼‚æˆ–ï¼Œç¬¬ä¸€ç»„ä¸åšå¤„ç†ã€‚</p><p><strong>ç¬¬äº”å—</strong></p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c">v24 = (<span class="hljs-keyword">int</span>)input_str[v25] &gt;&gt; <span class="hljs-number">2</span>;         <span class="hljs-comment">// a[0]&gt;&gt;2</span><br>v10 = ~(<span class="hljs-number">16</span> * ~(~input_str[v25] | <span class="hljs-number">0xFC</span>));<span class="hljs-comment">// (a[0]&amp;0x3 &lt;&lt; 4)</span><br>v11 = ~((<span class="hljs-keyword">int</span>)input_str[v25 + <span class="hljs-number">1</span>] &gt;&gt; <span class="hljs-number">4</span>);  <span class="hljs-comment">// a[1]&gt;&gt;4</span><br>v23 = ~(v11 | v10) | (((<span class="hljs-keyword">int</span>)input_str[v25 + <span class="hljs-number">1</span>] &gt;&gt; <span class="hljs-number">4</span>) &amp; <span class="hljs-number">0x24</span> | v11 &amp; <span class="hljs-number">0xDB</span>) ^ ((<span class="hljs-number">16</span> * ~(~input_str[v25] | <span class="hljs-number">0xFC</span>)) &amp; <span class="hljs-number">0x24</span> | v10 &amp; <span class="hljs-number">0xDB</span>);<br>LOBYTE(v11) = ~(<span class="hljs-number">4</span> * (input_str[v25 + <span class="hljs-number">1</span>] &amp; (input_str[v25 + <span class="hljs-number">1</span>] ^ <span class="hljs-number">0xF0</span>)));<br>v12 = ~((<span class="hljs-keyword">int</span>)input_str[v25 + <span class="hljs-number">2</span>] &gt;&gt; <span class="hljs-number">6</span>);<br>v22 = ~(v12 | v11) | (((<span class="hljs-keyword">int</span>)input_str[v25 + <span class="hljs-number">2</span>] &gt;&gt; <span class="hljs-number">6</span>) &amp; <span class="hljs-number">0x11</span> | v12 &amp; <span class="hljs-number">0xEE</span>) ^ ((<span class="hljs-number">4</span>* (input_str[v25 + <span class="hljs-number">1</span>] &amp; (input_str[v25 + <span class="hljs-number">1</span>] ^ <span class="hljs-number">0xF0</span>))) &amp; <span class="hljs-number">0x11</span> | v11 &amp; <span class="hljs-number">0xEE</span>);<br>v21 = input_str[v25 + <span class="hljs-number">2</span>] &amp; (input_str[v25 + <span class="hljs-number">2</span>] ^ <span class="hljs-number">0xC0</span>);<br>v32 = <span class="hljs-number">0x7F</span>;<br>Str1[v26] = *(_BYTE *)sub_A22210(&amp;off_A52E38, v24);<br>Str1[v26 + <span class="hljs-number">1</span>] = *(_BYTE *)sub_A22210(&amp;off_A52E38, v23);<br>Str1[v26 + <span class="hljs-number">2</span>] = *(_BYTE *)sub_A22210(&amp;off_A52E38, v22);<br>v13 = v26 + <span class="hljs-number">3</span>;<br>v26 += <span class="hljs-number">4</span>;<br>Str1[v13] = *(_BYTE *)sub_A22210(&amp;off_A52E38, v21);<br>v20 = v25 + <span class="hljs-number">3</span>;<br>v19 = <span class="hljs-number">0xC90DC21D</span>;<br></code></pre></td></tr></tbody></table></figure><p>base64åŠ å¯†ï¼ŒåŠ¨è°ƒæµ‹è¯•å¾—çŸ¥3byteå˜ä¸º4byteçš„æ¯ç»„6bitçš„é¡ºåºæ²¡æœ‰å˜ï¼Œåªä¸è¿‡ç”¨ä¸æˆ–éå®ç°èµ·æ¥æ¯”è¾ƒéš¾è¯»ï¼Œè¿™ä¸€æ­¥å’Œç¬¬å››å—æ˜¯äº¤æ›¿è¿›è¡Œçš„ï¼Œæ¯è¿›è¡Œä¸€æ¬¡ç¬¬äº”å—å†è¿›è¡Œç¬¬å››å—ï¼Œbase64çš„è¡¨éœ€è¦åŠ¨è°ƒè·å¾—ã€‚</p><p>é€šè¿‡&amp;off_A52E38é—´æ¥å¯»å€è·å¾—ã€‚</p><p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220124231204350.png" alt="image-20220124231204350"></p><p>è€å¿ƒè°ƒè¯•ï¼Œäº†è§£å—çš„æ‰§è¡Œé¡ºåºåæ¢³ç†è§£å¯†é€»è¾‘ï¼Œå…ˆæ˜¯base64æ¢è¡¨ï¼Œä¹‹åé€†ç¬¬å››å—çš„å¼‚æˆ–ï¼Œå†ä¹‹åéœ€è¦æ‹¿åˆ°v31ï¼Œå‡è®¾æˆ‘ä»¬çš„baseè§£å¯†åçš„ä¸º c d å³ a^v31 b^v31 è€Œ v31æ˜¯ç”±a^bå¾—åˆ°æ‰€ä»¥ c^d == a^d  å…¶ä¸­å¼‚æˆ–çš„v31æŠµæ¶ˆäº†ï¼Œå› æ­¤å¼‚æˆ–çš„4byteçš„keyå¯ç”±å¯†æ–‡4ä¸ªä¸€ç»„å¼‚æˆ–å¾—åˆ°ï¼Œä¹‹åå†è¿›è¡Œè§£å¯†ã€‚</p><p>å®Œæ•´expå¦‚ä¸‹:</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64<br>s=<span class="hljs-string">'Fi9X/fxX6Q6JBfUfBM1V/y6V6PcPjMaQLl9IuttFuH68'</span><br>t1=<span class="hljs-string">'QVEJAfHmUYjBac+u8Ph5n9Od16FrICL/X0GvtM4qk7T2z3wNSsyoebilxWKgZpRD'</span><br>t2=<span class="hljs-string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'</span><br>c=<span class="hljs-string">''</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(s)):<br>    c+=t2[t1.index(s[i])]<br>cc=<span class="hljs-built_in">list</span>(base64.b64decode(c.encode()))  <span class="hljs-comment">#baseæ¢è¡¨</span><br><br>t=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(cc),<span class="hljs-number">3</span>): <span class="hljs-comment">#åˆ†æˆ3ä¸ªä¸€ç»„</span><br>    t.append(cc[i:i+<span class="hljs-number">3</span>])<br><span class="hljs-built_in">print</span>(t)<br>new=[t[<span class="hljs-number">0</span>]]<br><br>key=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-built_in">len</span>(t)):<br>    tmp=[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>]<br>    a=base64.b64encode(<span class="hljs-built_in">bytes</span>(t[i-<span class="hljs-number">1</span>])).decode()<br>    k=[]<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):<br>        k.append(t2.find(a[j]))<br>    key.append(k)<br><br><span class="hljs-comment">#print(key) è¿˜åŸbase64æ‰€ç”¨key</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(t)):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(i):<br>        k=key[j]<br>        <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):<br>            t[i][p]^=k[p]<br><span class="hljs-built_in">print</span>(t) <span class="hljs-comment">#ä½ è¿­ä»£çš„base</span><br><br>m=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> t:<br>    m.extend(i)<br><span class="hljs-comment">#print(m)            #baseé€†å‘åçš„æ˜æ–‡</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">bytes</span>(m))<br>mm=[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>]<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">xor</span>(<span class="hljs-params">a,b</span>):</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(a)):<br>        a[i]^=b[i]<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(m)-<span class="hljs-number">1</span>,<span class="hljs-number">4</span>): <span class="hljs-comment">#éœ€è¦å¼‚æˆ–v31 è€Œ v31æ˜¯ç”± æ˜æ–‡4ä¸ªä¸€ç»„å¼‚æˆ–è€Œæ¥</span><br>   xor(mm,m[i:i+<span class="hljs-number">4</span>])<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(m)):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(mm[i%<span class="hljs-number">4</span>]^m[i]),end=<span class="hljs-string">''</span>)<br><span class="hljs-comment">#fce5e3dfc6db4f808ccaa6fcffecf583P</span><br></code></pre></td></tr></tbody></table></figure><hr><blockquote><p>re1ç†è§£é”™äº†ï¼Œä¹‹å‰ä¹Ÿæ²¡æœ‰ç¼–å†™è§£é‡Šå™¨çš„ç»éªŒï¼Œåç»­ä¼šå¤ç°è¡¥ä¸Šã€‚</p><p>åŒæ—¶èµ›ä¸­èŠ±å¤§é‡æ—¶é—´å»æAndroidäº†ï¼Œå¯æƒœæœ€ç»ˆæ²¡èƒ½è°ƒåŠ¨èµ·soæ–‡ä»¶ï¼Œå¯èƒ½æ˜¯æ¨¡æ‹Ÿå™¨æœ‰ç‚¹é—®é¢˜æŠŠï¼Œä¸€ç›´attachç›®æ ‡ç¨‹åºä¸ä¸Šï¼Œä½†æœ€ç»ˆæ”¶è·ä¹Ÿæ˜¯è›®å¤§çš„ã€‚</p><p>è¿™æ¬¡å†™è§£å¯†è„šæœ¬å¤±è¯¯æœ‰ç‚¹å¤§ï¼Œå·®ç‚¹re3å°±åºŸäº†ï¼Œçœ‹må¸ˆå‚…ç”¨z3è§£çš„ï¼Œç¡®å®åˆå¿«åˆå‡†ï¼Œè‡ªå·±è¿˜è¦å¥½å¥½åŠ æ²¹å“¦<img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/0BE18A75.png" alt="img" style="zoom: 33%;"></p></blockquote>]]></content>
    
    
    <categories>
      
      <category>CTF-WP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Wp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PinTool-DBIæŠ€æœ¯åˆ©ç”¨</title>
    <link href="/2021/12/31/PinTool-DBI%E5%88%A9%E7%94%A8/"/>
    <url>/2021/12/31/PinTool-DBI%E5%88%A9%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<blockquote><p>ä»¥2021SCTFçš„Low-REä¸ºä¸»ï¼Œåˆæ¢pintoolæŠ€æœ¯ï¼Œä¹Ÿå¯¹REæ‰‹æ®µæœ‰äº†æ–°çš„è®¤è¯†</p></blockquote><h1>IntelPinçš„å®‰è£…</h1><blockquote><p>Pin æ˜¯ Intel å…¬å¸ç ”å‘çš„ä¸€ä¸ªåŠ¨æ€äºŒè¿›åˆ¶æ’æ¡©æ¡†æ¶ï¼Œå¯ä»¥åœ¨äºŒè¿›åˆ¶ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­æ’å…¥å„ç§å‡½æ•°ï¼Œä»¥ç›‘æ§ç¨‹åºæ¯ä¸€æ­¥çš„æ‰§è¡Œã€‚</p></blockquote><h2 id="æ¡ä»¶å‡†å¤‡">æ¡ä»¶å‡†å¤‡</h2><figure class="highlight c"><table><tbody><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><pre><code class="hljs c"><span class="hljs-number">1</span>ã€Visual Studio Community <span class="hljs-number">2019</span> Edition<br><br><span class="hljs-number">2</span>ã€Cygwin<span class="hljs-number">'</span>s <span class="hljs-number">64</span>-bit<br><span class="hljs-comment">//https://cygwin.com/install.html</span><br><span class="hljs-comment">//éœ€è¦å†å®‰è£…æ—¶é€‰æ‹©make gcc-g++çš„åŒ…ï¼Œéé»˜è®¤</span><br>    <br><span class="hljs-number">3</span>ã€Intel Pin<br><span class="hljs-comment">//https://www.intel.com/content/www/us/en/developer/articles/tool/pin-a-binary-instrumentation-tool-downloads.html</span><br><span class="hljs-comment">//ç‰ˆæœ¬å¯ä»¥åœ¨3.18 - 3.20 æˆ– 3.11-3.13 æœ‰äº›å¯¹åº”ç‰ˆæœ¬çš„å·¥å…·å·²ç»è¢«ç¼–è¯‘ä¸ºdllåœ¨gitä¸Š</span><br></code></pre></td></tr></tbody></table></figure><h3 id="VS">VS</h3><p>ä¸è¿‡è¦è®°å½•VSçš„vcvars32/64.batçš„å­˜æ”¾è·¯å¾„ï¼Œæ‰¾åˆ°VSå­˜æ”¾çš„ä½ç½®ï¼Œä¾‹å¦‚ã€‚</p><blockquote><p>â€œF:\visual studio2019\VC\Auxiliary\Buildâ€<br>buildæ–‡ä»¶å¤¹ä¸‹æœ‰è¿™ä¸¤ä¸ªbatæ–‡ä»¶</p></blockquote><h3 id="Cygwin">Cygwin</h3><p>Cygwinæ˜¯èƒ½åœ¨windowsç¯å¢ƒä¸‹æ‰§è¡Œlinuxçš„æŒ‡ä»¤ï¼Œä¸è¿‡makeï¼Œgccï¼Œg++ç­‰æŒ‡ä»¤è¦è‡ªå·±ä¸‹è½½ã€‚</p><p><img src="https://i.imgur.com/5fpdYVd.png" alt=""></p><p>view é€‰æ‹©FULL æœç´¢è¦å®‰è£…çš„gcc-g++ å’Œ make å³å¯ï¼Œå°ç®­å¤´é€‰ç€ç‰ˆæœ¬ï¼Œskipå³è·³è¿‡ã€‚</p><p><strong>ä¸‹è½½å®Œæˆåï¼Œå°†â€™D:\Cygwin\binâ€™æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ã€‚</strong></p><p><strong>cygwinå®‰è£…æ–°åŒ…</strong></p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-number">1</span>ã€é‡æ–°è¿è¡Œå®‰è£…ç¨‹åº<br><br><span class="hljs-number">2</span>ã€ç±»ä¼¼apt-get<br><br> apt-cyg install yourPackage<br></code></pre></td></tr></tbody></table></figure><h3 id="Intel-Pin">Intel Pin</h3><p><a href="https://www.intel.com/content/www/us/en/developer/articles/tool/pin-a-binary-instrumentation-tool-downloads.html">Intel pinå®˜ç½‘ä¸‹è½½</a></p><p><strong>ç‰ˆæœ¬å¯ä»¥é€‰æ‹©3.18-3.20 / 3.10-3.13 æœ‰ç°æˆçš„å·¥å…·</strong>ã€‚</p><p>å®Œæˆä¸‹è½½åï¼Œå°†pin.exeæ‰€åœ¨çš„ç›®å½•æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ã€‚</p><blockquote><p>ä¾‹å¦‚: â€œD:\pindir\pinâ€</p></blockquote><p>å®Œæˆä»¥ä¸Šæ“ä½œåï¼Œéœ€è¦å¯¹pin\source\tools\ManualExamplesçš„æ–‡ä»¶è¿›è¡Œç¼–è¯‘</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c">x64<br><br>pushd D:\pindir\pin\source\tools\ManualExamples<br><span class="hljs-comment">//é€‰æ‹©å¯¹åº”ä½çš„batæ–‡ä»¶</span><br><br><span class="hljs-string">"F:\visual studio2019\VC\Auxiliary\Build\vcvars64.bat"</span><br><br>make all æˆ– make TARGET=intel64 <span class="hljs-comment">//ç­‰å¾…å³å¯</span><br><br><br><br>x86<br><br>pushd D:\pindir\pin\source\tools\ManualExamples<br><span class="hljs-comment">//é€‰æ‹©å¯¹åº”ä½çš„batæ–‡ä»¶</span><br><br><span class="hljs-string">"F:\visual studio2019\VC\Auxiliary\Build\vcvars64.bat"</span><br><br>make all æˆ– make TARGET=ia32 <span class="hljs-comment">//ç­‰å¾…å³å¯</span><br><br></code></pre></td></tr></tbody></table></figure><p><strong>ç¼–è¯‘æˆåŠŸåï¼Œä¼šåœ¨ManualExamplesç›®å½•ä¸‹ç”Ÿæˆä¸¤ä¸ªç›®å½•ï¼Œé‡Œé¢çš„dll æ–‡ä»¶å³ç”¨åˆ°çš„pintoolsã€‚</strong></p><blockquote><p>ä½¿ç”¨è¯­æ³•<br>pin -t inscount0.dll â€“ test.exe   ä¸¤ä¸ª-</p></blockquote><p>å•ç‹¬æŠŠpintoolçš„dllæ–‡ä»¶æ”¾åˆ°ä¸ç›®æ ‡PEæ–‡ä»¶åŒç›®å½•ä¸‹ï¼Œæ‰“å¼€cmdè¾“å…¥æŒ‡ä»¤å³å¯ã€‚</p><p><strong>å®Œæˆä¸Šè¿°æ“ä½œåï¼ŒIntel Pinçš„ä¸€äº›å¸¸ç”¨pindllå³å¯è‡ªç”±ä½¿ç”¨ã€‚</strong></p><p>æœ‰å…³pinçš„æ›´å¤šçŸ¥è¯†è¯¦è§:<a href="https://firmianay.gitbooks.io/ctf-all-in-one/content/doc/5.2.1_pin.html#pin-%E5%9C%A8-ctf-%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8">https://firmianay.gitbooks.io/ctf-all-in-one/content/doc/5.2.1_pin.html#pin-åœ¨-ctf-ä¸­çš„åº”ç”¨</a></p><h1>Pinåœ¨CTFä¸­çš„ä½¿ç”¨</h1><blockquote><p>æ ¹æ®åšé¢˜ç»éªŒï¼Œå¾€å¾€åŠ å¯†åflagçš„checkæ˜¯é€ä¸ªæ¯”å¯¹ï¼Œä¹Ÿå°±æ˜¯è¾ƒæ¥è¿‘æ˜æ–‡çš„è¾“å…¥æ‰§è¡Œçš„æŒ‡ä»¤æ•°ç›®è¶Šå¤šï¼Œæˆ–ç”¨æ¯”è¾ƒæ¬¡æ•°æ¥åæ˜ ï¼Œæ ¹æ®è¿™ä¸€ç‰¹æ€§ï¼Œæœ‰äº†pinçš„inscountçš„è¾…åŠ©ï¼Œæˆ‘ä»¬ä¾¿èƒ½é€šè¿‡åé¦ˆçš„æŒ‡ä»¤æ‰§è¡Œæ•°ç›®æ¥çˆ†ç ´flagã€‚</p></blockquote><h2 id="low-re">low_re</h2><blockquote><p>é¢˜ç›®é™„ä»¶åœ¨æ–‡æœ«ã€‚</p></blockquote><p><img src="https://res.cloudinary.com/lu1u/image/upload/v1640960133/blog_img/%E6%AF%94%E8%B5%9B%E5%A4%8D%E7%8E%B0/sctf-lowre_etmaja.png" alt=""></p><p>VMä¿æŠ¤å£³ï¼Œ64ä½ç¨‹åºï¼Œè„±èµ·å£³æ¥å°±æ¯”è¾ƒéº»çƒ¦ï¼Œä¸è¿‡x64dbgèƒ½ç›´æ¥å®šä½å…¥å£ç‚¹dumpå‡ºï¼Œä½†è„±å£³åçš„ç¨‹åºæ‹–å…¥IDAçš„é€»è¾‘ä¹Ÿçœ‹ä¸å‡ºå¦‚ä½•æ‰§è¡Œã€‚</p><p>stringsçª—å£æœ‰çº¿ç´¢ï¼Œæœ‰äº›hashå’Œflagçš„æç¤ºè¾“å…¥ï¼Œä¹Ÿéš¾çŒœå‡ºåŠ å¯†ç®—æ³•å¦‚ä½•ï¼Œèµ·åˆå°è¯•åŠ¨è°ƒï¼Œè™½ç„¶äº†è§£åˆ°æ˜¯åœ¨è°ƒç”¨pyæ–‡ä»¶æ‰§è¡ŒåŠ å¯†ï¼Œå¹¶ä¸”æ‰¾åˆ°äº†å‡ ä¸ªå…³é”®å‡½æ•°ï¼Œä½†æ˜¯è¿˜æ˜¯å‘ç°ä¸äº†åŠ å¯†è¿‡ç¨‹ã€‚</p><blockquote><p>ç”±æ­¤å¼•å…¥ä¸€ç§æ–°çš„REæ–¹å¼ï¼Œé™æ€å’ŒåŠ¨æ€éƒ½æ— æ„Ÿï¼Œå°±å°è¯•pintoolæ¥æš´ç ´ä¸€ä¸‹ã€‚</p></blockquote><h3 id="çˆ†ç ´è¾“å…¥é•¿åº¦">çˆ†ç ´è¾“å…¥é•¿åº¦</h3><p>ä¸ºäº†è®©è¾“å‡ºæ•ˆæœæ›´ç›´è§‚ä¸€äº›ï¼Œä¿®æ”¹inscount0.cppç¼–è¯‘å‡ºmycount64.dll,(è‡ªå¸¦çš„æ˜¯å†™å…¥åˆ°æ–‡ä»¶)ã€‚</p><blockquote><p>inscount1(BBçº§æ’æ¡©) ä¸ inscount0(insçº§æ’æ¡©) æ•ˆæœç›¸åŒï¼Œä½† inscount1 é€Ÿåº¦æ›´å¿«ï¼Œå®é™…è§£é¢˜æ—¶å¯ä»¥ç”¨ inscount1 ä»£æ›¿ inscount0</p></blockquote><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">VOID <span class="hljs-title">Fini</span><span class="hljs-params">(INT32 code, VOID *v)</span></span><br><span class="hljs-function"></span>{<br>    <span class="hljs-comment">// Write to a file since cout and cerr maybe closed by the application</span><br>    OutFile.setf(ios::showbase);<br>    OutFile &lt;&lt; <span class="hljs-string">"Count "</span> &lt;&lt; icount &lt;&lt; <span class="hljs-built_in">endl</span>;<br><span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span>&lt;&lt;<span class="hljs-string">"Count "</span> &lt;&lt; icount &lt;&lt; <span class="hljs-built_in">endl</span>;<span class="hljs-comment">//this ç»“æœè¾“å‡º</span><br>    OutFile.close();<br>}<br></code></pre></td></tr></tbody></table></figure><p>æ ¹æ®hashçš„æ¡æ•°æ¥çœ‹è¾“å…¥çš„ä½æ•°ä¸ä¼šå¤ªå¤šï¼Œå…ˆç”¨mycountçˆ†ç ´ä¸€ä¸‹ä¸åŒè¾“å…¥ä½æ•°ï¼Œå› ä¸ºç¨‹åºä¸€èˆ¬éƒ½ä¼šæ£€æµ‹ä¸€ä¸‹è¾“å…¥çš„é•¿åº¦ï¼Œå¦‚æœé•¿åº¦æ­£ç¡®åé¦ˆçš„æŒ‡ä»¤æ•°ä¹Ÿä¼šæ›´å¤šã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> subprocess <span class="hljs-keyword">import</span> Popen,PIPE<br><span class="hljs-keyword">from</span> sys <span class="hljs-keyword">import</span> argv<br><span class="hljs-keyword">import</span> string<br>pinInit = <span class="hljs-keyword">lambda</span> tool,pe: Popen([<span class="hljs-string">'pin'</span>,<span class="hljs-string">'-t'</span>,tool,<span class="hljs-string">'--'</span>,pe],stdin=PIPE,stdout=PIPE)<br>pinWrite = <span class="hljs-keyword">lambda</span>  cont : pin.stdin.write(cont)<br>pinRead = <span class="hljs-keyword">lambda</span> : pin.communicate()[<span class="hljs-number">0</span>]<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:<br>    last_count = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">30</span>):<br>        pin = pinInit(<span class="hljs-string">"mycount64"</span>,<span class="hljs-string">"low_re.exe"</span>)<br>        pinWrite(<span class="hljs-string">b"a"</span>*i+<span class="hljs-string">b'\n'</span>)  <span class="hljs-comment">#  æ¢è¡Œå‰å³è¾“å…¥å†…å®¹</span><br>        _count = <span class="hljs-built_in">int</span>(pinRead().split(<span class="hljs-string">b"Count "</span>)[<span class="hljs-number">1</span>])<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">"inputlen({:2d}) -&gt; cout({}) -&gt; delta({})"</span>.<span class="hljs-built_in">format</span>(i,_count,_count-last_count))<br>        last_count=_count<br></code></pre></td></tr></tbody></table></figure><p><img src="https://res.cloudinary.com/lu1u/image/upload/v1640960688/blog_img/%E6%AF%94%E8%B5%9B%E5%A4%8D%E7%8E%B0/lowre1_cqg80x.png" alt=""></p><p>å¯è§åœ¨è¾“å…¥é•¿åº¦ä¸º17æ—¶è¿”å›çš„æŒ‡ä»¤æ•°ç›®æ˜æ˜¾å¤šäºå…¶ä»–é•¿åº¦ï¼Œæ•…flagå¤§è‡´é•¿ä¸º17ã€‚</p><h3 id="çˆ†ç ´è¾“å…¥å†…å®¹">çˆ†ç ´è¾“å…¥å†…å®¹</h3><p>ä¹Ÿæ˜¯æ ¹æ®åé¦ˆæŒ‡ä»¤æ•°ç›®æœ€å¤šæ¥ä¼°è®¡ä¸ºæ­£ç¡®å­—ç¬¦ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> subprocess <span class="hljs-keyword">import</span> Popen,PIPE<br><span class="hljs-keyword">from</span> sys <span class="hljs-keyword">import</span> argv<br><span class="hljs-keyword">import</span> string<br>pinInit = <span class="hljs-keyword">lambda</span> tool,pe: Popen([<span class="hljs-string">'pin'</span>,<span class="hljs-string">'-t'</span>,tool,<span class="hljs-string">'--'</span>,pe],stdin=PIPE,stdout=PIPE)<br>pinWrite = <span class="hljs-keyword">lambda</span>  cont : pin.stdin.write(cont)<br>pinRead = <span class="hljs-keyword">lambda</span> : pin.communicate()[<span class="hljs-number">0</span>]<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:<br>    last_count = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> string.printable: <span class="hljs-comment">#ä»å¯æ‰“å°å­—ç¬¦ä¸­çˆ†ç ´</span><br>        pin = pinInit(<span class="hljs-string">"mycount64"</span>,<span class="hljs-string">"low_re.exe"</span>)<br>        pinWrite(i.encode()+<span class="hljs-string">b'*'</span>*<span class="hljs-number">16</span>+<span class="hljs-string">b'\n'</span>)  <span class="hljs-comment">#  æ¢è¡Œå‰å³è¾“å…¥å†…å®¹</span><br>        _count = <span class="hljs-built_in">int</span>(pinRead().split(<span class="hljs-string">b"Count "</span>)[<span class="hljs-number">1</span>])<br>        <span class="hljs-comment">#print("inputlen({:2d}) -&gt; cout({}) -&gt; delta({})".format(i,_count,_count-last_count))</span><br>        <span class="hljs-comment">#last_count=_count</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">'Count(%s) : %d'</span>%(i,_count))<br><span class="hljs-comment"># ***************** -&gt;624221257</span><br><span class="hljs-comment"># S**************** -&gt;659084533</span><br><span class="hljs-comment"># S1*************** -&gt;699517166</span><br></code></pre></td></tr></tbody></table></figure><p>å¦‚ä¸‹å›¾ï¼Œç¬¬ä¸€ä¸ªå­—ç¬¦ä¸ºSæ—¶æŒ‡ä»¤æ•°ç›®æœ€å¤šï¼ŒæŒ‰ç…§å¦‚ä¸‹æ€è·¯çˆ†ç ´ã€‚</p><p><img src="https://res.cloudinary.com/lu1u/image/upload/v1640960965/blog_img/%E6%AF%94%E8%B5%9B%E5%A4%8D%E7%8E%B0/lowre2_eygakr.png" alt=""></p><p>å•ç”±ä¸»çº¿ç¨‹çˆ†ç ´ä¼šæ¯”è¾ƒæ…¢ï¼Œåˆæ¶‰æ—¶è·‘äº†1ä¸ªå¤šå°æ—¶ï¼Œäº†è§£å¤šçº¿ç¨‹åï¼Œç”¨pythonå®ç°å¤šçº¿ç¨‹çš„çˆ†ç ´ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> subprocess <span class="hljs-keyword">import</span> Popen,PIPE<br><span class="hljs-keyword">from</span> sys <span class="hljs-keyword">import</span> argv<br><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> queue<br><span class="hljs-keyword">import</span> string<br>pinInit = <span class="hljs-keyword">lambda</span> tool,pe: Popen([<span class="hljs-string">'pin'</span>,<span class="hljs-string">'-t'</span>,tool,<span class="hljs-string">'--'</span>,pe],stdin=PIPE,stdout=PIPE)<br>last_count=<span class="hljs-number">695980376</span> <span class="hljs-comment">#å½“å‰å­—ç¬¦å¯¹åº”çš„æŒ‡ä»¤æ•°</span><br>flag=<span class="hljs-string">'S1'</span> <span class="hljs-comment">#æµ‹è¯•çš„å­—ç¬¦</span><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">pintool</span>(<span class="hljs-params">s</span>):</span><br>    pin = pinInit(<span class="hljs-string">"mycount64"</span>, <span class="hljs-string">"low_re.exe"</span>)<br>    pin.stdin.write(s.encode())<br>    _count = <span class="hljs-built_in">int</span>(pin.communicate()[<span class="hljs-number">0</span>].split(<span class="hljs-string">b"Count "</span>)[<span class="hljs-number">1</span>])<br>    <span class="hljs-keyword">return</span> _count<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">boom</span>():</span><br>        <span class="hljs-keyword">global</span> flag,last_count,Tcount<br><br>        <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> q.empty():<br>            nows=q.get()<br>            s=(flag+nows).ljust(<span class="hljs-number">17</span>,<span class="hljs-string">'*'</span>)+<span class="hljs-string">'\n'</span> <span class="hljs-comment">#æ¢è¡Œä»£è¡¨è¾“å…¥</span><br>            cout=pintool(s)<br>            <span class="hljs-keyword">if</span> cout - last_count &gt; <span class="hljs-number">30000000</span>:<span class="hljs-comment">#è®¾å®šå€¼æ¥åˆ¤å®šè¾“å…¥æ˜¯å¦æ­£ç¡®</span><br>                flag += nows<br>                last_count = cout<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">'now_str({}) -&gt; count({})'</span>.<span class="hljs-built_in">format</span>(flag, cout))<br>                q.queue.clear()<br>                <span class="hljs-keyword">return</span><br>            <span class="hljs-comment">#    q.queue.clear() æ¸…é™¤é˜Ÿåˆ—å†èµ‹å€¼</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">setque</span>(<span class="hljs-params">q</span>):</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> string.printable[:-<span class="hljs-number">2</span>]:<span class="hljs-comment">#</span><br>        q.put(i)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:<br>    q = queue.Queue(<span class="hljs-number">100</span>)<br>    setque(q)<br><br>    <span class="hljs-keyword">while</span> <span class="hljs-built_in">len</span>(flag)!=<span class="hljs-number">17</span>:<br>        <span class="hljs-keyword">if</span> q.empty():<br>            setque(q)<br>        <span class="hljs-keyword">while</span> threading.active_count()&lt;<span class="hljs-number">5</span>: <span class="hljs-comment">#ç»´æŒæ´»è·ƒçš„å¤šçº¿ç¨‹</span><br>             t=threading.Thread(target=boom)<br>             <span class="hljs-comment">#print(threading.active_count())</span><br>             t.start()<br></code></pre></td></tr></tbody></table></figure><p>è¿è¡Œç»“æœ:</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs c">now_str(S1) -&gt; count(<span class="hljs-number">695980376</span>)<br>now_str(S1d) -&gt; count(<span class="hljs-number">735896918</span>)<br>now_str(S1de) -&gt; count(<span class="hljs-number">773007592</span>)<br>now_str(S1deC) -&gt; count(<span class="hljs-number">811103179</span>)<br>now_str(S1deCh) -&gt; count(<span class="hljs-number">852675272</span>)<br>now_str(S1deCh4) -&gt; count(<span class="hljs-number">885489938</span>)<br>now_str(S1deCh4n) -&gt; count(<span class="hljs-number">927208181</span>)<br>now_str(S1deCh4nn) -&gt; count(<span class="hljs-number">965470416</span>)<br>now_str(S1deCh4nne) -&gt; count(<span class="hljs-number">1002501465</span>)<br>now_str(S1deCh4nnel) -&gt; count(<span class="hljs-number">1035433103</span>)<br>now_str(S1deCh4nnelA) -&gt; count(<span class="hljs-number">1074349914</span>)<br>now_str(S1deCh4nnelAt) -&gt; count(<span class="hljs-number">1112107131</span>)<br>now_str(S1deCh4nnelAtt) -&gt; count(<span class="hljs-number">1149152834</span>)<br>now_str(S1deCh4nnelAtt@) -&gt; count(<span class="hljs-number">1192837040</span>)<br>now_str(S1deCh4nnelAtt@c) -&gt; count(<span class="hljs-number">1231986313</span>)<br><span class="hljs-comment">//SCTF{S1deCh4nnelAtt@ck}</span><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">hello challanger</span><br><span class="hljs-comment">please input your flag:</span><br><span class="hljs-comment">S1deCh4nnelAtt@ck</span><br><span class="hljs-comment">you are right</span><br><span class="hljs-comment">Count 1227060385*/</span><br></code></pre></td></tr></tbody></table></figure><p>åœ¨è·‘åˆ°æœ€åä¸€ä¸ªå­—ç¬¦æ—¶ä¼šæœ‰äº›åå¸¸ï¼Œå¯ä»¥å•ç‹¬å†çˆ†ç ´æˆ–è€…æ ¹æ®å¤§æ„çŒœå‡ºä¸ºattackã€‚</p><blockquote><p>åæ€:æœ¬é¢˜æœ‰ç€VMå£³ï¼Œæˆ–è€…å¦‚æœé‡åˆ°å¤§é‡çš„æ··æ·†ï¼Œåœ¨flagé•¿åº¦è¾ƒçŸ­çš„æƒ…å†µä¸‹ï¼Œpintoolæ— ç–‘æ˜¯ä¸€å¤§åˆ©å™¨ã€‚</p></blockquote><p>æœ‰äº›ç¨‹åºåˆ¤æ–­flagæ­£è¯¯ä¼šæœ‰congraæˆ–wrong!ç­‰æç¤ºï¼Œè¿”å›å€¼åœ¨pin.communicate()å…ƒç»„ä¸­ï¼Œä¹Ÿå¯ä»¥ç”¨äºçˆ†ç ´ã€‚</p><h2 id="checkåˆ¤æ–­è®¡æ•°">checkåˆ¤æ–­è®¡æ•°</h2><blockquote><p>æœ‰æ—¶æ­£ç¡®æˆ–è€…é”™è¯¯çš„è¾“å…¥åœ¨æ‰§è¡ŒæŒ‡ä»¤æ•°ä¸Šæ²¡æœ‰è¾ƒå¤§å·®åˆ«ï¼Œé‚£ä¹ˆç¬¬ä¸€ç§æ–¹å¼å°±ä¸å¤ªé€‚ç”¨äº†ï¼Œä½†æ˜¯ç¨‹åºå¦‚æœæ˜¯å¯¹è¾“å…¥é€ä¸ªcheckçš„è¯ï¼Œå¹¶ä¸”æˆ‘ä»¬IDAä¸­å·²çŸ¥åˆ¤æ–­ä»£ç çš„åœ°å€ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½é€šè¿‡æ”¹å†™pintoolæ¥è®¡æ•°ã€‚</p></blockquote><p>ä¾‹å¦‚:</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;length(provided_flag); i++)<br>{<br><span class="hljs-keyword">if</span> (main_mapanic(provided_flag[i]) != constant_binary_blob[i])<br>{<br>bad_boy();<br><span class="hljs-built_in">exit</span>();<br>}<br>goodboy();<br>}<br><span class="hljs-comment">//èŠ‚é€‰è‡ªå‰è¾ˆåšå®¢</span><br></code></pre></td></tr></tbody></table></figure><p>å¯è§æ˜¯é€ä¸ªå¯¹flagè¿›è¡Œæ¯”è¾ƒçš„ï¼Œå³cmpå¤„ï¼Œæˆ‘ä»¬å¯ä»¥ä»¥æ­¤ä¸ºå‚è€ƒï¼Œæ¯å½“ç¨‹åºæ‰§è¡Œåˆ°cmpä¸€æ¬¡è®¡æ•°åŠ ä¸€ï¼Œå› ä¸ºå¦‚æœæ¯”å¯¹é”™è¯¯ç¨‹åºå°±ä¼šé€€å‡ºï¼Œç”±æ­¤å¯ä»¥ç”±countçš„å¤§å°æ¥åˆ¤æ–­è¾“å…¥çš„æ­£ç¡®æ€§ã€‚</p><p>åŒæ ·ï¼Œå¯¹inscount0è¿›è¡Œä¿®æ”¹å¹¶ç¼–è¯‘æˆæ–°çš„pintoolã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c">æ›´æ”¹å‰ï¼š<br><span class="hljs-function">VOID <span class="hljs-title">docount</span><span class="hljs-params">()</span> </span>{ icount++; }<br>æ›´æ”¹åï¼š<br><span class="hljs-function">VOID <span class="hljs-title">docount</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *ip)</span> </span><br><span class="hljs-function"></span>{<br>  <span class="hljs-comment">// .text:000000000047B96E  cmp al, cl; #ä»£ç æ¯”è¾ƒå¤„</span><br><span class="hljs-keyword">if</span> ((<span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">int</span>)ip == <span class="hljs-number">0x000000000047B96E</span>)<br> icount++; <br>}<br><br></code></pre></td></tr></tbody></table></figure><p>ç¼–å†™pyè„šæœ¬å¯¹ç¨‹åºè¿›è¡Œpintoolæ”»å‡»å³å¯ã€‚</p><blockquote><p>æœ€è¿‘åˆæ¶‰äºŒè¿›åˆ¶æ’æ¡©æŠ€æœ¯å’Œpintoolçš„ç®€å•ä½¿ç”¨ï¼ŒæŸäº›åœ°æ–¹å¯èƒ½æœ‰é”™è¯¯ç†è§£ï¼ŒåŒæ—¶å¤šçº¿ç¨‹çš„è„šæœ¬å¯èƒ½å†™çš„æœ‰ç‚¹æ‹‰è·¨ï¼Œè¿˜æœ›å¸ˆå‚…ä»¬æŒ‡æ­£ã€‚</p></blockquote><hr><p>å‚è€ƒ:</p><p>[pin install]èµ·åˆé…ç½®å‚è€ƒ: <a href="https://www.cnblogs.com/mgdzy/p/13644475.html">https://www.cnblogs.com/mgdzy/p/13644475.html</a></p><p>[pin in ctf]<a href="https://m4x.fun/post/pin-in-ctf/">https://m4x.fun/post/pin-in-ctf/</a></p><p>[cpuä¾§ä¿¡é“]<a href="https://www.istt.org.cn/NewsDetail/2672118.html">https://www.istt.org.cn/NewsDetail/2672118.html</a></p><p>[å¤šçº¿ç¨‹è„šæœ¬ç¼–å†™]<a href="https://www.cnblogs.com/franknihao/p/6627857.html">https://www.cnblogs.com/franknihao/p/6627857.html</a></p><p>low_reé“¾æ¥ï¼š<a href="https://pan.baidu.com/s/17-1WMhu9g5scBQ-RO6MO9Q">https://pan.baidu.com/s/17-1WMhu9g5scBQ-RO6MO9Q</a><br>æå–ç ï¼šuuuu</p>]]></content>
    
    
    <categories>
      
      <category>RE</category>
      
    </categories>
    
    
    <tags>
      
      <tag>RE</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>RSA dpå’Œdqæ³„éœ²</title>
    <link href="/2021/12/18/dp%E5%92%8Cdq%E6%B3%84%E9%9C%B2/"/>
    <url>/2021/12/18/dp%E5%92%8Cdq%E6%B3%84%E9%9C%B2/</url>
    
    <content type="html"><![CDATA[<blockquote><p>ä»ä¸€ä¸ª[ç¾ŠåŸæ¯ 2020]Powerå¯†ç é¢˜ï¼Œå¼•å‘çš„å…³äºdp å’Œ dqæ³„éœ²ç­‰æœ‰è¶£çš„é—®é¢˜ã€‚</p></blockquote><p><strong>é¢˜ç›®æœ¬èº«å°±å‡ºçš„æœ‰æ¼æ´ï¼Œå¹¶ä¸”å¯¹dpæ³„éœ²çš„å±å®³æœ‰äº†æ›´æ·±çš„ç†è§£ã€‚</strong></p><blockquote><p><strong>å…¶ä¸­çš„æ•°å­¦åŸºç¡€ä¸»è¦åŸºäºè´¹é©¬å®šç†å’Œç®€å•çš„æ•°è®ºæ¨å¯¼,æˆç«‹ä»¥må°äºpä¸ºå‰æ</strong></p></blockquote><h3 id="1ã€-ç¾ŠåŸæ¯-2020-Power">1ã€[ç¾ŠåŸæ¯ 2020]Power</h3><p>é¢˜ç›®å¦‚ä¸‹</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></div></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-keyword">from</span> secret <span class="hljs-keyword">import</span> flag<br><br>p = getPrime(<span class="hljs-number">512</span>)<br>q = getPrime(<span class="hljs-number">512</span>)<br>n = p**<span class="hljs-number">4</span>*q<br><br>e = <span class="hljs-number">65537</span><br>phi = gmpy2.lcm(p - <span class="hljs-number">1</span>, q - <span class="hljs-number">1</span>)<br>d = gmpy2.invert(e, phi)<br>dp = d % (p - <span class="hljs-number">1</span>)<br>m = bytes_to_long(flag)<br>c = <span class="hljs-built_in">pow</span>(m, e, n)<br><span class="hljs-built_in">print</span> (<span class="hljs-string">"dp = "</span> + <span class="hljs-built_in">str</span>(dp))<br><span class="hljs-built_in">print</span> (<span class="hljs-string">"c = "</span> + <span class="hljs-built_in">str</span>(c))<br><br>y = <span class="hljs-number">449703347709287328982446812318870158230369688625894307953604074502413258045265502496365998383562119915565080518077360839705004058211784369656486678307007348691991136610142919372779782779111507129101110674559235388392082113417306002050124215904803026894400155194275424834577942500150410440057660679460918645357376095613079720172148302097893734034788458122333816759162605888879531594217661921547293164281934920669935417080156833072528358511807757748554348615957977663784762124746554638152693469580761002437793837094101338408017407251986116589240523625340964025531357446706263871843489143068620501020284421781243879675292060268876353250854369189182926055204229002568224846436918153245720514450234433170717311083868591477186061896282790880850797471658321324127334704438430354844770131980049668516350774939625369909869906362174015628078258039638111064842324979997867746404806457329528690722757322373158670827203350590809390932986616805533168714686834174965211242863201076482127152571774960580915318022303418111346406295217571564155573765371519749325922145875128395909112254242027512400564855444101325427710643212690768272048881411988830011985059218048684311349415764441760364762942692722834850287985399559042457470942580456516395188637916303814055777357738894264037988945951468416861647204658893837753361851667573185920779272635885127149348845064478121843462789367112698673780005436144393573832498203659056909233757206537514290993810628872250841862059672570704733990716282248839</span><br><br>g = <span class="hljs-number">2</span><br>x = <span class="hljs-number">2019</span>*p**<span class="hljs-number">2</span> + <span class="hljs-number">2020</span>*p**<span class="hljs-number">3</span> + <span class="hljs-number">2021</span>*p**<span class="hljs-number">4</span><br>c1 = <span class="hljs-built_in">pow</span>(g, x, y)<br><span class="hljs-built_in">print</span>( <span class="hljs-string">"c1 = "</span> + <span class="hljs-built_in">str</span>(c1))<br><br><span class="hljs-comment"># dp = 379476973158146550831004952747643994439940435656483772269013081580532539640189020020958796514224150837680366977747272291881285391919167077726836326564473</span><br><br><span class="hljs-comment"># c = 57248258945927387673579467348106118747034381190703777861409527336272914559699490353325906672956273559867941402281438670652710909532261303394045079629146156340801932254839021574139943933451924062888426726353230757284582863993227592703323133265180414382062132580526658205716218046366247653881764658891315592607194355733209493239611216193118424602510964102026998674323685134796018596817393268106583737153516632969041693280725297929277751136040546830230533898514659714717213371619853137272515967067008805521051613107141555788516894223654851277785393355178114230929014037436770678131148140398384394716456450269539065009396311996040422853740049508500540281488171285233445744799680022307180452210793913614131646875949698079917313572873073033804639877699884489290120302696697425</span><br><br><span class="hljs-comment"># c1 = 78100131461872285613426244322737502147219485108799130975202429638042859488136933783498210914335741940761656137516033926418975363734194661031678516857040723532055448695928820624094400481464950181126638456234669814982411270985650209245687765595483738876975572521276963149542659187680075917322308512163904423297381635532771690434016589132876171283596320435623376283425228536157726781524870348614983116408815088257609788517986810622505961538812889953185684256469540369809863103948326444090715161351198229163190130903661874631020304481842715086104243998808382859633753938512915886223513449238733721777977175430329717970940440862059204518224126792822912141479260791232312544748301412636222498841676742208390622353022668320809201312724936862167350709823581870722831329406359010293121019764160016316259432749291142448874259446854582307626758650151607770478334719317941727680935243820313144829826081955539778570565232935463201135110049861204432285060029237229518297291679114165265808862862827211193711159152992427133176177796045981572758903474465179346029811563765283254777813433339892058322013228964103304946743888213068397672540863260883314665492088793554775674610994639537263588276076992907735153702002001005383321442974097626786699895993544581572457476437853778794888945238622869401634353220344790419326516836146140706852577748364903349138246106379954647002557091131475669295997196484548199507335421499556985949139162639560622973283109342746186994609598854386966520638338999059</span><br></code></pre></td></tr></tbody></table></figure><p>æˆ‘ä»¬å·²çŸ¥cï¼Œc1ï¼Œdpï¼Œe æ²¡æœ‰nï¼Œå¯èƒ½æˆ‘ä»¬æ³¨æ„åŠ›æ¯”è¾ƒå®¹æ˜“è¢«c1çš„çº¦æŸæ‰€å¸å¼•ã€‚</p><p><strong>c1æ˜¯ç”±2^x mod y ç”Ÿæˆçš„ï¼Œå…¶ä¸­xå’Œpç›¸å…³ï¼Œyæ˜¯ä¸€ä¸ªéå¸¸å¤§çš„æ•°ï¼Œå¦‚æœæ²¡æœ‰æ¨¡è¿ç®—ï¼Œä¸€ä¸ªç®€å•logå°±èƒ½æ±‚å‡ºnï¼Œ åœ¨æ¨¡è¿ç®—ä¸‹ï¼Œè¿™å°±ä¸Šå‡ä¸ºç¦»æ•£å¯¹æ•°é—®é¢˜ã€‚</strong></p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡sympyåº“çš„<code>discrete_log</code> å‡½æ•°æ¥æ±‚è§£ï¼Œå¯pæ˜¯ä¸€ä¸ª512bitçš„æ•°ï¼ŒXæ˜¯éå¸¸å¤§çš„ï¼Œåœ¨5minå·¦å³pythonè·‘å‡ºï¼Œæˆ–è®¸sagemath ä¼šæ›´å¿«ä¸€ç‚¹ï¼Œè¿™ä¹Ÿè¦æ±‚ä¹‹åè¦æŒæ¡ä¸€äº›æœ‰å…³ç¦»æ•£å¯¹æ•°çš„æ±‚è§£ç®—æ³•ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(sympy.discrete_log(y,c1,<span class="hljs-number">2</span>))<br></code></pre></td></tr></tbody></table></figure><p>å‚è€ƒç”¨æ³•:        <a href="https://www.pythonf.cn/read/109392">https://www.pythonf.cn/read/109392</a></p><p>ç¦»æ•£å¯¹æ•°ç®—æ³•: <a href="http://www.zbc53.top/archives/124/">http://www.zbc53.top/archives/124/</a></p><p><strong>å‡è®¾ æˆ‘ä»¬æ±‚å‡ºäº†X ä¹‹åXå°±æ˜¯pçš„ä¸€ä¸ªå¤šæ¬¡æ–¹ç¨‹ï¼Œå¯ä»¥ç”¨z3è¿›è¡Œæ±‚è§£ã€‚</strong></p><p>æ±‚å‡ºpä¹‹åå‘¢ï¼Œæˆ‘ä»¬è¿˜æ˜¯æ²¡æœ‰n å¹¶ä¸”æ²¡æœ‰qçš„ç›¸å…³ä¿¡æ¯ï¼Œè¿™æ—¶å°±è¦ç”¨åˆ°dpè¿™ä¸€ä¸ªæ¡ä»¶ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python">dp= d mod p-<span class="hljs-number">1</span><br><span class="hljs-comment">#ä¸¤éåŒä¹˜e</span><br>e*dp = e*d mod p -<span class="hljs-number">1</span> <br><span class="hljs-comment">#ç­‰ä»·</span><br>e*dp = e*d + k*(p-<span class="hljs-number">1</span>)    (<span class="hljs-number">1</span>)<br><br><span class="hljs-string">"""</span><br><span class="hljs-string">æ ¹æ®æˆ‘ä»¬é’Ÿçˆ±çš„e*d = 1 mod phi n</span><br><span class="hljs-string"></span><br><span class="hljs-string">n= (p^4) *q</span><br><span class="hljs-string">phi(n) = (p^3)*(p-1)*q</span><br><span class="hljs-string"></span><br><span class="hljs-string">æœ‰äº†è¿™äº›å‰æ,ä¸å¦¨è®©å¼(1) mod phin</span><br><span class="hljs-string">"""</span><br>e*d + k*(p-<span class="hljs-number">1</span>) mod phin = e*dp <br><span class="hljs-comment">#ç­‰ä»·</span><br><span class="hljs-number">1</span> + k*(p-<span class="hljs-number">1</span>) = e*dp +  k*phin    phin=(p^<span class="hljs-number">3</span>)*(p-<span class="hljs-number">1</span>)*q  ä¹Ÿæ˜¯k<span class="hljs-string">'*(p-1)</span><br><span class="hljs-string">#æ•´ç† ä¹Ÿå°±æ˜¯</span><br><span class="hljs-string">e*dp = 1 + k1*(p-1)     (2)    #æ„Ÿè§‰å‡ºå…¶ä¸­çš„å€æ•°å…³ç³»å³å¯</span><br><span class="hljs-string">#æ­¤å¤„æ ‡ä½å¼(2) æˆ‘ä»¬ä¹‹åä¼šé‡ç‚¹ç”¨åˆ°</span><br><span class="hljs-string"></span><br><span class="hljs-string">"""</span><br><span class="hljs-string">æ—¢ç„¶</span><br><span class="hljs-string">m ^ e = c mod n</span><br><span class="hljs-string">c^d mod n = m</span><br><span class="hljs-string">ç”¨åˆ°äº†æ¬§æ‹‰å®šç†</span><br><span class="hljs-string">a^(phin) mod n = 1 </span><br><span class="hljs-string"></span><br><span class="hljs-string">é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç±»ä¼¼</span><br><span class="hljs-string">c ^ (dp) = m ^ (e*dp) = m ^ (1 + k1*(p-1))</span><br><span class="hljs-string">æ ¹æ®è´¹é©¬å®šç† a ^ (p-1) mod p = 1</span><br><span class="hljs-string">é‚£ä¹ˆ c ^ dp  mod p = m</span><br><span class="hljs-string">"""</span><br><span class="hljs-string">c ^ dp  mod p = m</span><br></code></pre></td></tr></tbody></table></figure><p>æ ¹æ®ä¸Šè¿°æ¨å¯¼ï¼Œæ‹¿åˆ°pï¼Œæ¸¸æˆå°±ç»“æŸäº†ã€‚</p><ul><li><p>ä¸Šè¿°  c ^ dp  mod p = m å¿…é¡»è¦æ»¡è¶³ m &lt; p æˆ–è€…è¿‘ä¼¼æ¥è¿‘ å¦åˆ™è¿‘ä¹ä¸èƒ½æ±‚è§£</p><p>å³ m = (c^dp mod p) + k*p</p></li></ul><p><strong>å›é¡¾ä¸€ä¸‹è§£é¢˜æ€è·¯ï¼Œæˆ‘ä»¬æ‰§ç€äºè§£ç¦»æ•£å¯¹æ•°å’Œé«˜æ¬¡æ–¹ç¨‹ä¸å°±æ˜¯ä¸ºäº†æ±‚pä¹ˆï¼Œä½†æ€»ç»“ä¸€ä¸‹ä¸Šé¢æ— è®ºæ˜¯dpè¿˜æ˜¯ c1 éƒ½æ˜¯æœ‰å…³pçš„ï¼Œä¸¤ä¸ªæ–¹ç¨‹æ±‚ä¸€ä¸ªæœªçŸ¥é‡ï¼Œæ˜¯ä¸æ˜¯æœ‰ç‚¹å¥¢ä¾ˆäº†å‘¢?</strong></p><p><strong>æ³¨æ„æ¨å¯¼ä¸­çš„è¿™ä¸ªå¼å­e<em>dp = 1 + k1</em>(p-1)ï¼ï¼ï¼ eå’Œdpå·²çŸ¥ï¼ŒkæœªçŸ¥ä½†æ˜¯ e<em>dp - 1 ä¸€å®šæ˜¯ (p-1)çš„æ•´æ•°å€ï¼Œå¹¶ä¸”e</em>dp-1ä¸º525ä¸ªbit æ˜¯ååˆ†æ¥è¿‘çš„ï¼Œè¿™å®Œå…¨å¯ä»¥çˆ†ç ´ã€‚</strong></p><p>è„šæœ¬å¦‚ä¸‹</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span>  gmpy2<br><span class="hljs-keyword">import</span> cmath<br><span class="hljs-keyword">import</span> sympy<br><span class="hljs-keyword">from</span>  Crypto.Util.number <span class="hljs-keyword">import</span> *<br>e = <span class="hljs-number">65537</span><br>dp=<span class="hljs-number">379476973158146550831004952747643994439940435656483772269013081580532539640189020020958796514224150837680366977747272291881285391919167077726836326564473</span><br>c=<span class="hljs-number">57248258945927387673579467348106118747034381190703777861409527336272914559699490353325906672956273559867941402281438670652710909532261303394045079629146156340801932254839021574139943933451924062888426726353230757284582863993227592703323133265180414382062132580526658205716218046366247653881764658891315592607194355733209493239611216193118424602510964102026998674323685134796018596817393268106583737153516632969041693280725297929277751136040546830230533898514659714717213371619853137272515967067008805521051613107141555788516894223654851277785393355178114230929014037436770678131148140398384394716456450269539065009396311996040422853740049508500540281488171285233445744799680022307180452210793913614131646875949698079917313572873073033804639877699884489290120302696697425</span><br>ep=e*dp-<span class="hljs-number">1</span><br><br><span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>,<span class="hljs-number">1000000</span>):<br>    <span class="hljs-keyword">if</span> ep % k ==<span class="hljs-number">0</span>:<br>        p = (ep//k) +<span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span> isPrime(p):<br>            <span class="hljs-built_in">print</span>(k)<br><br>p=<span class="hljs-number">12131601165788024635030034921084070470053842112984866821070395281728468805072716002494427632757418621194662541766157553264889658892783635499016425528807741</span><br><span class="hljs-built_in">print</span>(long_to_bytes(<span class="hljs-built_in">pow</span>(c,dp,p)))<br></code></pre></td></tr></tbody></table></figure><p><strong>è¿™æ ·ä¹Ÿèƒ½è¾¾åˆ°è§£å‡ºpçš„ç›®çš„ï¼Œå¹¶ä¸”ç›´æ¥ç”¨ pow(c,dp,p),æ±‚è§£ï¼Œç”¨åˆ°äº†ä¸¤ä¸ªäºŒçº§æ¨å¯¼ç»“è®ºã€‚</strong></p><p><strong>è¿™ä¹Ÿèƒ½é€éœ²å‡ºå½“m&lt;pæ—¶e*dpæ³„éœ²çš„å±å®³ï¼Œå¦‚æœèƒ½é€šè¿‡dpçˆ†ç ´å‡ºpï¼Œæˆ–è€…ç›´æ¥æ‹¿åˆ°p ï¼Œåˆ™ç›´æ¥ç”¨dp å’Œ pï¼Œä½œä¸ºç§é’¥å’Œå…¬é’¥è§£å¯†å³å¯ã€‚</strong></p><p><strong>dpï¼Œdqæœ¬èº«å°±æ˜¯ä¸ºäº†å¿«é€Ÿè§£å¯†æœåŠ¡çš„ï¼Œä¹Ÿå°±å†³å®šäº†ï¼Œå¤§å¤šæƒ…å†µä¸‹çš„på’Œqæ˜¯éå¸¸å¤§çš„ï¼Œå¾€å¾€mä¼šæ¯”pè¦å°å¾ˆå¤šï¼Œå¦‚æœå‡ºé¢˜äººåœ¨dpæ³„éœ²æ—¶å¿½è§†äº†è¿™ä¸€ç‚¹ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šå‡ºç°éé¢„æœŸã€‚</strong></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#åœ¨m&gt;&gt;p çš„dpæ³„éœ²å°±éœ€è¦ç»™å‡ºeå’Œnï¼Œä»¥ä¾¿æˆ‘ä»¬å€ŸåŠ©pæ¥åˆ†è§£n</span><br><span class="hljs-comment">#ä»¥ç½‘ä¸Šçš„ä¸€ä¸ªé¢˜ç›®ä¸ºä¾‹</span><br>(<span class="hljs-string">'dp='</span>, <span class="hljs-string">'0x7f1344a0b8d2858492aaf88d692b32c23ef0d2745595bc5fe68de384b61c03e8fd054232f2986f8b279a0105b7bee85f74378c7f5f35c3fd505e214c0738e1d9'</span>)<br>(<span class="hljs-string">'n='</span>, <span class="hljs-string">'0x5eee1b4b4f17912274b7427d8dc0c274dc96baa72e43da36ff39d452ff6f2ef0dc6bf7eb9bdab899a6bb718c070687feff517fcf5377435c56c248ad88caddad6a9cefa0ca9182daffcc6e48451d481f37e6520be384bedb221465ec7c95e2434bf76568ef81e988039829a2db43572e2fe57e5be0dc5d94d45361e96e14bd65L'</span>)<br>(<span class="hljs-string">'e='</span>, <span class="hljs-string">'0x10001'</span>)<br>(<span class="hljs-string">'c='</span>, <span class="hljs-string">'0x510fd8c3f6e21dfc0764a352a2c7ff1e604e1681a3867480a070a480f722e2f4a63ca3d7a92b862955ab4be76cde43b51576a128fba49348af7a6e34b335cfdbda8e882925b20503762edf530d6cd765bfa951886e192b1e9aeed61c0ce50d55d11e343c78bb617d8a0adb7b4cf3b913ee85437191f1136e35b94078e68bee8dL'</span>)<br></code></pre></td></tr></tbody></table></figure><h4 id="1ã€p-m-Quic-Crack">1ã€p&lt;m Quic Crack</h4><p><strong>pçš„ä½æ•°å¯ä»¥ç›´æ¥è§‚å¯Ÿdpå¾—å‡ºï¼Œæ¥è¿‘512bitï¼Œ64å­—èŠ‚ï¼Œä¸€èˆ¬flagåœ¨30-50å·¦å³ç”šè‡³æ›´çŸ­ï¼Œå³m&lt;p</strong></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span>  gmpy2<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br>dp=<span class="hljs-number">0x7f1344a0b8d2858492aaf88d692b32c23ef0d2745595bc5fe68de384b61c03e8fd054232f2986f8b279a0105b7bee85f74378c7f5f35c3fd505e214c0738e1d9</span><br><br>n=<span class="hljs-number">0x5eee1b4b4f17912274b7427d8dc0c274dc96baa72e43da36ff39d452ff6f2ef0dc6bf7eb9bdab899a6bb718c070687feff517fcf5377435c56c248ad88caddad6a9cefa0ca9182daffcc6e48451d481f37e6520be384bedb221465ec7c95e2434bf76568ef81e988039829a2db43572e2fe57e5be0dc5d94d45361e96e14bd65</span><br>e=<span class="hljs-number">0x10001</span><br>c=<span class="hljs-number">0x510fd8c3f6e21dfc0764a352a2c7ff1e604e1681a3867480a070a480f722e2f4a63ca3d7a92b862955ab4be76cde43b51576a128fba49348af7a6e34b335cfdbda8e882925b20503762edf530d6cd765bfa951886e192b1e9aeed61c0ce50d55d11e343c78bb617d8a0adb7b4cf3b913ee85437191f1136e35b94078e68bee8d</span><br>edp=e*dp - <span class="hljs-number">1</span><br><span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>,<span class="hljs-number">10000000</span>):<br>    <span class="hljs-keyword">if</span> edp%k==<span class="hljs-number">0</span>:<br>        p= edp//k + <span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span> isPrime(p):<br>            <span class="hljs-built_in">print</span>(long_to_bytes(<span class="hljs-built_in">pow</span>(c,dp,p)))<br></code></pre></td></tr></tbody></table></figure><p>å½“ç„¶è¿™åªæ˜¯ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œä½†æ˜¯ç½‘ä¸Šå¤§å¤šæ•°å…³äºdpæ³„éœ²é¢˜ç›®è²Œä¼¼éƒ½å­˜åœ¨è¿™ä¸ªé—®é¢˜ã€‚</p><h4 id="2ã€é€šç”¨è§£æ³•">2ã€é€šç”¨è§£æ³•</h4><p><strong>é€šè§£ï¼Œå½“ç„¶rsaåŠ å¯†å¯¹å¯†æ–‡æœ¬èº«å°±é™åˆ¶äº†mæ˜¯è¦æ¯”nå°çš„</strong></p><p>æ‰€ä»¥åˆ†è§£nç›´æ¥è§£å°±å¾—äº†ï¼Œæ—¢ç„¶ä¸Šè„šæœ¬æˆ‘ä»¬å·²ç»æµ‹è¯•å‡ºäº†p ï¼Œé‚£ä¹ˆq = n//p å³å¯ã€‚</p><p>ç»¼ä¸Šï¼Œç»¼åˆä¸¤ç§è„šæœ¬</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span>  gmpy2<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br>dp=<span class="hljs-number">0x7f1344a0b8d2858492aaf88d692b32c23ef0d2745595bc5fe68de384b61c03e8fd054232f2986f8b279a0105b7bee85f74378c7f5f35c3fd505e214c0738e1d9</span><br><br>n=<span class="hljs-number">0x5eee1b4b4f17912274b7427d8dc0c274dc96baa72e43da36ff39d452ff6f2ef0dc6bf7eb9bdab899a6bb718c070687feff517fcf5377435c56c248ad88caddad6a9cefa0ca9182daffcc6e48451d481f37e6520be384bedb221465ec7c95e2434bf76568ef81e988039829a2db43572e2fe57e5be0dc5d94d45361e96e14bd65</span><br>e=<span class="hljs-number">0x10001</span><br>c=<span class="hljs-number">0x510fd8c3f6e21dfc0764a352a2c7ff1e604e1681a3867480a070a480f722e2f4a63ca3d7a92b862955ab4be76cde43b51576a128fba49348af7a6e34b335cfdbda8e882925b20503762edf530d6cd765bfa951886e192b1e9aeed61c0ce50d55d11e343c78bb617d8a0adb7b4cf3b913ee85437191f1136e35b94078e68bee8d</span><br>edp=e*dp - <span class="hljs-number">1</span><br><span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>,<span class="hljs-number">10000000</span>):<br>    <span class="hljs-keyword">if</span> edp%k==<span class="hljs-number">0</span>:<br>        p= edp//k + <span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span> isPrime(p):<br>            <span class="hljs-keyword">try</span>:<br>                <span class="hljs-built_in">print</span>(long_to_bytes(<span class="hljs-built_in">pow</span>(c,dp,p)).decode(<span class="hljs-string">'utf-8'</span>)) <span class="hljs-comment">#flagè‚¯å®šæ˜¯å¯è§å­—ç¬¦</span><br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">'Quick Crack Suc!'</span>)<br>                <span class="hljs-keyword">break</span><br>            <span class="hljs-keyword">except</span>:<br>                q=n//p<br>                phi=(p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)<br>                d=gmpy2.invert(e,phi)<br>                <span class="hljs-keyword">try</span>:<br>                    <span class="hljs-built_in">print</span>(long_to_bytes(<span class="hljs-built_in">pow</span>(c,d,n)).decode(<span class="hljs-string">'utf-8'</span>))<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">'yes!'</span>)<br>                    <span class="hljs-keyword">break</span><br>                <span class="hljs-keyword">except</span>:<br>                    <span class="hljs-keyword">pass</span><br></code></pre></td></tr></tbody></table></figure><p><strong>æµ‹è¯•ï¼Œç”¨å¦‚ä¸‹å¼ä¾‹æ¥æµ‹è¯• m &gt; pçš„æƒ…å†µ</strong></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">dp = <span class="hljs-number">14423533367739841601650555272663543354837347609362352488761411482549189398193</span><br>p =  <span class="hljs-number">69901287164206610888661720099426949703910023683707793762919220907478091073681</span><br>c=  <span class="hljs-number">2262919207276468849681578487794992281448594044416435512543882157738828978766101685798623343531305619235784170849036103143665025760464116190980363198608567</span><br>e=<span class="hljs-number">65537</span><br>n=<span class="hljs-number">5965322435025945026021165385608956120433036321627501574655956870755806607342365635361310529607383516087208412532082338428923031616470920911896483167491881</span><br></code></pre></td></tr></tbody></table></figure><h3 id="2ã€dp-dqæ³„éœ²">2ã€dp dqæ³„éœ²</h3><p><strong>dp å’Œ dqæ³„éœ² å’Œdpæ³„éœ²æœ‰ç€å¼‚æ›²åŒå·¥ä¹‹å¦™ï¼Œä¸è¿‡å¿½ç•¥äº†m &lt; p / q å°±æˆäº†çº¸è€è™ã€‚</strong></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">c: <span class="hljs-number">95272795986475189505518980251137003509292621140166383887854853863720692420204142448424074834657149326853553097626486371206617513769930277580823116437975487148956107509247564965652417450550680181691869432067892028368985007229633943149091684419834136214793476910417359537696632874045272326665036717324623992885</span><br>p: <span class="hljs-number">11387480584909854985125335848240384226653929942757756384489381242206157197986555243995335158328781970310603060671486688856263776452654268043936036556215243</span><br>q: <span class="hljs-number">12972222875218086547425818961477257915105515705982283726851833508079600460542479267972050216838604649742870515200462359007315431848784163790312424462439629</span><br>dp: <span class="hljs-number">8191957726161111880866028229950166742224147653136894248088678244548815086744810656765529876284622829884409590596114090872889522887052772791407131880103961</span><br>dq: <span class="hljs-number">3570695757580148093370242608506191464756425954703930236924583065811730548932270595568088372441809535917032142349986828862994856575730078580414026791444659</span><br></code></pre></td></tr></tbody></table></figure><p>æŒ‰ä¹‹å‰çš„ç®—æ³• æ˜¯è¦ç”¨ä¸­å›½å‰©ä½™å®šç†æ±‚dçš„</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">dp = d mod p-<span class="hljs-number">1</span><br>dq = d mod q-<span class="hljs-number">1</span><br></code></pre></td></tr></tbody></table></figure><h4 id="1ã€è§£å¯†æ€è·¯-Crt">1ã€è§£å¯†æ€è·¯ + Crt</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python">m1 = c^dp mod p<br>m2 = c^dq mod q<br>dp = d mod p-<span class="hljs-number">1</span>   -&gt; dp = d + k*(p-<span class="hljs-number">1</span>)<br>dq = q mod q-<span class="hljs-number">1</span><br><span class="hljs-comment">#æ ¹æ® è´¹é©¬å¯å¾— c^dp mod p = c^d mod p</span><br><span class="hljs-comment">#åŒç† c^dq mod q = c^d mod q </span><br>c^d mod p = m1<br>c^d mod q = m2<br><br>æ„é€  x = k1*m1 + k2*m2<br><br>(<span class="hljs-number">1</span>)k1 mod p =<span class="hljs-number">1</span><br>(<span class="hljs-number">2</span>)k1 mod q =<span class="hljs-number">0</span><br><br>k1 = k*q å¸¦å…¥(<span class="hljs-number">1</span>)<br>k = q^(-<span class="hljs-number">1</span>) mod p <br>å³ k1 = (q ^(-<span class="hljs-number">1</span>) mod p) *q<br><br><span class="hljs-string">"""</span><br><span class="hljs-string">æ¨å¹¿åˆ°ä¸€èˆ¬ å¦‚æœ åœ¨å‰©ä½™å®šç†ä¸­</span><br><span class="hljs-string">x mod a1 = b1 </span><br><span class="hljs-string">x mod a2 = b2</span><br><span class="hljs-string">x mod a3 = b3</span><br><span class="hljs-string">...</span><br><span class="hljs-string"></span><br><span class="hljs-string">é‚£ä¹ˆæ„é€ çš„æ•° m = k1*b1 + k2*b2 + ... kn * bn</span><br><span class="hljs-string">k1 = ((a2 *a3 *..an)^(-1) mod a1) * (a2 *a3 *..an)</span><br><span class="hljs-string">k2 = ((a1 *a3 *..an)^(-1) mod a1) * (a2 *a3 *..an)</span><br><span class="hljs-string"><span class="hljs-meta">... </span>å¦‚æ­¤è§„å¾‹</span><br><span class="hljs-string">M=a1*a2*..an</span><br><span class="hljs-string">Mi = M / ai</span><br><span class="hljs-string">Mi' = gmpy2.invert(Mi,ai)</span><br><span class="hljs-string">Mi * Mi' * bi æ¯ä¸€é¡¹</span><br><span class="hljs-string">ç»¼åˆè¦%M  ä¸€ä¸‹</span><br><span class="hljs-string">"""</span><br><br></code></pre></td></tr></tbody></table></figure><p>å³</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span>  gmpy2<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><br>dp= <span class="hljs-number">90494486973243104756298311175705002887155440121025946664275790548694955799661434870163629541771658812502682012435200659355928618529521731475360236486362525996535354732687624609637012830178545914960485330748345108757203508531117591067570383564779625954776907685968592668868046507450242047759226407026094726359</span><br>dq= <span class="hljs-number">92386717102324384872139253931247976320472847834037799716676564640678692924258053130751618730959510913784801723023536527134208843358920592320351399005428347188639433875570867152865970587272904695272790831679276818402117343413503376057524788386479263579869430615501089905630519162146030369086836183772975252551</span><br>p= <span class="hljs-number">121869669684596731118740111360803257498670698122183387353481580136405322481841982461820301261370579505460038281590785837096967719889404913176714663774999789266522508163678949469953184327222227297952119212490499582581953510522212981687122483764873187827531047946130999532741388680549345732675732040579796067001</span><br>q= <span class="hljs-number">128363031923139297392077349407719417788135630403499671848196425800900870531452570499668481104884553795224784931947824885511134525485570129640119439950191944938407656926280993408854767711557863016197167505998324659906146937423415404059310560359693643987781862684489401368519777953281060013045590132161625607377</span><br>c= <span class="hljs-number">4176193749773450562408160796325873473193702511560805285554329767573726211097194419198463203488792792756598428753745425419950423161673497255820731183746106463781291156892140581651301528184812357534808298071893380519977926677138246941946185699346532140641376461516107672722425971178865758049759985915001009787241295292157744353554548314911531918044654676691927347018033509499136103964942830581407087547565204232556314726045307279963709599952745342811947421707024572981812906869557834491207590418553244020621858083633564878305733114484857827620268881100166090837841224767358579366482347136224695333980041913268394994302</span><br>m1 = <span class="hljs-built_in">pow</span>(c,dp,p)<br>m2 = <span class="hljs-built_in">pow</span>(c,dq,q)<br>d = gmpy2.invert(q,p)*(q)*m1 + gmpy2.invert(p,q)*(p)*m2<br><br><span class="hljs-built_in">print</span>(long_to_bytes(d%(p*q)))<br></code></pre></td></tr></tbody></table></figure><p>ç”¨pythonçš„åº“sympyæ¥å®ç°crt</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sympy.ntheory.modular <span class="hljs-keyword">import</span> * <span class="hljs-comment">#ä»sympyæ•°è®ºåº“ä¸­å¯¼å…¥å‡½æ•°</span><br>crt([p,q],[m1,m2])<br><span class="hljs-comment"># ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ¨¡æ•°ç»„ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä½™æ•°ç»„</span><br><span class="hljs-comment"># è¿”å›å€¼æ˜¯ä¸€ä¸ªå…ƒç»„ ç¬¬ä¸€ä¸ªæ•°æ˜¯æ±‚è§£çš„må€¼ï¼Œç¬¬äºŒä¸ªæ•°æ˜¯æ‰€æœ‰æ¨¡æ•°çš„ä¹˜ç§¯</span><br><br>m=crt([p,q],[m1,m2])[<span class="hljs-number">0</span>] <span class="hljs-comment">#å¾—åˆ°è§£å³å¯</span><br><span class="hljs-built_in">print</span>(long_to_bytes(m%n))<br></code></pre></td></tr></tbody></table></figure><p>sympyåº“ä¸­æœ‰å¾ˆå¤šæ–¹ä¾¿çš„å‡½æ•°ï¼Œæœ‰å¤§è‡´å°è±¡ç™¾åº¦å³å¯ã€‚</p><h4 id="2ã€æµ‹è¯•ç”¨ä¾‹">2ã€æµ‹è¯•ç”¨ä¾‹</h4><p>åä¾‹å½“messaege&gt;q</p><p>æ³¨æ„mè¦å°äºn</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span>  gmpy2<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br>p=getPrime(<span class="hljs-number">256</span>)<br>q=getPrime(<span class="hljs-number">256</span>)<br>n=p*q<br>phi=(p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)<br>e=<span class="hljs-number">65537</span><br>d=gmpy2.invert(e,phi)<br>dp=d%(p-<span class="hljs-number">1</span>)<br>dq=d%(q-<span class="hljs-number">1</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">'dp = '</span>,dp)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">'p = '</span>,p)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">'dq = '</span>,dq)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">'q= '</span>,q)<br>m=<span class="hljs-string">b'flag{If_the message_is_larger_than_prime_end!!!}'</span><br>c=bytes_to_long(m)<br>c= <span class="hljs-built_in">pow</span>(c,e,n)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">'c= '</span>,c)<br></code></pre></td></tr></tbody></table></figure><p>å¦‚æœç»§ç»­è§£å¯†,åˆ™æ˜¯ä¹±ç </p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br>dp = <span class="hljs-number">14423533367739841601650555272663543354837347609362352488761411482549189398193</span><br>p =  <span class="hljs-number">69901287164206610888661720099426949703910023683707793762919220907478091073681</span><br>c=  <span class="hljs-number">2262919207276468849681578487794992281448594044416435512543882157738828978766101685798623343531305619235784170849036103143665025760464116190980363198608567</span><br><span class="hljs-built_in">print</span>(long_to_bytes(<span class="hljs-built_in">pow</span>(c,dp,p)))<br><span class="hljs-comment"># b'Y\x83^\xa4\xf2\xbaC\xbfY\xa0\x9a!\x07^\xb0\x12\xaa-\xa0\x10\xf8;\x9b\xb1\xaaF5\x9f\xb2\x952\xc0'</span><br></code></pre></td></tr></tbody></table></figure><p>ä¸­å›½å‰©ä½™å®šç†,æˆåŠŸè§£å†³</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span>  gmpy2<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br>dp =  <span class="hljs-number">14423533367739841601650555272663543354837347609362352488761411482549189398193</span><br>p =  <span class="hljs-number">69901287164206610888661720099426949703910023683707793762919220907478091073681</span><br>dq =  <span class="hljs-number">32437946587531699347725552012753985094383131578752766354933176932787801620073</span><br>q=  <span class="hljs-number">85339235900086908600694050911639754370783480963298143334400691126173744722201</span><br>c=  <span class="hljs-number">2262919207276468849681578487794992281448594044416435512543882157738828978766101685798623343531305619235784170849036103143665025760464116190980363198608567</span><br>m1 = <span class="hljs-built_in">pow</span>(c,dp,p)<br>m2 = <span class="hljs-built_in">pow</span>(c,dq,q)<br>d = gmpy2.invert(q,p)*(q)*m1 + gmpy2.invert(p,q)*(p)*m2<br><br><span class="hljs-built_in">print</span>(long_to_bytes(d%(p*q)))<br><span class="hljs-comment">#b'flag{If_the message_is_larger_than_prime_end!!!}'</span><br></code></pre></td></tr></tbody></table></figure><hr><blockquote><p>æ¨å¯¼è¿‡ç¨‹ä¸­çš„ä¸­é—´ç»“è®ºä¹Ÿèƒ½å¯¹è§£å¯†æœ‰å·¨å¤§è´¡çŒ®ï¼Œåœ¨è¿›è¡ŒåŠ å¯†æ—¶ï¼Œè¿˜è¦è€ƒè™‘å¯†æ–‡å’Œç´ å› æ•°ä»¥åŠæ¨¡æ•°çš„å¤§å°ï¼Œé˜²æ­¢å‡ºç°éé¢„æœŸçš„æ¼æ´ã€‚</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Crypto</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Crypto</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2021NCTF-Re</title>
    <link href="/2021/12/01/2021NCTF-RE/"/>
    <url>/2021/12/01/2021NCTF-RE/</url>
    
    <content type="html"><![CDATA[<h1>NCTF-RE</h1><h2 id="ç­¾åˆ°">ç­¾åˆ°</h2><p><strong>é€IDAåˆé€flag</strong></p><p><strong>æ¬¢è¿æ¥åˆ°NCTF-é€†å‘å·¥ç¨‹(Reverse Engineering)</strong><br><strong>è¿™é‡Œå¯èƒ½æœ‰ä½ éœ€è¦çš„å·¥å…·:</strong><br><strong>ida pro 7.6 :</strong></p><p><strong>é“¾æ¥ï¼š<a href="https://pan.baidu.com/s/1bV2HjBBX0bwwtzORqhErOg">https://pan.baidu.com/s/1bV2HjBBX0bwwtzORqhErOg</a></strong></p><p><strong>æå–ç ï¼šo49x</strong></p><h2 id="Shadowbringer">Shadowbringer</h2><p>c++64ä½ç¨‹åºï¼Œidaè½½å…¥</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><pre><code class="hljs c"><span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::<span class="hljs-built_in">string</span>(v4, <span class="hljs-string">"U&gt;F2UsQXN`5sXMELT=:7M_2&lt;X]^1ThaWF0=KM?9IUhAsTM5:T==_Ns&amp;&lt;Vhb!"</span>, &amp;v6);<br>  <span class="hljs-built_in">std</span>::allocator&lt;<span class="hljs-keyword">char</span>&gt;::~allocator(&amp;v6);<br>  <span class="hljs-built_in">std</span>::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;<span class="hljs-built_in">std</span>::char_traits&lt;<span class="hljs-keyword">char</span>&gt;&gt;(refptr__ZSt4cout, <span class="hljs-string">"Welcome.Please input your flag:\n"</span>);<br>  <span class="hljs-built_in">std</span>::<span class="hljs-keyword">operator</span>&gt;&gt;&lt;<span class="hljs-keyword">char</span>&gt;(refptr__ZSt3cin, (<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> *)input);<br>  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::<span class="hljs-built_in">string</span>((<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> *)v8, (<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> *)input);<span class="hljs-comment">// strcpy</span><br>  base64encode1((<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> *)v7, (<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> *)v8);<span class="hljs-comment">// æ¢è¡¨çš„base64</span><br>  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::<span class="hljs-keyword">operator</span>=((<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> *)input, (<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> *)v7);<span class="hljs-comment">// èµ‹å€¼ ç¬¬ä¸€å±‚å¯†æ–‡</span><br>  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::~<span class="hljs-built_in">string</span>((<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> *)v7);<br>  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::~<span class="hljs-built_in">string</span>((<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> *)v8);<br>  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::<span class="hljs-built_in">string</span>((<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> *)v10, (<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> *)input);<span class="hljs-comment">// å¤åˆ¶ä¸€ä¸ªå¯¹è±¡v10</span><br>  base64encode2((<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> *)v9, (<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> *)v10); <span class="hljs-comment">// base64æ¢è¡¨ ä¸¤æ¬¡ ä¸åŒçš„è¡¨</span><br>  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::<span class="hljs-keyword">operator</span>=((<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> *)input, (<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> *)v9);<br>  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::~<span class="hljs-built_in">string</span>((<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> *)v9);<br>  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::~<span class="hljs-built_in">string</span>((<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> *)v10);<br>  <span class="hljs-keyword">if</span> ( (<span class="hljs-keyword">unsigned</span> __int8)<span class="hljs-built_in">std</span>::<span class="hljs-keyword">operator</span>==&lt;<span class="hljs-keyword">char</span>&gt;(input, v4) )<br>    <span class="hljs-built_in">std</span>::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;<span class="hljs-built_in">std</span>::char_traits&lt;<span class="hljs-keyword">char</span>&gt;&gt;(refptr__ZSt4cout, <span class="hljs-string">"Right."</span>);<br>  <span class="hljs-keyword">else</span><br>    <span class="hljs-built_in">std</span>::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;<span class="hljs-built_in">std</span>::char_traits&lt;<span class="hljs-keyword">char</span>&gt;&gt;(refptr__ZSt4cout, <span class="hljs-string">"Wrong."</span>);<br>  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::~<span class="hljs-built_in">string</span>((<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> *)v4);<br></code></pre></td></tr></tbody></table></figure><p>ä¸»è¦ç”¨åˆ°äº†c++ stringç±»æ¥è¿›è¡Œå¤„ç†ï¼Œç»“åˆåŠ¨è°ƒï¼Œå¤§è‡´ç»è¿‡äº†ä¸¤æ¬¡base64å˜è¡¨åŠ å¯†ï¼Œåœ¨å’Œv4è¿›è¡Œæ¯”è¾ƒã€‚<br><strong>ç¬¬ä¸€ç»„è¡¨ï¼Œ</strong><br><strong>â€˜#$%&amp;â€™,27h,â€˜()*+,-.s0123456789:;&lt;=&gt;?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[h]â€™+â€˜^_`abâ€™</strong></p><p><strong>ç¬¬äºŒç»„è¡¨</strong><br><strong>â€˜ba`_^]h[ZYXWVUTSRQPONMLKJIHGFEDCBA@?&gt;=&lt;;:9876543210s.-,+*)(â€™,27h,â€˜&amp;â€™â€˜+â€™%$#â€™</strong></p><p>ä¸¤æ¬¡åŠ å¯†çš„ä»£ç å¤§è‡´ç›¸åŒï¼Œä¸»è¦é€šè¿‡è¡¨çš„é•¿åº¦å’Œæ¯æ¬¡å¤„ç†çš„äºŒè¿›åˆ¶é•¿åº¦åˆ¤æ–­ä¸ºbase64.</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-built_in">std</span>::<span class="hljs-built_in">bitset</span>&lt;8ull&gt;::to_string(v13, v14);     <span class="hljs-comment">// è½¬ä¸º2è¿›åˆ¶</span><br><span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; j &lt; (<span class="hljs-keyword">unsigned</span> __int64)<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::size((<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> *)&amp;v9); j += <span class="hljs-number">6</span> )<span class="hljs-comment">// 6ä¸ªäºŒè¿›åˆ¶ä¸€ç»„</span><br>v7 = (<span class="hljs-keyword">char</span> *)<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::<span class="hljs-keyword">operator</span>[](&amp;hisoralce, v6);<span class="hljs-comment">//è¡¨ç´¢å¼•</span><br><br><span class="hljs-keyword">while</span> ( (<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::size(a1) &amp; <span class="hljs-number">3</span>) != <span class="hljs-number">0</span> )<br>  {<br>    <span class="hljs-built_in">std</span>::<span class="hljs-keyword">operator</span>+&lt;<span class="hljs-keyword">char</span>&gt;(v19, a1, <span class="hljs-string">'!'</span>);<br>    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::<span class="hljs-keyword">operator</span>=(a1, (<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> *)v19);<br>    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::~<span class="hljs-built_in">string</span>((<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> *)v19);<br>  }<br><span class="hljs-comment">//ä¸ä¸º4çš„å€æ•°å°±ä¸æ–­+!</span><br></code></pre></td></tr></tbody></table></figure><p>äº†è§£æµç¨‹åå†™è§£å¯†è„šæœ¬å³å¯</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64<br>table1=<span class="hljs-string">'#$%&amp;'</span>+<span class="hljs-string">'\x27'</span>+<span class="hljs-string">'()*+,-.s0123456789:;&lt;=&gt;?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[h]'</span>+<span class="hljs-string">'^_`ab'</span><br>table2=<span class="hljs-string">'ba`_^]h[ZYXWVUTSRQPONMLKJIHGFEDCBA@?&gt;=&lt;;:9876543210s.-,+*)('</span>+<span class="hljs-string">'\x27'</span>+<span class="hljs-string">'&amp;%$#'</span><br>base=<span class="hljs-string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'</span><br>enc=<span class="hljs-string">'U&gt;F2UsQXN`5sXMELT=:7M_2&lt;X]^1ThaWF0=KM?9IUhAsTM5:T==_Ns&amp;&lt;Vhb!'</span><br><span class="hljs-comment">#enc='FsJ7M?b&lt;U-&gt;2M&gt;U:'#123456789æµ‹è¯•</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">newbase</span>(<span class="hljs-params">enc,table</span>):</span><br>    m=<span class="hljs-string">''</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(enc)):<br>        <span class="hljs-keyword">if</span> enc[i] <span class="hljs-keyword">in</span> table:<br>            m+=base[table.index(enc[i])]<br>        <span class="hljs-keyword">else</span>:<br>            m+=<span class="hljs-string">'='</span><br>    <span class="hljs-built_in">print</span>(base64.b64decode(m))<br>    <span class="hljs-keyword">return</span> base64.b64decode(m)<br>c1=newbase(enc,table2).decode()<br>newbase(c1,table1)<br><span class="hljs-comment">#NCTF{H0m3_r1d1n9_h0m3_dy1n9_h0p3}</span><br></code></pre></td></tr></tbody></table></figure><h2 id="é²¨é²¨çš„ç§˜å¯†">é²¨é²¨çš„ç§˜å¯†</h2><p>32ä½ç¨‹åº,idaè½½å…¥</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c">IpAdress = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x20</span>u);<br> VirtualProtect(IpAdress, <span class="hljs-number">0x20</span>u, <span class="hljs-number">0x40</span>u, &amp;flOldProtect);<br> dword_404E48 = (<span class="hljs-keyword">int</span>)IpAdress;<br> *(_BYTE *)IpAdress = <span class="hljs-number">0xC3</span>;                    <span class="hljs-comment">// retçš„æœºå™¨ç </span><br> ((<span class="hljs-keyword">void</span> (*)(<span class="hljs-keyword">void</span>))IpAdress)<br></code></pre></td></tr></tbody></table></figure><p><strong>åˆšè½½å…¥å°±æœ‰ç§è«åå…¶å¦™çš„ç†Ÿæ‚‰æ„Ÿï¼Œå’Œè¥¿æ¹–è®ºå‰‘çš„ä¸€é“é€†å‘é¢˜æ€è·¯å·®ä¸å¤šï¼Œåˆæ˜¯ä½“åŠ›æ´»ã€‚</strong><br>æ˜¯ä¸€ç§ä¿®æ”¹ä»£ç çš„æ“ä½œæ•°å¹¶å•è¯­å¥æ‰§è¡Œçš„SMCï¼Œé€šè¿‡ä¸€ä¸ªæ•°ç»„æ¥ç¡®å®šèµ‹å€¼ä»£ç é•¿åº¦çš„å¤§å°ï¼Œå’Œé€‰å®šç›¸åº”çš„æ“ä½œæ•°å’Œä¿®æ”¹çš„ä½ç½®ã€‚</p><p>æŒ–å‡ºæ±‡ç¼–ä»£ç ï¼Œç»“åˆåŠ¨è°ƒåˆ†æè¯­å¥è¿˜åŸç®—æ³•ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs c">mov     ds:dword_403474, <span class="hljs-number">0F</span>FFFFFFFh            <span class="hljs-comment">// mov output ,0xffffffff</span><br>mov     ecx, ds:dword_403464                         <span class="hljs-comment">// mov ecx,index(0) </span><br>mov     dl, byte ptr ds:VirtualProtect[ecx]        <span class="hljs-comment">// mov dl,input[0]</span><br>mov     byte ptr ds:dword_403470, dl             <span class="hljs-comment">// mov temp,dl</span><br>movzx   eax, byte ptr ds:dword_403470         <span class="hljs-comment">//  mov eax, temp  è¾“å…¥ä¼ ç»™eax</span><br><span class="hljs-keyword">xor</span>     eax, ds:dword_403474                          <span class="hljs-comment">//  xor   eax,output å–åç±»ä¼¼</span><br>mov     byte ptr ds:dword_403470, al            <span class="hljs-comment">//   mov temp , al  ä¿å­˜å–åçš„å€¼</span><br>movzx   ecx, byte ptr ds:dword_403470        <span class="hljs-comment">//   mov ecx,temp </span><br><span class="hljs-keyword">and</span>     ecx, <span class="hljs-number">0F</span>Fh                                             <span class="hljs-comment">//   and  ecx,0xff</span><br>mov     byte ptr ds:dword_403470, cl            <span class="hljs-comment">//   mov temp,cl</span><br>mov     edx, ds:dword_403474                      <span class="hljs-comment">//    mov edx,output </span><br>shr     edx,   <span class="hljs-number">8</span>                                                 <span class="hljs-comment">//    shr   edx,8</span><br>mov     ds:dword_403474, edx                      <span class="hljs-comment">//    mov output,edx</span><br>movzx   eax, byte ptr ds:dword_403470       <span class="hljs-comment">//    mov eax,temp</span><br>mov     ecx, ds:dword_403474                         <span class="hljs-comment">//    mov ecx,output</span><br><span class="hljs-keyword">xor</span>     ecx, dword ptr ds:byte_403058[eax*<span class="hljs-number">4</span>]     <span class="hljs-comment">//  xor ecx, sbox[4*eax]   //174841BC  xor sbox[4*0x9e] ç»“æœä¿å­˜åˆ°output</span><br>mov     ds:dword_403474, ecx                              <br>mov     edx, ds:dword_403464                            ....<br>mov     al, [edx+<span class="hljs-number">403005</span>h]<br>mov     byte ptr ds:dword_403470, al<br>movzx   ecx, byte ptr ds:dword_403470<br><span class="hljs-keyword">xor</span>     ecx, ds:dword_403474<br>mov     byte ptr ds:dword_403470, cl<br>mov     edx, ds:dword_403474<br>shr     edx, <span class="hljs-number">8</span><br>mov     ds:dword_403474, edx<br>movzx   eax, byte ptr ds:dword_403470<br>mov     ecx, ds:dword_403474<br><span class="hljs-keyword">xor</span>     ecx, dword ptr ds:byte_403058[eax*<span class="hljs-number">4</span>]     <span class="hljs-comment">//xor ecx,sbox[4*eax]  //eax 0xdd</span><br>mov     ds:dword_403474, ecx            <span class="hljs-comment">//mov output,ecx</span><br>mov     edx, ds:dword_403474                            <span class="hljs-comment">//mov edx,output</span><br><span class="hljs-keyword">xor</span>     edx, <span class="hljs-number">0F</span>FFFFFFFh           <span class="hljs-comment">//xor     edx, 0FFFFFFFFh</span><br>mov     ds:dword_403474, edx                          <span class="hljs-comment">//mov    output edx</span><br><br></code></pre></td></tr></tbody></table></figure><p>pythonä»£ç å¦‚ä¸‹</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">input</span>=<span class="hljs-string">'a'</span>*<span class="hljs-number">40</span><br>output=<span class="hljs-number">0xffffffff</span><br><span class="hljs-keyword">for</span> index <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">40</span>,<span class="hljs-number">2</span>):<br>        tmp=(<span class="hljs-built_in">ord</span>(<span class="hljs-built_in">input</span>[index])^output)&amp;<span class="hljs-number">0xff</span><br>        output=output&gt;&gt;<span class="hljs-number">8</span><br>        output=output^somebox[tmp]<br>        <span class="hljs-comment">#print("%x %x"%(tmp,output))</span><br>        tmp = (<span class="hljs-built_in">ord</span>(<span class="hljs-built_in">input</span>[index+<span class="hljs-number">1</span>]) ^ output) &amp; <span class="hljs-number">0xff</span><br>        output = output &gt;&gt; <span class="hljs-number">8</span><br>        output = output ^ somebox[tmp]<br>        output=output^<span class="hljs-number">0xffffffff</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">"%x %x"</span> % (tmp, output))<br></code></pre></td></tr></tbody></table></figure><p><strong>å¯çŸ¥æ˜¯ä¸¤ä¸ªå­—èŠ‚ä¸ºä¸€ç»„è¿›è¡Œçš„å¤„ç†ï¼Œz3è§£å› ä¸ºæ¶‰åŠä¸‹æ ‡é—®é¢˜ä¸å¥½ä¸‹æ‰‹ï¼Œz3æ‰€å¾—ä¸­é—´æ–¹ç¨‹REFçš„å‚æ•°ä¸èƒ½è½¬æ¢ä¸ºå…¶ä»–ç±»å‹çš„å˜é‡ï¼Œæ‰€ä»¥ç›´æ¥çˆ†ç ´ã€‚</strong></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python">somebox=[<span class="hljs-number">0x00000000</span>, <span class="hljs-number">0x77073096</span>, <span class="hljs-number">0xEE0E612C</span>, <span class="hljs-number">0x990951BA</span>, <span class="hljs-number">0x076DC419</span>, <span class="hljs-number">0x706AF48F</span>, <span class="hljs-number">0xE963A535</span>, <span class="hljs-number">0x9E6495A3</span>, <span class="hljs-number">0x0EDB8832</span>, <span class="hljs-number">0x79DCB8A4</span>, <span class="hljs-number">0xE0D5E91E</span>, <span class="hljs-number">0x97D2D988</span>, <span class="hljs-number">0x09B64C2B</span>, <span class="hljs-number">0x7EB17CBD</span>, <span class="hljs-number">0xE7B82D07</span>, <span class="hljs-number">0x90BF1D91</span>, <span class="hljs-number">0x1DB71064</span>, <span class="hljs-number">0x6AB020F2</span>, <span class="hljs-number">0xF3B97148</span>, <span class="hljs-number">0x84BE41DE</span>, <span class="hljs-number">0x1ADAD47D</span>, <span class="hljs-number">0x6DDDE4EB</span>, <span class="hljs-number">0xF4D4B551</span>, <span class="hljs-number">0x83D385C7</span>, <span class="hljs-number">0x136C9856</span>, <span class="hljs-number">0x646BA8C0</span>, <span class="hljs-number">0xFD62F97A</span>, <span class="hljs-number">0x8A65C9EC</span>, <span class="hljs-number">0x14015C4F</span>, <span class="hljs-number">0x63066CD9</span>, <span class="hljs-number">0xFA0F3D63</span>, <span class="hljs-number">0x8D080DF5</span>, <span class="hljs-number">0x3B6E20C8</span>, <span class="hljs-number">0x4C69105E</span>, <span class="hljs-number">0xD56041E4</span>, <span class="hljs-number">0xA2677172</span>, <span class="hljs-number">0x3C03E4D1</span>, <span class="hljs-number">0x4B04D447</span>, <span class="hljs-number">0xD20D85FD</span>, <span class="hljs-number">0xA50AB56B</span>, <span class="hljs-number">0x35B5A8FA</span>, <span class="hljs-number">0x42B2986C</span>, <span class="hljs-number">0xDBBBC9D6</span>, <span class="hljs-number">0xACBCF940</span>, <span class="hljs-number">0x32D86CE3</span>, <span class="hljs-number">0x45DF5C75</span>, <span class="hljs-number">0xDCD60DCF</span>, <span class="hljs-number">0xABD13D59</span>, <span class="hljs-number">0x26D930AC</span>, <span class="hljs-number">0x51DE003A</span>, <span class="hljs-number">0xC8D75180</span>, <span class="hljs-number">0xBFD06116</span>, <span class="hljs-number">0x21B4F4B5</span>, <span class="hljs-number">0x56B3C423</span>, <span class="hljs-number">0xCFBA9599</span>, <span class="hljs-number">0xB8BDA50F</span>, <span class="hljs-number">0x2802B89E</span>, <span class="hljs-number">0x5F058808</span>, <span class="hljs-number">0xC60CD9B2</span>, <span class="hljs-number">0xB10BE924</span>, <span class="hljs-number">0x2F6F7C87</span>, <span class="hljs-number">0x58684C11</span>, <span class="hljs-number">0xC1611DAB</span>, <span class="hljs-number">0xB6662D3D</span>, <span class="hljs-number">0x76DC4190</span>, <span class="hljs-number">0x01DB7106</span>, <span class="hljs-number">0x98D220BC</span>, <span class="hljs-number">0xEFD5102A</span>, <span class="hljs-number">0x71B18589</span>, <span class="hljs-number">0x06B6B51F</span>, <span class="hljs-number">0x9FBFE4A5</span>, <span class="hljs-number">0xE8B8D433</span>, <span class="hljs-number">0x7807C9A2</span>, <span class="hljs-number">0x0F00F934</span>, <span class="hljs-number">0x9609A88E</span>, <span class="hljs-number">0xE10E9818</span>, <span class="hljs-number">0x7F6A0DBB</span>, <span class="hljs-number">0x086D3D2D</span>, <span class="hljs-number">0x91646C97</span>, <span class="hljs-number">0xE6635C01</span>, <span class="hljs-number">0x6B6B51F4</span>, <span class="hljs-number">0x1C6C6162</span>, <span class="hljs-number">0x856530D8</span>, <span class="hljs-number">0xF262004E</span>, <span class="hljs-number">0x6C0695ED</span>, <span class="hljs-number">0x1B01A57B</span>, <span class="hljs-number">0x8208F4C1</span>, <span class="hljs-number">0xF50FC457</span>, <span class="hljs-number">0x65B0D9C6</span>, <span class="hljs-number">0x12B7E950</span>, <span class="hljs-number">0x8BBEB8EA</span>, <span class="hljs-number">0xFCB9887C</span>, <span class="hljs-number">0x62DD1DDF</span>, <span class="hljs-number">0x15DA2D49</span>, <span class="hljs-number">0x8CD37CF3</span>, <span class="hljs-number">0xFBD44C65</span>, <span class="hljs-number">0x4DB26158</span>, <span class="hljs-number">0x3AB551CE</span>, <span class="hljs-number">0xA3BC0074</span>, <span class="hljs-number">0xD4BB30E2</span>, <span class="hljs-number">0x4ADFA541</span>, <span class="hljs-number">0x3DD895D7</span>, <span class="hljs-number">0xA4D1C46D</span>, <span class="hljs-number">0xD3D6F4FB</span>, <span class="hljs-number">0x4369E96A</span>, <span class="hljs-number">0x346ED9FC</span>, <span class="hljs-number">0xAD678846</span>, <span class="hljs-number">0xDA60B8D0</span>, <span class="hljs-number">0x44042D73</span>, <span class="hljs-number">0x33031DE5</span>, <span class="hljs-number">0xAA0A4C5F</span>, <span class="hljs-number">0xDD0D7CC9</span>, <span class="hljs-number">0x5005713C</span>, <span class="hljs-number">0x270241AA</span>, <span class="hljs-number">0xBE0B1010</span>, <span class="hljs-number">0xC90C2086</span>, <span class="hljs-number">0x5768B525</span>, <span class="hljs-number">0x206F85B3</span>, <span class="hljs-number">0xB966D409</span>, <span class="hljs-number">0xCE61E49F</span>, <span class="hljs-number">0x5EDEF90E</span>, <span class="hljs-number">0x29D9C998</span>, <span class="hljs-number">0xB0D09822</span>, <span class="hljs-number">0xC7D7A8B4</span>, <span class="hljs-number">0x59B33D17</span>, <span class="hljs-number">0x2EB40D81</span>, <span class="hljs-number">0xB7BD5C3B</span>, <span class="hljs-number">0xC0BA6CAD</span>, <span class="hljs-number">0xEDB88320</span>, <span class="hljs-number">0x9ABFB3B6</span>, <span class="hljs-number">0x03B6E20C</span>, <span class="hljs-number">0x74B1D29A</span>, <span class="hljs-number">0xEAD54739</span>, <span class="hljs-number">0x9DD277AF</span>, <span class="hljs-number">0x04DB2615</span>, <span class="hljs-number">0x73DC1683</span>, <span class="hljs-number">0xE3630B12</span>, <span class="hljs-number">0x94643B84</span>, <span class="hljs-number">0x0D6D6A3E</span>, <span class="hljs-number">0x7A6A5AA8</span>, <span class="hljs-number">0xE40ECF0B</span>, <span class="hljs-number">0x9309FF9D</span>, <span class="hljs-number">0x0A00AE27</span>, <span class="hljs-number">0x7D079EB1</span>, <span class="hljs-number">0xF00F9344</span>, <span class="hljs-number">0x8708A3D2</span>, <span class="hljs-number">0x1E01F268</span>, <span class="hljs-number">0x6906C2FE</span>, <span class="hljs-number">0xF762575D</span>, <span class="hljs-number">0x806567CB</span>, <span class="hljs-number">0x196C3671</span>, <span class="hljs-number">0x6E6B06E7</span>, <span class="hljs-number">0xFED41B76</span>, <span class="hljs-number">0x89D32BE0</span>, <span class="hljs-number">0x10DA7A5A</span>, <span class="hljs-number">0x67DD4ACC</span>, <span class="hljs-number">0xF9B9DF6F</span>, <span class="hljs-number">0x8EBEEFF9</span>, <span class="hljs-number">0x17B7BE43</span>, <span class="hljs-number">0x60B08ED5</span>, <span class="hljs-number">0xD6D6A3E8</span>, <span class="hljs-number">0xA1D1937E</span>, <span class="hljs-number">0x38D8C2C4</span>, <span class="hljs-number">0x4FDFF252</span>, <span class="hljs-number">0xD1BB67F1</span>, <span class="hljs-number">0xA6BC5767</span>, <span class="hljs-number">0x3FB506DD</span>, <span class="hljs-number">0x48B2364B</span>, <span class="hljs-number">0xD80D2BDA</span>, <span class="hljs-number">0xAF0A1B4C</span>, <span class="hljs-number">0x36034AF6</span>, <span class="hljs-number">0x41047A60</span>, <span class="hljs-number">0xDF60EFC3</span>, <span class="hljs-number">0xA867DF55</span>, <span class="hljs-number">0x316E8EEF</span>, <span class="hljs-number">0x4669BE79</span>, <span class="hljs-number">0xCB61B38C</span>, <span class="hljs-number">0xBC66831A</span>, <span class="hljs-number">0x256FD2A0</span>, <span class="hljs-number">0x5268E236</span>, <span class="hljs-number">0xCC0C7795</span>, <span class="hljs-number">0xBB0B4703</span>, <span class="hljs-number">0x220216B9</span>, <span class="hljs-number">0x5505262F</span>, <span class="hljs-number">0xC5BA3BBE</span>, <span class="hljs-number">0xB2BD0B28</span>, <span class="hljs-number">0x2BB45A92</span>, <span class="hljs-number">0x5CB36A04</span>, <span class="hljs-number">0xC2D7FFA7</span>, <span class="hljs-number">0xB5D0CF31</span>, <span class="hljs-number">0x2CD99E8B</span>, <span class="hljs-number">0x5BDEAE1D</span>, <span class="hljs-number">0x9B64C2B0</span>, <span class="hljs-number">0xEC63F226</span>, <span class="hljs-number">0x756AA39C</span>, <span class="hljs-number">0x026D930A</span>, <span class="hljs-number">0x9C0906A9</span>, <span class="hljs-number">0xEB0E363F</span>, <span class="hljs-number">0x72076785</span>, <span class="hljs-number">0x05005713</span>, <span class="hljs-number">0x95BF4A82</span>, <span class="hljs-number">0xE2B87A14</span>, <span class="hljs-number">0x7BB12BAE</span>, <span class="hljs-number">0x0CB61B38</span>, <span class="hljs-number">0x92D28E9B</span>, <span class="hljs-number">0xE5D5BE0D</span>, <span class="hljs-number">0x7CDCEFB7</span>, <span class="hljs-number">0x0BDBDF21</span>, <span class="hljs-number">0x86D3D2D4</span>, <span class="hljs-number">0xF1D4E242</span>, <span class="hljs-number">0x68DDB3F8</span>, <span class="hljs-number">0x1FDA836E</span>, <span class="hljs-number">0x81BE16CD</span>, <span class="hljs-number">0xF6B9265B</span>, <span class="hljs-number">0x6FB077E1</span>, <span class="hljs-number">0x18B74777</span>, <span class="hljs-number">0x88085AE6</span>, <span class="hljs-number">0xFF0F6A70</span>, <span class="hljs-number">0x66063BCA</span>, <span class="hljs-number">0x11010B5C</span>, <span class="hljs-number">0x8F659EFF</span>, <span class="hljs-number">0xF862AE69</span>, <span class="hljs-number">0x616BFFD3</span>, <span class="hljs-number">0x166CCF45</span>, <span class="hljs-number">0xA00AE278</span>, <span class="hljs-number">0xD70DD2EE</span>, <span class="hljs-number">0x4E048354</span>, <span class="hljs-number">0x3903B3C2</span>, <span class="hljs-number">0xA7672661</span>, <span class="hljs-number">0xD06016F7</span>, <span class="hljs-number">0x4969474D</span>, <span class="hljs-number">0x3E6E77DB</span>, <span class="hljs-number">0xAED16A4A</span>, <span class="hljs-number">0xD9D65ADC</span>, <span class="hljs-number">0x40DF0B66</span>, <span class="hljs-number">0x37D83BF0</span>, <span class="hljs-number">0xA9BCAE53</span>, <span class="hljs-number">0xDEBB9EC5</span>, <span class="hljs-number">0x47B2CF7F</span>, <span class="hljs-number">0x30B5FFE9</span>, <span class="hljs-number">0xBDBDF21C</span>, <span class="hljs-number">0xCABAC28A</span>, <span class="hljs-number">0x53B39330</span>, <span class="hljs-number">0x24B4A3A6</span>, <span class="hljs-number">0xBAD03605</span>, <span class="hljs-number">0xCDD70693</span>, <span class="hljs-number">0x54DE5729</span>, <span class="hljs-number">0x23D967BF</span>, <span class="hljs-number">0xB3667A2E</span>, <span class="hljs-number">0xC4614AB8</span>, <span class="hljs-number">0x5D681B02</span>, <span class="hljs-number">0x2A6F2B94</span>, <span class="hljs-number">0xB40BBE37</span>, <span class="hljs-number">0xC30C8EA1</span>, <span class="hljs-number">0x5A05DF1B</span>, <span class="hljs-number">0x2D02EF8D</span>]<br>enc=[<span class="hljs-number">0xC0F6605E</span>, <span class="hljs-number">0x00B16E0A</span>, <span class="hljs-number">0x3319A2D2</span>, <span class="hljs-number">0x57CAB7B7</span>, <span class="hljs-number">0x9A646D9C</span>, <span class="hljs-number">0xBDD82726</span>, <span class="hljs-number">0xD838FB91</span>, <span class="hljs-number">0x8DE10BB3</span>, <span class="hljs-number">0x176B0DAD</span>, <span class="hljs-number">0x685FDEEF</span>, <span class="hljs-number">0x2C1FF7B1</span>, <span class="hljs-number">0x6C444296</span>, <span class="hljs-number">0xA15CFE90</span>, <span class="hljs-number">0x20CD8721</span>, <span class="hljs-number">0x62967CE8</span>, <span class="hljs-number">0x2C1641FD</span>, <span class="hljs-number">0x572D0F9A</span>, <span class="hljs-number">0xAE52DC2C</span>, <span class="hljs-number">0x50497DCF</span>, <span class="hljs-number">0xFF6ABF4A</span>]<br>s=<span class="hljs-string">''</span><br>enc=[<span class="hljs-number">0xC0F6605E</span>, <span class="hljs-number">0x00B16E0A</span>, <span class="hljs-number">0x3319A2D2</span>, <span class="hljs-number">0x57CAB7B7</span>, <span class="hljs-number">0x9A646D9C</span>, <span class="hljs-number">0xBDD82726</span>, <span class="hljs-number">0xD838FB91</span>, <span class="hljs-number">0x8DE10BB3</span>, <span class="hljs-number">0x176B0DAD</span>, <span class="hljs-number">0x685FDEEF</span>, <span class="hljs-number">0x2C1FF7B1</span>, <span class="hljs-number">0x6C444296</span>, <span class="hljs-number">0xA15CFE90</span>, <span class="hljs-number">0x20CD8721</span>, <span class="hljs-number">0x62967CE8</span>, <span class="hljs-number">0x2C1641FD</span>, <span class="hljs-number">0x572D0F9A</span>, <span class="hljs-number">0xAE52DC2C</span>, <span class="hljs-number">0x50497DCF</span>, <span class="hljs-number">0xFF6ABF4A</span>]<br><span class="hljs-keyword">for</span> i  <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">20</span>):<br>    <span class="hljs-keyword">for</span>  m <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>,<span class="hljs-number">128</span>):<br>        <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>,<span class="hljs-number">128</span>):<br>            output = <span class="hljs-number">0xffffffff</span><br>            tmp=(m^output)&amp;<span class="hljs-number">0xff</span><br>            output=output&gt;&gt;<span class="hljs-number">8</span><br>            output=output^somebox[tmp]<br>            <span class="hljs-comment">#print("%x %x"%(tmp,output))</span><br>            tmp = (n ^ output) &amp; <span class="hljs-number">0xff</span><br>            output = output &gt;&gt; <span class="hljs-number">8</span><br>            output = output ^ somebox[tmp]<br>            output=output^<span class="hljs-number">0xffffffff</span><br>            <span class="hljs-keyword">if</span> output==enc[i]:<br>                s+=<span class="hljs-built_in">chr</span>(m)+<span class="hljs-built_in">chr</span>(n)<br><br><span class="hljs-built_in">print</span>(s)<br><span class="hljs-comment">#NCTF{rLdE57TG0iHA39qUnFZp6LeJyYEBcxMNL7}</span><br></code></pre></td></tr></tbody></table></figure><h2 id="ç‹—ç‹—çš„ç§˜å¯†">ç‹—ç‹—çš„ç§˜å¯†</h2><p><strong>æŒºä¸é”™çš„ï¼Œè§£å®Œæƒ³æš´æ‰“å‡ºé¢˜äººã€‚</strong><br>32ä½ç¨‹åºï¼Œidaè½½å…¥è·å¾—å‡flagä¸€æš<br><img src="https://bu.dusays.com/2021/12/01/811a7364f1bd8.png" alt=""><br>ä¸è¿‡mainä¹‹å‰æœ‰ä¸ªTlsCallbackå‡½æ•°ï¼Œç›´æ¥ä¸‹ä¸ªæ–­ç‚¹ï¼ŒåŠ¨æ€åˆ†æã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">if</span> ( !v9 &amp;&amp; !IsDebuggerPresent() )<br>   {<br>     off_825014 = (<span class="hljs-keyword">int</span> (__cdecl *)(_DWORD))sub_823000;<br>     v8 = (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> *)((<span class="hljs-keyword">char</span> *)sub_823000 + <span class="hljs-number">256</span>);<br>     <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">24</span>; ++i )<br>       v8 += <span class="hljs-number">2</span>;<br>     <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">24</span>; ++j )<br>     {<br>       v8 -= <span class="hljs-number">2</span>;<br>       sub_8211F0(v8);<br>     }<br>   }<br></code></pre></td></tr></tbody></table></figure><p>åè°ƒè¯•ï¼Œoff_825014åœ¨ä¸»å‡½æ•°å‡ºç°è¿‡ï¼Œä½†æ˜¯ä¸ªå‡é€»è¾‘ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†å†…å®¹æ˜¯SMCä¿®æ”¹æŠ€æœ¯ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-function"><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> __cdecl <span class="hljs-title">sub_8211F0</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> *a1)</span></span><br><span class="hljs-function"></span>{<br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> result; <span class="hljs-comment">// eax</span><br>  <span class="hljs-keyword">int</span> i; <span class="hljs-comment">// [esp+0h] [ebp-Ch]</span><br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> v3; <span class="hljs-comment">// [esp+4h] [ebp-8h]</span><br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> v4; <span class="hljs-comment">// [esp+8h] [ebp-4h]</span><br><br>  v4 = *a1;<br>  v3 = a1[<span class="hljs-number">1</span>];<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">64</span>; ++i )<br>  {<br>    v3 -= (dword_825004[(*(_DWORD *)delta &gt;&gt; <span class="hljs-number">11</span>) &amp; <span class="hljs-number">3</span>] + *(_DWORD *)delta) ^ (v4 + ((v4 &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">16</span> * v4)));<br>    *(_DWORD *)delta += dword_825000;<br>    v4 -= (dword_825004[delta[<span class="hljs-number">0</span>] &amp; <span class="hljs-number">3</span>] + *(_DWORD *)delta) ^ (v3 + ((v3 &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">16</span> * v3)));<br>  }<br>  *a1 = v4;<br>  result = v3;<br>  a1[<span class="hljs-number">1</span>] = v3;<br>  <span class="hljs-keyword">return</span> result;<br>}<br></code></pre></td></tr></tbody></table></figure><p><strong>ç›´æ¥æ”¹eipç»•è¿‡è¿™ä¸ªåè°ƒè¯•å³å¯ï¼ŒåŒæ—¶ä¿®æ”¹ä»£ç ç”¨çš„xTeaï¼Œä¸è¿‡deltaçš„å€¼æœ‰ä¸ªå°å‘ï¼Œmainå‡½æ•°ä¸­æœ‰ä¸ªåˆ›å»ºçº¿ç¨‹çš„å‡½æ•°ï¼Œå°†deltaèµ‹å€¼ä¸º0xDA76C600ï¼Œpatchè¿›è¡Œä¿®æ”¹ï¼Œåé¢ä¸‹ä¸ªæ–­F9ã€‚</strong></p><blockquote><p>çº¿ç¨‹çš„æ‰§è¡Œé¡ºåºä¸æ˜¯å¤ªæ¸…æ¥šï¼Œä¸è¿‡TLSCALLBACKåœ¨mainä¹‹å‰æ‰§è¡Œï¼Œè€Œdeltaåœ¨mainå‡½æ•°ä¸­è¢«æ”¹æ‰ï¼Œä¸ºä»€ä¹ˆä¼šåº”ç”¨åˆ°smcä¸­å‘¢ï¼Œæœ‰å¾…è§£å†³ã€‚</p></blockquote><p><strong>ä¿®å¤å‡½æ•°åæ‹¿åˆ°çœŸæ­£å¤„ç†é€»è¾‘ã€‚</strong></p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> __cdecl <span class="hljs-title">sub_823000</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *a1)</span></span><br><span class="hljs-function"></span>{<br>  <span class="hljs-keyword">signed</span> <span class="hljs-keyword">int</span> v2; <span class="hljs-comment">// [esp+0h] [ebp-98h]</span><br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> v3; <span class="hljs-comment">// [esp+10h] [ebp-88h]</span><br>  <span class="hljs-keyword">signed</span> <span class="hljs-keyword">int</span> v4; <span class="hljs-comment">// [esp+1Ch] [ebp-7Ch]</span><br>  <span class="hljs-keyword">int</span> v5; <span class="hljs-comment">// [esp+2Ch] [ebp-6Ch]</span><br>  <span class="hljs-keyword">int</span> v6; <span class="hljs-comment">// [esp+2Ch] [ebp-6Ch]</span><br>  <span class="hljs-keyword">char</span> v7; <span class="hljs-comment">// [esp+32h] [ebp-66h]</span><br>  <span class="hljs-keyword">signed</span> <span class="hljs-keyword">int</span> Size; <span class="hljs-comment">// [esp+34h] [ebp-64h]</span><br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> v9; <span class="hljs-comment">// [esp+38h] [ebp-60h]</span><br>  <span class="hljs-keyword">int</span> k; <span class="hljs-comment">// [esp+38h] [ebp-60h]</span><br>  <span class="hljs-keyword">unsigned</span> __int8 *v11; <span class="hljs-comment">// [esp+3Ch] [ebp-5Ch]</span><br>  <span class="hljs-keyword">int</span> i; <span class="hljs-comment">// [esp+40h] [ebp-58h]</span><br>  <span class="hljs-keyword">signed</span> <span class="hljs-keyword">int</span> j; <span class="hljs-comment">// [esp+40h] [ebp-58h]</span><br>  <span class="hljs-keyword">signed</span> <span class="hljs-keyword">int</span> m; <span class="hljs-comment">// [esp+40h] [ebp-58h]</span><br>  <span class="hljs-keyword">signed</span> <span class="hljs-keyword">int</span> n; <span class="hljs-comment">// [esp+40h] [ebp-58h]</span><br>  <span class="hljs-keyword">signed</span> <span class="hljs-keyword">int</span> ii; <span class="hljs-comment">// [esp+40h] [ebp-58h]</span><br>  <span class="hljs-keyword">char</span> v17[<span class="hljs-number">62</span>]; <span class="hljs-comment">// [esp+44h] [ebp-54h]</span><br>  <span class="hljs-keyword">int</span> v18; <span class="hljs-comment">// [esp+82h] [ebp-16h]</span><br>  <span class="hljs-keyword">int</span> v19; <span class="hljs-comment">// [esp+86h] [ebp-12h]</span><br>  <span class="hljs-keyword">int</span> v20; <span class="hljs-comment">// [esp+8Ah] [ebp-Eh]</span><br>  <span class="hljs-keyword">int</span> v21; <span class="hljs-comment">// [esp+8Eh] [ebp-Ah]</span><br>  __int16 v22; <span class="hljs-comment">// [esp+92h] [ebp-6h]</span><br><br>  v3 = <span class="hljs-built_in">strlen</span>(a1);<br>  Size = <span class="hljs-number">146</span> * v3 / <span class="hljs-number">0x64</span> + <span class="hljs-number">1</span>;<br>  v4 = <span class="hljs-number">0</span>;<br>  v11 = (<span class="hljs-keyword">unsigned</span> __int8 *)<span class="hljs-built_in">malloc</span>(Size);<br>  v17[<span class="hljs-number">0</span>] = <span class="hljs-number">82</span>;<br>  v17[<span class="hljs-number">1</span>] = <span class="hljs-number">-61</span>;<br>  v17[<span class="hljs-number">2</span>] = <span class="hljs-number">26</span>;<br>  v17[<span class="hljs-number">3</span>] = <span class="hljs-number">-32</span>;<br>  v17[<span class="hljs-number">4</span>] = <span class="hljs-number">22</span>;<br>  v17[<span class="hljs-number">5</span>] = <span class="hljs-number">93</span>;<br>  v17[<span class="hljs-number">6</span>] = <span class="hljs-number">94</span>;<br>  v17[<span class="hljs-number">7</span>] = <span class="hljs-number">-30</span>;<br>  v17[<span class="hljs-number">8</span>] = <span class="hljs-number">103</span>;<br>  v17[<span class="hljs-number">9</span>] = <span class="hljs-number">31</span>;<br>  v17[<span class="hljs-number">10</span>] = <span class="hljs-number">31</span>;<br>  v17[<span class="hljs-number">11</span>] = <span class="hljs-number">6</span>;<br>  v17[<span class="hljs-number">12</span>] = <span class="hljs-number">6</span>;<br>  v17[<span class="hljs-number">13</span>] = <span class="hljs-number">31</span>;<br>  v17[<span class="hljs-number">14</span>] = <span class="hljs-number">23</span>;<br>  v17[<span class="hljs-number">15</span>] = <span class="hljs-number">6</span>;<br>  v17[<span class="hljs-number">16</span>] = <span class="hljs-number">15</span>;<br>  v17[<span class="hljs-number">17</span>] = <span class="hljs-number">-7</span>;<br>  v17[<span class="hljs-number">18</span>] = <span class="hljs-number">6</span>;<br>  v17[<span class="hljs-number">19</span>] = <span class="hljs-number">103</span>;<br>  v17[<span class="hljs-number">20</span>] = <span class="hljs-number">88</span>;<br>  v17[<span class="hljs-number">21</span>] = <span class="hljs-number">-78</span>;<br>  v17[<span class="hljs-number">22</span>] = <span class="hljs-number">-30</span>;<br>  v17[<span class="hljs-number">23</span>] = <span class="hljs-number">-116</span>;<br>  v17[<span class="hljs-number">24</span>] = <span class="hljs-number">15</span>;<br>  v17[<span class="hljs-number">25</span>] = <span class="hljs-number">42</span>;<br>  v17[<span class="hljs-number">26</span>] = <span class="hljs-number">6</span>;<br>  v17[<span class="hljs-number">27</span>] = <span class="hljs-number">-119</span>;<br>  v17[<span class="hljs-number">28</span>] = <span class="hljs-number">-49</span>;<br>  v17[<span class="hljs-number">29</span>] = <span class="hljs-number">42</span>;<br>  v17[<span class="hljs-number">30</span>] = <span class="hljs-number">6</span>;<br>  v17[<span class="hljs-number">31</span>] = <span class="hljs-number">31</span>;<br>  v17[<span class="hljs-number">32</span>] = <span class="hljs-number">-104</span>;<br>  v17[<span class="hljs-number">33</span>] = <span class="hljs-number">26</span>;<br>  v17[<span class="hljs-number">34</span>] = <span class="hljs-number">62</span>;<br>  v17[<span class="hljs-number">35</span>] = <span class="hljs-number">23</span>;<br>  v17[<span class="hljs-number">36</span>] = <span class="hljs-number">103</span>;<br>  v17[<span class="hljs-number">37</span>] = <span class="hljs-number">31</span>;<br>  v17[<span class="hljs-number">38</span>] = <span class="hljs-number">-9</span>;<br>  v17[<span class="hljs-number">39</span>] = <span class="hljs-number">58</span>;<br>  v17[<span class="hljs-number">40</span>] = <span class="hljs-number">68</span>;<br>  v17[<span class="hljs-number">41</span>] = <span class="hljs-number">-61</span>;<br>  v17[<span class="hljs-number">42</span>] = <span class="hljs-number">22</span>;<br>  v17[<span class="hljs-number">43</span>] = <span class="hljs-number">51</span>;<br>  v17[<span class="hljs-number">44</span>] = <span class="hljs-number">105</span>;<br>  v17[<span class="hljs-number">45</span>] = <span class="hljs-number">26</span>;<br>  v17[<span class="hljs-number">46</span>] = <span class="hljs-number">117</span>;<br>  v17[<span class="hljs-number">47</span>] = <span class="hljs-number">22</span>;<br>  v17[<span class="hljs-number">48</span>] = <span class="hljs-number">62</span>;<br>  v17[<span class="hljs-number">49</span>] = <span class="hljs-number">23</span>;<br>  v17[<span class="hljs-number">50</span>] = <span class="hljs-number">-43</span>;<br>  v17[<span class="hljs-number">51</span>] = <span class="hljs-number">105</span>;<br>  v17[<span class="hljs-number">52</span>] = <span class="hljs-number">122</span>;<br>  v17[<span class="hljs-number">53</span>] = <span class="hljs-number">27</span>;<br>  v17[<span class="hljs-number">54</span>] = <span class="hljs-number">68</span>;<br>  v17[<span class="hljs-number">55</span>] = <span class="hljs-number">68</span>;<br>  v17[<span class="hljs-number">56</span>] = <span class="hljs-number">62</span>;<br>  v17[<span class="hljs-number">57</span>] = <span class="hljs-number">103</span>;<br>  v17[<span class="hljs-number">58</span>] = <span class="hljs-number">-9</span>;<br>  v17[<span class="hljs-number">59</span>] = <span class="hljs-number">-119</span>;<br>  v17[<span class="hljs-number">60</span>] = <span class="hljs-number">103</span>;<br>  v17[<span class="hljs-number">61</span>] = <span class="hljs-number">-61</span>;<br>  v18 = <span class="hljs-number">0</span>;<br>  v19 = <span class="hljs-number">0</span>;<br>  v20 = <span class="hljs-number">0</span>;<br>  v21 = <span class="hljs-number">0</span>;<br>  v22 = <span class="hljs-number">0</span>;<br>  <span class="hljs-built_in">memset</span>(v11, <span class="hljs-number">0</span>, Size);<br>  v9 = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">256</span>; ++i )<br>  {<br>    v7 = byte_825018[i];<br>    byte_825018[i] = byte_825018[(i + *((<span class="hljs-keyword">unsigned</span> __int8 *)&amp;delta + i % <span class="hljs-number">4</span>)) % <span class="hljs-number">256</span>];<span class="hljs-comment">// deltaå˜ä¸º0äº†</span><br>    byte_825018[(i + *((<span class="hljs-keyword">unsigned</span> __int8 *)&amp;delta + i % <span class="hljs-number">4</span>)) % <span class="hljs-number">256</span>] = v7;<br>  }<br>  <span class="hljs-keyword">while</span> ( v9 &lt; <span class="hljs-built_in">strlen</span>(a1) )<br>  {<br>    v5 = a1[v9];<br>    <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">146</span> * v3 / <span class="hljs-number">0x64</span>; ; --j )<br>    {<br>      v6 = v5 + (v11[j] &lt;&lt; <span class="hljs-number">8</span>);<br>      v11[j] = v6 % <span class="hljs-number">47</span>;<br>      v5 = v6 / <span class="hljs-number">47</span>;<br>      <span class="hljs-keyword">if</span> ( j &lt; v4 )<br>        v4 = j;<br>      <span class="hljs-keyword">if</span> ( !v5 &amp;&amp; j &lt;= v4 )<br>        <span class="hljs-keyword">break</span>;<br>    }<br>    ++v9;<br>  }<br>  <span class="hljs-keyword">for</span> ( k = <span class="hljs-number">0</span>; !v11[k]; ++k )<br>    ;<br>  <span class="hljs-keyword">for</span> ( m = <span class="hljs-number">0</span>; m &lt; Size; ++m )<br>    v11[m] = byte_825118[v11[k++]];             <span class="hljs-comment">// å•è¡¨æ›¿æ¢</span><br>  <span class="hljs-keyword">while</span> ( m &lt; Size )<br>    v11[m++] = <span class="hljs-number">0</span>;<br>  v2 = <span class="hljs-built_in">strlen</span>((<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *)v11);<br>  <span class="hljs-keyword">for</span> ( n = <span class="hljs-number">0</span>; n &lt; v2; ++n )<br>    v11[n] ^= byte_825018[v11[n]];              <span class="hljs-comment">// å¼‚æˆ–å¤„ç†</span><br>  <span class="hljs-keyword">for</span> ( ii = <span class="hljs-number">0</span>; ii &lt; v2; ++ii )<br>  {<br>    <span class="hljs-keyword">if</span> ( v11[ii] != (<span class="hljs-keyword">unsigned</span> __int8)v17[ii] )<br>    {<br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Wrong!\n"</span>, v2);<br>      <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>    }<br>  }<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Right!\n"</span>, v2);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}<br></code></pre></td></tr></tbody></table></figure><p><strong>deltaçš„å€¼æ˜¯0ï¼Œéœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œæ¥ç€å°±æ˜¯å†™è„šæœ¬é€†å‘ï¼Œz3ä¸å¥½ç›´æ¥æ±‚è§£ï¼ŒåŠ å¯†æµç¨‹æ˜¯å…ˆå°†è¾“å…¥è½¬ä¸º47è¿›åˆ¶ä¸‹æ¯ä½çš„å€¼å­˜åœ¨æ•°ç»„v11ä¸­ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªé0å€¼çš„ä¸‹æ ‡kï¼Œæ¥ç€è¿›è¡Œå•è¡¨æ›¿æ¢å’Œå¼‚æˆ–ã€‚</strong></p><blockquote><p>åˆæ˜¯ä¸€ä¸ªz3ç›´æ¥å‡ºï¼Œå´è¢«banäº†çš„é¢˜ï¼Œç±»å‹è½¬æ¢æœ‰ç‚¹å‘</p></blockquote><p><strong>å› ä¸ºæ¶‰åŠåˆ°è¡¨ç´¢å¼•å’Œæœ¬èº«å¼‚æˆ–ä¸å¥½é€†å‘è¿˜åŸï¼Œæ‰€ä»¥æƒ³ç€å…ˆçˆ†ç ´v11æ•°ç»„ã€‚</strong></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python">enc=[<span class="hljs-number">0x52</span>, <span class="hljs-number">0xC3</span>, <span class="hljs-number">0x1A</span>, <span class="hljs-number">0xE0</span>, <span class="hljs-number">0x16</span>, <span class="hljs-number">0x5D</span>, <span class="hljs-number">0x5E</span>, <span class="hljs-number">0xE2</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0x1F</span>, <span class="hljs-number">0x1F</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x1F</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x0F</span>, <span class="hljs-number">0xF9</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0x58</span>, <span class="hljs-number">0xB2</span>, <span class="hljs-number">0xE2</span>, <span class="hljs-number">0x8C</span>, <span class="hljs-number">0x0F</span>, <span class="hljs-number">0x2A</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x89</span>, <span class="hljs-number">0xCF</span>, <span class="hljs-number">0x2A</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x1F</span>, <span class="hljs-number">0x98</span>, <span class="hljs-number">0x1A</span>, <span class="hljs-number">0x3E</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0x1F</span>, <span class="hljs-number">0xF7</span>, <span class="hljs-number">0x3A</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0xC3</span>, <span class="hljs-number">0x16</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x69</span>, <span class="hljs-number">0x1A</span>, <span class="hljs-number">0x75</span>, <span class="hljs-number">0x16</span>, <span class="hljs-number">0x3E</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0xD5</span>, <span class="hljs-number">0x69</span>, <span class="hljs-number">0x7A</span>, <span class="hljs-number">0x1B</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0x3E</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0xF7</span>, <span class="hljs-number">0x89</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0xC3</span>]<br>c=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">61</span>):<br>    temp=[]<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">47</span>):<br>        tmp=tb2[j]<br>        tmp=tmp^table[tmp]<br>        <span class="hljs-keyword">if</span> tmp==enc[i]:<br>            temp.append(j)<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(temp)==<span class="hljs-number">1</span>:<br>        c.append(temp[<span class="hljs-number">0</span>])<br>    <span class="hljs-keyword">else</span>:<br>        c.append(temp)<br>c.insert(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>)<br><br><span class="hljs-comment">#[0, 2, 0, [33, 45], 44, 30, 40, 8, 23, [7, 11, 22], [34, 37], [34, 37], [19, 20, 43], [19, 20, 43], [34, 37], 24, [19, 20, 43], [4, 31], 29, [19, 20, 43], [7, 11, 22], 13, 5, 23, 41, [4, 31], 35, [19, 20, 43], 9, 14, 35, [19, 20, 43], [34, 37], 3, [33, 45], 10, 24, [7, 11, 22], [34, 37], 38, 1, 25, 0, 30, 6, 42, [33, 45], 36, 30, 10, 24, 21, 42, 26, 28, 25, 25, 10, [7, 11, 22], 38, 9, [7, 11, 22]]</span><br></code></pre></td></tr></tbody></table></figure><p><strong>v11ç¬¬ä¸€ä½æ˜¯0ï¼Œæ ¹æ®åŠ å¯†çš„æœ€åä¸€ä½æ˜¯0xc3ï¼Œæˆ–è€…å¤šæ¬¡æµ‹è¯•éƒ½å¯çŸ¥ï¼Œä¸è¿‡è¿™è§£æœ‰ç‚¹å¤šï¼Œä¸‹é¢å°±æ˜¯å¯¹cè¿›è¡Œæ’åˆ—ç»„åˆï¼Œä¹‹å47è¿›åˆ¶è½¬ï¼Œlong_to_bytesä¸‹å³å¯ï¼Œä¸è¿‡è¿™â€¦tmdï¼Œdfsä¸å¤ªä¼šå†™ï¼Œç›´æ¥ç¡¬çˆ†ç ´äº†ï¼Œå¤§æ¦‚è·‘äº†åŠå°æ—¶,ç›´æ¥æ•´emoäº†ã€‚</strong></p><blockquote><p>è·‘èµ·æ¥æ‰æ„è¯†åˆ°ä»é«˜ä½å¼€å§‹çˆ†ç ´ä¼šæ¯”è¾ƒå¿«ï¼Œé«˜ä½å¯¹è½¬å­—ç¬¦çš„å½±å“è¾ƒå¤§ï¼Œå‚»äº†</p></blockquote><p>å®Œæ•´å¦‚ä¸‹</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dododo</span>(<span class="hljs-params">c</span>):</span><br>    <span class="hljs-built_in">sum</span> = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">62</span>):<br>        <span class="hljs-built_in">sum</span> += c[i] * <span class="hljs-built_in">pow</span>(<span class="hljs-number">47</span>, <span class="hljs-number">61</span> - i)<br>    m=long_to_bytes(<span class="hljs-built_in">sum</span>)<br>    <span class="hljs-keyword">try</span>:<br>        flag=m.decode()<br>        <span class="hljs-built_in">print</span>(flag)<br>        exit(<span class="hljs-number">0</span>)<br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">pass</span><br><br><br>enc=[<span class="hljs-number">0x52</span>, <span class="hljs-number">0xC3</span>, <span class="hljs-number">0x1A</span>, <span class="hljs-number">0xE0</span>, <span class="hljs-number">0x16</span>, <span class="hljs-number">0x5D</span>, <span class="hljs-number">0x5E</span>, <span class="hljs-number">0xE2</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0x1F</span>, <span class="hljs-number">0x1F</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x1F</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x0F</span>, <span class="hljs-number">0xF9</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0x58</span>, <span class="hljs-number">0xB2</span>, <span class="hljs-number">0xE2</span>, <span class="hljs-number">0x8C</span>, <span class="hljs-number">0x0F</span>, <span class="hljs-number">0x2A</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x89</span>, <span class="hljs-number">0xCF</span>, <span class="hljs-number">0x2A</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x1F</span>, <span class="hljs-number">0x98</span>, <span class="hljs-number">0x1A</span>, <span class="hljs-number">0x3E</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0x1F</span>, <span class="hljs-number">0xF7</span>, <span class="hljs-number">0x3A</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0xC3</span>, <span class="hljs-number">0x16</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x69</span>, <span class="hljs-number">0x1A</span>, <span class="hljs-number">0x75</span>, <span class="hljs-number">0x16</span>, <span class="hljs-number">0x3E</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0xD5</span>, <span class="hljs-number">0x69</span>, <span class="hljs-number">0x7A</span>, <span class="hljs-number">0x1B</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0x3E</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0xF7</span>, <span class="hljs-number">0x89</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0xC3</span>]<br>table=[<span class="hljs-number">0x21</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x87</span>, <span class="hljs-number">0x09</span>, <span class="hljs-number">0x21</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0xA2</span>, <span class="hljs-number">0x9B</span>, <span class="hljs-number">0xF4</span>, <span class="hljs-number">0xDF</span>, <span class="hljs-number">0xAC</span>, <span class="hljs-number">0x7C</span>, <span class="hljs-number">0xA1</span>, <span class="hljs-number">0xC6</span>, <span class="hljs-number">0x16</span>, <span class="hljs-number">0xD0</span>, <span class="hljs-number">0x0F</span>, <span class="hljs-number">0xDD</span>, <span class="hljs-number">0xDC</span>, <span class="hljs-number">0x73</span>, <span class="hljs-number">0xC5</span>, <span class="hljs-number">0x6B</span>, <span class="hljs-number">0xD1</span>, <span class="hljs-number">0x96</span>, <span class="hljs-number">0x47</span>, <span class="hljs-number">0xC2</span>, <span class="hljs-number">0x26</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0x4E</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x82</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x56</span>, <span class="hljs-number">0x9A</span>, <span class="hljs-number">0x6E</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x92</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0xB5</span>, <span class="hljs-number">0xB4</span>, <span class="hljs-number">0x71</span>, <span class="hljs-number">0xA9</span>, <span class="hljs-number">0xCE</span>, <span class="hljs-number">0xC3</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x59</span>, <span class="hljs-number">0xBF</span>, <span class="hljs-number">0x2D</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0x22</span>, <span class="hljs-number">0xA6</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x04</span>, <span class="hljs-number">0xB2</span>, <span class="hljs-number">0xCD</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0xD5</span>, <span class="hljs-number">0x68</span>, <span class="hljs-number">0x4D</span>, <span class="hljs-number">0x5B</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0x9E</span>, <span class="hljs-number">0x85</span>, <span class="hljs-number">0xCF</span>, <span class="hljs-number">0x9D</span>, <span class="hljs-number">0xCC</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x32</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0xE3</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0xAD</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0x4F</span>, <span class="hljs-number">0xFA</span>, <span class="hljs-number">0x72</span>, <span class="hljs-number">0x83</span>, <span class="hljs-number">0x4C</span>, <span class="hljs-number">0x86</span>, <span class="hljs-number">0x60</span>, <span class="hljs-number">0xB7</span>, <span class="hljs-number">0xD7</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x0C</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0xB3</span>, <span class="hljs-number">0x7B</span>, <span class="hljs-number">0x19</span>, <span class="hljs-number">0xD4</span>, <span class="hljs-number">0x69</span>, <span class="hljs-number">0x08</span>, <span class="hljs-number">0x0B</span>, <span class="hljs-number">0x1F</span>, <span class="hljs-number">0x3D</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x79</span>, <span class="hljs-number">0xD3</span>, <span class="hljs-number">0xEE</span>, <span class="hljs-number">0x93</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0xDE</span>, <span class="hljs-number">0x23</span>, <span class="hljs-number">0x3B</span>, <span class="hljs-number">0x5D</span>, <span class="hljs-number">0x8D</span>, <span class="hljs-number">0xA5</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0x5F</span>, <span class="hljs-number">0x58</span>, <span class="hljs-number">0xDB</span>, <span class="hljs-number">0x97</span>, <span class="hljs-number">0xF6</span>, <span class="hljs-number">0x7A</span>, <span class="hljs-number">0x18</span>, <span class="hljs-number">0x52</span>, <span class="hljs-number">0x15</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x25</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0x2C</span>, <span class="hljs-number">0x05</span>, <span class="hljs-number">0xE8</span>, <span class="hljs-number">0x0D</span>, <span class="hljs-number">0x98</span>, <span class="hljs-number">0x2A</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0xE2</span>, <span class="hljs-number">0xEF</span>, <span class="hljs-number">0x48</span>, <span class="hljs-number">0x87</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0x1C</span>, <span class="hljs-number">0xCA</span>, <span class="hljs-number">0x2B</span>, <span class="hljs-number">0xA7</span>, <span class="hljs-number">0x8A</span>, <span class="hljs-number">0x09</span>, <span class="hljs-number">0x81</span>, <span class="hljs-number">0xE7</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0xAA</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0x6F</span>, <span class="hljs-number">0x8E</span>, <span class="hljs-number">0x91</span>, <span class="hljs-number">0xF1</span>, <span class="hljs-number">0xF0</span>, <span class="hljs-number">0xA4</span>, <span class="hljs-number">0x46</span>, <span class="hljs-number">0x3A</span>, <span class="hljs-number">0x7D</span>, <span class="hljs-number">0x54</span>, <span class="hljs-number">0xEB</span>, <span class="hljs-number">0x2F</span>, <span class="hljs-number">0xC1</span>, <span class="hljs-number">0xC0</span>, <span class="hljs-number">0x0E</span>, <span class="hljs-number">0xBD</span>, <span class="hljs-number">0xE1</span>, <span class="hljs-number">0x6C</span>, <span class="hljs-number">0x64</span>, <span class="hljs-number">0xBE</span>, <span class="hljs-number">0xE4</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x3C</span>, <span class="hljs-number">0x5A</span>, <span class="hljs-number">0xA8</span>, <span class="hljs-number">0x9F</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0xAF</span>, <span class="hljs-number">0xA0</span>, <span class="hljs-number">0x13</span>, <span class="hljs-number">0xED</span>, <span class="hljs-number">0x1B</span>, <span class="hljs-number">0xEC</span>, <span class="hljs-number">0x8B</span>, <span class="hljs-number">0x3E</span>, <span class="hljs-number">0x7E</span>, <span class="hljs-number">0x27</span>, <span class="hljs-number">0x99</span>, <span class="hljs-number">0x75</span>, <span class="hljs-number">0xAB</span>, <span class="hljs-number">0xFE</span>, <span class="hljs-number">0xD9</span>, <span class="hljs-number">0x3F</span>, <span class="hljs-number">0xF3</span>, <span class="hljs-number">0xEA</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0xF7</span>, <span class="hljs-number">0x95</span>, <span class="hljs-number">0xBA</span>, <span class="hljs-number">0x1D</span>, <span class="hljs-number">0x40</span>, <span class="hljs-number">0xB0</span>, <span class="hljs-number">0xF9</span>, <span class="hljs-number">0xE5</span>, <span class="hljs-number">0xF8</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0xBC</span>, <span class="hljs-number">0xB6</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0xC9</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0x9C</span>, <span class="hljs-number">0x2E</span>, <span class="hljs-number">0x89</span>, <span class="hljs-number">0x5C</span>, <span class="hljs-number">0x7F</span>, <span class="hljs-number">0xB1</span>, <span class="hljs-number">0x1A</span>, <span class="hljs-number">0xD6</span>, <span class="hljs-number">0x90</span>, <span class="hljs-number">0xAE</span>, <span class="hljs-number">0xDA</span>, <span class="hljs-number">0xE6</span>, <span class="hljs-number">0x5E</span>, <span class="hljs-number">0xB9</span>, <span class="hljs-number">0x84</span>, <span class="hljs-number">0xE9</span>, <span class="hljs-number">0x55</span>, <span class="hljs-number">0xBB</span>, <span class="hljs-number">0xC7</span>, <span class="hljs-number">0x0A</span>, <span class="hljs-number">0xE0</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0xF2</span>, <span class="hljs-number">0xD8</span>, <span class="hljs-number">0xCB</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0xB8</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0x94</span>, <span class="hljs-number">0x6A</span>, <span class="hljs-number">0x4A</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0x24</span>, <span class="hljs-number">0x14</span>, <span class="hljs-number">0x51</span>, <span class="hljs-number">0x07</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x21</span>, <span class="hljs-number">0xC8</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0xFD</span>, <span class="hljs-number">0x8F</span>, <span class="hljs-number">0xC4</span>, <span class="hljs-number">0xF5</span>, <span class="hljs-number">0xFC</span>]<br><span class="hljs-comment">#delta=[0,0xc6,0x76,0xda]</span><br>tb2=[<span class="hljs-number">0xA7</span>, <span class="hljs-number">0x1C</span>, <span class="hljs-number">0x7E</span>, <span class="hljs-number">0xAF</span>, <span class="hljs-number">0xD9</span>, <span class="hljs-number">0xC2</span>, <span class="hljs-number">0xC0</span>, <span class="hljs-number">0xBE</span>, <span class="hljs-number">0x1F</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0x9A</span>, <span class="hljs-number">0x85</span>, <span class="hljs-number">0x26</span>, <span class="hljs-number">0xE3</span>, <span class="hljs-number">0x87</span>, <span class="hljs-number">0xC3</span>, <span class="hljs-number">0x21</span>, <span class="hljs-number">0xE0</span>, <span class="hljs-number">0x95</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0x71</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x75</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0xA5</span>, <span class="hljs-number">0x1D</span>, <span class="hljs-number">0x0D</span>, <span class="hljs-number">0x2F</span>, <span class="hljs-number">0xEE</span>, <span class="hljs-number">0x25</span>, <span class="hljs-number">0x7B</span>, <span class="hljs-number">0xB5</span>, <span class="hljs-number">0x82</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0x8D</span>, <span class="hljs-number">0xDB</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0x3A</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0xD4</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0x99</span>, <span class="hljs-number">0x97</span>, <span class="hljs-number">0x9D</span>, <span class="hljs-number">0xE8</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0x00</span>]<br><br>c=[]<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">61</span>):<br>    temp=[]<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">47</span>):<br>        tmp=tb2[j]<br>        tmp=tmp^table[tmp]<br>        <span class="hljs-keyword">if</span> tmp==enc[i]:<br>            temp.append(j)<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(temp)==<span class="hljs-number">1</span>:<br>        c.append(temp[<span class="hljs-number">0</span>])<br>    <span class="hljs-keyword">else</span>:<br>        c.append(temp)<br>c.insert(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>)<br><span class="hljs-built_in">print</span>(c)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> c:<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(i,<span class="hljs-built_in">int</span>):<br>        <span class="hljs-keyword">pass</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(i)<br>c[<span class="hljs-number">3</span>]=<span class="hljs-number">45</span><br>tblen=[]<br>l=<span class="hljs-number">1</span><br>index=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(c)):<br>    <span class="hljs-keyword">try</span>:<br>        tblen.append(<span class="hljs-built_in">len</span>(c[i]))<br>        l*=<span class="hljs-built_in">len</span>(c[i])<br>        index.append(i)<br>    <span class="hljs-keyword">except</span>:<br>        tblen.append(<span class="hljs-number">1</span>)<br><br><span class="hljs-built_in">print</span>(tblen)<br><span class="hljs-built_in">print</span>(index)<br><br><span class="hljs-built_in">sum</span>=<span class="hljs-number">0</span><br>t1=[<span class="hljs-number">7</span>, <span class="hljs-number">11</span>, <span class="hljs-number">22</span>]<br>t2=[<span class="hljs-number">34</span>, <span class="hljs-number">37</span>]<br>t3=[<span class="hljs-number">19</span>, <span class="hljs-number">20</span>, <span class="hljs-number">43</span>]<br>t4=[<span class="hljs-number">4</span>, <span class="hljs-number">31</span>]<br>t5=[<span class="hljs-number">33</span>, <span class="hljs-number">45</span>]<br><br><br><span class="hljs-keyword">for</span>  a1 <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):<br>    c[<span class="hljs-number">9</span>]=t1[a1]<br>    <span class="hljs-keyword">for</span> a2 <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>):<br>        c[<span class="hljs-number">10</span>]=t2[a2]<br>        <span class="hljs-keyword">for</span> a3 <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>):<br>            c[<span class="hljs-number">11</span>]=t2[a3]<br>            <span class="hljs-keyword">for</span> a4 <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):<br>                c[<span class="hljs-number">12</span>]=t3[a4]<br>                <span class="hljs-keyword">for</span> a5 <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):<br>                    c[<span class="hljs-number">13</span>]=t3[a5]<br>                    <span class="hljs-keyword">for</span> a6 <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>):<br>                        c[<span class="hljs-number">14</span>]=t2[a6]<br>                        <span class="hljs-keyword">for</span> a7 <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):<br>                            c[<span class="hljs-number">16</span>]=t3[a7]<br>                            <span class="hljs-keyword">for</span> a8 <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>):<br>                                c[<span class="hljs-number">17</span>]=t4[a8]<br>                                <span class="hljs-keyword">for</span> a9 <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):<br>                                    c[<span class="hljs-number">19</span>]=t3[a9]<br>                                    <span class="hljs-keyword">for</span> a10 <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):<br>                                        c[<span class="hljs-number">20</span>]=t1[a10]<br>                                        <span class="hljs-keyword">for</span> a11 <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>):<br>                                            c[<span class="hljs-number">25</span>]=t4[a11]<br>                                            <span class="hljs-keyword">for</span> a12 <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):<br>                                                c[<span class="hljs-number">27</span>]=t3[a12]<br>                                                <span class="hljs-keyword">for</span> a13 <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):<br>                                                    c[<span class="hljs-number">31</span>]=t3[a13]<br>                                                    <span class="hljs-keyword">for</span> a14 <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>):<br>                                                        c[<span class="hljs-number">32</span>]=t2[a14]<br>                                                        <span class="hljs-keyword">for</span> a15 <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>):<br>                                                            c[<span class="hljs-number">34</span>]=t5[a15]<br>                                                            <span class="hljs-keyword">for</span> a16 <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):<br>                                                                c[<span class="hljs-number">37</span>]=t1[a16]<br>                                                                <span class="hljs-keyword">for</span> a17 <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>):<br>                                                                    c[<span class="hljs-number">38</span>]=t2[a17]<br>                                                                    <span class="hljs-keyword">for</span> a18 <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>):<br>                                                                        c[<span class="hljs-number">46</span>]=t5[a18]<br>                                                                        <span class="hljs-keyword">for</span> a19 <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):<br>                                                                            c[<span class="hljs-number">58</span>]=t1[a19]<br>                                                                            <span class="hljs-keyword">for</span> a20 <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):<br>                                                                                c[<span class="hljs-number">61</span>]=t1[a20]<br>                                                                                dododo(c)<br><br><span class="hljs-comment">#NCTF{ADF0E239-D911-3781-7E40-A575A19E5835}</span><br></code></pre></td></tr></tbody></table></figure><p>é¢˜æ„Ÿè§‰éƒ½æŒºå¥½ç©çš„ï¼Œå°±æ˜¯æŠŠz3 banæ‰å¤ªä¸å¤Ÿæ„æ€äº†ï¼Œè‡ªå·±çš„ç®—æ³•èƒ½åŠ›ä¸æ˜¯å¤ªç»™åŠ›ã€‚</p><hr><p><strong>æ€»ç»“:C++æˆ–è€…å†å¤æ‚ä¸€ç‚¹çš„è¯­è¨€è¿˜å¾—æ˜¯åŠ¨è°ƒï¼Œçº¿ç¨‹çš„è°ƒç”¨å…³ç³»è¦æ¢³ç†æ¸…æ™°è¿˜æœ‰å¸¸è§ç®—æ³•ï¼ŒåŒæ—¶å·©å›ºäº†ä¸€ä¸‹è¥¿æ¹–çš„SMCæ€è·¯ã€‚</strong></p><blockquote><p>NCTFè¿˜æ˜¯å·®ä¸€é“Androidå°±èƒ½AKäº†ï¼Œnativeå±‚çš„ä»£ç çœ‹çš„å¤´çš®å‘éº»ï¼Œæœ‰æ—¶é—´è¦åŠæ—¶å¤ç°å’Œåæ€ï¼Œå¦:èˆªå“¥TQQQLLLï¼Œç›´æ¥ç»™ç§’äº†</p></blockquote><p><strong>åŠ ä¸Šå®‰æ´µæ¯ï¼Œä¸Šå‘¨å°æ¯”èµ›è¿˜æ˜¯è›®å¤šçš„ï¼Œèƒ½å­¦åˆ°å¾ˆå¤šä¸œè¥¿ï¼Œä½†è¿˜æ²¡å®Œå…¨å¤ç°ã€‚æœ€è¿‘ä¸´è¿‘è€ƒè¯•å‘¨ï¼Œå®éªŒå’Œè€ƒè¯•æ¯”è¾ƒå¤šï¼Œè¦å»å†²åˆºäº†ï¼Œä¼°è®¡æ˜¯æœ€è¿‘ä¸¤å‘¨ä¸ä¼šå†æ‘¸äº†ã€‚</strong></p><blockquote><p>åˆ«è´ªå¿ƒï¼Œæˆ‘ä»¬ä¸ä¼šä»€ä¹ˆéƒ½æœ‰ï¼Œåˆ«ç°å¿ƒï¼Œæˆ‘ä»¬ä¹Ÿä¸ä¼šä»€ä¹ˆéƒ½æ²¡æœ‰ã€‚è®©æˆ‘ä»¬åƒä¸ªè‹±å‹‡çš„è’™å¤éª‘å£«ä¸€æ ·ï¼Œæ‹¿èµ·æ‰‹ä¸­é”‹åˆ©çš„é©¬åˆ€ï¼Œå»ä¸æ›´å¼ºå¤§çš„æ•Œäººæ‹¼æ€å§ï¼</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>CTF Memory</category>
      
    </categories>
    
    
    <tags>
      
      <tag>RE</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è¥¿æ¹–è®ºå‰‘2021-Re</title>
    <link href="/2021/11/21/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%912021/"/>
    <url>/2021/11/21/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%912021/</url>
    
    <content type="html"><![CDATA[<p><strong>æ„Ÿæ‚Ÿ: æ”¶è·æŒºå¤§çš„ï¼ŒåŒæ—¶æ„è¯†åˆ°è‡ªå·±çš„åšé¢˜æ€è·¯å’Œæ–¹æ³•è¿˜æœ‰æ‰€æ¬ ç¼ºï¼Œè¿˜æ˜¯è¦åšå¥½åº”å¯¹ä½“åŠ›æ´»çš„å‡†å¤‡ã€‚</strong></p><hr><h3 id="1ã€ROR">1ã€ROR</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></div></td><td class="code"><pre><code class="hljs c">  __CheckForDebuggerJustMyCode(&amp;unk_406029);<br>  v6[<span class="hljs-number">0</span>] = <span class="hljs-number">128</span>;<br>  v6[<span class="hljs-number">1</span>] = <span class="hljs-number">64</span>;<br>  v6[<span class="hljs-number">2</span>] = <span class="hljs-number">32</span>;<br>  v6[<span class="hljs-number">3</span>] = <span class="hljs-number">16</span>;<br>  v6[<span class="hljs-number">4</span>] = <span class="hljs-number">8</span>;<br>  v6[<span class="hljs-number">5</span>] = <span class="hljs-number">4</span>;<br>  v6[<span class="hljs-number">6</span>] = <span class="hljs-number">2</span>;<br>  v6[<span class="hljs-number">7</span>] = <span class="hljs-number">1</span>;<br>  <span class="hljs-built_in">memset</span>(input, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(input));<br>  <span class="hljs-built_in">memset</span>(Buf2, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(Buf2));<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Input:"</span>, v4);<br>  <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%40s"</span>, (<span class="hljs-keyword">char</span>)input);<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">strlen</span>(input) != <span class="hljs-number">40</span> )<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">40</span>; i += <span class="hljs-number">8</span> )<br>  {<br>    <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">8</span>; ++j )<br>    {<br>      v5 = ((v6[j] &amp; input[i + <span class="hljs-number">3</span>]) &lt;&lt; (<span class="hljs-number">8</span> - (<span class="hljs-number">3</span> - j) % <span class="hljs-number">8u</span>)) | ((v6[j] &amp; (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)input[i + <span class="hljs-number">3</span>]) &gt;&gt; ((<span class="hljs-number">3</span> - j) % <span class="hljs-number">8u</span>)) | ((v6[j] &amp; input[i + <span class="hljs-number">2</span>]) &lt;&lt; (<span class="hljs-number">8</span> - (<span class="hljs-number">2</span> - j) % <span class="hljs-number">8u</span>)) | ((v6[j] &amp; (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)input[i + <span class="hljs-number">2</span>]) &gt;&gt; ((<span class="hljs-number">2</span> - j) % <span class="hljs-number">8u</span>)) | ((v6[j] &amp; input[i + <span class="hljs-number">1</span>]) &lt;&lt; (<span class="hljs-number">8</span> - (<span class="hljs-number">1</span> - j) % <span class="hljs-number">8u</span>)) | ((v6[j] &amp; (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)input[i + <span class="hljs-number">1</span>]) &gt;&gt; ((<span class="hljs-number">1</span> - j) % <span class="hljs-number">8u</span>)) | ((v6[j] &amp; (<span class="hljs-keyword">unsigned</span> __int8)input[i]) &lt;&lt; (<span class="hljs-number">8</span> - -j % <span class="hljs-number">8u</span>)) | ((v6[j] &amp; (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)input[i]) &gt;&gt; (-j % <span class="hljs-number">8u</span>));<br>      Buf2[j + i] = byte_405000[(<span class="hljs-keyword">unsigned</span> __int8)(((v6[j] &amp; (<span class="hljs-keyword">unsigned</span> __int8)input[i + <span class="hljs-number">7</span>]) &lt;&lt; (<span class="hljs-number">8</span> - (<span class="hljs-number">7</span> - j) % <span class="hljs-number">8u</span>)) | ((v6[j] &amp; (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)input[i + <span class="hljs-number">7</span>]) &gt;&gt; ((<span class="hljs-number">7</span> - j) % <span class="hljs-number">8u</span>)) | ((v6[j] &amp; input[i + <span class="hljs-number">6</span>]) &lt;&lt; (<span class="hljs-number">8</span> - (<span class="hljs-number">6</span> - j) % <span class="hljs-number">8u</span>)) | ((v6[j] &amp; (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)input[i + <span class="hljs-number">6</span>]) &gt;&gt; ((<span class="hljs-number">6</span> - j) % <span class="hljs-number">8u</span>)) | ((v6[j] &amp; input[i + <span class="hljs-number">5</span>]) &lt;&lt; (<span class="hljs-number">8</span> - (<span class="hljs-number">5</span> - j) % <span class="hljs-number">8u</span>)) | ((v6[j] &amp; (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)input[i + <span class="hljs-number">5</span>]) &gt;&gt; ((<span class="hljs-number">5</span> - j) % <span class="hljs-number">8u</span>)) | ((v6[j] &amp; input[i + <span class="hljs-number">4</span>]) &lt;&lt; (<span class="hljs-number">8</span> - (<span class="hljs-number">4</span> - j) % <span class="hljs-number">8u</span>)) | ((v6[j] &amp; (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)input[i + <span class="hljs-number">4</span>]) &gt;&gt; ((<span class="hljs-number">4</span> - j) % <span class="hljs-number">8u</span>)) | v5)];<br>    }<br>  }<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">memcmp</span>(&amp;unk_405100, Buf2, <span class="hljs-number">0x28</span>u) )<br>  {<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Wrong"</span>);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>  }<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Congratulations"</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"flag is DASCTF{your input}"</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}<br></code></pre></td></tr></tbody></table></figure><p>ä¸»è¦å°±æ˜¯å¯¹è¾“å…¥8ä¸ªä¸€ç»„è¿›è¡Œä½è¿ç®—ï¼Œä¹‹åå†è¿›è¡Œè¡¨byte_405000çš„ç´¢å¼•ï¼Œçœ‹åˆ°ç«‹é©¬æƒ³åˆ°z3ï¼Œä¿®æ”¹ä»£ç z3è§£å¯†ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> z3 <span class="hljs-keyword">import</span> *<br>v6=[<span class="hljs-number">128</span>,<span class="hljs-number">64</span>,<span class="hljs-number">32</span>,<span class="hljs-number">16</span>,<span class="hljs-number">8</span>,<span class="hljs-number">4</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>]<br><span class="hljs-built_in">input</span>=[BitVec(<span class="hljs-string">'s%d'</span>%i,<span class="hljs-number">8</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">40</span>)]<br>Buf2=[<span class="hljs-number">0</span>]*<span class="hljs-number">40</span><br>byte_405000=[<span class="hljs-number">0x65</span>, <span class="hljs-number">0x08</span>, <span class="hljs-number">0xF7</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0xBC</span>, <span class="hljs-number">0xC3</span>, <span class="hljs-number">0xCF</span>, <span class="hljs-number">0xB8</span>, <span class="hljs-number">0x83</span>, <span class="hljs-number">0x7B</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0xD5</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0xBD</span>, <span class="hljs-number">0x9F</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0xD4</span>, <span class="hljs-number">0xD7</span>, <span class="hljs-number">0xEB</span>, <span class="hljs-number">0x90</span>, <span class="hljs-number">0x89</span>, <span class="hljs-number">0x5E</span>, <span class="hljs-number">0x54</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0x7D</span>, <span class="hljs-number">0xF4</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0x99</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0xAD</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0x46</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0x2A</span>, <span class="hljs-number">0x9D</span>, <span class="hljs-number">0x7F</span>, <span class="hljs-number">0xD2</span>, <span class="hljs-number">0xE1</span>, <span class="hljs-number">0x21</span>, <span class="hljs-number">0x8B</span>, <span class="hljs-number">0x1D</span>, <span class="hljs-number">0x5A</span>, <span class="hljs-number">0x91</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0x94</span>, <span class="hljs-number">0xF9</span>, <span class="hljs-number">0x0C</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0xCA</span>, <span class="hljs-number">0xE8</span>, <span class="hljs-number">0xCB</span>, <span class="hljs-number">0x5F</span>, <span class="hljs-number">0x19</span>, <span class="hljs-number">0xF6</span>, <span class="hljs-number">0xF0</span>, <span class="hljs-number">0x3C</span>, <span class="hljs-number">0xDE</span>, <span class="hljs-number">0xDA</span>, <span class="hljs-number">0xEA</span>, <span class="hljs-number">0x9C</span>, <span class="hljs-number">0x14</span>, <span class="hljs-number">0x75</span>, <span class="hljs-number">0xA4</span>, <span class="hljs-number">0x0D</span>, <span class="hljs-number">0x25</span>, <span class="hljs-number">0x58</span>, <span class="hljs-number">0xFC</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0x86</span>, <span class="hljs-number">0x05</span>, <span class="hljs-number">0x6B</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0x9A</span>, <span class="hljs-number">0x6D</span>, <span class="hljs-number">0xD1</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x98</span>, <span class="hljs-number">0x68</span>, <span class="hljs-number">0x2D</span>, <span class="hljs-number">0x52</span>, <span class="hljs-number">0x3D</span>, <span class="hljs-number">0xDD</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0xD6</span>, <span class="hljs-number">0xD0</span>, <span class="hljs-number">0xA2</span>, <span class="hljs-number">0xED</span>, <span class="hljs-number">0xA5</span>, <span class="hljs-number">0x3B</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0x3E</span>, <span class="hljs-number">0xF2</span>, <span class="hljs-number">0x22</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0xF3</span>, <span class="hljs-number">0x1A</span>, <span class="hljs-number">0xA8</span>, <span class="hljs-number">0x09</span>, <span class="hljs-number">0xDC</span>, <span class="hljs-number">0x7C</span>, <span class="hljs-number">0x4B</span>, <span class="hljs-number">0x5C</span>, <span class="hljs-number">0x1E</span>, <span class="hljs-number">0xA1</span>, <span class="hljs-number">0xB0</span>, <span class="hljs-number">0x71</span>, <span class="hljs-number">0x04</span>, <span class="hljs-number">0xE2</span>, <span class="hljs-number">0x9B</span>, <span class="hljs-number">0xB7</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0x4E</span>, <span class="hljs-number">0x16</span>, <span class="hljs-number">0x23</span>, <span class="hljs-number">0x82</span>, <span class="hljs-number">0x56</span>, <span class="hljs-number">0xD8</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0xB4</span>, <span class="hljs-number">0x24</span>, <span class="hljs-number">0x7E</span>, <span class="hljs-number">0x87</span>, <span class="hljs-number">0xF8</span>, <span class="hljs-number">0x0A</span>, <span class="hljs-number">0x13</span>, <span class="hljs-number">0xE3</span>, <span class="hljs-number">0xE4</span>, <span class="hljs-number">0xE6</span>, <span class="hljs-number">0x1C</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x2C</span>, <span class="hljs-number">0xB1</span>, <span class="hljs-number">0xEC</span>, <span class="hljs-number">0x93</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0xA9</span>, <span class="hljs-number">0x95</span>, <span class="hljs-number">0xBB</span>, <span class="hljs-number">0xD3</span>, <span class="hljs-number">0x51</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0xE7</span>, <span class="hljs-number">0xC9</span>, <span class="hljs-number">0xCE</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0x72</span>, <span class="hljs-number">0x47</span>, <span class="hljs-number">0x6C</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0x15</span>, <span class="hljs-number">0xDF</span>, <span class="hljs-number">0xD9</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x3F</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0xCD</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x07</span>, <span class="hljs-number">0x73</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0x85</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x8A</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0xAA</span>, <span class="hljs-number">0xAC</span>, <span class="hljs-number">0x2E</span>, <span class="hljs-number">0xA3</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x7A</span>, <span class="hljs-number">0xB5</span>, <span class="hljs-number">0x8E</span>, <span class="hljs-number">0x69</span>, <span class="hljs-number">0x1F</span>, <span class="hljs-number">0x6A</span>, <span class="hljs-number">0x97</span>, <span class="hljs-number">0x55</span>, <span class="hljs-number">0x3A</span>, <span class="hljs-number">0xB2</span>, <span class="hljs-number">0x59</span>, <span class="hljs-number">0xAB</span>, <span class="hljs-number">0xE0</span>, <span class="hljs-number">0x28</span>, <span class="hljs-number">0xC0</span>, <span class="hljs-number">0xB3</span>, <span class="hljs-number">0xBE</span>, <span class="hljs-number">0xCC</span>, <span class="hljs-number">0xC6</span>, <span class="hljs-number">0x2B</span>, <span class="hljs-number">0x5B</span>, <span class="hljs-number">0x92</span>, <span class="hljs-number">0xEE</span>, <span class="hljs-number">0x60</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x84</span>, <span class="hljs-number">0x4D</span>, <span class="hljs-number">0x0F</span>, <span class="hljs-number">0x26</span>, <span class="hljs-number">0x4A</span>, <span class="hljs-number">0x48</span>, <span class="hljs-number">0x0B</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0x5D</span>, <span class="hljs-number">0x6F</span>, <span class="hljs-number">0x4C</span>, <span class="hljs-number">0xB9</span>, <span class="hljs-number">0x81</span>, <span class="hljs-number">0x96</span>, <span class="hljs-number">0x32</span>, <span class="hljs-number">0xFD</span>, <span class="hljs-number">0x40</span>, <span class="hljs-number">0x8D</span>, <span class="hljs-number">0x27</span>, <span class="hljs-number">0xC1</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x4F</span>, <span class="hljs-number">0x79</span>, <span class="hljs-number">0xC8</span>, <span class="hljs-number">0x0E</span>, <span class="hljs-number">0x8C</span>, <span class="hljs-number">0xE5</span>, <span class="hljs-number">0x9E</span>, <span class="hljs-number">0xAE</span>, <span class="hljs-number">0xBF</span>, <span class="hljs-number">0xEF</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0xC5</span>, <span class="hljs-number">0xAF</span>, <span class="hljs-number">0xA0</span>, <span class="hljs-number">0xC2</span>, <span class="hljs-number">0xFA</span>, <span class="hljs-number">0xC7</span>, <span class="hljs-number">0xB6</span>, <span class="hljs-number">0xDB</span>, <span class="hljs-number">0x18</span>, <span class="hljs-number">0xC4</span>, <span class="hljs-number">0xA6</span>, <span class="hljs-number">0xFE</span>, <span class="hljs-number">0xE9</span>, <span class="hljs-number">0xF5</span>, <span class="hljs-number">0x6E</span>, <span class="hljs-number">0x64</span>, <span class="hljs-number">0x2F</span>, <span class="hljs-number">0xF1</span>, <span class="hljs-number">0x1B</span>, <span class="hljs-number">0xFB</span>, <span class="hljs-number">0xBA</span>, <span class="hljs-number">0xA7</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0x8F</span>]<br>enc=[<span class="hljs-number">0x65</span>, <span class="hljs-number">0x55</span>, <span class="hljs-number">0x24</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x9D</span>, <span class="hljs-number">0x71</span>, <span class="hljs-number">0xB8</span>, <span class="hljs-number">0xC8</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0xFB</span>, <span class="hljs-number">0x87</span>, <span class="hljs-number">0x7F</span>, <span class="hljs-number">0x9A</span>, <span class="hljs-number">0x9C</span>, <span class="hljs-number">0xB1</span>, <span class="hljs-number">0xDF</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x8F</span>, <span class="hljs-number">0x9D</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0x8F</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0xF6</span>, <span class="hljs-number">0x8E</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0xDA</span>, <span class="hljs-number">0xB4</span>, <span class="hljs-number">0x8C</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0xFB</span>, <span class="hljs-number">0x99</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x48</span>, <span class="hljs-number">0x6A</span>, <span class="hljs-number">0xCA</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0xE7</span>, <span class="hljs-number">0xA4</span>, <span class="hljs-number">0x79</span>]<br>tmp=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(enc)):<br>    tmp.append(byte_405000.index(enc[i]))<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">40</span>,<span class="hljs-number">8</span>):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">8</span>):<br>        v5 = ((v6[j] &amp; <span class="hljs-built_in">input</span>[i + <span class="hljs-number">3</span>]) &lt;&lt; (<span class="hljs-number">8</span> - (<span class="hljs-number">3</span> - j) % <span class="hljs-number">8</span>)) | ((v6[j] &amp; <span class="hljs-built_in">input</span>[i + <span class="hljs-number">3</span>]) &gt;&gt; ((<span class="hljs-number">3</span> - j) % <span class="hljs-number">8</span>)) | ((v6[j] &amp; <span class="hljs-built_in">input</span>[i + <span class="hljs-number">2</span>]) &lt;&lt; (<span class="hljs-number">8</span> - (<span class="hljs-number">2</span> - j) % <span class="hljs-number">8</span>)) | ((v6[j] &amp; <span class="hljs-built_in">input</span>[i + <span class="hljs-number">2</span>]) &gt;&gt; ((<span class="hljs-number">2</span> - j) % <span class="hljs-number">8</span>)) | ((v6[j] &amp; <span class="hljs-built_in">input</span>[i + <span class="hljs-number">1</span>]) &lt;&lt; (<span class="hljs-number">8</span> - (<span class="hljs-number">1</span> - j) % <span class="hljs-number">8</span>)) | ((v6[j] &amp; <span class="hljs-built_in">input</span>[i + <span class="hljs-number">1</span>]) &gt;&gt; ((<span class="hljs-number">1</span> - j) % <span class="hljs-number">8</span>)) | ((v6[j] &amp; <span class="hljs-built_in">input</span>[i]) &lt;&lt; (<span class="hljs-number">8</span> - -j % <span class="hljs-number">8</span>)) | ((v6[j] &amp; <span class="hljs-built_in">input</span>[i]) &gt;&gt; (-j % <span class="hljs-number">8</span>))<br>        Buf2[j + i]=((((v6[j] &amp; <span class="hljs-built_in">input</span>[i + <span class="hljs-number">7</span>]) &lt;&lt; (<span class="hljs-number">8</span> - (<span class="hljs-number">7</span> - j) % <span class="hljs-number">8</span>)) | ((v6[j] &amp; <span class="hljs-built_in">input</span>[i + <span class="hljs-number">7</span>]) &gt;&gt; ((<span class="hljs-number">7</span> - j) % <span class="hljs-number">8</span>)) | ((v6[j] &amp; <span class="hljs-built_in">input</span>[i + <span class="hljs-number">6</span>]) &lt;&lt; (<span class="hljs-number">8</span> - (<span class="hljs-number">6</span> - j) % <span class="hljs-number">8</span>)) | ((v6[j] &amp; <span class="hljs-built_in">input</span>[i + <span class="hljs-number">6</span>]) &gt;&gt; ((<span class="hljs-number">6</span> - j) % <span class="hljs-number">8</span>)) | ((v6[j] &amp; <span class="hljs-built_in">input</span>[i + <span class="hljs-number">5</span>]) &lt;&lt; (<span class="hljs-number">8</span> - (<span class="hljs-number">5</span> - j) % <span class="hljs-number">8</span>)) | ((v6[j] &amp; <span class="hljs-built_in">input</span>[i + <span class="hljs-number">5</span>]) &gt;&gt; ((<span class="hljs-number">5</span> - j) % <span class="hljs-number">8</span>)) | ((v6[j] &amp; <span class="hljs-built_in">input</span>[i + <span class="hljs-number">4</span>]) &lt;&lt; (<span class="hljs-number">8</span> - (<span class="hljs-number">4</span> - j) % <span class="hljs-number">8</span>)) | ((v6[j] &amp; <span class="hljs-built_in">input</span>[i + <span class="hljs-number">4</span>]) &gt;&gt; ((<span class="hljs-number">4</span> - j) % <span class="hljs-number">8</span>)) | v5))&amp;<span class="hljs-number">0xff</span><br>s=Solver()<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">40</span>):<br>    s.add(Buf2[i]==tmp[i])<br>s.check()<br><span class="hljs-keyword">if</span> s.check():<br>    m=s.model()<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">40</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(m[<span class="hljs-built_in">input</span>[i]].as_long()),end=<span class="hljs-string">''</span>)<br></code></pre></td></tr></tbody></table></figure><p>èµ›åæ•´ç†çš„æ—¶å€™copyä¸€éå°±è¿‡äº†ï¼Œæ¯”èµ›çš„æ—¶å€™å‡ºäº†ç‚¹é—®é¢˜ï¼Œå¡äº†æ®µæ—¶é—´ã€‚</p><p>å¦ä¸€ç§è§£æ³•å°±æ˜¯äº†è§£ç¨‹åºçš„ä½è¿ç®—åœ¨å¹²ä»€ä¹ˆï¼Œv6æ•°ç»„å¯¹åº”çš„8ä½äºŒè¿›åˆ¶æ¯ä¸€ä½,å•æ‹¿ä¸€å°æ®µåˆ†æã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c">i=<span class="hljs-number">0</span><br>j=<span class="hljs-number">0</span>~<span class="hljs-number">8</span><br>v6[<span class="hljs-number">0</span>]=<span class="hljs-number">128</span>-&gt;<span class="hljs-number">0x10000000</span><br>((v6[j] &amp; input[i + <span class="hljs-number">3</span>]) &lt;&lt; (<span class="hljs-number">8</span> - (<span class="hljs-number">3</span> - j) % <span class="hljs-number">8u</span>)) | ((v6[j] &amp; (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)input[i + <span class="hljs-number">3</span>]) &gt;&gt; ((<span class="hljs-number">3</span> - j) % <span class="hljs-number">8u</span>)) | ((v6[j] &amp; input[i + <span class="hljs-number">2</span>]) &lt;&lt; (<span class="hljs-number">8</span> - (<span class="hljs-number">2</span> - j) % <span class="hljs-number">8u</span>)) | ((v6[j] &amp; (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)input[i + <span class="hljs-number">2</span>]) &gt;&gt; ((<span class="hljs-number">2</span> - j) % <span class="hljs-number">8u</span>)) | ((v6[j] &amp; input[i + <span class="hljs-number">1</span>]) &lt;&lt; (<span class="hljs-number">8</span> - (<span class="hljs-number">1</span> - j) % <span class="hljs-number">8u</span>)) | ((v6[j] &amp; (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)input[i + <span class="hljs-number">1</span>]) &gt;&gt; ((<span class="hljs-number">1</span> - j) % <span class="hljs-number">8u</span>)) | ((v6[j] &amp; (<span class="hljs-keyword">unsigned</span> __int8)input[i]) &lt;&lt; (<span class="hljs-number">8</span> - -j % <span class="hljs-number">8u</span>)) | ((v6[j] &amp; (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)input[i]) &gt;&gt; (-j % <span class="hljs-number">8u</span>))<br>    <br><span class="hljs-comment">/*ä¸Šä¸ºchar input[0~3]  åˆ†åˆ«ä¸ä¸Šv6[j]å–å‡ºæœ€é«˜ä½ï¼Œå› ä¸ºç¬¬äºŒæ­¥é™å®š(unsigned __int8)ç±»å‹ï¼Œæ‰€ä»¥åªçœ‹å³ç§»ï¼Œå·¦ç§»éƒ½èˆå»äº†</span><br><span class="hljs-comment">input 0   intput 1  input2  input3</span><br><span class="hljs-comment">é«˜ä½  a0000000  b0000000  c0000000  d0000000</span><br><span class="hljs-comment">input3 å³ç§»3  input2 å³ç§»2  input 1 å³ç§»1 ..</span><br><span class="hljs-comment">å˜æˆ abcd0000</span><br><span class="hljs-comment">ååŠæ®µä¹Ÿç±»ä¼¼ åŠ ä¸Šinput4~7 å‡è®¾7ä¸ºx0000000åˆ™ æœ€åå˜ä¸ºabcd...x</span><br><span class="hljs-comment">ä¹Ÿå°±æ˜¯8ä¸ªä¸€ç»„ å¯¹åº”ä½çš„äºŒè¿›åˆ¶é‡æ–°ç»„åˆæŒ‰ç…§é¡ºåºåšåˆ°å³æ”¾0-7çš„å¯¹åº”ä½</span><br><span class="hljs-comment">é€†è¿‡ç¨‹ï¼Œé€šè¿‡encåœ¨tableä¸­çš„ç´¢å¼•è½¬æ¢ä¸º8ä¸ªäºŒè¿›åˆ¶ï¼Œä¹‹å8ä¸ªä¸€ç»„ï¼Œé‡ç»„å³å¯ã€‚</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></tbody></table></figure><p>exp:</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> z3 <span class="hljs-keyword">import</span> *<br>v6=[<span class="hljs-number">128</span>,<span class="hljs-number">64</span>,<span class="hljs-number">32</span>,<span class="hljs-number">16</span>,<span class="hljs-number">8</span>,<span class="hljs-number">4</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>]<br>Buf2=[<span class="hljs-number">0</span>]*<span class="hljs-number">40</span><br>byte_405000=[<span class="hljs-number">0x65</span>, <span class="hljs-number">0x08</span>, <span class="hljs-number">0xF7</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0xBC</span>, <span class="hljs-number">0xC3</span>, <span class="hljs-number">0xCF</span>, <span class="hljs-number">0xB8</span>, <span class="hljs-number">0x83</span>, <span class="hljs-number">0x7B</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0xD5</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0xBD</span>, <span class="hljs-number">0x9F</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0xD4</span>, <span class="hljs-number">0xD7</span>, <span class="hljs-number">0xEB</span>, <span class="hljs-number">0x90</span>, <span class="hljs-number">0x89</span>, <span class="hljs-number">0x5E</span>, <span class="hljs-number">0x54</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0x7D</span>, <span class="hljs-number">0xF4</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0x99</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0xAD</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0x46</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0x2A</span>, <span class="hljs-number">0x9D</span>, <span class="hljs-number">0x7F</span>, <span class="hljs-number">0xD2</span>, <span class="hljs-number">0xE1</span>, <span class="hljs-number">0x21</span>, <span class="hljs-number">0x8B</span>, <span class="hljs-number">0x1D</span>, <span class="hljs-number">0x5A</span>, <span class="hljs-number">0x91</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0x94</span>, <span class="hljs-number">0xF9</span>, <span class="hljs-number">0x0C</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0xCA</span>, <span class="hljs-number">0xE8</span>, <span class="hljs-number">0xCB</span>, <span class="hljs-number">0x5F</span>, <span class="hljs-number">0x19</span>, <span class="hljs-number">0xF6</span>, <span class="hljs-number">0xF0</span>, <span class="hljs-number">0x3C</span>, <span class="hljs-number">0xDE</span>, <span class="hljs-number">0xDA</span>, <span class="hljs-number">0xEA</span>, <span class="hljs-number">0x9C</span>, <span class="hljs-number">0x14</span>, <span class="hljs-number">0x75</span>, <span class="hljs-number">0xA4</span>, <span class="hljs-number">0x0D</span>, <span class="hljs-number">0x25</span>, <span class="hljs-number">0x58</span>, <span class="hljs-number">0xFC</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0x86</span>, <span class="hljs-number">0x05</span>, <span class="hljs-number">0x6B</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0x9A</span>, <span class="hljs-number">0x6D</span>, <span class="hljs-number">0xD1</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x98</span>, <span class="hljs-number">0x68</span>, <span class="hljs-number">0x2D</span>, <span class="hljs-number">0x52</span>, <span class="hljs-number">0x3D</span>, <span class="hljs-number">0xDD</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0xD6</span>, <span class="hljs-number">0xD0</span>, <span class="hljs-number">0xA2</span>, <span class="hljs-number">0xED</span>, <span class="hljs-number">0xA5</span>, <span class="hljs-number">0x3B</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0x3E</span>, <span class="hljs-number">0xF2</span>, <span class="hljs-number">0x22</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0xF3</span>, <span class="hljs-number">0x1A</span>, <span class="hljs-number">0xA8</span>, <span class="hljs-number">0x09</span>, <span class="hljs-number">0xDC</span>, <span class="hljs-number">0x7C</span>, <span class="hljs-number">0x4B</span>, <span class="hljs-number">0x5C</span>, <span class="hljs-number">0x1E</span>, <span class="hljs-number">0xA1</span>, <span class="hljs-number">0xB0</span>, <span class="hljs-number">0x71</span>, <span class="hljs-number">0x04</span>, <span class="hljs-number">0xE2</span>, <span class="hljs-number">0x9B</span>, <span class="hljs-number">0xB7</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0x4E</span>, <span class="hljs-number">0x16</span>, <span class="hljs-number">0x23</span>, <span class="hljs-number">0x82</span>, <span class="hljs-number">0x56</span>, <span class="hljs-number">0xD8</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0xB4</span>, <span class="hljs-number">0x24</span>, <span class="hljs-number">0x7E</span>, <span class="hljs-number">0x87</span>, <span class="hljs-number">0xF8</span>, <span class="hljs-number">0x0A</span>, <span class="hljs-number">0x13</span>, <span class="hljs-number">0xE3</span>, <span class="hljs-number">0xE4</span>, <span class="hljs-number">0xE6</span>, <span class="hljs-number">0x1C</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x2C</span>, <span class="hljs-number">0xB1</span>, <span class="hljs-number">0xEC</span>, <span class="hljs-number">0x93</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0xA9</span>, <span class="hljs-number">0x95</span>, <span class="hljs-number">0xBB</span>, <span class="hljs-number">0xD3</span>, <span class="hljs-number">0x51</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0xE7</span>, <span class="hljs-number">0xC9</span>, <span class="hljs-number">0xCE</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0x72</span>, <span class="hljs-number">0x47</span>, <span class="hljs-number">0x6C</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0x15</span>, <span class="hljs-number">0xDF</span>, <span class="hljs-number">0xD9</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x3F</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0xCD</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x07</span>, <span class="hljs-number">0x73</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0x85</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x8A</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0xAA</span>, <span class="hljs-number">0xAC</span>, <span class="hljs-number">0x2E</span>, <span class="hljs-number">0xA3</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x7A</span>, <span class="hljs-number">0xB5</span>, <span class="hljs-number">0x8E</span>, <span class="hljs-number">0x69</span>, <span class="hljs-number">0x1F</span>, <span class="hljs-number">0x6A</span>, <span class="hljs-number">0x97</span>, <span class="hljs-number">0x55</span>, <span class="hljs-number">0x3A</span>, <span class="hljs-number">0xB2</span>, <span class="hljs-number">0x59</span>, <span class="hljs-number">0xAB</span>, <span class="hljs-number">0xE0</span>, <span class="hljs-number">0x28</span>, <span class="hljs-number">0xC0</span>, <span class="hljs-number">0xB3</span>, <span class="hljs-number">0xBE</span>, <span class="hljs-number">0xCC</span>, <span class="hljs-number">0xC6</span>, <span class="hljs-number">0x2B</span>, <span class="hljs-number">0x5B</span>, <span class="hljs-number">0x92</span>, <span class="hljs-number">0xEE</span>, <span class="hljs-number">0x60</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x84</span>, <span class="hljs-number">0x4D</span>, <span class="hljs-number">0x0F</span>, <span class="hljs-number">0x26</span>, <span class="hljs-number">0x4A</span>, <span class="hljs-number">0x48</span>, <span class="hljs-number">0x0B</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0x5D</span>, <span class="hljs-number">0x6F</span>, <span class="hljs-number">0x4C</span>, <span class="hljs-number">0xB9</span>, <span class="hljs-number">0x81</span>, <span class="hljs-number">0x96</span>, <span class="hljs-number">0x32</span>, <span class="hljs-number">0xFD</span>, <span class="hljs-number">0x40</span>, <span class="hljs-number">0x8D</span>, <span class="hljs-number">0x27</span>, <span class="hljs-number">0xC1</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x4F</span>, <span class="hljs-number">0x79</span>, <span class="hljs-number">0xC8</span>, <span class="hljs-number">0x0E</span>, <span class="hljs-number">0x8C</span>, <span class="hljs-number">0xE5</span>, <span class="hljs-number">0x9E</span>, <span class="hljs-number">0xAE</span>, <span class="hljs-number">0xBF</span>, <span class="hljs-number">0xEF</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0xC5</span>, <span class="hljs-number">0xAF</span>, <span class="hljs-number">0xA0</span>, <span class="hljs-number">0xC2</span>, <span class="hljs-number">0xFA</span>, <span class="hljs-number">0xC7</span>, <span class="hljs-number">0xB6</span>, <span class="hljs-number">0xDB</span>, <span class="hljs-number">0x18</span>, <span class="hljs-number">0xC4</span>, <span class="hljs-number">0xA6</span>, <span class="hljs-number">0xFE</span>, <span class="hljs-number">0xE9</span>, <span class="hljs-number">0xF5</span>, <span class="hljs-number">0x6E</span>, <span class="hljs-number">0x64</span>, <span class="hljs-number">0x2F</span>, <span class="hljs-number">0xF1</span>, <span class="hljs-number">0x1B</span>, <span class="hljs-number">0xFB</span>, <span class="hljs-number">0xBA</span>, <span class="hljs-number">0xA7</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0x8F</span>]<br>enc=[<span class="hljs-number">0x65</span>, <span class="hljs-number">0x55</span>, <span class="hljs-number">0x24</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x9D</span>, <span class="hljs-number">0x71</span>, <span class="hljs-number">0xB8</span>, <span class="hljs-number">0xC8</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0xFB</span>, <span class="hljs-number">0x87</span>, <span class="hljs-number">0x7F</span>, <span class="hljs-number">0x9A</span>, <span class="hljs-number">0x9C</span>, <span class="hljs-number">0xB1</span>, <span class="hljs-number">0xDF</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x8F</span>, <span class="hljs-number">0x9D</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0x8F</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0xF6</span>, <span class="hljs-number">0x8E</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0xDA</span>, <span class="hljs-number">0xB4</span>, <span class="hljs-number">0x8C</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0xFB</span>, <span class="hljs-number">0x99</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x48</span>, <span class="hljs-number">0x6A</span>, <span class="hljs-number">0xCA</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0xE7</span>, <span class="hljs-number">0xA4</span>, <span class="hljs-number">0x79</span>]<br>tmp=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(enc)):<br>    tmp.append(<span class="hljs-built_in">bin</span>(byte_405000.index(enc[i]))[<span class="hljs-number">2</span>:].zfill(<span class="hljs-number">8</span>))<br><span class="hljs-built_in">print</span>(tmp)<br>m=[<span class="hljs-string">''</span>]*<span class="hljs-number">40</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">40</span>,<span class="hljs-number">8</span>):<br>    <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">8</span>):<span class="hljs-comment">#æ§åˆ¶tmpçš„ç´¢å¼•</span><br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">8</span>):<br>            m[i+j]+=tmp[i+p][j]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> m:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">int</span>(i,<span class="hljs-number">2</span>)),end=<span class="hljs-string">''</span>)<br><span class="hljs-comment">#Q5la5_3KChtem6_HYHk_NlHhNZz73aCZeK05II96</span><br></code></pre></td></tr></tbody></table></figure><p>ä¸Šè¿°ä¸¤ç§æ–¹æ³•éƒ½å¯ä»¥æ±‚é€†ï¼Œä¸è¿‡æ“…é•¿ä½¿ç”¨z3æ¥è§£è¿™é“é¢˜æ˜¯éå¸¸è¿…é€Ÿçš„ï¼Œå‡å°‘äº†ä»£ç åˆ†æé‡ã€‚</p><h3 id="2ã€TacticalArmed">2ã€TacticalArmed</h3><p>èµ›åå¤ç°ï¼Œå­¦åˆ°å¾ˆå¤šä¸œè¥¿ï¼ŒåŸºç¡€è¿˜æ˜¯â‘§é¡¶ï¼Œå°¤å…¶æ˜¯å¯¹æ‰§è¡Œæµç¨‹æœ‰ä¿®æ”¹çš„ä»£ç ã€‚</p><p>winé€†å‘ï¼Œæœ‰Tlscallbackå‡½æ•°ï¼Œå¼€äº†ä¸€ä¸ªè¿›ç¨‹ï¼Œè·Ÿè¿›è¿›ç¨‹å¤„ç†å‡½æ•°ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c">.text:<span class="hljs-number">004010</span>D6 ;   __try { <span class="hljs-comment">// __except at loc_4010F1</span><br>.text:<span class="hljs-number">004010</span>D6                 mov     [ebp+ms_exc.registration.TryLevel], <span class="hljs-number">0</span><br>.text:<span class="hljs-number">004010</span>DD                 <span class="hljs-keyword">int</span>     <span class="hljs-number">2</span>Dh             ; Windows NT - debugging services: eax = type<br>.text:<span class="hljs-number">004010</span>DF                 nop<br>.text:<span class="hljs-number">004010E0</span>                 jmp     <span class="hljs-keyword">short</span> loc_401142<br>.text:<span class="hljs-number">004010E0</span> ;   } <span class="hljs-comment">// starts at 4010D6</span><br></code></pre></td></tr></tbody></table></figure><p>å­˜åœ¨Int 2dåè°ƒè¯•ï¼Œå³æ­£å¸¸è¿è¡Œä¼šå¼•å‘å¼‚å¸¸è€Œæ£€æµ‹åˆ°è°ƒè¯•å™¨åˆ™ç»§ç»­æ‰§è¡Œï¼Œæ‰€ä»¥çœŸæ­£ä»£ç é€»è¾‘åœ¨å¼‚å¸¸å¤„ç†ä¸­ã€‚</p><p>åˆ†æä»£ç çŸ¥æ˜¯å¯¹dword_405000è¿™ä¸ªå†…å­˜ä¸­èµ‹å€¼äº†4ä¸ªintï¼Œä¸€èˆ¬æ˜¯ä¿®æ”¹keyæˆ–æŸä¸ªè§£å¯†éœ€è¦çš„å‚æ•°ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c">dword_405000 -&gt;<span class="hljs-number">7</span>CE45630h  <span class="hljs-number">58334908</span>h  <span class="hljs-number">66398867</span>h  <span class="hljs-number">0</span>C35195B1h<br><span class="hljs-comment">//retn æŒ‡ä»¤</span><br>retn <span class="hljs-number">4</span> -&gt; pop eip  add esp,<span class="hljs-number">4</span><br></code></pre></td></tr></tbody></table></figure><p>ä¹‹åä¸»å‡½æ•°å†…ç”¨åˆ°äº†ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆv21,æ¥è¡¨ç¤ºlpadressçš„å‡½æ•°ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c">  lpAdress = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>u);<br>  VirtualProtect(lpAdress, <span class="hljs-number">0x10</span>u, <span class="hljs-number">0x40</span>u, &amp;flOldProtect);<br>  v21 = (__int64 (__fastcall *)(<span class="hljs-keyword">int</span>, _DWORD))lpAdress;<br><br><span class="hljs-comment">//å‡½æ•°æŒ‡é’ˆ</span><br>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Func</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span></span>;   <span class="hljs-comment">/*å£°æ˜ä¸€ä¸ªå‡½æ•°*/</span><br>    <span class="hljs-keyword">int</span> (*p) (<span class="hljs-keyword">int</span>);  <span class="hljs-comment">/*å®šä¹‰ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆ*/</span><br>    p = Func;          <span class="hljs-comment">/*å°†Funcå‡½æ•°çš„é¦–åœ°å€èµ‹ç»™æŒ‡é’ˆå˜é‡p*/</span><br>p(<span class="hljs-number">1</span>) ç­‰ä»· Func(<span class="hljs-number">1</span>)  <br></code></pre></td></tr></tbody></table></figure><p>æ•´ä½“mainå‡½æ•°å¦‚ä¸‹</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs c">lpAdress = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>u);<br>VirtualProtect(lpAdress, <span class="hljs-number">0x10</span>u, <span class="hljs-number">0x40</span>u, &amp;flOldProtect);<br>v21 = (__int64 (__fastcall *)(<span class="hljs-keyword">int</span>, _DWORD))lpAdress;<br>Src = (<span class="hljs-keyword">char</span> *)&amp;loc_405010;                    <span class="hljs-comment">// æŒ‡å‘ä¸€ä¸ªç¥ç§˜çš„æ•°ä¸² ç±»ä¼¼opcode</span><br>Size = <span class="hljs-number">0</span>;<br>v18 = <span class="hljs-number">0</span>;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">"Input flag here:"</span>, v13);<br><span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%255s"</span>, (<span class="hljs-keyword">char</span>)Str);<br>v17 = <span class="hljs-built_in">strlen</span>(Str) &gt;&gt; <span class="hljs-number">3</span>;                       <span class="hljs-comment">// size_tæ˜¯unsigned int çš„ä¸€ä¸ªå®å®šä¹‰ ä¸»è¦ç”¨æ¥è®¡æ•°</span><br>a3 = <span class="hljs-number">0</span>;<br>v15 = <span class="hljs-number">0</span>;<br>a2 = <span class="hljs-number">0</span>;<br>v12 = v4;<br>HIDWORD(v11) = v3;<br>v5 = __readeflags();<br>v10 = v5;<br><span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )                                   <span class="hljs-comment">// v15å¾ªç¯33æ¬¡ åˆ†æ¸…</span><br>{<br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )                                 <br>  {<br>    <span class="hljs-keyword">while</span> ( Size )<br>    {<br>      <span class="hljs-built_in">memset</span>(lpAdress, <span class="hljs-number">0</span>, <span class="hljs-number">0x10</span>u);             <span class="hljs-comment">// æ¸…0</span><br>      <span class="hljs-built_in">memcpy</span>(lpAdress, Src, Size);            <span class="hljs-comment">// æŠŠsrcå¤„æŒ‡å‘çš„ä»£ç  èµ‹å€¼è¿‡å»</span><br>      dispatch((<span class="hljs-keyword">int</span>)lpAdress, a2, a3);<br>      *((_BYTE *)lpAdress + Size) = <span class="hljs-number">0xC3</span>;     <span class="hljs-comment">// retçš„æœºå™¨ç æ˜¯0xc3</span><br>      __writeeflags(v10);<br>      v6 = v21(v12, HIDWORD(v11));<br>      v12 = v7;<br>      v11 = v6;<br>      v8 = __readeflags();<br>      v10 = v8;<br>      ++a2;<br>      Src += <span class="hljs-number">16</span>;<br>      Size = unk_405220[v18++];               <span class="hljs-comment">// è¯»å–opcodeçš„å¤§å° æ§åˆ¶é‡Œé¢çš„ä»£ç æ‰§è¡Œ</span><br>    }<br>    <span class="hljs-keyword">if</span> ( v15 == <span class="hljs-number">33</span> )<br>      <span class="hljs-keyword">break</span>;<br>    ++v15;<br>    a2 = <span class="hljs-number">0</span>;<br>    Src = (<span class="hljs-keyword">char</span> *)&amp;loc_405010;<br>    Size = unk_405220[<span class="hljs-number">0</span>];                     <span class="hljs-comment">// 6</span><br>    v18 = <span class="hljs-number">1</span>;<br>  }<br>  <span class="hljs-keyword">if</span> ( ++a3 == v17 )                          <span class="hljs-comment">// v17æ˜¯è¾“å…¥é•¿åº¦//8  è¾“å…¥8ä¸ªä¸€ç»„</span><br>    <span class="hljs-keyword">break</span>;<br>  v15 = <span class="hljs-number">0</span>;<br>  Size = <span class="hljs-number">0</span>;<br>}<br><span class="hljs-keyword">if</span> ( <span class="hljs-built_in">memcmp</span>(Str, dword_40532C, <span class="hljs-number">40u</span>) )<br>{<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Wrong"</span>);<br>  <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>}<br><span class="hljs-built_in">puts</span>(<span class="hljs-string">"Congratulations"</span>);<br><span class="hljs-built_in">puts</span>(<span class="hljs-string">"flag is DASCTF{your input}"</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br></code></pre></td></tr></tbody></table></figure><p>ä¸»è¦æ­¥éª¤æ˜¯æ˜¯while(size)é‡Œçš„å¾ªç¯ï¼Œä¸»è¦æ˜¯ä»£ç çš„æ‰§è¡Œã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c">*((_BYTE *)lpAdress + Size) = <span class="hljs-number">0xC3</span>;<br>æ˜¯å¯¹æ¯ä¸ªè¯­å¥æœ«å†™ä¸Šretè¯­å¥ï¼Œç”¨äºè¿”å›ã€‚<br>ä¹‹åé€šè¿‡v21æ¥è°ƒç”¨ï¼Œåœ¨è°ƒç”¨å‰è¿˜æœ‰ä¸€ä¸ªé’ˆå¯¹opcodeçš„smc<br></code></pre></td></tr></tbody></table></figure><p>ç”¨switch caseè¯­å¥æ¥è¿›è¡Œä¸åŒå˜é‡çš„åˆ†å‘ï¼Œæ¯”è¾ƒæ–°é¢–ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> __cdecl <span class="hljs-title">dispatch</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a1, <span class="hljs-keyword">int</span> a2, <span class="hljs-keyword">int</span> a3)</span></span><br><span class="hljs-function"></span>{<br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> v3; <span class="hljs-comment">// [esp+Ch] [ebp-50h]</span><br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> v4; <span class="hljs-comment">// [esp+50h] [ebp-Ch]</span><br>  <span class="hljs-keyword">int</span> i; <span class="hljs-comment">// [esp+58h] [ebp-4h]</span><br><br>  __CheckForDebuggerJustMyCode(&amp;unk_406015);<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; *(_BYTE *)(i + a1); ++i )        <span class="hljs-comment">// ä¸€ç›´æ‰¾opcodeä¸º0çš„åœ°æ–¹åœ</span><br>    ;<br>  v4 = dword_4052A8[a2] % <span class="hljs-number">0x10</span>u;<br>  v3 = (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)dword_4052A8[a2] &gt;&gt; <span class="hljs-number">4</span>;     <span class="hljs-comment">// 16è¿›åˆ¶æ•°çš„é«˜ä½å’Œä½ä½ 16è¿›åˆ¶æ¨¡å¼</span><br>  <span class="hljs-keyword">switch</span> ( v3 )<br>  {<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">1u</span>:<br>      *(_DWORD *)(i + a1) = <span class="hljs-number">4</span> * (v4 + <span class="hljs-number">2</span> * a3) + <span class="hljs-number">0x405648</span>;<span class="hljs-comment">// input a3æ˜¯8ä¸ªä¸€ç»„ ä¾æ¬¡è¶Šè¿‡8ä¸ªå­—èŠ‚</span><br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">2u</span>:<br>      *(_DWORD *)(i + a1) = <span class="hljs-number">4</span> * v4 + <span class="hljs-number">0x405000</span>;  <span class="hljs-comment">// key</span><br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">3u</span>:<br>      *(_DWORD *)(i + a1) = &amp;unk_405748;        <span class="hljs-comment">// sum çœ‹æ±‡ç¼–å¾—å‡º </span><br>      <span class="hljs-keyword">break</span>;<br>  }<br>}<br></code></pre></td></tr></tbody></table></figure><p>caseè¯­å¥çš„å·¦ä¾§æ˜¯ä¸€ä¸ªintçš„æŒ‡é’ˆï¼Œæ‰€ä»¥å³ä¾§æ˜¯ä¸€ä¸ªåœ°å€ï¼Œå¯ä»¥è·³è½¬åˆ°0x405648å’Œ0x405000ï¼Œå‘ç°ä¸€ä¸ªæ˜¯è¾“å…¥çš„é¦–åœ°å€ï¼Œä¸€ä¸ªè¿™æ˜¯åœ¨Tlscallbackä¸­è¢«ä¿®æ”¹è¿‡çš„intæ•°æ®ç»„çš„åœ°å€ï¼Œè¿˜æœ‰ä¸€ä¸ª&amp;unk_405748ï¼Œæ²¡æœ‰å…¶ä»–çš„äº¤å‰å¼•ç”¨æ‰€ä»¥åˆå§‹é»˜è®¤ä¸º0ï¼Œ(å…¨å±€å˜é‡)ã€‚</p><p>è€Œswitch å’Œ caseä¸­ç”¨åˆ°çš„ç´¢å¼•åœ¨dword_4052A8è¿™ä¸ªæ•°ç»„ä¸­ï¼Œ16è¿›åˆ¶é«˜ä½ä¸ºcaseç´¢å¼•ï¼Œä½ä½ä¸ºå¯»å€çš„ä¸‹æ ‡ã€‚</p><p><strong>ç»¼ä¸Šï¼Œæµç¨‹å°±æ˜¯æŠŠsrcå¤„çš„ä»£ç ä¾æ¬¡cpyåˆ°lpadressä¸­ï¼Œé€šè¿‡dispatchæ¥ä¿®æ”¹æ“ä½œæ•°çš„å€¼(æ“ä½œæ•°ä¹Ÿæ˜¯å†™å…¥æœºå™¨ç ä¸­çš„)ï¼Œä¹‹åä¾æ¬¡æ‰§è¡Œã€‚è¿™ç‰‡ä»£ç é€šè¿‡v15æ§åˆ¶ä¸€å…±æ‰§è¡Œ33æ¬¡ï¼ŒåŒæ—¶æ ¹æ®è¾“å…¥è¿›è¡Œ8ä¸ªä¸€ç»„åˆ†ç»„å†å¾ªç¯ä¸Šè¿°æ“ä½œã€‚</strong></p><p>Src = (char *)&amp;loc_405010;    srcæ¯æ¬¡+16æ‰§è¡Œ</p><p><img src="https://res.cloudinary.com/lu1u/image/upload/v1637546895/blog_img/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91/x_wxkqn4.png" alt=""></p><p>movæ“ä½œåé¢éƒ½æ˜¯00ï¼Œæ‰€ä»¥éœ€è¦dispatchæ¥èµ‹å€¼ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-number">8B</span> <span class="hljs-number">0</span>D <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>                 mov     ecx, large ds:<span class="hljs-number">0</span><br><span class="hljs-number">81</span> E9 D2 <span class="hljs-number">96</span> <span class="hljs-number">5</span>A <span class="hljs-number">7</span>E                 sub     ecx, <span class="hljs-number">7E5</span>A96D2h  <br><span class="hljs-number">89</span> <span class="hljs-number">0</span>D <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>                 mov     large ds:<span class="hljs-number">0</span>, ecx<br><span class="hljs-number">8B</span> <span class="hljs-number">15</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>                 mov     edx, large ds:<span class="hljs-number">0</span><br>C1 EA <span class="hljs-number">05</span>                          shr     edx, <span class="hljs-number">5</span><br>A1 <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>                    mov     eax, large ds:<span class="hljs-number">0</span><br><span class="hljs-number">03</span> C2                             add     eax, edx<br><span class="hljs-number">8B</span> <span class="hljs-number">0</span>D <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>                 mov     ecx, large ds:<span class="hljs-number">0</span><br><span class="hljs-number">03</span> <span class="hljs-number">0</span>D <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>                 add     ecx, large ds:<span class="hljs-number">0</span><br><span class="hljs-number">33</span> C1                             <span class="hljs-keyword">xor</span>     eax, ecx<br><span class="hljs-number">8B</span> <span class="hljs-number">15</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>                 mov     edx, large ds:<span class="hljs-number">0</span><br>C1 E2 <span class="hljs-number">04</span>                          shl     edx, <span class="hljs-number">4</span><br><span class="hljs-number">8B</span> <span class="hljs-number">0</span>D <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>                 mov     ecx, large ds:<span class="hljs-number">0</span><br><span class="hljs-number">03</span> CA                             add     ecx, edx<br><span class="hljs-number">33</span> C1                             <span class="hljs-keyword">xor</span>     eax, ecx<br><span class="hljs-number">8B</span> <span class="hljs-number">15</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>                 mov     edx, large ds:<span class="hljs-number">0</span><br><span class="hljs-number">03</span> D0                             add     edx, eax<br><span class="hljs-number">89</span> <span class="hljs-number">15</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>                 mov     large ds:<span class="hljs-number">0</span>, edx<br>A1 <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>                    mov     eax, large ds:<span class="hljs-number">0</span><br>C1 E8 <span class="hljs-number">05</span>                          shr     eax, <span class="hljs-number">5</span>    <br><span class="hljs-number">8B</span> <span class="hljs-number">0</span>D <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>                 mov     ecx, large ds:<span class="hljs-number">0</span>  <br><span class="hljs-number">03</span> C8                             add     ecx, eax<br><span class="hljs-number">8B</span> <span class="hljs-number">15</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>                 mov     edx, large ds:<span class="hljs-number">0</span><br><span class="hljs-number">03</span> <span class="hljs-number">15</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>                 add     edx, large ds:<span class="hljs-number">0</span>   <span class="hljs-number">33</span> CA                             <span class="hljs-keyword">xor</span>     ecx, edx<br>A1 <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>                    mov     eax, large ds:<span class="hljs-number">0</span><br>C1 E0 <span class="hljs-number">04</span>                          shl     eax, <span class="hljs-number">4</span><br><span class="hljs-number">8B</span> <span class="hljs-number">15</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>                 mov     edx, large ds:<span class="hljs-number">0</span><br><span class="hljs-number">03</span> D0                             add     edx, eax<br><span class="hljs-number">33</span> CA                             <span class="hljs-keyword">xor</span>     ecx, edx<br>A1 <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>                    mov     eax, large ds:<span class="hljs-number">0</span><br><span class="hljs-number">03</span> C1                             add     eax, ecx<br>A3 <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>                    mov     large ds:<span class="hljs-number">0</span>, eax<br><br></code></pre></td></tr></tbody></table></figure><p>è„šæœ¬å¯¹4025A8æ•°ç»„å¤„ç†ï¼Œæ‹¿åˆ°ä¿®æ”¹æ“ä½œæ•°çš„æµç¨‹ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; *(_BYTE *)(i + a1); ++i )ï¼›        <span class="hljs-comment">// ä¸€ç›´æ‰¾opcodeä¸º0çš„åœ°æ–¹åœ</span><br><br><span class="hljs-number">3</span> <span class="hljs-number">0</span> <span class="hljs-number">3</span> <span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">2</span> <span class="hljs-number">0</span> <span class="hljs-number">3</span> <span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">2</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">2</span> <span class="hljs-number">0</span> <span class="hljs-number">3</span> <span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">2</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">0</span> <br><span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">3</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">2</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">0</span> <br><span class="hljs-comment">//ä¸¾ä¾‹</span><br> <span class="hljs-number">3</span> <span class="hljs-number">0</span> -&gt; <span class="hljs-keyword">switch</span>(<span class="hljs-number">3</span>) ä¹Ÿå°±æ˜¯ æŠŠ<span class="hljs-number">8</span>D <span class="hljs-number">0</span>D <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> å<span class="hljs-number">4</span>ä¸ªæ”¹æˆunk_405748çš„åœ°å€å¹¶å–å†…å®¹èµ‹å€¼ç»™ecx<br> <span class="hljs-number">0</span> <span class="hljs-number">0</span> æ— æ“åš<br> <span class="hljs-number">1</span> <span class="hljs-number">1</span> æ˜¯å–å‡ºinput[<span class="hljs-number">1</span>] å³è¾¹æ˜¯v4=<span class="hljs-number">1</span>   <span class="hljs-number">4</span> * (v4 + <span class="hljs-number">2</span> * a3) + <span class="hljs-number">0x405648</span><br> <span class="hljs-number">2</span> <span class="hljs-number">1</span> æ˜¯å–å‡ºkey[<span class="hljs-number">1</span>] <span class="hljs-comment">//å¤§è‡´åˆ†æåç¡®å®š  </span><br> ...ä¾æ¬¡è¡¥å…¨æ±‡ç¼–å¹¶ç¿»è¯‘<br></code></pre></td></tr></tbody></table></figure><p>å¦‚ä¸‹:</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs c">mov ecx,&amp;unk_405748<br><br>sum=<span class="hljs-number">0</span>;<br><br>sub     ecx, <span class="hljs-number">7E5</span>A96D2h<br>mov &amp;unk_405748,ecx<br><br>sum-=<span class="hljs-number">0x7E5A96D2</span><br><br>mov  edx,input[<span class="hljs-number">1</span>]<br>shr edx,<span class="hljs-number">5</span><br><br>mov eax,key[<span class="hljs-number">1</span>]<br><br>add eax,edx <span class="hljs-comment">//2 1  0 0</span><br><br>mov ecx,sum<br>add ecx,input[<span class="hljs-number">1</span>]<br><br><span class="hljs-keyword">xor</span> eax,ecx   <span class="hljs-comment">//(input[1]+sum)^(input[1]&gt;&gt;5 + key[1])</span><br><br>mov edx, input[<span class="hljs-number">1</span>]<br>shl edx,<span class="hljs-number">4</span><br>mov ecx,key[<span class="hljs-number">0</span>]<br>add ecx,edx<br><span class="hljs-keyword">xor</span> eax,ecx<br><span class="hljs-comment">// (input[1]&lt;&lt;4 + key[0])^(input[1]+sum)^(input[1]&gt;&gt;5 + key[1])</span><br><br>mov edx ,input[<span class="hljs-number">0</span>]<br>add edx,eax<br><br>mov edx,input[<span class="hljs-number">0</span>] <br><br><span class="hljs-comment">//ä»¥ä¸Šå®ç°çš„å°±æ˜¯ v0+=(v1&lt;&lt;4 + k0)^(v1 + sum)(v1 &gt;&gt;5 + k1)</span><br>.....<br><br><span class="hljs-comment">//ä¸è¿‡æ±‡ç¼–ä¸­æ²¡æœ‰ mov  xxx,0 å¹¶ä¸” å¯¹ sum é‚£è¾¹åœ°å€å†…å®¹unk_405748 ä¹Ÿæ²¡æœ‰åˆ«çš„äº¤å‰å¼•ç”¨  ä¹Ÿå°±æ˜¯æ¯ç»„</span><br></code></pre></td></tr></tbody></table></figure><p>åˆ†æåˆ°ä¸€åŠå°±èƒ½æ¨å‡ºæ˜¯TeaåŠ å¯†ï¼Œè½®æ•°ä¸º33 ï¼Œdefaultä¸º0x7E5A96D2ï¼Œæ—¢ç„¶åˆ†æå‡º&amp;unk_405748ä¸ºsumï¼Œå¹¶ä¸”å¯¹ä»–æ²¡æœ‰åˆ«çš„å¼•ç”¨ï¼Œæ‰€ä»¥å†å¯¹å¯†æ–‡å¤šæ¬¡åŠ å¯†æ—¶sumæ˜¯åœ¨ä¸Šä¸€è½®åŸºç¡€ä¸Šä½¿ç”¨çš„ã€‚</p><p>è§£å¯†è„šæœ¬:</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;iostream&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">tea_decode</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>* s, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>* key,<span class="hljs-keyword">int</span> count)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{<br><span class="hljs-keyword">int</span> a = <span class="hljs-number">0xE98651DC67185A11</span>;<br><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> enc[] = { <span class="hljs-number">0x422F1DED</span>,<span class="hljs-number">0x1485E472</span>,<span class="hljs-number">0x35578D5</span>,<span class="hljs-number">0x0BF6B80A2</span>,<span class="hljs-number">0x97D77245</span>,<span class="hljs-number">0x2DAE75D1</span>,<span class="hljs-number">0x665FA963</span>,<span class="hljs-number">0x292E6D74</span>,<span class="hljs-number">0x9795FCC1</span>,<span class="hljs-number">0x0BB5C8E9</span>};<br><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> key[<span class="hljs-number">4</span>] = { <span class="hljs-number">0x7CE45630</span>,<span class="hljs-number">0x58334908</span>,<span class="hljs-number">0x66398867</span>,<span class="hljs-number">0x0C35195B1</span> };<br><span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">10</span>;i+=<span class="hljs-number">2</span>)<br>tea_decode(enc+i, key,i/<span class="hljs-number">2</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">tea_decode</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>* s, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>* key,<span class="hljs-keyword">int</span> count)</span> </span>{<br><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> v0 = s[<span class="hljs-number">0</span>];<br><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> v1 = s[<span class="hljs-number">1</span>];<br><span class="hljs-keyword">uint32_t</span> sum = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> defalt = <span class="hljs-number">0x7E5A96D2</span>;<br><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> k0 = key[<span class="hljs-number">0</span>], k1 = key[<span class="hljs-number">1</span>], k2 = key[<span class="hljs-number">2</span>], k3 = key[<span class="hljs-number">3</span>];<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; (<span class="hljs-number">33</span>*count+<span class="hljs-number">33</span>); i++)<span class="hljs-comment">// sumçŠ¶æ€ä¿å­˜åˆ°ä¸‹ä¸€ç»„</span><br>sum -= defalt;<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">33</span>; i++) {  <br>v1 -= ((v0 &lt;&lt; <span class="hljs-number">4</span>) + k2) ^ (v0 + sum) ^ ((v0 &gt;&gt; <span class="hljs-number">5</span>) + k3);<br>v0 -= ((v1 &lt;&lt; <span class="hljs-number">4</span>) + k0) ^ (v1 + sum) ^ ((v1 &gt;&gt; <span class="hljs-number">5</span>) + k1);<br>sum += defalt;<br>}<br>s[<span class="hljs-number">0</span>] = v0;<br>s[<span class="hljs-number">1</span>] = v1;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d,%d,"</span>, v0,v1);<br>}<br><span class="hljs-comment">/*</span><br><span class="hljs-comment">a=[826566507,843212655,845236089,1097428850,1198086245,1902206776,1132088430,1181900618,1917866824,1261778286]</span><br><span class="hljs-comment">for i in a:</span><br><span class="hljs-comment">    print(int.to_bytes(i,4,'little').decode(),end='')</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></tbody></table></figure><h3 id="3ã€è™šå‡çš„ç²‰ä¸">3ã€è™šå‡çš„ç²‰ä¸</h3><p>dosç•Œé¢çš„ä»£ç åŠ¨ç”»ï¼Œæœ‰ç‚¹éœ‡æ’¼ï¼Œä¸è¿‡é¢˜ç›®æ²¡è®¾è®¡åˆ°ä»€ä¹ˆç®—æ³•ï¼Œä¸»è¦è¿˜æ˜¯è¯»æµç¨‹ã€‚</p><p>é¦–å…ˆå°±æ˜¯æ‰¾åˆ°3ä¸ªkeyï¼ŒæŸ¥çœ‹stringsçª—å£ï¼Œå‘ç°ç¬¬ä¸€å­—ç¬¦ä¸²å¾ˆå¯ç–‘,å¯¹å…¶äº¤å‰å¼•ç”¨å‘ç°äº†ä¸€ä¸ªæœªè¢«è°ƒç”¨çš„å‡½æ•°ï¼Œéœ€è¦é‡æ–°å®šä¹‰ä¸€ä¸‹ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//#j#M_OEE!jmhih,=555"xtx</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">sub_401379</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>{<br>  <span class="hljs-keyword">char</span> Buffer[<span class="hljs-number">100</span>]; <span class="hljs-comment">// [esp+16h] [ebp-92h] BYREF</span><br>  <span class="hljs-keyword">char</span> FileName[<span class="hljs-number">30</span>]; <span class="hljs-comment">// [esp+7Ah] [ebp-2Eh] BYREF</span><br>  FILE *Stream; <span class="hljs-comment">// [esp+98h] [ebp-10h]</span><br>  <span class="hljs-keyword">int</span> i; <span class="hljs-comment">// [esp+9Ch] [ebp-Ch]</span><br><br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">23</span>; ++i )<br>    FileName[i] = aJMOeeJmhih555X[i] ^ <span class="hljs-number">0xC</span>;<br>  Stream = fopen(FileName, <span class="hljs-string">"r"</span>);<br>  fread(Buffer, <span class="hljs-number">0x57</span>u, <span class="hljs-number">1u</span>, Stream);<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%s\n"</span>, Buffer);<br>}    <br></code></pre></td></tr></tbody></table></figure><p>æ‹‰å‡ºå»å¼‚æˆ–ä¸€ä¸‹ï¼Œæ˜¯åœ¨è¯»<strong>P./f/ASCII-faded 1999P.txt</strong>è¿™ä¸ªæ–‡ä»¶ï¼Œæ‰“å¼€æŸ¥çœ‹ï¼Œå‘ç°keyã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">K3y1: (<span class="hljs-built_in">hex</span>(<span class="hljs-built_in">ord</span>(<span class="hljs-string">'A'</span>)) + <span class="hljs-built_in">hex</span>(<span class="hljs-built_in">ord</span>(<span class="hljs-string">'W'</span>))).replace(<span class="hljs-string">"0x"</span>, <span class="hljs-string">""</span>)<br>K3y2: <span class="hljs-built_in">ord</span>(<span class="hljs-string">'F'</span>) + <span class="hljs-built_in">ord</span>(<span class="hljs-string">'a'</span>) + <span class="hljs-built_in">ord</span>(<span class="hljs-string">'d'</span>) + <span class="hljs-built_in">ord</span>(<span class="hljs-string">'e'</span>) + <span class="hljs-built_in">ord</span>(<span class="hljs-string">'d'</span>) + <span class="hljs-built_in">ord</span>(<span class="hljs-string">'i'</span>) + <span class="hljs-built_in">ord</span>(<span class="hljs-string">'s'</span>) + <span class="hljs-built_in">ord</span>(<span class="hljs-string">'b'</span>) + <span class="hljs-built_in">ord</span>(<span class="hljs-string">'e'</span>) + <span class="hljs-built_in">ord</span>(<span class="hljs-string">'s'</span>) + <span class="hljs-built_in">ord</span>(<span class="hljs-string">'t'</span>)<br><span class="hljs-comment">#key3æ˜¯æ–‡ä»¶è¯»å–çš„å­—èŠ‚å¤§å°ï¼Œæ ¹æ®ifåˆ¤æ–­çŸ¥æ˜¯40</span><br><span class="hljs-keyword">if</span> ( Buffer[<span class="hljs-number">0</span>] != <span class="hljs-string">'U'</span> || Buffer[<span class="hljs-number">39</span>] != <span class="hljs-string">'S'</span> )<br></code></pre></td></tr></tbody></table></figure><p>ä¹‹åå®ƒé€šè¿‡ä¸Šè¿°çš„keyè®¡ç®—äº†ä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼Œä¹‹åä»ä¸­è¯»å–å†…å®¹ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-string">"UzNDcmU3X0szeSUyMCUzRCUyMEFsNE5fd0FsSzNS"</span><br>base64 -&gt; urlè§£ç  -&gt; S3Cre7_K3y = Al4N_wAlK3R<br></code></pre></td></tr></tbody></table></figure><p>ä¹‹åè§‚å¯Ÿä¸€ä¸ªç”¨åˆ°keyçš„checkç»“æœçš„å¤„ç†ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">if</span> ( v24 == <span class="hljs-number">1</span> )<br> {<br>   v25 = <span class="hljs-number">5317</span>;<br>   Stream = fopen(<span class="hljs-string">"./f/ASCII-faded 5315.txt"</span>, <span class="hljs-string">"rb"</span>);<br>   <span class="hljs-keyword">if</span> ( !Stream )<br>   {<br>     <span class="hljs-built_in">printf</span>(<span class="hljs-string">"ERROR!\n"</span>);<br>     <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>   }<br>   fread(v6, <span class="hljs-number">0x4EDE</span>u, <span class="hljs-number">1u</span>, Stream);<br>   fclose(Stream);<br>   v22 = <span class="hljs-number">0</span>;<br>   <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">0x84E</span>; ++i )<br>   {<br>     <span class="hljs-keyword">if</span> ( v22 &gt; <span class="hljs-number">10</span> )<br>       v22 = <span class="hljs-number">0</span>;<br>     v6[i] ^= key[v22++];<br>   }<br>   Stream = fopen(<span class="hljs-string">"./f/ASCII-faded 5315.txt"</span>, <span class="hljs-string">"w"</span>);<br>   fwrite(v6, <span class="hljs-number">0x84F</span>u, <span class="hljs-number">1u</span>, Stream);<br>   fclose(Stream);<br> }<br></code></pre></td></tr></tbody></table></figure><p>å¯¹5317è¿›è¡Œå¼‚æˆ–ä¹‹åå†å†™å…¥ï¼Œå†å¼‚æˆ–ä¸€æ¬¡è§‚å¯Ÿå†…å®¹,åé¢å°±æ²¡ä»€ä¹ˆå†…å®¹äº†ï¼Œå°±æ˜¯æ¥ç€å¥ä¹æ¥ç€èˆäº†ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">key=<span class="hljs-string">'Al4N_wAlK3R'</span><br>f=<span class="hljs-built_in">open</span>(<span class="hljs-string">'ASCII-faded 5315.txt'</span>,<span class="hljs-string">'r+'</span>)<br>s=f.read()<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(s)):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(s[i])^<span class="hljs-built_in">ord</span>(key[i%<span class="hljs-built_in">len</span>(key)])),end=<span class="hljs-string">''</span>)<br><br></code></pre></td></tr></tbody></table></figure><p>è¾“å…¥keyè·‘èµ·æ¥è¿˜æ˜¯æŒºä¸é”™çš„ï¼Œæ‘˜æ‰çœ¼é•œ.jpgã€‚</p><p><img src="https://res.cloudinary.com/lu1u/image/upload/v1637550797/blog_img/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91/1_dhb3xj.png" alt=""></p><p>A_TrUe_AW_f4ns</p><p>ä¸è¿‡è¿™é¢˜ï¼Œé™æ€çš„è¯å°±æœ€åä¸€ä¸ªkeyæœ‰ç”¨ï¼Œè¿˜æ˜¯åœ¨æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”Uå’ŒSå·²çŸ¥ï¼Œç›´æ¥æ–‡ä»¶æœç´¢ï¼Œä¹Ÿèƒ½æ‹¿åˆ°keyï¼Œç„¶åç›´æ¥å¼‚æˆ–å°±å¯ä»¥äº†ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">5317</span>):<br>    f=<span class="hljs-built_in">open</span>(<span class="hljs-string">'ASCII-faded %s.txt'</span>%<span class="hljs-built_in">str</span>(i).zfill(<span class="hljs-number">4</span>),<span class="hljs-string">'r+'</span>)<br>    s=f.read()<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">'U'</span><span class="hljs-keyword">in</span> s <span class="hljs-keyword">and</span> <span class="hljs-string">'S'</span> <span class="hljs-keyword">in</span> s:<br>        <span class="hljs-built_in">print</span>(i)<br>    <span class="hljs-keyword">else</span>:<br>        f.close()<br>        <span class="hljs-keyword">continue</span><br><span class="hljs-string">"""</span><br><span class="hljs-string">4157 -&gt;keyçš„æ–‡ä»¶</span><br><span class="hljs-string">5315</span><br><span class="hljs-string">"""</span><br></code></pre></td></tr></tbody></table></figure><hr><p><strong>æ¯”èµ›æ—¶å€™æŒºéº»çš„ï¼Œæ¯”èµ›å¿«è¦æˆªæ­¢æ‰æœ‰ç‚¹æ„Ÿè§‰ï¼Œè¿˜æœ‰ä¸€ä¸ªç¡¬ä»¶æè¿°è¯­è¨€æœ‰å¾…å¤ç°ï¼Œè®¡ç»„å®éªŒè¯¾ç”¨çš„verilogç¥ä¼¼ï¼Œå…³é”®æ˜¯ä¸ä¼šå•Š! äººä¸è¡Œåˆ«æ€ªè·¯ä¸å¹³ï¼Œè¿˜å¾—è¡¥ï¼ã€‚</strong></p>]]></content>
    
    
    <categories>
      
      <category>CTF Memory</category>
      
    </categories>
    
    
    <tags>
      
      <tag>RE</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CUMT-REä¸“é¡¹</title>
    <link href="/2021/11/11/CUMT-RE/"/>
    <url>/2021/11/11/CUMT-RE/</url>
    
    <content type="html"><![CDATA[<h1>CUMT-2021REä¸“é¡¹èµ›</h1><h3 id="1ã€ç­¾åˆ°">1ã€ç­¾åˆ°</h3><p><strong>å¾ªç¯å·¦ç§»</strong>ï¼Œé€†åºå³å¯</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><pre><code class="hljs c">*((_BYTE *)Buf2 + v3) = __ROL1__(*((_BYTE *)Buf2 + v3), <span class="hljs-number">1</span>);<br>++v3;<br></code></pre></td></tr></tbody></table></figure><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br>Buf1=[<span class="hljs-number">0</span>]*<span class="hljs-number">12</span><br>Buf1[<span class="hljs-number">0</span>] = <span class="hljs-number">0xE8DAEAC6</span>;<br>Buf1[<span class="hljs-number">1</span>] = <span class="hljs-number">0xF6CCE8C6</span>;<br>Buf1[<span class="hljs-number">2</span>] = <span class="hljs-number">0xCA9680DA</span>;<br>Buf1[<span class="hljs-number">3</span>] = <span class="hljs-number">0xECCAA4BE</span>;<br>Buf1[<span class="hljs-number">4</span>] = <span class="hljs-number">0x66E6A4CA</span>;<br>Buf1[<span class="hljs-number">5</span>] = <span class="hljs-number">0x72DCCABE</span>;<br>Buf1[<span class="hljs-number">6</span>] = <span class="hljs-number">0x8ACA9C62</span>;<br>Buf1[<span class="hljs-number">7</span>] = <span class="hljs-number">0xCEDC62A4</span>;<br>Buf1[<span class="hljs-number">8</span>] = <span class="hljs-number">0x66A48EBE</span>;<br>Buf1[<span class="hljs-number">9</span>] = <span class="hljs-number">0x80BE6EC2</span>;<br>Buf1[<span class="hljs-number">10</span>] = <span class="hljs-number">0xDC6282CE</span>;<br>Buf1[<span class="hljs-number">11</span>] = <span class="hljs-number">0xFA</span>;<br><span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(Buf1)):<br>    a=<span class="hljs-built_in">int</span>.to_bytes(Buf1[j],<span class="hljs-number">4</span>,<span class="hljs-string">'little'</span>)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> a:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>((i&gt;&gt;<span class="hljs-number">1</span>)|((i&amp;<span class="hljs-number">1</span>)&lt;&lt;<span class="hljs-number">7</span>)),end=<span class="hljs-string">''</span>)<br><br></code></pre></td></tr></tbody></table></figure><h3 id="2ã€æ¥è‡ªå­—èŠ‚ç çš„é¼“åŠ±">2ã€æ¥è‡ªå­—èŠ‚ç çš„é¼“åŠ±</h3><p><strong>pythonå­—èŠ‚ç </strong>ï¼Œæ¯”è¾ƒçŸ­ï¼Œå¯¹ç…§å®˜æ–¹æ–‡æ¡£å¾ˆå®¹æ˜“ä¾¿èƒ½ç¿»è¯‘å‡ºæºç ã€‚</p><p><a href="https://docs.python.org/3/library/dis.html">dis â€” Disassembler for Python bytecode â€” Python 3.10.0 documentation</a></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br>n=[-<span class="hljs-number">83</span>,-<span class="hljs-number">96</span>,-<span class="hljs-number">78</span>,-<span class="hljs-number">21</span>,-<span class="hljs-number">3</span>,-<span class="hljs-number">17</span>,<span class="hljs-number">58</span>,<span class="hljs-number">31</span>,<span class="hljs-number">58</span>]<br><span class="hljs-comment">#ff=input</span><br>c=<span class="hljs-string">''</span><br>f=<span class="hljs-built_in">open</span>(<span class="hljs-string">'1'</span>,<span class="hljs-string">'r'</span>)<br>s=f.read()<br>f.close()<br>f=<span class="hljs-built_in">open</span>(<span class="hljs-string">'2'</span>,<span class="hljs-string">'rb'</span>)<br>b=f.read(<span class="hljs-number">9</span>)<br>f.close()<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(s)):<br>    tmp=<span class="hljs-built_in">ord</span>(s[i])^b[i]<br>    tmp=tmp+n[i]<br>    c+=<span class="hljs-built_in">chr</span>(tmp)<br><span class="hljs-keyword">if</span> c==ff:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">'Right! Please add cumtctf{}'</span>)<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">'try again'</span>)<br></code></pre></td></tr></tbody></table></figure><p>ffæ˜¯è¾“å…¥ï¼Œåªåœ¨æœ€åç”¨åˆ°ï¼Œæ•…ç¿»è¯‘å‡ºçš„å­—èŠ‚ç å‰éƒ¨åˆ†ä¾¿æ˜¯flagçš„ç”Ÿæˆä»£ç ã€‚</p><h3 id="3ã€my-cloth">3ã€my cloth</h3><p><strong>ç»å…¸upxå£³ï¼ŒååŠ ä¸‰æ®µé­”æ”¹defaultå’Œè½®æ•°çš„TeaåŠ å¯†ã€‚</strong></p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs c">  v23[<span class="hljs-number">0</span>] = <span class="hljs-number">222</span>;<br>  v23[<span class="hljs-number">1</span>] = <span class="hljs-number">173</span>;<br>  v23[<span class="hljs-number">2</span>] = <span class="hljs-number">190</span>;<br>  v23[<span class="hljs-number">3</span>] = <span class="hljs-number">239</span>;<br>  <br> v5 = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">3</span>; ++i )<br>    v5 = (v5 &lt;&lt; <span class="hljs-number">8</span>) + (<span class="hljs-keyword">unsigned</span> __int8)v24[i];<br>  v7 = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">4</span>; j &lt;= <span class="hljs-number">7</span>; ++j )<br>    v7 = (v7 &lt;&lt; <span class="hljs-number">8</span>) + (<span class="hljs-keyword">unsigned</span> __int8)v24[j]; <span class="hljs-comment">//è¾“å…¥è½¬å¤§ç«¯</span><br>  v17 = v5;<br>  v18 = v7;<br>  encrypt(&amp;v17, v23);<br>  <br> <span class="hljs-comment">//æ˜æ–‡ç›¸é‚»ä¸¤å››ä¸ªå­—èŠ‚è¿›è¡ŒåŠ å¯†ï¼Œå¹¶è½¬æˆå¤§ç«¯çš„intå‹ï¼Œkeyæ˜¯å›ºå®šçš„</span><br><span class="hljs-function"><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> *__fastcall <span class="hljs-title">encrypt</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> *result, _DWORD *a2)</span></span><br><span class="hljs-function"></span>{<br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> v2; <span class="hljs-comment">// [sp+Ch] [bp+Ch]</span><br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> v3; <span class="hljs-comment">// [sp+10h] [bp+10h]</span><br>  <span class="hljs-keyword">int</span> v4; <span class="hljs-comment">// [sp+14h] [bp+14h]</span><br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> i; <span class="hljs-comment">// [sp+18h] [bp+18h]</span><br><br>  v2 = *result;<br>  v3 = result[<span class="hljs-number">1</span>];<br>  v4 = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">0x3F</span>; ++i )<br>  {<br>    v4 -= <span class="hljs-number">559038737</span>;<br>    v2 += (a2[<span class="hljs-number">1</span>] + (v3 &gt;&gt; <span class="hljs-number">5</span>)) ^ (<span class="hljs-number">16</span> * v3 + *a2) ^ (v4 + v3);<br>    v3 += (a2[<span class="hljs-number">3</span>] + (v2 &gt;&gt; <span class="hljs-number">5</span>)) ^ (<span class="hljs-number">16</span> * v2 + a2[<span class="hljs-number">2</span>]) ^ (v4 + v2);<br>  }<br>  *result = v2;<br>  result[<span class="hljs-number">1</span>] = v3;<br>  <span class="hljs-keyword">return</span> result;<br>}<br></code></pre></td></tr></tbody></table></figure><p>exp:</p><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;iostream&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">tea_decode</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>* s, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>* key)</span> </span>{<br><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> v0 = s[<span class="hljs-number">0</span>];<br><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> v1 = s[<span class="hljs-number">1</span>];<br><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> defalt = <span class="hljs-number">0x21524111</span>;<br><span class="hljs-keyword">int</span> sum = <span class="hljs-number">0</span>;<br>    <br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">0x3F</span>; i++)<br>sum -= defalt;<br><br><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> k0 = key[<span class="hljs-number">0</span>], k1 = key[<span class="hljs-number">1</span>], k2 = key[<span class="hljs-number">2</span>], k3 = key[<span class="hljs-number">3</span>];<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">0x3f</span>; i++) {<br>v1 -= (k3 + (v0 &gt;&gt; <span class="hljs-number">5</span>)) ^ ((v0 &lt;&lt; <span class="hljs-number">4</span>) + k2) ^ (sum + v0);<br>v0 -= (k1 + (v1 &gt;&gt; <span class="hljs-number">5</span>)) ^ ((v1 &lt;&lt; <span class="hljs-number">4</span>) + k0) ^ (sum + v1);<br>sum += defalt;<br>}<br>s[<span class="hljs-number">0</span>] = v0;<br>s[<span class="hljs-number">1</span>] = v1;<br>cout &lt;&lt; s[<span class="hljs-number">0</span>] &lt;&lt; <span class="hljs-string">","</span> &lt;&lt; s[<span class="hljs-number">1</span>] &lt;&lt; <span class="hljs-string">","</span>;<br>}<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{<br><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> key[<span class="hljs-number">4</span>] = { <span class="hljs-number">222</span>,<span class="hljs-number">173</span>,<span class="hljs-number">190</span>,<span class="hljs-number">239</span> };<br><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> enc[<span class="hljs-number">6</span>] = { <span class="hljs-number">0xD5AF0608</span>,<span class="hljs-number">0x361EF340</span>,<span class="hljs-number">0xB55D7042</span>,<span class="hljs-number">0xB460532B</span>,<span class="hljs-number">0xC53FB95B</span>,<span class="hljs-number">0xCC5F1002</span> };<br><span class="hljs-built_in">tea_decode</span>(enc, key);<br><span class="hljs-built_in">tea_decode</span>(enc + <span class="hljs-number">2</span>, key);<br><span class="hljs-built_in">tea_decode</span>(enc + <span class="hljs-number">4</span>, key);<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}<br><span class="hljs-comment">/* python</span><br><span class="hljs-comment">a=[1668640116,1668572795,1382381157,1920165215,829644646,1970167677,]</span><br><span class="hljs-comment">for i in a:</span><br><span class="hljs-comment">    print(int.to_bytes(i,4,'big').decode(),end='')</span><br><span class="hljs-comment">*/</span><br><br></code></pre></td></tr></tbody></table></figure><h3 id="4ã€weak">4ã€weak</h3><p><strong>èŠ±æŒ‡ä»¤+æ•°ç‹¬</strong></p><p>èŠ±æŒ‡ä»¤å•ç‹¬å†™äº†ä¸€ä¸ªå‡½æ•°ï¼Œé€šè¿‡ä¿®æ”¹EIPæ¥è¶Šè¿‡åƒåœ¾ä»£ç ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c">.text:<span class="hljs-number">00000000000013</span>EA junk            proc near               ; CODE XREF: .text:<span class="hljs-number">000000000000123</span>Aâ†‘p<br>.text:<span class="hljs-number">00000000000013</span>EA                 pop     rax<br>.text:<span class="hljs-number">00000000000013</span>EB                 add     rax, <span class="hljs-number">5</span><br>.text:<span class="hljs-number">00000000000013</span>EF                 push    rax<br>.text:<span class="hljs-number">00000000000013F</span>0                 retn<br>.text:<span class="hljs-number">00000000000013F</span>0 junk            endp<br></code></pre></td></tr></tbody></table></figure><p>call ä¼špushä¸‹ä¸€æ¡æŒ‡ä»¤çš„IPï¼Œä¹‹åå¯¹IP+5ï¼Œå¹¶retnï¼Œå¯¹IPçš„å€¼å®Œæˆ+5çš„æ“ä½œã€‚<br>nopæ‰call junkä¸‹ä¸€æ¡æŒ‡ä»¤å¼€å§‹çš„5ä¸ªå­—èŠ‚å³å¯ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> __cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **argv, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **envp)</span></span><br><span class="hljs-function"></span>{<br>  <span class="hljs-keyword">int</span> v3; <span class="hljs-comment">// eax</span><br>  <span class="hljs-keyword">int</span> v5; <span class="hljs-comment">// eax</span><br>  <span class="hljs-keyword">int</span> v6; <span class="hljs-comment">// [rsp+4h] [rbp-7Ch]</span><br>  <span class="hljs-keyword">unsigned</span> __int64 i; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  <span class="hljs-keyword">unsigned</span> __int64 j; <span class="hljs-comment">// [rsp+10h] [rbp-70h]</span><br>  <span class="hljs-keyword">unsigned</span> __int64 k; <span class="hljs-comment">// [rsp+18h] [rbp-68h]</span><br>  <span class="hljs-keyword">unsigned</span> __int64 m; <span class="hljs-comment">// [rsp+20h] [rbp-60h]</span><br>  <span class="hljs-keyword">unsigned</span> __int64 n; <span class="hljs-comment">// [rsp+28h] [rbp-58h]</span><br>  <span class="hljs-keyword">unsigned</span> __int64 ii; <span class="hljs-comment">// [rsp+30h] [rbp-50h]</span><br>  <span class="hljs-keyword">unsigned</span> __int64 jj; <span class="hljs-comment">// [rsp+38h] [rbp-48h]</span><br>  __int64 v14; <span class="hljs-comment">// [rsp+40h] [rbp-40h]</span><br>  __int64 v15; <span class="hljs-comment">// [rsp+48h] [rbp-38h]</span><br>  __int64 v16; <span class="hljs-comment">// [rsp+50h] [rbp-30h]</span><br>  __int64 v17[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [rsp+60h] [rbp-20h] BYREF</span><br><br>  v17[<span class="hljs-number">3</span>] = __readfsqword(<span class="hljs-number">0x28</span>u);<br>  v17[<span class="hljs-number">0</span>] = <span class="hljs-number">0LL</span>;<br>  v17[<span class="hljs-number">1</span>] = <span class="hljs-number">0LL</span>;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"your flag?"</span>);<br>  __isoc99_scanf(<span class="hljs-string">"%s"</span>, v17);<br>  v6 = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0LL</span>; i &lt;= <span class="hljs-number">0x23</span>; ++i )<br>  {<br>    <span class="hljs-keyword">if</span> ( !numbers[i] )<br>      numbers[i] = *((_BYTE *)v17 + v6++) - <span class="hljs-number">48</span>;<br>  }<br>  junk();<br>  <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0LL</span>; j &lt;= <span class="hljs-number">5</span>; ++j )<br>  {<br>    v14 = <span class="hljs-number">0LL</span>;<br>    v15 = <span class="hljs-number">0LL</span>;<br>    v16 = <span class="hljs-number">0LL</span>;<br>    <span class="hljs-keyword">for</span> ( k = <span class="hljs-number">0LL</span>; k &lt;= <span class="hljs-number">5</span>; ++k )<br>    {<br>      v3 = numbers[<span class="hljs-number">6</span> * j + k] - <span class="hljs-number">1</span>;<br>      ++*((_DWORD *)&amp;v14 + v3);<span class="hljs-comment">//è¦æ±‚v3 0-5 å³æ•°ç»„æ¯è¡Œä¸º1-6</span><br>    }<br>    <span class="hljs-keyword">for</span> ( m = <span class="hljs-number">0LL</span>; m &lt;= <span class="hljs-number">5</span>; ++m )<br>    {<br>      <span class="hljs-keyword">if</span> ( *((_DWORD *)&amp;v14 + m) != <span class="hljs-number">1</span> )<br>      {<br>LABEL_12:<br>        fail();<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>      }<br>    }<br>  }<br>  junk();<br>  <span class="hljs-keyword">for</span> ( n = <span class="hljs-number">0LL</span>; n &lt;= <span class="hljs-number">5</span>; ++n )<br>  {<br>    v14 = <span class="hljs-number">0LL</span>;<br>    v15 = <span class="hljs-number">0LL</span>;<br>    v16 = <span class="hljs-number">0LL</span>;<br>    <span class="hljs-keyword">for</span> ( ii = <span class="hljs-number">0LL</span>; ii &lt;= <span class="hljs-number">5</span>; ++ii )<br>    {<br>      v5 = numbers[<span class="hljs-number">6</span> * ii + n] - <span class="hljs-number">1</span>; <span class="hljs-comment">//è¦æ±‚æ¯åˆ—1-6</span><br>      ++*((_DWORD *)&amp;v14 + v5);<br>    }<br>    <span class="hljs-keyword">for</span> ( jj = <span class="hljs-number">0LL</span>; jj &lt;= <span class="hljs-number">5</span>; ++jj )<br>    {<br>      <span class="hljs-keyword">if</span> ( *((_DWORD *)&amp;v14 + jj) != <span class="hljs-number">1</span> )<br>        <span class="hljs-keyword">goto</span> LABEL_12;<br>    }<br>  }<br>  succ();<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}<br></code></pre></td></tr></tbody></table></figure><p>6é˜¶æ•°ç‹¬ï¼Œæ•°ç‹¬å¹¶ä¸éš¾ï¼Œæ‰‹æ’¸å³å¯ã€‚</p><h3 id="5ã€gogogo">5ã€gogogo</h3><p><strong>go è¯­è¨€+è¿·å®«é—®é¢˜ 10x10é˜¶</strong><br>ä¸è¿‡IDA7.6ä¹Ÿå­˜åœ¨ä¸€äº›åç¼–è¯‘çš„é—®é¢˜</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c">v12 = fmt_Fscanln(v5, v8, v10);<br> <span class="hljs-keyword">if</span> ( !v2 )<br> {<br>   <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0LL</span>; v15[<span class="hljs-number">1</span>] &gt; i; i = v14 + <span class="hljs-number">1</span> )<br>   {<br>     v14 = i;<br>     <span class="hljs-keyword">if</span> ( !(<span class="hljs-keyword">unsigned</span> __int8)main___ptr_Maze__advance() )<br>     {<br>       v16[<span class="hljs-number">0</span>] = &amp;off_4D6200;<br>       v14 = fmt_Fprintln(v6, v9, v11, v12, v13);<br>     }<br>   }<br>   <span class="hljs-keyword">if</span> ( a11111111111010[<span class="hljs-number">11</span>] == <span class="hljs-string">'#'</span> )<br></code></pre></td></tr></tbody></table></figure><p>â€‹ æ¯”å¦‚å°†æœ€åçš„checkç»ˆç‚¹çš„ä½ç½®ï¼Œè¯†åˆ«æˆäº†ä¸€ä¸ªå¸¸é‡ä½ç½®ï¼ŒæŸ¥çœ‹æ±‡ç¼–å’ŒåŠ¨è°ƒèƒ½è§£å†³è¿™ä¸ªé”™è¯¯ã€‚</p><p>â€‹è¿·å®«è·¯å¾„ï¼Œä»ä¸‹æ ‡11(0xB)å¼€å§‹ï¼Œæ‰«åˆ°â€™#'ï¼Œçœ¼è¿‡å³å¯ã€‚ä½†è¿˜æ˜¯å‡†å¤‡å¥½ä¸€å¥—ç†Ÿæ‚‰çš„è‡ªåŠ¨åŒ–è¿·å®«è„šæœ¬ï¼Œä¸€æ—¦é‡å¤§èµ·æ¥ï¼Œæ‰‹æ’¸å°±ä¸ç°å®äº†ã€‚</p><h3 id="6ã€SimpleSMC">6ã€SimpleSMC</h3><p><strong>èŠ±æŒ‡ä»¤+åè°ƒè¯•+SMC+Blowfish</strong></p><p>â€‹é¦–å…ˆè§‚å¯Ÿmainå‡½æ•°ï¼Œç¬¬ä¸€å¥æ±‡ç¼–ä¾¿æ˜¯iretqçš„è¿”å›æŒ‡ä»¤ï¼Œæ˜¾ç„¶ç»è¿‡äº†ä¿®æ”¹ï¼Œå¯¹mainäº¤å‰å¼•ç”¨å¯ä»¥å®šä½åˆ°ä¸€å¥lea rcx, mainï¼Œå¹¶å‘ç°ä¸Šæ–¹æœ‰èŠ±æŒ‡ä»¤ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c">.text:<span class="hljs-number">0000000140003001</span> ; __unwind { <span class="hljs-comment">// __C_specific_handler</span><br>.text:<span class="hljs-number">0000000140003001</span>                 jz      <span class="hljs-keyword">short</span> near ptr loc_140003005+<span class="hljs-number">1</span><br>.text:<span class="hljs-number">0000000140003003</span>                 jnz     <span class="hljs-keyword">short</span> near ptr loc_140003005+<span class="hljs-number">1</span><br>.text:<span class="hljs-number">0000000140003005</span><br>.text:<span class="hljs-number">0000000140003005</span> loc_140003005:                          ; CODE XREF: sub_140002FF0:loc_140003001â†‘j<br>.text:<span class="hljs-number">0000000140003005</span>                                         ; sub_140002FF0+<span class="hljs-number">13</span>â†‘j<br>.text:<span class="hljs-number">0000000140003005</span>                 call    near ptr <span class="hljs-number">0</span>C9493074h<br>.text:<span class="hljs-number">000000014000300</span>A                 loope   near ptr loc_140003053+<span class="hljs-number">1</span><br></code></pre></td></tr></tbody></table></figure><p>é€šè¿‡jz å’Œ jnz è¿ç”¨å®ç°è·³è½¬ï¼Œnopæ‰loc_140003005å¤„çš„ç¬¬ä¸€ä¸ªå­—èŠ‚å³å¯ã€‚</p><p><img src="https://res.cloudinary.com/lu1u/image/upload/v1637039417/blog_img/1_ukikcx.png" alt=""></p><p>é€šè¿‡ä¸NTæœ‰å…³çš„APIè°ƒç”¨ï¼Œç±»ä¼¼ä¸€ç§åè°ƒè¯•æ‰‹æ®µï¼Œä¸è¿‡æ­¤å¤„ä¹Ÿæ²¡å‘ç°å¯¹mainå‡½æ•°æœ‰å…³çš„å¤„ç†ï¼Œè·Ÿè¿›140003110å‡½æ•°ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c">.text:<span class="hljs-number">0000000140003110</span> sub_140003110   proc near               ; CODE XREF: sub_140002FF0:loc_140003073â†‘p<br>.text:<span class="hljs-number">0000000140003110</span>                                         ; DATA XREF: .pdata:<span class="hljs-number">000000014000</span>D054â†“o<br>.text:<span class="hljs-number">0000000140003110</span><br>.text:<span class="hljs-number">0000000140003110</span> var_8           = qword ptr <span class="hljs-number">-8</span><br>.text:<span class="hljs-number">0000000140003110</span><br>.text:<span class="hljs-number">0000000140003110</span>                 pushfq<br>.text:<span class="hljs-number">0000000140003111</span>                 <span class="hljs-keyword">or</span>      [rsp+<span class="hljs-number">8</span>+var_8], <span class="hljs-number">100</span>h<br>.text:<span class="hljs-number">0000000140003119</span>                 popfq<br>.text:<span class="hljs-number">000000014000311</span>A                 retn<br>.text:<span class="hljs-number">000000014000311</span>A sub_140003110   endp<br></code></pre></td></tr></tbody></table></figure><p>pushfqæ˜¯å°†æ ‡å¿—å¯„å­˜å™¨çš„å€¼å…¥æ ˆï¼Œä¹‹åor 0x100è¿›è¡Œä¿®æ”¹ï¼Œå°†TFæ ‡å¿—ä½ç½®1ï¼Œæ¶‰åŠåˆ°ä¸€ä¸ªåè°ƒè¯•ã€‚</p><p>â€‹<strong>é€šè¿‡å°†é™·é˜±æ ‡å¿—ä½TFç½®1å¯¼è‡´è§¦å‘å•æ­¥æ‰§è¡Œå¼‚å¸¸ï¼ˆè§¦å‘åä¼šç½®0ï¼‰ï¼Œè€Œæˆ‘ä»¬äº‹å…ˆè®¾ç½®å¥½çš„å¼‚å¸¸å¤„ç†å‡½æ•°ä¼šä¿®æ”¹eipè·³åˆ°æ­£ç¡®çš„ä»£ç å¤„ï¼Œè°ƒè¯•æ—¶åˆ™ä¸ä¼šã€‚</strong></p><p>å‚è€ƒ:<a href="https://www.cnblogs.com/glodears/p/12842101.html">åè°ƒè¯•æŠ€æœ¯â€“WIndowsç¯‡ - æ·±æµ·ä¹‹ç‚ - åšå®¢å›­ (cnblogs.com)</a></p><p>åœ¨æ±‡ç¼–çª—å£èƒ½çœ‹åˆ°try å’Œ exceptï¼Œå¹¶ä¸”åœ¨except çš„ä»£ç ä¸­çœ‹åˆ°äº†å¯¹mainå‡½æ•°å¤„çš„å†…å­˜è¿›è¡Œäº†smcè‡ªä¿®æ”¹ã€‚</p><p><img src="https://res.cloudinary.com/lu1u/image/upload/v1637040466/blog_img/re_ks9zzr.png" alt=""></p><p>æ±‡ç¼–çœ‹å‡ºï¼Œä¿®æ”¹ä»£ç ä¸ºå•å­—èŠ‚å¾ªç¯å·¦ç§»ä¸‰å¼‚æˆ–0x3Fæ¢å¤ï¼Œidapyè„šæœ¬æ¢å¤å³å¯ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> idautils<br>target=<span class="hljs-number">0x0000000140001000</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0x1F50</span>):<br>    a=Byte(target+i)<br>    result=((a&lt;&lt;<span class="hljs-number">3</span>)|(a&gt;&gt;<span class="hljs-number">5</span>))^<span class="hljs-number">0x3f</span><br>    PatchByte(target+i,result&amp;<span class="hljs-number">0xff</span>)<br>    <br><span class="hljs-built_in">print</span>(<span class="hljs-string">'yes'</span>)<br></code></pre></td></tr></tbody></table></figure><p>ä¿®å¤åå¯è§idaåœ¨åç¼–è¯‘æ—¶å®šä¹‰äº†4ä¸ª256çš„intæ•°ç»„ï¼Œå¹¶ä¸”å†…å­˜ä¸­æœ‰è¿ç»­çš„18ä¸ªintã€‚</p><p><img src="https://res.cloudinary.com/lu1u/image/upload/v1637041060/blog_img/re1_bwtple.png" alt=""></p><p>hintæç¤ºä¸ºblowfishåŠ å¯†ï¼Œä¸è¿‡ä¼˜åŒ–è®©ä»£ç é¢ç›®å…¨éï¼Œä¸€æ­¥ä¸€æ­¥åˆ†ææ˜¯ä¸ªä½“åŠ›æ´»ã€‚</p><p>blowfishå‚è€ƒ:<a href="https://cloud.tencent.com/developer/article/1836650">https://cloud.tencent.com/developer/article/1836650</a></p><p>ä¸è¿‡æ˜¯é­”æ”¹æ‰äº†pç›’å’Œsç›’ï¼Œåˆå§‹åŒ–çš„ä»£ç æ˜¯æ²¡æœ‰å˜çš„ï¼Œå¯èƒ½ç»è¿‡ä¼˜åŒ–æœ‰äº›éš¾è¯»ã€‚</p><p>ä¾‹å¦‚:</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; ++i)<br>{<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">256</span>; j+=<span class="hljs-number">2</span>)<br>{<br>BlowfishEncryption(ptr, &amp;leftSide, &amp;rightSide);<br>ptr-&gt;s[i][j] = leftSide;<br>ptr-&gt;s[i][j+<span class="hljs-number">1</span>] = rightSide;<br>}<br>}<br><span class="hljs-comment">//è€ŒIDAç›´æ¥è¯†åˆ«ä¸º</span><br> <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">0x200</span>; ++i )<br>     <span class="hljs-comment">//xxxxxxx</span><br></code></pre></td></tr></tbody></table></figure><p>æ•´ä½“åŠ å¯†æµç¨‹å°±æ˜¯å…ˆç§˜é’¥åˆå§‹åŒ–ï¼Œæ­¤éƒ¨åˆ†ä¸è¾“å…¥æ— å…³ï¼Œä¹‹åè¿›è¡ŒåŠ å¯†ï¼ŒåŠ å¯†æµç¨‹ç±»ä¼¼festilè½®ï¼Œå·¦è¾¹ç­‰äºå·¦è¾¹å¼‚æˆ–p[i]ï¼Œå³è¾¹ç­‰ä¸F(å·¦)^å³ï¼Œæœ€åå†å·¦å³äº¤æ¢ã€‚ä¸€å…±å¾ªç¯16è½®ï¼Œæœ€åä¸€è½®å–æ¶ˆäº¤æ¢ï¼Œå·¦å³ä¸p[17]å’Œp[16]å¼‚æˆ–å³å¯ã€‚è§£å¯†å³é€†è¿‡ç¨‹ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">blowfish_decrypt</span><span class="hljs-params">(<span class="hljs-keyword">uint32_t</span>* L, <span class="hljs-keyword">uint32_t</span>* R)</span> </span>{<br>*L ^= P[<span class="hljs-number">17</span>];<br>*R ^= P[<span class="hljs-number">16</span>];<br>swap(L, R);<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">short</span> r = <span class="hljs-number">15</span>; r &gt;=<span class="hljs-number">0</span>; r--) {<br>*L = *L ^ f(*R);<br>*R^=P[r];<br>swap(L, R);<br>}<br>}<br></code></pre></td></tr></tbody></table></figure><p>æŒ‰ç…§å†…å­˜ä¸­çš„æ•°æ®ä¿®æ”¹å¤´æ–‡ä»¶ä¸­çš„pboxå’Œsboxï¼Œè§£å¯†çš„ä¸»ä½“ä»£ç å¦‚ä¸‹ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">"blowfish.h"</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;<br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">uint32_t</span> <span class="hljs-title">f</span><span class="hljs-params">(<span class="hljs-keyword">uint32_t</span> x)</span> </span>{<br><span class="hljs-keyword">uint32_t</span> h = S[<span class="hljs-number">0</span>][x &gt;&gt; <span class="hljs-number">24</span>] + S[<span class="hljs-number">1</span>][x &gt;&gt; <span class="hljs-number">16</span> &amp; <span class="hljs-number">0xff</span>];<br><span class="hljs-keyword">return</span> (h ^ S[<span class="hljs-number">2</span>][x &gt;&gt; <span class="hljs-number">8</span> &amp; <span class="hljs-number">0xff</span>]) + S[<span class="hljs-number">3</span>][x &amp; <span class="hljs-number">0xff</span>];<br>}<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">blowfish_encrypt</span><span class="hljs-params">(<span class="hljs-keyword">uint32_t</span>* L, <span class="hljs-keyword">uint32_t</span>* R)</span> </span>{<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">short</span> r = <span class="hljs-number">0</span>; r &lt; <span class="hljs-number">16</span>; r++) {<br><br>*L = *L ^ P[r];<br>*R = f(*L) ^ *R;<br>swap(L, R);<br>}<br>swap(L, R);<br>*R = *R ^ P[<span class="hljs-number">16</span>];<br>*L = *L ^ P[<span class="hljs-number">17</span>];<br>}<br><br><span class="hljs-comment">//void blowfish_decrypt(uint32_t* L, uint32_t* R) { // ç½‘ä¸Šä¸€èˆ¬é‡‡ç”¨çš„è§£å¯†æ–¹æ³•  æ„Ÿè§‰æœ‰ç‚¹åˆ«æ‰­</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//for (short r = 17; r &gt; 1; r--) {</span><br><span class="hljs-comment">//*L = *L ^ P[r];</span><br><span class="hljs-comment">//*R = f(*L) ^ *R;</span><br><span class="hljs-comment">//swap(L, R);</span><br><span class="hljs-comment">//}</span><br><span class="hljs-comment">//swap(L, R); </span><br><span class="hljs-comment">//*R = *R ^ P[1];</span><br><span class="hljs-comment">//*L = *L ^ P[0];</span><br><span class="hljs-comment">//}</span><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">blowfish_decrypt</span><span class="hljs-params">(<span class="hljs-keyword">uint32_t</span>* L, <span class="hljs-keyword">uint32_t</span>* R)</span> </span>{<br>*L ^= P[<span class="hljs-number">17</span>];<br>*R ^= P[<span class="hljs-number">16</span>];<br>swap(L, R);<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">short</span> r = <span class="hljs-number">15</span>; r &gt;= <span class="hljs-number">0</span>; r--) {<br>*L = *L ^ f(*R);<br>*R ^= P[r];<br>swap(L, R);<br>}<br>}<br><br><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">blowfish_init</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>* key, <span class="hljs-keyword">int</span> key_len)</span> </span>{<br><span class="hljs-comment">/* initialize P box w/ key*/</span><br><span class="hljs-keyword">uint32_t</span> k;<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">short</span> i = <span class="hljs-number">0</span>, p = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">18</span>; i++)<br>{<br>k = key[i % key_len];<br>P[i] ^= k;<br>}<br><span class="hljs-comment">/* blowfish key expansion (521 iterations) */</span><br><span class="hljs-keyword">uint32_t</span> l = <span class="hljs-number">0x00</span>, r = <span class="hljs-number">0x00</span>;<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">short</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">18</span>; i += <span class="hljs-number">2</span>)<br>{<br>blowfish_encrypt(&amp;l, &amp;r);<br>P[i] = l;<br>P[i + <span class="hljs-number">1</span>] = r;<br>}<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">short</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++) <span class="hljs-comment">//512æ¬¡</span><br>{<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">short</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">256</span>; j += <span class="hljs-number">2</span>)<br>{<br>blowfish_encrypt(&amp;l, &amp;r); S[i][j] = l;<br>S[i][j + <span class="hljs-number">1</span>] = r;<br>}<br>}<br>}<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{<br><br><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> key[<span class="hljs-number">4</span>] = { <span class="hljs-number">0x12233445</span>,<span class="hljs-number">0xDEADBEEF</span>,<span class="hljs-number">0x90223344</span>,<span class="hljs-number">0x88112243</span> };<br>blowfish_init(key, <span class="hljs-number">4</span>);<br><br><span class="hljs-keyword">uint32_t</span> enc[<span class="hljs-number">8</span>] = { <span class="hljs-number">0x7187C938</span>, <span class="hljs-number">0xCDE138C1</span>, <span class="hljs-number">0x3DBA6F8C</span>, <span class="hljs-number">0x4E68D12A</span>, <span class="hljs-number">0xA7FB22EE</span>, <span class="hljs-number">0x52E73F49</span>, <span class="hljs-number">0x81E16485</span>, <span class="hljs-number">0x753D87D7</span> };<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i += <span class="hljs-number">1</span>)<br>blowfish_decrypt(enc + <span class="hljs-number">7</span> - i, enc + i);<br><br><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">"%s"</span>, (<span class="hljs-keyword">char</span>*)enc);<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}<br></code></pre></td></tr></tbody></table></figure><p>å½“ç„¶ç§˜é’¥åˆå§‹åŒ–æ˜¯ä¸è¾“å…¥æ— å…³çš„ï¼Œé€šè¿‡åŠ¨è°ƒæ¥æ‹¿åˆ°åˆå§‹åŒ–åçš„æ‰©å±•ç›’å’Œç§˜é’¥è§£å¯†å¯èƒ½ä¼šæ›´å¿«ã€‚</p><hr><p>æœ€åï¼ŒæŸäº›äººç°åœ¨ç»ˆäºæœ‰è‡ªå·±çš„åšå®¢å•¦ï¼Œç”¨reä¸“é¡¹æ¥çºªå¿µä¸€ä¸‹ï¼Œä¹Ÿæ˜¯æœ€è¿‘é¸½äº†è€ä¹…çš„æ¯”èµ›ï¼Œç°åœ¨ç»ˆäºå®Œç»“æ’’èŠ±å’¯ï¼Œè¿˜æœ‰ä¸€å †æ¯”èµ›æœ‰å¾…å¤ç°ï¼Œè·¯é€”å°šè¿œï¼Œè¿˜è¦ç»§ç»­å‰è¡Œï¼</p>]]></content>
    
    
    <categories>
      
      <category>RE</category>
      
    </categories>
    
    
    <tags>
      
      <tag>RE</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
