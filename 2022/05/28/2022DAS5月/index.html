

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/QQå›¾ç‰‡20211218184601.jpg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Lightu&#39;s Blog">
  <meta name="keywords" content="">
  
    <meta name="description" content="DAS5æœˆåç‰¢å¤§èµ›åæ€">
<meta property="og:type" content="article">
<meta property="og:title" content="DAS_5æœˆ_å‡ºé¢˜äººæŒ‘æˆ˜èµ›">
<meta property="og:url" content="http://example.com/2022/05/28/2022DAS5%E6%9C%88/index.html">
<meta property="og:site_name" content="Lightu">
<meta property="og:description" content="DAS5æœˆåç‰¢å¤§èµ›åæ€">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/xx.png">
<meta property="article:published_time" content="2022-05-28T13:33:39.954Z">
<meta property="article:modified_time" content="2022-09-27T14:42:36.364Z">
<meta property="article:author" content="Lightu&#39;s Blog">
<meta property="article:tag" content="WER">
<meta property="article:tag" content="CEF">
<meta property="article:tag" content="LuaJIT">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/xx.png">
  
  
  <title>DAS_5æœˆ_å‡ºé¢˜äººæŒ‘æˆ˜èµ› - Lightu</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />
  


<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.14","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0,"placement":"right"},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"follow_dnt":true},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Lightu&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                é¦–é¡µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                å½’æ¡£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                åˆ†ç±»
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                æ ‡ç­¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                å…³äº
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                å‹é“¾
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/wallhaven-l3v7pr.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="DAS_5æœˆ_å‡ºé¢˜äººæŒ‘æˆ˜èµ›">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2022-05-28 21:33" pubdate>
        2022å¹´5æœˆ28æ—¥ æ™šä¸Š
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      12k å­—
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      102 åˆ†é’Ÿ
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">DAS_5æœˆ_å‡ºé¢˜äººæŒ‘æˆ˜èµ›</h1>
            
            <div class="markdown-body">
              <h1>DAS 5æœˆ</h1>
<blockquote>
<p>éš”å¤©å°±è¦è€ƒè¯•ï¼Œå•çº¯æ‘¸äº†æ‘¸ï¼Œçœ‹èƒ½å¦æ‘¸åˆ°å·¥ä½œé‡å°‘çš„ï¼Œäºæ˜¯é€‰æ‹©äº†luajitï¼Œç½‘ä¸Šçš„æ–¹æ³•å‡ ä¹å°è¯•äº†ä¸€éä¹Ÿæ²¡æœ‰è§£å†³æ–¹æ¡ˆï¼Œç‰ˆæœ¬ä¿¡æ¯æ²¡æœ‰ï¼Œluajitè‡ªå¸¦çš„åæ±‡ç¼–å°è¯•æ— æœï¼Œä½“éªŒæå·®ã€‚</p>
</blockquote>
<h2 id="wer">wer</h2>
<h3 id="æ±‚è§£">æ±‚è§£</h3>
<blockquote>
<p>bcfè™šå‡æ§åˆ¶æµï¼ŒçœŸæ­£çš„é€»è¾‘ä¸åœ¨mainï¼Œè€Œæ˜¯åœ¨æŸä¸ªå‡½æ•°å†…å¯¹è¾“å…¥è¿›è¡Œäº†è½¬å­˜ï¼Œä¹‹ååˆè¿›è¡Œäº†ç›¸å…³å¤„ç†ã€‚</p>
</blockquote>
<p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220527091239631.png" srcset="/img/loading.gif" lazyload alt="image-20220527091239631"></p>
<p>ç›´æ¥å®šä½åˆ°è¾“å…¥éƒ¨åˆ†ï¼Œè¦æ±‚è¾“å…¥ä¸º38ä½å¹¶ä¸”å°†è¾“å…¥å­˜å…¥ä¸¤ä¸ªxmmwordä¸‹ã€‚</p>
<p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220527091852751.png" srcset="/img/loading.gif" lazyload alt="image-20220527091852751"></p>
<p>è·Ÿè¿›<code>sub_1400DB50</code>,a2ä¸­å­˜æ”¾çš„æˆ‘ä»¬çš„è¾“å…¥ï¼Œå¯è§å¯¹è¾“å…¥è¿›è¡Œäº†è½¬ç§»ï¼Œä¹‹åå¯¹<code>xmmword_140035C20</code>äº¤å‰å¼•ç”¨ï¼Œå®šä½åˆ°ä¸€ä¸ªæ–°çš„å¤„ç†å‡½æ•°ã€‚</p>
<p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220527092129863.png" srcset="/img/loading.gif" lazyload alt="image-20220527092129863"></p>
<p>checké€»è¾‘ä¸º input[i]^v3[i]==102 ,å¾ªç¯32æ¬¡å¦‚æœæˆåŠŸå°±è¾“å‡ºcorrectã€‚</p>
<p><code>exp</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><pre><code class="hljs python">enc=[<span class="hljs-number">0x05</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0x55</span>, <span class="hljs-number">0x05</span>, <span class="hljs-number">0x04</span>, <span class="hljs-number">0x07</span>, <span class="hljs-number">0x5E</span>, <span class="hljs-number">0x54</span>, <span class="hljs-number">0x05</span>, <span class="hljs-number">0x07</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0x5F</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0x05</span>, <span class="hljs-number">0x55</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x54</span>, <span class="hljs-number">0x55</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0x05</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x52</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x51</span>, <span class="hljs-number">0x53</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(enc)):<br>    enc[i]^=<span class="hljs-number">102</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">b'flag{'</span>+<span class="hljs-built_in">bytes</span>(enc)+<span class="hljs-string">b'}'</span>)<br><span class="hljs-comment">#flag{ce3cba82ca6de596565c3f231ecd4675}</span><br></code></pre></td></tr></tbody></table></figure>
<blockquote>
<p>ä¸‹æ¬¡æ—¶é—´ç´§è¿˜æ˜¯è€è€å®å®æ‘¸windowsäº†ï¼Œä¸æ‘¸ä¸ç†Ÿæ‚‰çš„é¢†åŸŸã€‚ğŸ˜­ğŸ˜­ğŸ˜­</p>
</blockquote>
<h3 id="æº¯æº">æº¯æº</h3>
<p>æŸ¥é˜…<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/win32/wer/windows-error-reporting">Windows é”™è¯¯æŠ¥å‘Š - Win32 åº”ç”¨|å¾®è½¯æ–‡æ¡£ (microsoft.com)</a>å®˜æ–¹æ–‡æ¡£ï¼Œäº†è§£WERå’ŒARR(ç¨‹åºæ¢å¤å’Œé‡å¯)çš„ç›¸å…³çŸ¥è¯†ã€‚</p>
<blockquote>
<p>é”™è¯¯æŠ¥å‘ŠåŠŸèƒ½ä½¿ç”¨æˆ·èƒ½å¤Ÿé€šçŸ¥å¾®è½¯æœ‰å…³åº”ç”¨ç¨‹åºæ•…éšœã€å†…æ ¸æ•…éšœã€æ— ååº”çš„åº”ç”¨ç¨‹åºå’Œå…¶ä»–åº”ç”¨ç¨‹åºçš„å…·ä½“é—®é¢˜ã€‚å¹¶ä¸”å¯ä»¥ä½¿ç”¨åº”ç”¨ç¨‹åºæ¢å¤å’Œé‡å¯(ARR)ï¼Œä»¥ç¡®ä¿å®¢æˆ·åœ¨å…¶åº”ç”¨ç¨‹åºå´©æºƒæ—¶ä¸ä¼šä¸¢å¤±æ•°æ®ï¼Œå¹¶å…è®¸ç”¨æˆ·å¿«é€Ÿè¿”å›åˆ°ä»–ä»¬çš„ä»»åŠ¡ã€‚</p>
</blockquote>
<p>å¯¹getflagçš„ä¸»è¦å‡½æ•°è¿›è¡Œäº¤å‰å¼•ç”¨ï¼Œè§‚å¯Ÿå‡½æ•°è°ƒç”¨çš„å…³ç³»ã€‚</p>
<p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220527124229347.png" srcset="/img/loading.gif" lazyload alt="image-20220527124229347"></p>
<p><strong>é¦–å…ˆatexitæ³¨å†Œäº†ç»ˆæ­¢å‡½æ•°ï¼Œå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹æ³¨å†Œç»ˆæ­¢å‡½æ•°ï¼Œå¹¶ä¸”ä»–åœ¨ç¨‹åºç»“æŸæ—¶è°ƒç”¨ã€‚</strong></p>
<p>å¹¶ä¸”æ³¨å†Œæ˜¯åœ¨mainå‡½æ•°è¿è¡Œå‰å®Œæˆçš„ã€‚</p>
<blockquote>
<p>inittermå‡½æ•°è´Ÿè´£éå†å‡½æ•°æŒ‡é’ˆè¡¨å¹¶åˆå§‹åŒ–å®ƒä»¬çš„å†…éƒ¨æ–¹æ³•ã€‚</p>
</blockquote>
<p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220527125654996.png" srcset="/img/loading.gif" lazyload alt="image-20220527125654996"></p>
<blockquote>
<p>è¿™ä¸ªç‰¹æ€§ä¸ºå…¶èƒ½éšè—æ§åˆ¶æµï¼Œå·å¤©æ¢æ—¥ï¼Œå›¾ç©·è€ŒåŒ•ä¸è§æä¾›äº†æ”¯æ’‘ã€‚</p>
</blockquote>
<p>å…¶æ¬¡æ˜¯æ³¨å†Œäº†<strong>æ¢å¤å›è°ƒå‡½æ•°</strong></p>
<p>å¦‚æœåº”ç”¨ç¨‹åºé‡åˆ°æœªå¤„ç†çš„å¼‚å¸¸æˆ–å˜å¾—æ— å“åº”ï¼ŒWindows é”™è¯¯æŠ¥å‘Š ï¼ˆWERï¼‰ å°†è°ƒç”¨æŒ‡å®šçš„æ¢å¤å›è°ƒã€‚</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">HRESULT <span class="hljs-title">RegisterApplicationRecoveryCallback</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">  [in]           APPLICATION_RECOVERY_CALLBACK pRecoveyCallback, <span class="hljs-comment">//æ¢å¤å‡½æ•°æŒ‡é’ˆ</span></span></span><br><span class="hljs-params"><span class="hljs-function">  [in, optional] PVOID                         pvParameter,      <span class="hljs-comment">//ä¼ é€’å˜é‡çš„æŒ‡é’ˆï¼Œå¯ä¸ºç©º</span></span></span><br><span class="hljs-params"><span class="hljs-function">  [in]           DWORD                         dwPingInterval,   <span class="hljs-comment">//æ¢å¤ ping é—´éš”ï¼Œä»¥æ¯«ç§’ä¸ºå•ä½ï¼Œå¿…é¡»è¦åœ¨è¿™ä¸ªé—´éš”å†…è°ƒç”¨ApplicationRecoveryInProgresså‡½æ•°æ¥è¯´æ˜æ­£åœ¨ä¸»åŠ¨æ¢å¤ï¼Œå¦åˆ™ä¼šè¢«werç»ˆæ­¢ã€‚</span></span></span><br><span class="hljs-params"><span class="hljs-function">  [in]           DWORD                         dwFlags           <span class="hljs-comment">//ç›®å‰æ— æ„ä¹‰</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>;<br><br>ApplicationRecoveryInProgress(&amp;pbCancelled);<span class="hljs-comment">// æŒ‡ç¤ºè°ƒç”¨åº”ç”¨ç¨‹åºæ­£åœ¨ç»§ç»­æ¢å¤æ•°æ®ã€‚</span><br><br><span class="hljs-function">HRESULT <span class="hljs-title">ApplicationRecoveryInProgress</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">  [out] PBOOL pbCancelled    <span class="hljs-comment">//ç”¨æˆ·æ˜¯å¦å–æ¶ˆæ¢å¤ï¼Œç”±werè®¾ç½® ;å–æ¶ˆæ¢å¤/æ¢å¤å®Œæˆæ—¶ pbCancelledä¸º1</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">ApplicationRecoveryFinished</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">  [in] BOOL bSuccess          <span class="hljs-comment">//æ¢å¤æˆåŠŸè¾“å…¥ä¸º1 ä¸æˆåŠŸä¸º0</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>;<br><br></code></pre></td></tr></tbody></table></figure>
<p><code>æ³¨å†Œå‡½æ•°</code></p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> __fastcall <span class="hljs-title">sub_14000F4A0</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>{<br>  HWND ForegroundWindow; <span class="hljs-comment">// rax</span><br><br>  ForegroundWindow = GetForegroundWindow();     <span class="hljs-comment">//æ£€ç´¢å‰å°çª—å£çš„å¥æŸ„ï¼ˆç”¨æˆ·å½“å‰æ­£åœ¨ä½¿ç”¨çš„çª—å£ï¼‰</span><br>  WerReportHang(ForegroundWindow, <span class="hljs-number">0</span>i64);        <span class="hljs-comment">// werå‡½æ•°ï¼Œåœ¨æŒ‡å®šçš„çª—å£ä¸Šå¯åŠ¨â€œæ— å“åº”â€æŠ¥å‘Šã€‚</span><br>  sub_14000F490(); <span class="hljs-comment">//æ²¡æœ‰æ‰§è¡Œåˆ° è¿›ç¨‹å°±ç»“æŸäº†</span><br>}<br><br>.text:<span class="hljs-number">000000014000F</span>490 sub_14000F490   proc near               ; CODE XREF: sub_14000F4A0+<span class="hljs-number">19</span>â†“j<br>.text:<span class="hljs-number">000000014000F</span>490                                         ; DATA XREF: .pdata:<span class="hljs-number">0000000140036894</span>â†“o<br>.text:<span class="hljs-number">000000014000F</span>490 ; __unwind { <span class="hljs-comment">// sub_140010E50</span><br>.text:<span class="hljs-number">000000014000F</span>490                 <span class="hljs-keyword">xor</span>     ecx, ecx<br>.text:<span class="hljs-number">000000014000F</span>492                 mov     eax, <span class="hljs-number">61</span>h ; <span class="hljs-string">'a'</span><br>.text:<span class="hljs-number">000000014000F</span>497                 mov     [rcx], ax    <span class="hljs-comment">//å†…å­˜åœ°å€0æ˜¯æœªåˆ†é…çš„åŒºåŸŸ ä¼šå¼•å‘å†…å­˜è®¿é—®å¼‚å¸¸</span><br>.text:<span class="hljs-number">000000014000F</span>49A                 retn<br>.text:<span class="hljs-number">000000014000F</span>49A ; } <span class="hljs-comment">// starts at 14000F490</span><br>.text:<span class="hljs-number">000000014000F</span>49A sub_14000F490   endp<br><br></code></pre></td></tr></tbody></table></figure>
<blockquote>
<p>å› ä¸ºWindowsä¼šè‡ªåŠ¨æŠ¥å‘Šæœªå¤„ç†çš„å¼‚å¸¸ï¼Œåº”ç”¨ç¨‹åºä¸åº”è¯¥å¤„ç†è‡´å‘½çš„å¼‚å¸¸ã€‚</p>
<p>å¦‚æœå‡ºç°æ•…éšœæˆ–ä¸å“åº”çš„è¿›ç¨‹æ˜¯äº¤äº’å¼çš„ï¼ŒWERä¼šæ˜¾ç¤ºä¸€ä¸ªç”¨æˆ·ç•Œé¢ï¼Œå‘ŠçŸ¥ç”¨æˆ·è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>å¦‚æœåœ¨ç”¨æˆ·è¯•å›¾ä¸åº”ç”¨ç¨‹åºè¿›è¡Œäº¤äº’æ—¶ï¼Œåº”ç”¨ç¨‹åºåœ¨äº”ç§’é’Ÿå†…ä¸å“åº”Windowsæ¶ˆæ¯ï¼Œåˆ™è¢«è®¤ä¸ºæ˜¯æ— å“åº”çš„ã€‚</p>
</blockquote>
<p>å› ä¸ºæˆ‘ä»¬<code>WerReportHang</code>å¯åŠ¨äº†"æ— å“åº”"æŠ¥å‘Šï¼ŒWERä¼šæœ‰ç¨‹åºæœªå“åº”çš„å¼‚å¸¸ï¼Œåœ¨å¼‚å¸¸é€€å‡ºä¹‹å‰ï¼Œè°ƒç”¨æ¢å¤å›è°ƒã€‚</p>
<ol>
<li>ä½¿ç”¨æ¢å¤å›è°ƒå°è¯•åœ¨åº”ç”¨ç¨‹åºç»ˆæ­¢ä¹‹å‰ä¿å­˜æ•°æ®å’ŒçŠ¶æ€ä¿¡æ¯ã€‚ ç„¶åï¼Œå¯ä»¥åœ¨é‡å¯åº”ç”¨ç¨‹åºæ—¶ä½¿ç”¨ä¿å­˜çš„æ•°æ®å’ŒçŠ¶æ€ä¿¡æ¯ã€‚</li>
<li>æ— å“åº”æŠ¥å‘Šå®Œæˆåï¼Œå®ƒå°†ç»ˆæ­¢åˆ›å»ºçª—å£çš„è¿›ç¨‹ã€‚è¿™ä¹Ÿæ˜¯è°ƒè¯•åˆ°è¿™ä¸€æ­¥ä¼šæŒ‚æ‰çš„åŸå› ã€‚</li>
</ol>
<p>æ•´ä½“æµç¨‹:  æ³¨å†Œç»ˆæ­¢å‡½æ•°/æ¢å¤å‡½æ•°  -&gt; main(è™šå‡æ§åˆ¶æµç»“æŸ) -&gt; ç»ˆæ­¢å‡½æ•° -&gt; å½“å‰çª—å£å¯åŠ¨"æ— å“åº”"æŠ¥å‘Š -&gt; è§¦å‘å¼‚å¸¸ -&gt; æ¢å¤å‡½æ•°ã€‚</p>
<h2 id="CEF">CEF</h2>
<h3 id="æ±‚è§£-2">æ±‚è§£</h3>
<blockquote>
<p>ç¨‹åºçš„ä¾èµ–æœ‰ç‚¹å¤šï¼Œå½“æ—¶å­˜ä¸‹æ–‡ä»¶å°±æ²¡ç»†çœ‹ï¼Œåæ¥çœ‹ç¾¤#REtardå¸ˆå‚…å‘äº†ä¸€å¼ å›¾ï¼Œçœ‹ç€æœ‰ç‚¹ç†Ÿæ‚‰çš„sm4ï¼Œç»ˆäºè¿˜æ˜¯å¯¹ä»–ä¸‹æ‰‹äº†ã€‚</p>
</blockquote>
<p>è¿è¡Œç¨‹åºï¼Œä¼šæœ‰ä¸€æ®µæŠ¥é”™ï¼Œä¸è¿‡å¯ä»¥æ ¹æ®è¿™ä¸ªæ˜æ–‡ä¿¡æ¯è¿›è¡Œæœç´¢ã€‚</p>
<p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220527201157512.png" srcset="/img/loading.gif" lazyload alt="image-20220527201157512"></p>
<p>æŸ¥çœ‹stringsçª—å£ï¼Œäº¤å‰å¼•ç”¨<code>please input your flag</code>å¾—åˆ°çš„ä»£ç é€»è¾‘échecké€»è¾‘ï¼Œåº”è¯¥æ˜¯åœ¨æ³¨å†Œçª—å£ã€‚</p>
<p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220527201315343.png" srcset="/img/loading.gif" lazyload alt="image-20220527201315343"></p>
<p>å¯ä»¥åœ¨æ•°æ®æ®µå¯¹å…¶ä»–å¯ç–‘çš„æ•°æ®è¿›è¡Œäº¤å‰å¼•ç”¨ï¼Œå°¤å…¶æ˜¯é•¿åº¦ä¸º32ä½çš„(ç»å…¸flag len)ï¼Œæˆ–è€…æ˜¯åŠ å¯†é€»è¾‘ä¸­éœ€è¦ç”¨çš„æ•°æ®è¡¨ã€‚</p>
<p>å¯ä»¥é€šè¿‡äº¤å‰å¼•ç”¨å®šä½åˆ°<code>sub_44F360</code>å‡½æ•°ï¼Œå…¶ä¸­ä¸€äº›æ˜¾ç¤ºæ˜æ–‡æœ‰å¼‚æˆ–è§£å¯†å¾—åˆ°ã€‚</p>
<p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220527202145352.png" srcset="/img/loading.gif" lazyload alt="image-20220527202145352"></p>
<p>è§£å¯†å¯å¾—document.write(â€˜%câ€™); å¹¶ä¸”ä¹‹åå…¶ä»–å­—ç¬¦å¯å¾—alert(â€˜Correctâ€™)ã€‚</p>
<blockquote>
<p>ğŸ˜€ğŸ˜€ğŸ˜€ï¼Œé€šè¿‡è§£å¯†å‡ºçš„ä¸€äº›æ˜æ–‡å­—ç¬¦å’ŒåŠ å¯†é€»è¾‘èµ°å‘ç¡®å®šè¯¥å¤„æ˜¯å…³é”®checkç‚¹ã€‚</p>
</blockquote>
<p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220527202548836.png" srcset="/img/loading.gif" lazyload alt="image-20220527202548836"></p>
<p>è¿™æ­¥é€»è¾‘æ²¡æœ‰æ¶‰åŠè¾“å…¥ï¼Œå¦‚æœæœ‰äº†è§£è¿‡<a target="_blank" rel="noopener" href="https://github.com/smallboyZ/Reverse_Crypto/blob/main/SM4/sm4.c">SM4 - mygithub</a>åŠ å¯†çš„è¯ï¼Œå¯ä»¥çœ‹å‡ºä»–å¤§è‡´ä¸ºç§˜é’¥æ‰©å±•çš„è¿‡ç¨‹ï¼Œç”±TKç”ŸæˆCK(è½®ç§˜é’¥)ï¼Œä¸è¿‡è¿›è¡Œäº†ç®€åŒ–æ²¡æœ‰sboxçš„æ›¿æ¢è¿‡ç¨‹ã€‚</p>
<blockquote>
<p>å¹¶ä¸”å‡ºé¢˜äººå¯¹ç»†èŠ‚å¤„ç†æ¯”è¾ƒå¥½ï¼Œå¯¹ç©ºé—´è¿›è¡Œäº†ä¼˜åŒ–ï¼Œé€šè¿‡æ¨¡è¿ç®—æ¥ä½¿è½®ç§˜é’¥çš„ç”Ÿæˆæ›´èŠ‚çœç©ºé—´ã€‚</p>
</blockquote>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sm4_exkey</span><span class="hljs-params">(<span class="hljs-keyword">uint32_t</span>*mkey)</span> </span>{<br>    <span class="hljs-keyword">int</span> i;<br><br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++) { <span class="hljs-comment">//åˆå§‹ç§˜é’¥å¼‚æˆ–FK</span><br>        mkey[i] ^= FK[i];<br>    }<br><br>    rK = (<span class="hljs-keyword">uint32_t</span>*)(mkey + <span class="hljs-number">4</span>);<br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++) {<br>        <span class="hljs-keyword">uint32_t</span> tmp = mkey[i + <span class="hljs-number">1</span>] ^ mkey[i + <span class="hljs-number">2</span>] ^ mkey[i + <span class="hljs-number">3</span>] ^ CK[i];<br>        sbox_replace(&amp;tmp);      <br>        rK[i]=mkey[i]^L2(tmp);<br>    } <br>}<br></code></pre></td></tr></tbody></table></figure>
<p>pythonæ¨¡æ‹Ÿå®ç°å¦‚ä¸‹</p>
<blockquote>
<p>å‘½åå¯èƒ½æœ‰äº›å·®å¼‚ï¼Œä¸»è¦æ˜¯åŠ å¯†æµç¨‹ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rol</span>(<span class="hljs-params">n,x</span>):</span><br>    <span class="hljs-keyword">return</span> (n&lt;&lt;x | n&gt;&gt;(<span class="hljs-number">32</span>-x))&amp;<span class="hljs-number">0xffffffff</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">ror</span>(<span class="hljs-params">n,x</span>):</span><br>    <span class="hljs-keyword">return</span> (n&gt;&gt;x | n&lt;&lt;(<span class="hljs-number">32</span>-x))&amp;<span class="hljs-number">0xffffffff</span><br><br><br>x=[<span class="hljs-number">0xA3B1BAC6</span>, <span class="hljs-number">0x56AA3350</span>, <span class="hljs-number">0x677D9197</span>, <span class="hljs-number">0xB27022DC</span>]<br>s=[<span class="hljs-number">0x12345678</span>, <span class="hljs-number">0x90ABCDEF</span>, <span class="hljs-number">0xFEDCBA09</span>, <span class="hljs-number">0x87654321</span>]<br>block=[x[i]^s[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>)]<br><br>tb=[<span class="hljs-number">0x00070E15</span>, <span class="hljs-number">0x1C232A31</span>, <span class="hljs-number">0x383F464D</span>, <span class="hljs-number">0x545B6269</span>, <span class="hljs-number">0x70777E85</span>, <span class="hljs-number">0x8C939AA1</span>, <span class="hljs-number">0xA8AFB6BD</span>, <span class="hljs-number">0xC4CBD2D9</span>, <span class="hljs-number">0xE0E7EEF5</span>, <span class="hljs-number">0xFC030A11</span>, <span class="hljs-number">0x181F262D</span>, <span class="hljs-number">0x343B4249</span>, <span class="hljs-number">0x50575E65</span>, <span class="hljs-number">0x6C737A81</span>, <span class="hljs-number">0x888F969D</span>, <span class="hljs-number">0xA4ABB2B9</span>, <span class="hljs-number">0xC0C7CED5</span>, <span class="hljs-number">0xDCE3EAF1</span>, <span class="hljs-number">0xF8FF060D</span>, <span class="hljs-number">0x141B2229</span>, <span class="hljs-number">0x30373E45</span>, <span class="hljs-number">0x4C535A61</span>, <span class="hljs-number">0x686F767D</span>, <span class="hljs-number">0x848B9299</span>, <span class="hljs-number">0xA0A7AEB5</span>, <span class="hljs-number">0xBCC3CAD1</span>, <span class="hljs-number">0xD8DFE6ED</span>, <span class="hljs-number">0xF4FB0209</span>, <span class="hljs-number">0x10171E25</span>, <span class="hljs-number">0x2C333A41</span>, <span class="hljs-number">0x484F565D</span>, <span class="hljs-number">0x646B7279</span>] <span class="hljs-comment">#å…¶å®è¿™æ˜¯SM4æ ‡å‡†çš„CK</span><br><br>ck=[]<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>):<br>    v11=tb[i]^block[(i+<span class="hljs-number">1</span>)%<span class="hljs-number">4</span>]^block[(i+<span class="hljs-number">2</span>)%<span class="hljs-number">4</span>]^block[(i+<span class="hljs-number">3</span>)%<span class="hljs-number">4</span>]<br>    t=v11^ror(v11,<span class="hljs-number">9</span>)^rol(v11,<span class="hljs-number">13</span>)<br>    block[i%<span class="hljs-number">4</span>]=block[i%<span class="hljs-number">4</span>]^t<br>    ck.append(block[i%<span class="hljs-number">4</span>])<br></code></pre></td></tr></tbody></table></figure>
<p>ä¹‹åå¯ä»¥è§‚å¯Ÿåˆ°è°ƒç”¨äº†CK_table,å¹¶ä¸”å°†è¾“å…¥4ä¸ªä¸€ç»„è½¬ä¸ºDWORDç±»å‹ï¼Œä¹‹åè°ƒç”¨<code>sub_4520E0</code>è¿›è¡ŒåŠ å¯†ã€‚</p>
<p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220527204027178.png" srcset="/img/loading.gif" lazyload alt="image-20220527204027178"></p>
<p><code>sub_4520E0</code>å‡½æ•°åŠ å¯†ä¸»ä½“å¦‚ä¸‹</p>
<p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220527204401527.png" srcset="/img/loading.gif" lazyload alt="image-20220527204401527"></p>
<p>è¿‡ç¨‹ä¸ç§˜é’¥æ‰©å±•ç±»ä¼¼ã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">mstr=[<span class="hljs-number">0</span>]*<span class="hljs-number">32</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>):<br>    v3=ck[i]^mstr[(i+<span class="hljs-number">1</span>)%<span class="hljs-number">4</span>]^mstr[(i+<span class="hljs-number">2</span>)%<span class="hljs-number">4</span>]^mstr[(i+<span class="hljs-number">3</span>)%<span class="hljs-number">4</span>]<br>    t=v3^rol(v3,<span class="hljs-number">2</span>)^ror(v3,<span class="hljs-number">8</span>)^rol(v3,<span class="hljs-number">10</span>)^ror(v3,<span class="hljs-number">14</span>)<br>    mstr[i%<span class="hljs-number">4</span>]=mstr[i%<span class="hljs-number">4</span>]^t<br></code></pre></td></tr></tbody></table></figure>
<p>ä¹‹åå†èµ‹å€¼æ—¶ï¼ŒBlock[0-3] åˆ†åˆ«å¯¹åº” v42ã€v41ã€v40ã€v39ï¼Œä¹‹åå­˜åˆ°CK[5]å¼€å§‹çš„åœ°å€ï¼Œæ‰€ä»¥åœ¨äºŒè½®è§£å¯†æ—¶ckçš„4ä¸ªæ•°æ®è¢«æ›¿æ¢ã€‚</p>
<p>ç»¼ä¸Šï¼Œè§£å¯†æµç¨‹å¦‚ä¸‹ã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rol</span>(<span class="hljs-params">n,x</span>):</span><br>    <span class="hljs-keyword">return</span> (n&lt;&lt;x | n&gt;&gt;(<span class="hljs-number">32</span>-x))&amp;<span class="hljs-number">0xffffffff</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">ror</span>(<span class="hljs-params">n,x</span>):</span><br>    <span class="hljs-keyword">return</span> (n&gt;&gt;x | n&lt;&lt;(<span class="hljs-number">32</span>-x))&amp;<span class="hljs-number">0xffffffff</span><br><br><br>x=[<span class="hljs-number">0xA3B1BAC6</span>, <span class="hljs-number">0x56AA3350</span>, <span class="hljs-number">0x677D9197</span>, <span class="hljs-number">0xB27022DC</span>]<br>s=[<span class="hljs-number">0x12345678</span>, <span class="hljs-number">0x90ABCDEF</span>, <span class="hljs-number">0xFEDCBA09</span>, <span class="hljs-number">0x87654321</span>]<br>block=[x[i]^s[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>)]<br><br>tb=[<span class="hljs-number">0x00070E15</span>, <span class="hljs-number">0x1C232A31</span>, <span class="hljs-number">0x383F464D</span>, <span class="hljs-number">0x545B6269</span>, <span class="hljs-number">0x70777E85</span>, <span class="hljs-number">0x8C939AA1</span>, <span class="hljs-number">0xA8AFB6BD</span>, <span class="hljs-number">0xC4CBD2D9</span>, <span class="hljs-number">0xE0E7EEF5</span>, <span class="hljs-number">0xFC030A11</span>, <span class="hljs-number">0x181F262D</span>, <span class="hljs-number">0x343B4249</span>, <span class="hljs-number">0x50575E65</span>, <span class="hljs-number">0x6C737A81</span>, <span class="hljs-number">0x888F969D</span>, <span class="hljs-number">0xA4ABB2B9</span>, <span class="hljs-number">0xC0C7CED5</span>, <span class="hljs-number">0xDCE3EAF1</span>, <span class="hljs-number">0xF8FF060D</span>, <span class="hljs-number">0x141B2229</span>, <span class="hljs-number">0x30373E45</span>, <span class="hljs-number">0x4C535A61</span>, <span class="hljs-number">0x686F767D</span>, <span class="hljs-number">0x848B9299</span>, <span class="hljs-number">0xA0A7AEB5</span>, <span class="hljs-number">0xBCC3CAD1</span>, <span class="hljs-number">0xD8DFE6ED</span>, <span class="hljs-number">0xF4FB0209</span>, <span class="hljs-number">0x10171E25</span>, <span class="hljs-number">0x2C333A41</span>, <span class="hljs-number">0x484F565D</span>, <span class="hljs-number">0x646B7279</span>]<br><br>ck=[]<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>):<br>    v11=tb[i]^block[(i+<span class="hljs-number">1</span>)%<span class="hljs-number">4</span>]^block[(i+<span class="hljs-number">2</span>)%<span class="hljs-number">4</span>]^block[(i+<span class="hljs-number">3</span>)%<span class="hljs-number">4</span>]<br>    t=v11^ror(v11,<span class="hljs-number">9</span>)^rol(v11,<span class="hljs-number">13</span>)<br>    block[i%<span class="hljs-number">4</span>]=block[i%<span class="hljs-number">4</span>]^t<br>    ck.append(block[i%<span class="hljs-number">4</span>])<br><br><span class="hljs-string">""" encry</span><br><span class="hljs-string">mstr=[0]*32</span><br><span class="hljs-string">for i in range(32):</span><br><span class="hljs-string">    v3=ck[i]^mstr[(i+1)%4]^mstr[(i+2)%4]^mstr[(i+3)%4]</span><br><span class="hljs-string">    t=v3^rol(v3,2)^ror(v3,8)^rol(v3,10)^ror(v3,14)</span><br><span class="hljs-string">    mstr[i%4]=mstr[i%4]^t</span><br><span class="hljs-string">"""</span><br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decry</span>(<span class="hljs-params">enc</span>):</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">31</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>):<br>        v3 = ck[i] ^ enc[(i + <span class="hljs-number">1</span>) % <span class="hljs-number">4</span>] ^ enc[(i + <span class="hljs-number">2</span>) % <span class="hljs-number">4</span>] ^ enc[(i + <span class="hljs-number">3</span>) % <span class="hljs-number">4</span>]<br>        t = v3 ^ rol(v3, <span class="hljs-number">2</span>) ^ ror(v3, <span class="hljs-number">8</span>) ^ rol(v3, <span class="hljs-number">10</span>) ^ ror(v3, <span class="hljs-number">14</span>)<br>        enc[i % <span class="hljs-number">4</span>] = enc[i % <span class="hljs-number">4</span>] ^ t<br><br><br>enc=[<span class="hljs-number">0xC0CB547D</span>, <span class="hljs-number">0xD7F5DB74</span>, <span class="hljs-number">0x1B92D96F</span>, <span class="hljs-number">0x204628EB</span>, <span class="hljs-number">0x60D3D5E5</span>, <span class="hljs-number">0x2F366D80</span>, <span class="hljs-number">0x612F63B0</span>, <span class="hljs-number">0x30A90F20</span>]<br>c1=enc[:<span class="hljs-number">4</span>][::-<span class="hljs-number">1</span>]<br>decry(c1)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">int</span>.to_bytes(c1[i], <span class="hljs-number">4</span>, <span class="hljs-string">'little'</span>).decode(),end=<span class="hljs-string">''</span>)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>    ck[<span class="hljs-number">5</span>+i]=enc[i]<br><br>c2=enc[<span class="hljs-number">4</span>:][::-<span class="hljs-number">1</span>]<br>decry(c2)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">int</span>.to_bytes(c2[i], <span class="hljs-number">4</span>, <span class="hljs-string">'little'</span>).decode(),end=<span class="hljs-string">''</span>)<br><span class="hljs-comment">#flag{3b2365b04700b5eac3a5fd0ba21b687f}</span><br></code></pre></td></tr></tbody></table></figure>
<p>æ˜¾ç¤ºçš„æ— æ³•æ‰“å¼€urlï¼Œå®é™…è¾“å…¥è§£å¯†çš„å­—ç¬¦å´æœ‰å›æ˜¾ã€‚</p>
<p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220527210629834.png" srcset="/img/loading.gif" lazyload alt="image-20220527210629834"></p>
<h3 id="æº¯æº-2">æº¯æº</h3>
<blockquote>
<p><code>CEF</code>æ˜¯<code>Chromium Embedded Framework</code>çš„ç¼©å†™ï¼Œå³â€œChromiumåµŒå…¥å¼æ¡†æ¶â€ï¼Œé‡‡ç”¨c++ç¼–å†™ï¼Œåœ°ä½ç±»ä¼¼äºElectronï¼Œæ˜¯webå¼€å‘åº”ç”¨ç¨‹åºçš„é‡è¦æ¡†æ¶ã€‚</p>
</blockquote>
<p>ç›®å½•ç‰¹å¾</p>
<figure class="highlight tex"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs tex">cef.pak<br>cef<span class="hljs-built_in">_</span>100<span class="hljs-built_in">_</span>percent.pak<br>cef<span class="hljs-built_in">_</span>200<span class="hljs-built_in">_</span>percent.pak<br>libcef.dll<br></code></pre></td></tr></tbody></table></figure>
<p>cefä½¿ç”¨å¤šè¿›ç¨‹ï¼Œä¸»è¿›ç¨‹ä¸º"æµè§ˆå™¨è¿›ç¨‹"ï¼Œå¹¶ä¸”ä»–å®ç°çš„åŠŸèƒ½å°±æ˜¯å°†Chromium çš„æµè§ˆå™¨åµŒå…¥åˆ°åº”ç”¨ç¨‹åºä¸­ã€‚</p>
<p>cefåº”ç”¨ç¨‹åºdemoé»˜è®¤åŠ è½½<code>google.com</code>,å½“ç„¶è¿™ä¸ªurlå¯ä»¥åˆ‡æ¢ä¸ºæœ¬åœ°æ–‡ä»¶ã€‚</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// åŠ è½½æœ¬åœ°æ–‡ä»¶â€œc:\example\example.htmlâ€ </span><br>... <br><span class="hljs-keyword">if</span> (url.empty()) <br>  url = <span class="hljs-string">"file://c:/example/example.html"</span>; <br>â€¦<br></code></pre></td></tr></tbody></table></figure>
<blockquote>
<p>æœ¬é¢˜urlè®¾ç½®çš„please input your flag å½“ç„¶æ˜¯é”™è¯¯çš„æ— æ³•åŠ è½½é¡µé¢ã€‚</p>
</blockquote>
<p>å…¥å£ç‚¹å‡½æ•°</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;windows.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"include/cef_command_line.h"</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"include/cef_sandbox_win.h"</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"tests/cefsimple/simple_app.h"</span></span><br><br><span class="hljs-comment">// When generating projects with CMake the CEF_USE_SANDBOX value will be defined</span><br><span class="hljs-comment">// automatically if using the required compiler version. Pass -DUSE_SANDBOX=OFF</span><br><span class="hljs-comment">// to the CMake command-line to disable use of the sandbox.</span><br><span class="hljs-comment">// Uncomment this line to manually enable sandbox support.</span><br><span class="hljs-comment">// #define CEF_USE_SANDBOX 1</span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> defined(CEF_USE_SANDBOX)</span><br><span class="hljs-comment">// The cef_sandbox.lib static library may not link successfully with all VS</span><br><span class="hljs-comment">// versions.</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> comment(lib, <span class="hljs-meta-string">"cef_sandbox.lib"</span>)</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br><br><span class="hljs-comment">// Entry point function for all processes.</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> APIENTRY <span class="hljs-title">wWinMain</span><span class="hljs-params">(HINSTANCE hInstance,</span></span><br><span class="hljs-params"><span class="hljs-function">                      HINSTANCE hPrevInstance,</span></span><br><span class="hljs-params"><span class="hljs-function">                      LPTSTR lpCmdLine,</span></span><br><span class="hljs-params"><span class="hljs-function">                      <span class="hljs-keyword">int</span> nCmdShow)</span> </span>{<br>  UNREFERENCED_PARAMETER(hPrevInstance);<br>  UNREFERENCED_PARAMETER(lpCmdLine);<br><br>  <span class="hljs-comment">// Enable High-DPI support on Windows 7 or newer.</span><br>  CefEnableHighDPISupport();<br><br>  <span class="hljs-keyword">void</span>* sandbox_info = <span class="hljs-literal">nullptr</span>;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> defined(CEF_USE_SANDBOX)</span><br>  <span class="hljs-comment">// Manage the life span of the sandbox information object. This is necessary</span><br>  <span class="hljs-comment">// for sandbox support on Windows. See cef_sandbox_win.h for complete details.</span><br>  CefScopedSandboxInfo scoped_sandbox;<br>  sandbox_info = scoped_sandbox.sandbox_info();<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br><br>  <span class="hljs-comment">// Provide CEF with command-line arguments.</span><br>  <span class="hljs-function">CefMainArgs <span class="hljs-title">main_args</span><span class="hljs-params">(hInstance)</span></span>;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> CEFåº”ç”¨ç¨‹åºæœ‰å¤šä¸ªå­è¿›ç¨‹ï¼ˆæ¸²æŸ“ã€GPUç­‰ï¼‰ï¼Œå…±äº«åŒä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ã€‚è¿™ä¸ªå‡½æ•°æ£€æŸ¥å‘½ä»¤è¡Œï¼Œå¦‚æœè¿™æ˜¯ä¸ª ä¸€ä¸ªå­è¿›ç¨‹ï¼Œåˆ™æ‰§è¡Œé€‚å½“çš„é€»è¾‘ã€‚</span><br><span class="hljs-comment">*/</span><br>  <span class="hljs-keyword">int</span> exit_code = CefExecuteProcess(main_args, <span class="hljs-literal">nullptr</span>, sandbox_info);<br>  <span class="hljs-keyword">if</span> (exit_code &gt;= <span class="hljs-number">0</span>) {<br>    <span class="hljs-comment">// The sub-process has completed so return here.</span><br>    <span class="hljs-keyword">return</span> exit_code;<br>  }<br><br>  <span class="hljs-comment">// Parse command-line arguments for use in this method.</span><br>  CefRefPtr&lt;CefCommandLine&gt; command_line = CefCommandLine::CreateCommandLine();<br>  command_line-&gt;InitFromString(::GetCommandLineW());<br><br>  <span class="hljs-comment">// Specify CEF global settings here.</span><br>  CefSettings settings;<br><br>  <span class="hljs-keyword">if</span> (command_line-&gt;HasSwitch(<span class="hljs-string">"enable-chrome-runtime"</span>)) {<br>    <span class="hljs-comment">// Enable experimental Chrome runtime. See issue #2969 for details.</span><br>    settings.chrome_runtime = <span class="hljs-literal">true</span>;<br>  }<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> !defined(CEF_USE_SANDBOX)</span><br>  settings.no_sandbox = <span class="hljs-literal">true</span>;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br><br>  <span class="hljs-comment">// SimpleApp implements application-level callbacks for the browser process.</span><br>  <span class="hljs-comment">/*</span><br><span class="hljs-comment">  å®ƒå°†åœ¨CEFåˆå§‹åŒ–åçš„OnContextInitialized()ä¸­åˆ›å»ºç¬¬ä¸€ä¸ªæµè§ˆå™¨å®ä¾‹ã€‚</span><br><span class="hljs-comment">  */</span><br>  <span class="hljs-function">CefRefPtr&lt;SimpleApp&gt; <span class="hljs-title">app</span><span class="hljs-params">(<span class="hljs-keyword">new</span> SimpleApp)</span></span>;<br><br>  <span class="hljs-comment">// åˆå§‹åŒ–CEF</span><br>  CefInitialize(main_args, settings, app.get(), sandbox_info);<br><br>  <span class="hljs-comment">// Run the CEF message loop. This will block until CefQuitMessageLoop() is</span><br>  <span class="hljs-comment">// called.</span><br>  CefRunMessageLoop();<br><br>  <span class="hljs-comment">// Shut down CEF.</span><br>  CefShutdown();<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}<br></code></pre></td></tr></tbody></table></figure>
<p>è‡³äºä¸€äº›å›è°ƒå‡½æ•°å’Œæ›´è¯¦ç»†çš„å®ä¾‹å¯ä»¥ç»“åˆ<a target="_blank" rel="noopener" href="https://bitbucket.org/chromiumembedded/cef/wiki/Tutorial.md">CEF-WIKI</a>æä¾›çš„demoæºç è¿›è¡Œè°ƒè¯•å’Œå­¦ä¹ ã€‚</p>
<blockquote>
<p>å¤§è‡´äº†è§£æµç¨‹ï¼Œè¿™ä¸ªæ¡†æ¶è¿˜æ˜¯æ¯”è¾ƒæœ‰è¶£çš„ï¼Œä¹‹åå¯ä»¥æ·±å…¥å­¦ä¹ ä¸€ä¸‹:)ã€‚</p>
</blockquote>
<h4 id="å°æ’æ›²">å°æ’æ›²</h4>
<p>å¯¹è§£å¯†å‡ºçš„js apiæ˜¯å¦æ„Ÿåˆ°å¼‚æˆ–ï¼Œæœç´¢CEFé€›çœ‹é›ªæ—¶æ‰åˆ°äº†å‡ºé¢˜äººçš„èº«å½±ã€‚</p>
<blockquote>
<p>ä¸è¿‡æœ¬é¢˜æ¥è¯´æ˜¯cefç›´æ¥è°ƒç”¨jsçš„ï¼Œå¹¶éé‡‡ç”¨çš„ä»¥ä¸‹æŠ€æœ¯æ‰‹æ®µã€‚</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://bbs.pediy.com/thread-268570.htm">å°†jsä»£ç æ³¨å…¥åˆ°ç¬¬ä¸‰æ–¹CEFåº”ç”¨ç¨‹åºçš„ä¸€ç‚¹æµ…è§-ç¼–ç¨‹æŠ€æœ¯-çœ‹é›ªè®ºå›-å®‰å…¨ç¤¾åŒº|å®‰å…¨æ‹›è˜|bbs.pediy.com</a></p>
<p>è¯¥æ–‡ä½œè€…æŠ“ä½CEFç¨‹åºåˆ›å»ºæµè§ˆå™¨çš„ç‰¹ç‚¹ï¼Œè¯•å›¾æ‰¾åˆ°ç”Ÿæˆçš„æµè§ˆå™¨å¯¹è±¡ï¼Œä»¥æ­¤æ¥ä»»æ„æ‰§è¡Œjsä»£ç ã€‚</p>
<blockquote>
<p>cef çš„æ ¸å¿ƒå…¨éƒ¨åœ¨libcef.dllé‡Œï¼Œæ‰€ä»¥ä»å…¶ä¸­åˆ›å»ºæµè§ˆå™¨çš„APIå…¥æ‰‹ï¼Œä¸ºäº†æ‹¿åˆ°åˆ›å»ºå‡ºçš„æµè§ˆå™¨å¯¹è±¡ã€‚</p>
</blockquote>
<p><strong>å°è¯•</strong></p>
<p>æ‰¾åˆ°åˆ›å»ºæµè§ˆå™¨çš„APIï¼Œè¿›è¡Œhookæ‹¿åˆ°æµè§ˆå™¨å¯¹è±¡ã€‚</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">cef_browser_host_create_browser</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">cef_window_info_t</span>* windowInfo,</span></span><br><span class="hljs-params"><span class="hljs-function">    struct <span class="hljs-keyword">_cef_client_t</span>* client,</span></span><br><span class="hljs-params"><span class="hljs-function">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">cef_string_t</span>* url,</span></span><br><span class="hljs-params"><span class="hljs-function">    struct <span class="hljs-keyword">_cef_browser_settings_t</span>* settings,</span></span><br><span class="hljs-params"><span class="hljs-function">    struct <span class="hljs-keyword">_cef_request_context_t</span>* request_context)</span></span>;<br></code></pre></td></tr></tbody></table></figure>
<p>è€Œè¿™ä¸ªå‡½æ•°æ˜¯å¼‚æ­¥,æ‰€ä»¥<code>cef_browser_t*</code>å­˜åœ¨äºåˆ›å»ºæˆåŠŸçš„å›è°ƒä¸­ï¼Œä½œè€…ä¹‹ååˆé€šè¿‡<code>_cef_client_t* client</code>å‚æ•°å…¥æ‰‹å»hookå›è°ƒï¼Œä½†æœ€ç»ˆä»¥å¤±è´¥å‘Šç»ˆã€‚</p>
<p>åŒæ­¥å’Œå¼‚æ­¥å¤ä¹ <a target="_blank" rel="noopener" href="https://www.cnblogs.com/IT-CPC/p/10898871.html">åŒæ­¥(Synchronous)å’Œå¼‚æ­¥(Asynchronous) - myCpC - åšå®¢å›­ (cnblogs.com)</a></p>
<p><strong>æŸ³æš—èŠ±æ˜</strong></p>
<p>å¸ˆå‚…åˆé€šè¿‡è§‚å¯Ÿlibcefçš„å…¶ä»–APIï¼Œæ‰¾åˆ°äº†çªç ´å£ã€‚</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">///</span><br><span class="hljs-comment">// Returns the current (top) context object in the V8 context stack.</span><br><span class="hljs-comment">///</span><br><span class="hljs-function">CEF_EXPORT <span class="hljs-keyword">cef_v8context_t</span>* <span class="hljs-title">cef_v8context_get_current_context</span><span class="hljs-params">()</span></span>; <span class="hljs-comment">//è¿”å›V8å¼•æ“çš„ä¸Šä¸‹æ–‡</span><br></code></pre></td></tr></tbody></table></figure>
<p>ä»‹äºV8jsä¸browseræ˜¯ç»‘å®šçš„ï¼Œæ‰€ä»¥å€ŸåŠ©v8jså¼•æ“çš„ä¸Šä¸‹æ–‡æ¥æ‹¿åˆ°browserå¯¹è±¡ã€‚</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">cef_browser_t</span>* browser = <span class="hljs-literal">NULL</span>;<br><span class="hljs-function"><span class="hljs-keyword">cef_v8context_t</span>* <span class="hljs-title">my_cef_v8context_get_current_context</span><span class="hljs-params">()</span> </span>{<br>    <span class="hljs-keyword">cef_v8context_t</span>* js_context = ori_cef_v8context_get_current_context(); <span class="hljs-comment">//è·å–V8jså¼•æ“ä¸Šä¸‹æ–‡</span><br>    Print(<span class="hljs-string">"my_cef_v8context_get_current_context js_context: %X!!\n"</span>, js_context);<br>    browser = js_context-&gt;get_browser(js_context); <span class="hljs-comment">//å¾—åˆ°æµè§ˆå™¨å¯¹è±¡!!!</span><br>    <span class="hljs-comment">//Print("[!!!] browser = %X\n", browser);</span><br>    <span class="hljs-keyword">_cef_frame_t</span>* frame = browser-&gt;get_main_frame(browser);<br>    <span class="hljs-comment">//Print("[!!!] frame = %X\n", frame);</span><br>    CefString script = payload;<br>    CefString url = xorstr(<span class="hljs-string">"app/wd"</span>).crypt_get();<br>    frame-&gt;execute_java_script(frame, script.GetStruct(), url.GetStruct(), <span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">return</span> js_context;<br>}<br><span class="hljs-comment">// write by renbohan  https://bbs.pediy.com/thread-268570.htm</span><br></code></pre></td></tr></tbody></table></figure>
<p>è‡³æ­¤ç›®çš„å·²ç»è¾¾æˆï¼Œå³æˆ‘ä»¬æˆåŠŸæ‹¿åˆ°äº†cefåˆ›å»ºå‡ºçš„æµè§ˆå™¨å¯¹è±¡ã€‚æ‰€è°“è¿‡æ²³æ‹†æ¡¥ï¼Œæ‹¿åˆ°è¯¥å¯¹è±¡åå°±å¯ä»¥éå¸¸æ–¹ä¾¿çš„æ‰§è¡Œjsä»£ç ï¼Œä»è€Œcefçš„æ‰“å·¥ç”Ÿæ¶¯ç»“æŸï¼Œjsæ‰æ˜¯checkä»£ç çš„ä¸»åœºã€‚</p>
<h2 id="LuaJit">LuaJit</h2>
<blockquote>
<p>å“¦ï¼Œå¤šä¹ˆç—›çš„é¢†æ‚Ÿ~ğŸ˜±ğŸ˜±ğŸ˜±</p>
</blockquote>
<p>æ‹¿åˆ°æ–‡ä»¶åå¯ä»¥é€šè¿‡010æ‰“å¼€ï¼Œå‘ç°æ˜¯éPEæ–‡ä»¶æ ¼å¼ï¼Œæ ¹æ®æ–‡ä»¶å¤´<code>1B 4C 4A 02</code>æœç´¢å¾—çŸ¥ä¸ºluajitç¼–è¯‘çš„æ–‡ä»¶ã€‚</p>
<p>LuaJIT ä½¿ç”¨äº†ä¸€ç§å…¨æ–°çš„æ–¹å¼æ¥ç¼–è¯‘å’Œæ‰§è¡Œ Lua è„šæœ¬ã€‚ç»è¿‡å¤„ç†åçš„ LuaJIT ç¨‹åºï¼Œå­—èŠ‚ç çš„ç¼–ç å®ç°æ›´åŠ ç®€å•ï¼Œæ‰§è¡Œæ•ˆç‡ç›¸æ¯” Lua å’Œ Luac æ›´åŠ é«˜æ•ˆã€‚</p>
<blockquote>
<p>ç›´æ¥ç™¾åº¦luajité€†å‘ï¼Œä¹‹å‰æ²¡æ¥è§¦è¿‡æ­¤ç±»é€†å‘ï¼Œæ ¼å±€å°äº†ğŸ™ƒã€‚æœ‰å¹¸ä¹‹å‰åœ¨<a target="_blank" rel="noopener" href="https://blog.shi1011.cn/rev/android/1216">ğŸŸå“¥ - Mas0n</a>åšå®¢ä¸Šçœ‹åˆ°è¿‡å‡ ç§luaçš„ä¿æŠ¤æ–¹å¼å’Œè§£å†³æ–¹æ¡ˆã€‚</p>
</blockquote>
<p>å¯ä»¥é€šè¿‡éè™«å¤§ç‰›çš„<a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/90241#h3-11">Luaç¨‹åºé€†å‘ä¹‹Luajitå­—èŠ‚ç ä¸åæ±‡ç¼–</a>äº†è§£luajitçš„opcodeç»“æ„å’Œæ–‡ä»¶æ ¼å¼ï¼Œå¹¶ä¸”æä¾›äº†010çš„<code>luajit.bt</code>çš„æ¨¡æ¿ã€‚</p>
<p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220528115928721.png" srcset="/img/loading.gif" lazyload alt="image-20220528115928721"></p>
<p>å¹¶ä¸”ä¹Ÿç›´æ¥è¿›è¡Œäº†åæ±‡ç¼–ï¼Œå½“ç„¶é˜…è¯»luajitåæ±‡ç¼–ä¹‹åçš„å­—èŠ‚ç ä¹Ÿæ˜¯ä¸€ç§æŠ˜ç£¨ï¼Œäºæ˜¯åœ¨<code>gayhub</code>ä¸Šå››å¤„æœå¯»åç¼–è¯‘çš„è½®å­ï¼Œä¸è¿‡ç»“æœéƒ½ä¸å°½äººæ„ã€‚</p>
<blockquote>
<p>æ€»ç»“: å‰è¾ˆä»¬çš„å·¥å…·å¤§å¤šä¸€è„‰ç›¸æ‰¿ï¼Œæ ¹æ®ç‰ˆæœ¬æ›´æ–°æ·»åŠ æ–°çš„opcodeï¼›åŒæ—¶åªèƒ½åç¼–è¯‘luajitç¼–è¯‘å‡º32ä½çš„æ–‡ä»¶ï¼Œå¯¹64ä½ä¸é€‚ç”¨ã€‚</p>
<p>è€Œä¸”æœ¬é¢˜æ²¡æœ‰ç»™å‡ºluajitçš„å…·ä½“ç‰ˆæœ¬ï¼Œæƒ³é‡‡ç”¨luajitåŸç”Ÿçš„åæ±‡ç¼–å·¥å…·è¿›è¡Œåæ±‡ç¼–éƒ½è¦è‡ªè¡Œæ‘¸ç´¢ç‰ˆæœ¬,ä¸»æµåº”è¯¥åœ¨2.1æˆ–2.0ğŸ˜­ã€‚</p>
</blockquote>
<p>LJDæœ€è¿‘çš„ä¸€ä¸ªé¡¹ç›®**<a target="_blank" rel="noopener" href="https://github.com/Dr-MTN/luajit-decompiler">luajit-decompiler</a>**ï¼ŒçŸ¥é“é¢˜ç›®å¯¹åº”ç‰ˆæœ¬æ‰å¯çŸ¥æ˜¯å¦éœ€è¦æ”¹opcodeï¼Œæˆ–è€…æ˜¯å·¥å…·çš„æœ‰å…³æŠ¥é”™ä¿¡æ¯ã€‚</p>
<p>åˆåœ¨å¾çˆ±ä¸Šçœ‹åˆ°ä¸€ç¯‡åšå®¢<a target="_blank" rel="noopener" href="https://www.52pojie.cn/thread-1378796-1-1.html"><strong>luajitåç¼–è¯‘ã€è§£å¯†</strong></a>,å…¶ä¸­æåˆ°äº†å¦ä¸€ç§å·¥å…·**<a target="_blank" rel="noopener" href="https://github.com/bobsayshilol/luajit-decomp"> luajit-decomp</a>**,æ­¤å·¥å…·ä½¿ç”¨èµ·æ¥åªéœ€ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„luajitå¹¶ç¼–è¯‘ï¼Œæ‹¿åˆ°å…¶ä¸­çš„<code>luajit.exe</code>ã€<code>lua51.dll</code>ã€<code>jitæ–‡ä»¶å¤¹</code>æ”¾åˆ°decompæ–‡ä»¶å¤¹ä¸‹ï¼Œè¿è¡Œjitdecompå³å¯ã€‚</p>
<ol>
<li><code>luajit-decomp\data\luajit</code>ä¸‹å­˜æ”¾å¾…åç¼–è¯‘çš„jitæ–‡ä»¶ã€‚</li>
<li>è¿è¡Œjitdecompï¼Œç»“æœä¼šåœ¨<code>luajit-decomp\data\out</code>è·¯å¾„ä¸‹ã€‚</li>
</ol>
<p>è™½ç„¶èƒ½å¯¹32/64ä½ç¼–è¯‘æ–‡ä»¶æˆåŠŸè¿›è¡Œåç¼–è¯‘ï¼Œä¸è¿‡åç¼–è¯‘åçš„ä»£ç ä¹Ÿæ¯”è¾ƒéš¾è¯»ï¼Œç›¸æ¯”è¯»å­—èŠ‚ç å¹¶æ²¡æœ‰å‡å°‘å¤ªå¤šå·¥ä½œé‡ï¼Œä¸è¿‡ä¹Ÿä¸å¤±ä¸ºä¸€ç§ä¸é”™æ–¹æ³•ã€‚</p>
<blockquote>
<p>åæ¥å’Œç¾¤å‹è®¨è®ºï¼Œ#REtardå¸ˆå‚…è¯´ç‰ˆæœ¬ä¸ºLuaJIT-2.1.0-beta3ï¼Œå¹¶ä¸”t0hkaå¸ˆå‚…archæ‹‰çš„æœ€æ–°çš„åŒ…ï¼Œç”¨å…¶è‡ªå¸¦çš„luajit -bl å³å®Œæˆäº†åæ±‡ç¼–ã€‚</p>
</blockquote>
<p>å»å®˜ç½‘ä¸‹è½½2.1.0-beta3çš„æºç ï¼Œä½¿ç”¨VSå·¥å…·åŒ…ä¸­çš„å‘½ä»¤è¡Œç¼–è¯‘å·¥å…·<code>vcvars64.bat</code>æ¥å®Œæˆç¼–è¯‘ï¼Œåœ¨Luajitæ ¹ç›®å½•ä¸‹æ‰“å¼€cmdè¾“å…¥<code>vcvars64.bat</code></p>
<p>æ–‡ä»¶è·¯å¾„ã€‚</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-string">"F:\visual studio2019\VC\Auxiliary\Build\vcvars64.bat"</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220528200018823.png" srcset="/img/loading.gif" lazyload alt="image-20220528200018823"></p>
<blockquote>
<p>åœ¨MSVC 32ä½ç¼–è¯‘ç¯å¢ƒä¸‹  msvcbuild.bat  ç¼–è¯‘32ä½</p>
<p>msvcbuild.bat gc64ç¼–è¯‘64ä½ï¼Œç¼–è¯‘64ä½åé¢ä¸€å®šè¦è·Ÿgc64, å³ä¾¿æ˜¯å¼€å¯çš„x64çš„ç¼–è¯‘å‘½ä»¤è¡Œã€‚</p>
</blockquote>
<p>ä¹‹åæˆåŠŸç¼–è¯‘å‡º<code>luajit.exe</code> å’Œ <code>lua51.dll</code>è¿™ä¸¤ä¸ªç¨‹åºï¼Œè¿™ä¹Ÿæ˜¯luajit-decompå·¥å…·å®ç°åç¼–è¯‘çš„æ”¯æ’‘ã€‚</p>
<p>åŒç›®å½•ä¸‹ç”¨è¿‡luajit.exe -bl task.jit å¯ä»¥æ˜¾ç¤ºåç¼–è¯‘åçš„å­—èŠ‚ç ã€‚</p>
<blockquote>
<p>ç»å…¸luajit.exe -h ç½—åˆ—æŒ‡ä»¤èœå•</p>
</blockquote>
<p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220528201038811.png" srcset="/img/loading.gif" lazyload alt="image-20220528201038811"></p>
<p>åç¼–è¯‘ä¸å¾—å°±æ’¸å­—èŠ‚ç ï¼Œä¸è¿‡å®˜ç½‘ç»™å‡ºçš„ä¸»è¦æ˜¯2.0ç‰ˆæœ¬çš„bytecode ï¼Œ è¯¦ç»†å¯è§<code>src/lj_bc.h</code> ã€‚</p>
<p>å¯ä»¥è‡ªå·±å†™ä¸€äº›luaä»£ç ï¼Œä¹‹åluajit -b test.lua xxx è¿›è¡Œç¼–è¯‘ä¹‹åæŸ¥çœ‹å­—èŠ‚ç å¯¹ç…§ã€‚</p>
<blockquote>
<p>æˆ–è€…ç”¨luajit-decompåç¼–è¯‘ä¸€ä¸‹ï¼Œå¯è¯»æ€§æ˜¯æœ‰ç‚¹å·®çš„ã€‚å…ˆæš‚æ—¶å‘Šä¸€æ®µè½ï¼Œä¹‹åå¡«å‘å§ï¼Œå³ä½¿æˆ‘çš„çŸ¥è¯†æ˜Ÿçƒå·²ç»è¢«æŒ–çš„å‘å‘æ´¼æ´¼å’¯!</p>
</blockquote>
<p><img src="https://blog-1309321804.cos.ap-nanjing.myqcloud.com/blog/image-20220528213003579.png" srcset="/img/loading.gif" lazyload alt="image-20220528213003579"></p>
<p>ç›¸å…³è¿æ¥:</p>
<p>LuaJitå®˜ç½‘ : <a target="_blank" rel="noopener" href="http://luajit.org/">http://luajit.org/</a>  ä¸€äº›å‚è€ƒæ–‡æ¡£å’Œç¼–è¯‘æ–¹æ³•</p>
<p><a target="_blank" rel="noopener" href="http://wiki.luajit.org/Bytecode-2.0">LuaJIT 2.0 Bytecode Instructions</a></p>
<h3 id="æ€»ç»“">æ€»ç»“</h3>
<p>çŸ¥è¯†é¢å’Œå¹¿åº¦è¿˜æ˜¯å·®äº†äº¿ç‚¹ï¼Œä¹‹å‰å¤ªå¤šé¢˜ç›®éƒ½åªæ˜¯å±€é™åœ¨è§£å¯†è¡¨é¢ï¼Œæ²¡å»æº¯æºã€‚åŒæ—¶å•çº¯è§£å¯†çš„è¯æ€è·¯è¦æ‰“å¼€ï¼Œèƒ½åœ¨æœ€çŸ­æ—¶é—´å†…å®šä½å…³é”®å¤„ç†å‡½æ•°çš„èƒ½åŠ›ååˆ†é‡è¦ï¼ŒåŒæ—¶èµ›åçš„å¤ç°å’Œæ·±å…¥å­¦ä¹ é¢˜ç›®æ¶‰åŠçš„è€ƒç‚¹ä¹Ÿæ˜¯å¿…ä¸å¯å°‘çš„éƒ¨åˆ†ã€‚ğŸ˜ƒğŸ˜ƒğŸ˜ƒ</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/CTF-WP/">CTF-WP</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/WER/">WER</a>
                    
                      <a class="hover-with-bg" href="/tags/CEF/">CEF</a>
                    
                      <a class="hover-with-bg" href="/tags/LuaJIT/">LuaJIT</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 åè®®</a> ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/04/20/NaCl-%E7%A8%8B%E5%BA%8F%E4%BF%AE%E5%A4%8D/">
                        <span class="hidden-mobile">æ¨¡æ‹Ÿæ ˆå¸§ä¿®å¤</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js" ></script>
  
  
    <script  src="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js" ></script>
  
  
    <script defer src="https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js" ></script>
  






  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
        typing(title);
      
    })(window, document);
  </script>















<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ ä¿æŒåœ¨æœ€åº•éƒ¨ -->
<script  src="/js/boot.js" ></script>


</body>
</html>
